import { Saito } from '../../apps/core';
import Peer from './peer';
import Transaction from './transaction';
import path from 'path';
import fs from 'fs';
import { fromBase58 } from 'saito-js/lib/util';

const DYN_MOD=
	"LyohIEZvciBsaWNlbnNlIGluZm9ybWF0aW9uIHBsZWFzZSBzZWUgZHluLm1vZHVsZS5qcy5MSUNFTlNFLnR4dCAqLwooKCk9Pnt2YXIgZT17NjAxOihlLHQscik9PntmdW5jdGlvbiBuKGUpe3JldHVybiBuPSJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJiJzeW1ib2wiPT10eXBlb2YgU3ltYm9sLml0ZXJhdG9yP2Z1bmN0aW9uKGUpe3JldHVybiB0eXBlb2YgZX06ZnVuY3Rpb24oZSl7cmV0dXJuIGUmJiJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJmUuY29uc3RydWN0b3I9PT1TeW1ib2wmJmUhPT1TeW1ib2wucHJvdG90eXBlPyJzeW1ib2wiOnR5cGVvZiBlfSxuKGUpfWZ1bmN0aW9uIG8oZSx0KXsobnVsbD09dHx8dD5lLmxlbmd0aCkmJih0PWUubGVuZ3RoKTtmb3IodmFyIHI9MCxuPW5ldyBBcnJheSh0KTtyPHQ7cisrKW5bcl09ZVtyXTtyZXR1cm4gbn1mdW5jdGlvbiBpKCl7InVzZSBzdHJpY3QiO2k9ZnVuY3Rpb24oKXtyZXR1cm4gdH07dmFyIGUsdD17fSxyPU9iamVjdC5wcm90b3R5cGUsbz1yLmhhc093blByb3BlcnR5LGE9T2JqZWN0LmRlZmluZVByb3BlcnR5fHxmdW5jdGlvbihlLHQscil7ZVt0XT1yLnZhbHVlfSx1PSJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2w/U3ltYm9sOnt9LHM9dS5pdGVyYXRvcnx8IkBAaXRlcmF0b3IiLGM9dS5hc3luY0l0ZXJhdG9yfHwiQEBhc3luY0l0ZXJhdG9yIixsPXUudG9TdHJpbmdUYWd8fCJAQHRvU3RyaW5nVGFnIjtmdW5jdGlvbiBmKGUsdCxyKXtyZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsdCx7dmFsdWU6cixlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pLGVbdF19dHJ5e2Yoe30sIiIpfWNhdGNoKGUpe2Y9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBlW3RdPXJ9fWZ1bmN0aW9uIGgoZSx0LHIsbil7dmFyIG89dCYmdC5wcm90b3R5cGUgaW5zdGFuY2VvZiBiP3Q6YixpPU9iamVjdC5jcmVhdGUoby5wcm90b3R5cGUpLHU9bmV3IGoobnx8W10pO3JldHVybiBhKGksIl9pbnZva2UiLHt2YWx1ZTpOKGUscix1KX0pLGl9ZnVuY3Rpb24gcChlLHQscil7dHJ5e3JldHVybnt0eXBlOiJub3JtYWwiLGFyZzplLmNhbGwodCxyKX19Y2F0Y2goZSl7cmV0dXJue3R5cGU6InRocm93Iixhcmc6ZX19fXQud3JhcD1oO3ZhciBkPSJzdXNwZW5kZWRTdGFydCIsdj0ic3VzcGVuZGVkWWllbGQiLHk9ImV4ZWN1dGluZyIsZz0iY29tcGxldGVkIixtPXt9O2Z1bmN0aW9uIGIoKXt9ZnVuY3Rpb24gdygpe31mdW5jdGlvbiBrKCl7fXZhciB4PXt9O2YoeCxzLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpO3ZhciBTPU9iamVjdC5nZXRQcm90b3R5cGVPZixBPVMmJlMoUyhDKFtdKSkpO0EmJkEhPT1yJiZvLmNhbGwoQSxzKSYmKHg9QSk7dmFyIEU9ay5wcm90b3R5cGU9Yi5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZSh4KTtmdW5jdGlvbiBPKGUpe1sibmV4dCIsInRocm93IiwicmV0dXJuIl0uZm9yRWFjaCgoZnVuY3Rpb24odCl7ZihlLHQsKGZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLl9pbnZva2UodCxlKX0pKX0pKX1mdW5jdGlvbiBfKGUsdCl7ZnVuY3Rpb24gcihpLGEsdSxzKXt2YXIgYz1wKGVbaV0sZSxhKTtpZigidGhyb3ciIT09Yy50eXBlKXt2YXIgbD1jLmFyZyxmPWwudmFsdWU7cmV0dXJuIGYmJiJvYmplY3QiPT1uKGYpJiZvLmNhbGwoZiwiX19hd2FpdCIpP3QucmVzb2x2ZShmLl9fYXdhaXQpLnRoZW4oKGZ1bmN0aW9uKGUpe3IoIm5leHQiLGUsdSxzKX0pLChmdW5jdGlvbihlKXtyKCJ0aHJvdyIsZSx1LHMpfSkpOnQucmVzb2x2ZShmKS50aGVuKChmdW5jdGlvbihlKXtsLnZhbHVlPWUsdShsKX0pLChmdW5jdGlvbihlKXtyZXR1cm4gcigidGhyb3ciLGUsdSxzKX0pKX1zKGMuYXJnKX12YXIgaTthKHRoaXMsIl9pbnZva2UiLHt2YWx1ZTpmdW5jdGlvbihlLG4pe2Z1bmN0aW9uIG8oKXtyZXR1cm4gbmV3IHQoKGZ1bmN0aW9uKHQsbyl7cihlLG4sdCxvKX0pKX1yZXR1cm4gaT1pP2kudGhlbihvLG8pOm8oKX19KX1mdW5jdGlvbiBOKHQscixuKXt2YXIgbz1kO3JldHVybiBmdW5jdGlvbihpLGEpe2lmKG89PT15KXRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpO2lmKG89PT1nKXtpZigidGhyb3ciPT09aSl0aHJvdyBhO3JldHVybnt2YWx1ZTplLGRvbmU6ITB9fWZvcihuLm1ldGhvZD1pLG4uYXJnPWE7Oyl7dmFyIHU9bi5kZWxlZ2F0ZTtpZih1KXt2YXIgcz1QKHUsbik7aWYocyl7aWYocz09PW0pY29udGludWU7cmV0dXJuIHN9fWlmKCJuZXh0Ij09PW4ubWV0aG9kKW4uc2VudD1uLl9zZW50PW4uYXJnO2Vsc2UgaWYoInRocm93Ij09PW4ubWV0aG9kKXtpZihvPT09ZCl0aHJvdyBvPWcsbi5hcmc7bi5kaXNwYXRjaEV4Y2VwdGlvbihuLmFyZyl9ZWxzZSJyZXR1cm4iPT09bi5tZXRob2QmJm4uYWJydXB0KCJyZXR1cm4iLG4uYXJnKTtvPXk7dmFyIGM9cCh0LHIsbik7aWYoIm5vcm1hbCI9PT1jLnR5cGUpe2lmKG89bi5kb25lP2c6dixjLmFyZz09PW0pY29udGludWU7cmV0dXJue3ZhbHVlOmMuYXJnLGRvbmU6bi5kb25lfX0idGhyb3ciPT09Yy50eXBlJiYobz1nLG4ubWV0aG9kPSJ0aHJvdyIsbi5hcmc9Yy5hcmcpfX19ZnVuY3Rpb24gUCh0LHIpe3ZhciBuPXIubWV0aG9kLG89dC5pdGVyYXRvcltuXTtpZihvPT09ZSlyZXR1cm4gci5kZWxlZ2F0ZT1udWxsLCJ0aHJvdyI9PT1uJiZ0Lml0ZXJhdG9yLnJldHVybiYmKHIubWV0aG9kPSJyZXR1cm4iLHIuYXJnPWUsUCh0LHIpLCJ0aHJvdyI9PT1yLm1ldGhvZCl8fCJyZXR1cm4iIT09biYmKHIubWV0aG9kPSJ0aHJvdyIsci5hcmc9bmV3IFR5cGVFcnJvcigiVGhlIGl0ZXJhdG9yIGRvZXMgbm90IHByb3ZpZGUgYSAnIituKyInIG1ldGhvZCIpKSxtO3ZhciBpPXAobyx0Lml0ZXJhdG9yLHIuYXJnKTtpZigidGhyb3ciPT09aS50eXBlKXJldHVybiByLm1ldGhvZD0idGhyb3ciLHIuYXJnPWkuYXJnLHIuZGVsZWdhdGU9bnVsbCxtO3ZhciBhPWkuYXJnO3JldHVybiBhP2EuZG9uZT8oclt0LnJlc3VsdE5hbWVdPWEudmFsdWUsci5uZXh0PXQubmV4dExvYywicmV0dXJuIiE9PXIubWV0aG9kJiYoci5tZXRob2Q9Im5leHQiLHIuYXJnPWUpLHIuZGVsZWdhdGU9bnVsbCxtKTphOihyLm1ldGhvZD0idGhyb3ciLHIuYXJnPW5ldyBUeXBlRXJyb3IoIml0ZXJhdG9yIHJlc3VsdCBpcyBub3QgYW4gb2JqZWN0Iiksci5kZWxlZ2F0ZT1udWxsLG0pfWZ1bmN0aW9uIFQoZSl7dmFyIHQ9e3RyeUxvYzplWzBdfTsxIGluIGUmJih0LmNhdGNoTG9jPWVbMV0pLDIgaW4gZSYmKHQuZmluYWxseUxvYz1lWzJdLHQuYWZ0ZXJMb2M9ZVszXSksdGhpcy50cnlFbnRyaWVzLnB1c2godCl9ZnVuY3Rpb24gTChlKXt2YXIgdD1lLmNvbXBsZXRpb258fHt9O3QudHlwZT0ibm9ybWFsIixkZWxldGUgdC5hcmcsZS5jb21wbGV0aW9uPXR9ZnVuY3Rpb24gaihlKXt0aGlzLnRyeUVudHJpZXM9W3t0cnlMb2M6InJvb3QifV0sZS5mb3JFYWNoKFQsdGhpcyksdGhpcy5yZXNldCghMCl9ZnVuY3Rpb24gQyh0KXtpZih0fHwiIj09PXQpe3ZhciByPXRbc107aWYocilyZXR1cm4gci5jYWxsKHQpO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiB0Lm5leHQpcmV0dXJuIHQ7aWYoIWlzTmFOKHQubGVuZ3RoKSl7dmFyIGk9LTEsYT1mdW5jdGlvbiByKCl7Zm9yKDsrK2k8dC5sZW5ndGg7KWlmKG8uY2FsbCh0LGkpKXJldHVybiByLnZhbHVlPXRbaV0sci5kb25lPSExLHI7cmV0dXJuIHIudmFsdWU9ZSxyLmRvbmU9ITAscn07cmV0dXJuIGEubmV4dD1hfX10aHJvdyBuZXcgVHlwZUVycm9yKG4odCkrIiBpcyBub3QgaXRlcmFibGUiKX1yZXR1cm4gdy5wcm90b3R5cGU9ayxhKEUsImNvbnN0cnVjdG9yIix7dmFsdWU6ayxjb25maWd1cmFibGU6ITB9KSxhKGssImNvbnN0cnVjdG9yIix7dmFsdWU6dyxjb25maWd1cmFibGU6ITB9KSx3LmRpc3BsYXlOYW1lPWYoayxsLCJHZW5lcmF0b3JGdW5jdGlvbiIpLHQuaXNHZW5lcmF0b3JGdW5jdGlvbj1mdW5jdGlvbihlKXt2YXIgdD0iZnVuY3Rpb24iPT10eXBlb2YgZSYmZS5jb25zdHJ1Y3RvcjtyZXR1cm4hIXQmJih0PT09d3x8IkdlbmVyYXRvckZ1bmN0aW9uIj09PSh0LmRpc3BsYXlOYW1lfHx0Lm5hbWUpKX0sdC5tYXJrPWZ1bmN0aW9uKGUpe3JldHVybiBPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKGUsayk6KGUuX19wcm90b19fPWssZihlLGwsIkdlbmVyYXRvckZ1bmN0aW9uIikpLGUucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoRSksZX0sdC5hd3JhcD1mdW5jdGlvbihlKXtyZXR1cm57X19hd2FpdDplfX0sTyhfLnByb3RvdHlwZSksZihfLnByb3RvdHlwZSxjLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpLHQuQXN5bmNJdGVyYXRvcj1fLHQuYXN5bmM9ZnVuY3Rpb24oZSxyLG4sbyxpKXt2b2lkIDA9PT1pJiYoaT1Qcm9taXNlKTt2YXIgYT1uZXcgXyhoKGUscixuLG8pLGkpO3JldHVybiB0LmlzR2VuZXJhdG9yRnVuY3Rpb24ocik/YTphLm5leHQoKS50aGVuKChmdW5jdGlvbihlKXtyZXR1cm4gZS5kb25lP2UudmFsdWU6YS5uZXh0KCl9KSl9LE8oRSksZihFLGwsIkdlbmVyYXRvciIpLGYoRSxzLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpLGYoRSwidG9TdHJpbmciLChmdW5jdGlvbigpe3JldHVybiJbb2JqZWN0IEdlbmVyYXRvcl0ifSkpLHQua2V5cz1mdW5jdGlvbihlKXt2YXIgdD1PYmplY3QoZSkscj1bXTtmb3IodmFyIG4gaW4gdClyLnB1c2gobik7cmV0dXJuIHIucmV2ZXJzZSgpLGZ1bmN0aW9uIGUoKXtmb3IoO3IubGVuZ3RoOyl7dmFyIG49ci5wb3AoKTtpZihuIGluIHQpcmV0dXJuIGUudmFsdWU9bixlLmRvbmU9ITEsZX1yZXR1cm4gZS5kb25lPSEwLGV9fSx0LnZhbHVlcz1DLGoucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjpqLHJlc2V0OmZ1bmN0aW9uKHQpe2lmKHRoaXMucHJldj0wLHRoaXMubmV4dD0wLHRoaXMuc2VudD10aGlzLl9zZW50PWUsdGhpcy5kb25lPSExLHRoaXMuZGVsZWdhdGU9bnVsbCx0aGlzLm1ldGhvZD0ibmV4dCIsdGhpcy5hcmc9ZSx0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChMKSwhdClmb3IodmFyIHIgaW4gdGhpcykidCI9PT1yLmNoYXJBdCgwKSYmby5jYWxsKHRoaXMscikmJiFpc05hTigrci5zbGljZSgxKSkmJih0aGlzW3JdPWUpfSxzdG9wOmZ1bmN0aW9uKCl7dGhpcy5kb25lPSEwO3ZhciBlPXRoaXMudHJ5RW50cmllc1swXS5jb21wbGV0aW9uO2lmKCJ0aHJvdyI9PT1lLnR5cGUpdGhyb3cgZS5hcmc7cmV0dXJuIHRoaXMucnZhbH0sZGlzcGF0Y2hFeGNlcHRpb246ZnVuY3Rpb24odCl7aWYodGhpcy5kb25lKXRocm93IHQ7dmFyIHI9dGhpcztmdW5jdGlvbiBuKG4sbyl7cmV0dXJuIHUudHlwZT0idGhyb3ciLHUuYXJnPXQsci5uZXh0PW4sbyYmKHIubWV0aG9kPSJuZXh0IixyLmFyZz1lKSwhIW99Zm9yKHZhciBpPXRoaXMudHJ5RW50cmllcy5sZW5ndGgtMTtpPj0wOy0taSl7dmFyIGE9dGhpcy50cnlFbnRyaWVzW2ldLHU9YS5jb21wbGV0aW9uO2lmKCJyb290Ij09PWEudHJ5TG9jKXJldHVybiBuKCJlbmQiKTtpZihhLnRyeUxvYzw9dGhpcy5wcmV2KXt2YXIgcz1vLmNhbGwoYSwiY2F0Y2hMb2MiKSxjPW8uY2FsbChhLCJmaW5hbGx5TG9jIik7aWYocyYmYyl7aWYodGhpcy5wcmV2PGEuY2F0Y2hMb2MpcmV0dXJuIG4oYS5jYXRjaExvYywhMCk7aWYodGhpcy5wcmV2PGEuZmluYWxseUxvYylyZXR1cm4gbihhLmZpbmFsbHlMb2MpfWVsc2UgaWYocyl7aWYodGhpcy5wcmV2PGEuY2F0Y2hMb2MpcmV0dXJuIG4oYS5jYXRjaExvYywhMCl9ZWxzZXtpZighYyl0aHJvdyBuZXcgRXJyb3IoInRyeSBzdGF0ZW1lbnQgd2l0aG91dCBjYXRjaCBvciBmaW5hbGx5Iik7aWYodGhpcy5wcmV2PGEuZmluYWxseUxvYylyZXR1cm4gbihhLmZpbmFsbHlMb2MpfX19fSxhYnJ1cHQ6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIHI9dGhpcy50cnlFbnRyaWVzLmxlbmd0aC0xO3I+PTA7LS1yKXt2YXIgbj10aGlzLnRyeUVudHJpZXNbcl07aWYobi50cnlMb2M8PXRoaXMucHJldiYmby5jYWxsKG4sImZpbmFsbHlMb2MiKSYmdGhpcy5wcmV2PG4uZmluYWxseUxvYyl7dmFyIGk9bjticmVha319aSYmKCJicmVhayI9PT1lfHwiY29udGludWUiPT09ZSkmJmkudHJ5TG9jPD10JiZ0PD1pLmZpbmFsbHlMb2MmJihpPW51bGwpO3ZhciBhPWk/aS5jb21wbGV0aW9uOnt9O3JldHVybiBhLnR5cGU9ZSxhLmFyZz10LGk/KHRoaXMubWV0aG9kPSJuZXh0Iix0aGlzLm5leHQ9aS5maW5hbGx5TG9jLG0pOnRoaXMuY29tcGxldGUoYSl9LGNvbXBsZXRlOmZ1bmN0aW9uKGUsdCl7aWYoInRocm93Ij09PWUudHlwZSl0aHJvdyBlLmFyZztyZXR1cm4iYnJlYWsiPT09ZS50eXBlfHwiY29udGludWUiPT09ZS50eXBlP3RoaXMubmV4dD1lLmFyZzoicmV0dXJuIj09PWUudHlwZT8odGhpcy5ydmFsPXRoaXMuYXJnPWUuYXJnLHRoaXMubWV0aG9kPSJyZXR1cm4iLHRoaXMubmV4dD0iZW5kIik6Im5vcm1hbCI9PT1lLnR5cGUmJnQmJih0aGlzLm5leHQ9dCksbX0sZmluaXNoOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD10aGlzLnRyeUVudHJpZXMubGVuZ3RoLTE7dD49MDstLXQpe3ZhciByPXRoaXMudHJ5RW50cmllc1t0XTtpZihyLmZpbmFsbHlMb2M9PT1lKXJldHVybiB0aGlzLmNvbXBsZXRlKHIuY29tcGxldGlvbixyLmFmdGVyTG9jKSxMKHIpLG19fSxjYXRjaDpmdW5jdGlvbihlKXtmb3IodmFyIHQ9dGhpcy50cnlFbnRyaWVzLmxlbmd0aC0xO3Q+PTA7LS10KXt2YXIgcj10aGlzLnRyeUVudHJpZXNbdF07aWYoci50cnlMb2M9PT1lKXt2YXIgbj1yLmNvbXBsZXRpb247aWYoInRocm93Ij09PW4udHlwZSl7dmFyIG89bi5hcmc7TChyKX1yZXR1cm4gb319dGhyb3cgbmV3IEVycm9yKCJpbGxlZ2FsIGNhdGNoIGF0dGVtcHQiKX0sZGVsZWdhdGVZaWVsZDpmdW5jdGlvbih0LHIsbil7cmV0dXJuIHRoaXMuZGVsZWdhdGU9e2l0ZXJhdG9yOkModCkscmVzdWx0TmFtZTpyLG5leHRMb2M6bn0sIm5leHQiPT09dGhpcy5tZXRob2QmJih0aGlzLmFyZz1lKSxtfX0sdH1mdW5jdGlvbiBhKGUsdCxyLG4sbyxpLGEpe3RyeXt2YXIgdT1lW2ldKGEpLHM9dS52YWx1ZX1jYXRjaChlKXtyZXR1cm4gdm9pZCByKGUpfXUuZG9uZT90KHMpOlByb21pc2UucmVzb2x2ZShzKS50aGVuKG4sbyl9ZnVuY3Rpb24gdShlKXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgdD10aGlzLHI9YXJndW1lbnRzO3JldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24obixvKXt2YXIgaT1lLmFwcGx5KHQscik7ZnVuY3Rpb24gdShlKXthKGksbixvLHUscywibmV4dCIsZSl9ZnVuY3Rpb24gcyhlKXthKGksbixvLHUscywidGhyb3ciLGUpfXUodm9pZCAwKX0pKX19ZnVuY3Rpb24gcyhlLHQpe2Zvcih2YXIgcj0wO3I8dC5sZW5ndGg7cisrKXt2YXIgbj10W3JdO24uZW51bWVyYWJsZT1uLmVudW1lcmFibGV8fCExLG4uY29uZmlndXJhYmxlPSEwLCJ2YWx1ZSJpbiBuJiYobi53cml0YWJsZT0hMCksT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsYyhuLmtleSksbil9fWZ1bmN0aW9uIGMoZSl7dmFyIHQ9ZnVuY3Rpb24oZSx0KXtpZigib2JqZWN0IiE9bihlKXx8IWUpcmV0dXJuIGU7dmFyIHI9ZVtTeW1ib2wudG9QcmltaXRpdmVdO2lmKHZvaWQgMCE9PXIpe3ZhciBvPXIuY2FsbChlLCJzdHJpbmciKTtpZigib2JqZWN0IiE9bihvKSlyZXR1cm4gbzt0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpfXJldHVybiBTdHJpbmcoZSl9KGUpO3JldHVybiJzeW1ib2wiPT1uKHQpP3Q6U3RyaW5nKHQpfXIoNDcxKTt2YXIgbD1yKDMwMCksZj1yKDg2NyksaD1mdW5jdGlvbigpe2Z1bmN0aW9uIGUodCxyKXshZnVuY3Rpb24oZSx0KXtpZighKGUgaW5zdGFuY2VvZiB0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX0odGhpcyxlKSx0aGlzLmFwcD10fHx7fSx0aGlzLmRlc2NyaXB0aW9uPSIiLHRoaXMuZGlybmFtZT0iIix0aGlzLmFwcG5hbWU9IiIsdGhpcy5uYW1lPSIiLHRoaXMuc2x1Zz0iIix0aGlzLmxpbms9IiIsdGhpcy5ldmVudHM9W10sdGhpcy5yZW5kZXJJbnRvcz17fSx0aGlzLmFsZXJ0cz0wLHRoaXMuY2F0ZWdvcmllcz0iIix0aGlzLnNxbGNhY2hlPXt9LHRoaXMuc3FsY2FjaGVfZW5hYmxlZD0wLHRoaXMuc2VydmljZXM9W10sdGhpcy5jb21wb25lbnRzPVtdLHRoaXMucmVxdWVzdF9ub19pbnRlcnJ1cHRzPSExLHRoaXMuZGJfdGFibGVzPVtdLHRoaXMudmVyc2lvbj0xLHRoaXMubWV0YT1bXSx0aGlzLnN0eWxlcz1bXSx0aGlzLnNjcmlwdHM9W10sdGhpcy5pbmNsdWRlc19hdHRhY2hlZD0wLHRoaXMuZXZlbnRMaXN0ZW5lcnM9W10sdGhpcy50aGVtZV9vcHRpb25zPXtsaXRlOiJmYS1zb2xpZCBmYS1zdW4iLGRhcms6ImZhLXNvbGlkIGZhLWNsb3VkLW1vb24iLG1pZG5pZ2h0OiJmYS1zb2xpZCBmYS1tb29uIixtaWxxdWV0b2FzdDoiZmEtc29saWQgZmEtY293IixzYW5ncmUzMDAwOiJmYS1zb2xpZCBmYS1kcm9wbGV0LXNsYXNoIn0sdGhpcy5wcm9jZXNzZWRUeHM9e30sdGhpcy5wYXJhbWV0ZXJzPXt9LHRoaXMuZGVmYXVsdF9odG1sPTAsdGhpcy5icm93c2VyX2FjdGl2ZT0wLHRoaXMucG9zc2libGVIb21lPTAsdGhpcy5wdWJsaWNLZXk9IiJ9dmFyIHQscixuLGEsYyxoLHAsZCx2LHksZyxtLGIsdyxrLHgsUyxBO3JldHVybiB0PWUscj1be2tleToiaW5zdGFsbE1vZHVsZSIsdmFsdWU6KEE9dShpKCkubWFyaygoZnVuY3Rpb24gZSh0KXt2YXIgcixuLG8sYSx1LHMsYztyZXR1cm4gaSgpLndyYXAoKGZ1bmN0aW9uKGUpe2Zvcig7Oylzd2l0Y2goZS5wcmV2PWUubmV4dCl7Y2FzZSAwOmlmKDEhPT10aGlzLmFwcC5CUk9XU0VSKXtlLm5leHQ9MjticmVha31yZXR1cm4gZS5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMjppZihyPSIiLmNvbmNhdCgiLyIsIi8uLi8uLi9tb2RzLyIpLmNvbmNhdCh0aGlzLmRpcm5hbWUsIi9zcWwiKSxuPXQuc3RvcmFnZS5yZXR1cm5GaWxlU3lzdGVtKCksbz1lbmNvZGVVUkkodGhpcy5yZXR1cm5TbHVnKCkpLG51bGw9PW4pe2UubmV4dD0yMzticmVha31pZighbi5leGlzdHNTeW5jKGwubm9ybWFsaXplKHIpKSl7ZS5uZXh0PTIzO2JyZWFrfWE9bi5yZWFkZGlyU3luYyhyKS5zb3J0KCksdT0wO2Nhc2UgOTppZighKHU8YS5sZW5ndGgpKXtlLm5leHQ9MjM7YnJlYWt9cmV0dXJuIGUucHJldj0xMCxzPWwuam9pbihyLGFbdV0pLGM9bi5yZWFkRmlsZVN5bmMocywidXRmOCIpLGUubmV4dD0xNSx0LnN0b3JhZ2UuZXhlY3V0ZURhdGFiYXNlKGMsbyk7Y2FzZSAxNTplLm5leHQ9MjA7YnJlYWs7Y2FzZSAxNzplLnByZXY9MTcsZS50MD1lLmNhdGNoKDEwKSxjb25zb2xlLmVycm9yKGUudDApO2Nhc2UgMjA6dSsrLGUubmV4dD05O2JyZWFrO2Nhc2UgMjM6Y2FzZSJlbmQiOnJldHVybiBlLnN0b3AoKX19KSxlLHRoaXMsW1sxMCwxN11dKX0pKSksZnVuY3Rpb24oZSl7cmV0dXJuIEEuYXBwbHkodGhpcyxhcmd1bWVudHMpfSl9LHtrZXk6ImluaXRpYWxpemUiLHZhbHVlOihTPXUoaSgpLm1hcmsoKGZ1bmN0aW9uIGUodCl7dmFyIHIsbixvLGEsdSxzLGMsZixoPXRoaXM7cmV0dXJuIGkoKS53cmFwKChmdW5jdGlvbihlKXtmb3IoOzspc3dpdGNoKGUucHJldj1lLm5leHQpe2Nhc2UgMDpyZXR1cm4gZS5uZXh0PTIsdGhpcy5hcHAud2FsbGV0LmdldFB1YmxpY0tleSgpO2Nhc2UgMjp0aGlzLnB1YmxpY0tleT1lLnNlbnQsbj1pKCkubWFyaygoZnVuY3Rpb24gZShyKXtyZXR1cm4gaSgpLndyYXAoKGZ1bmN0aW9uKGUpe2Zvcig7Oylzd2l0Y2goZS5wcmV2PWUubmV4dCl7Y2FzZSAwOnQuY29ubmVjdGlvbi5vbihoLmV2ZW50c1tyXSwoZnVuY3Rpb24oZSl7aC5yZWNlaXZlRXZlbnQoaC5ldmVudHNbcl0sZSl9KSk7Y2FzZSAxOmNhc2UiZW5kIjpyZXR1cm4gZS5zdG9wKCl9fSksZSl9KSksbz0wO2Nhc2UgNTppZighKG88dGhpcy5ldmVudHMubGVuZ3RoKSl7ZS5uZXh0PTEwO2JyZWFrfXJldHVybiBlLmRlbGVnYXRlWWllbGQobihvKSwidDAiLDcpO2Nhc2UgNzpvKyssZS5uZXh0PTU7YnJlYWs7Y2FzZSAxMDppZigxIT09dC5CUk9XU0VSKXtlLm5leHQ9MTI7YnJlYWt9cmV0dXJuIGUuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDEyOmlmKGE9IiIuY29uY2F0KCIvIiwiLy4uLy4uL21vZHMvIikuY29uY2F0KHRoaXMuZGlybmFtZSwiL3NxbCIpLG51bGwhPSh1PW51bGw9PXR8fG51bGw9PT0ocj10LnN0b3JhZ2UpfHx2b2lkIDA9PT1yP3ZvaWQgMDpyLnJldHVybkZpbGVTeXN0ZW0oKSkmJnUuZXhpc3RzU3luYyhsLm5vcm1hbGl6ZShhKSkpZm9yKHM9dS5yZWFkZGlyU3luYyhhKSxjPTA7YzxzLmxlbmd0aDtjKyspZj0oZj1zW2NdLnNsaWNlKDAsLTQpKS5yZXBsYWNlKC9cZCskLywiIiksdGhpcy5kYl90YWJsZXMucHVzaChmKTsiIj09PXRoaXMuYXBwbmFtZSYmKHRoaXMuYXBwbmFtZT10aGlzLm5hbWUpO2Nhc2UgMTY6Y2FzZSJlbmQiOnJldHVybiBlLnN0b3AoKX19KSxlLHRoaXMpfSkpKSxmdW5jdGlvbihlKXtyZXR1cm4gUy5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KX0se2tleToicmVuZGVyIix2YWx1ZTooeD11KGkoKS5tYXJrKChmdW5jdGlvbiBlKCl7dmFyIHQscixuLG87cmV0dXJuIGkoKS53cmFwKChmdW5jdGlvbihlKXtmb3IoOzspc3dpdGNoKGUucHJldj1lLm5leHQpe2Nhc2UgMDp0aGlzLmJyb3dzZXJfYWN0aXZlJiZ0aGlzLnBvc3NpYmxlSG9tZSYmKHRoaXMuYXBwLm9wdGlvbnMuaG9tZU1vZHVsZT10aGlzLnJldHVybk5hbWUoKSx0aGlzLmFwcC5zdG9yYWdlLnNhdmVPcHRpb25zKCkpLDA9PT10aGlzLmluY2x1ZGVzX2F0dGFjaGVkJiYodGhpcy5tZXRhJiZ0aGlzLmF0dGFjaE1ldGEoKSwobnVsbD09PSh0PXRoaXMuc3R5bGVzKXx8dm9pZCAwPT09dD92b2lkIDA6dC5sZW5ndGgpPjAmJnRoaXMuYXR0YWNoU3R5bGVTaGVldHMoKSwobnVsbD09PShyPXRoaXMuc2NyaXB0cyl8fHZvaWQgMD09PXI/dm9pZCAwOnIubGVuZ3RoKT4wJiYoY29uc29sZS5sb2coImF0dGFjaFNjcmlwdHMgaW4gIit0aGlzLm5hbWUsdGhpcy5zY3JpcHRzKSx0aGlzLmF0dGFjaFNjcmlwdHMoKSksKG51bGw9PT0obj10aGlzLnBvc3RTY3JpcHRzKXx8dm9pZCAwPT09bj92b2lkIDA6bi5sZW5ndGgpPjAmJnRoaXMuYXR0YWNoUG9zdFNjcmlwdHMoKSx0aGlzLmluY2x1ZGVzX2F0dGFjaGVkPTEpLG89MDtjYXNlIDM6aWYoIShvPHRoaXMuY29tcG9uZW50cy5sZW5ndGgpKXtlLm5leHQ9OTticmVha31yZXR1cm4gZS5uZXh0PTYsdGhpcy5jb21wb25lbnRzW29dLnJlbmRlcigpO2Nhc2UgNjpvKyssZS5uZXh0PTM7YnJlYWs7Y2FzZSA5OmNhc2UiZW5kIjpyZXR1cm4gZS5zdG9wKCl9fSksZSx0aGlzKX0pKSksZnVuY3Rpb24oKXtyZXR1cm4geC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KX0se2tleToicmV0dXJuTmFtZSIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5hcHBuYW1lP3RoaXMuYXBwbmFtZTp0aGlzLmdhbWVuYW1lP3RoaXMuZ2FtZW5hbWU6dGhpcy5uYW1lP3RoaXMubmFtZToiVW5rbm93biBNb2R1bGUifX0se2tleToicmV0dXJuVGl0bGUiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudGl0bGU/dGhpcy50aXRsZTp0aGlzLnJldHVybk5hbWUoKX19LHtrZXk6InJldHVybkltYWdlIix2YWx1ZTpmdW5jdGlvbigpe3JldHVybiIvc2FpdG8vaW1nL2RyZWFtc2NhcGUucG5nIn19LHtrZXk6InJldHVybkJhbm5lciIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4iL3NhaXRvL2ltZy9kcmVhbXNjYXBlLnBuZyJ9fSx7a2V5OiJoYXNTZXR0aW5ncyIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4hMX19LHtrZXk6ImxvYWRTZXR0aW5ncyIsdmFsdWU6ZnVuY3Rpb24oKXt9fSx7a2V5OiJpbml0aWFsaXplSFRNTCIsdmFsdWU6KGs9dShpKCkubWFyaygoZnVuY3Rpb24gZSh0KXtyZXR1cm4gaSgpLndyYXAoKGZ1bmN0aW9uKGUpe2Zvcig7Oylzd2l0Y2goZS5wcmV2PWUubmV4dCl7Y2FzZSAwOmNhc2UiZW5kIjpyZXR1cm4gZS5zdG9wKCl9fSksZSl9KSkpLGZ1bmN0aW9uKGUpe3JldHVybiBrLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pfSx7a2V5OiJhdHRhY2hFdmVudHMiLHZhbHVlOmZ1bmN0aW9uKGUpe319LHtrZXk6Im9uQ29uZmlybWF0aW9uIix2YWx1ZToodz11KGkoKS5tYXJrKChmdW5jdGlvbiBlKHQscixuKXtyZXR1cm4gaSgpLndyYXAoKGZ1bmN0aW9uKGUpe2Zvcig7Oylzd2l0Y2goZS5wcmV2PWUubmV4dCl7Y2FzZSAwOmNhc2UiZW5kIjpyZXR1cm4gZS5zdG9wKCl9fSksZSl9KSkpLGZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gdy5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KX0se2tleToicmV0dXJuTnVtYmVyT2ZOb3RpZmljYXRpb25zIix2YWx1ZTpmdW5jdGlvbigpe3JldHVybiAwfX0se2tleToib25OZXdCbG9jayIsdmFsdWU6ZnVuY3Rpb24oZSx0KXt9fSx7a2V5OiJvbkNoYWluUmVvcmdhbml6YXRpb24iLHZhbHVlOmZ1bmN0aW9uKGUsdCxyLG4pe319LHtrZXk6Im9uV2FsbGV0UmVzZXQiLHZhbHVlOihiPXUoaSgpLm1hcmsoKGZ1bmN0aW9uIGUodCl7cmV0dXJuIGkoKS53cmFwKChmdW5jdGlvbihlKXtmb3IoOzspc3dpdGNoKGUucHJldj1lLm5leHQpe2Nhc2UgMDpyZXR1cm4gZS5uZXh0PTIsdGhpcy5hcHAud2FsbGV0LmdldFB1YmxpY0tleSgpO2Nhc2UgMjp0aGlzLnB1YmxpY0tleT1lLnNlbnQ7Y2FzZSAzOmNhc2UiZW5kIjpyZXR1cm4gZS5zdG9wKCl9fSksZSx0aGlzKX0pKSksZnVuY3Rpb24oZSl7cmV0dXJuIGIuYXBwbHkodGhpcyxhcmd1bWVudHMpfSl9LHtrZXk6Im9uUGVlckhhbmRzaGFrZUNvbXBsZXRlIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD1hcmd1bWVudHMubGVuZ3RoPjEmJnZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06bnVsbDt0Lmhhc1NlcnZpY2UoImFyY2hpdmUiKSYmdGhpcy5vbkFyY2hpdmVIYW5kc2hha2VDb21wbGV0ZShlLHQpfX0se2tleToib25QZWVyU2VydmljZVVwIix2YWx1ZToobT11KGkoKS5tYXJrKChmdW5jdGlvbiBlKHQscixuKXtyZXR1cm4gaSgpLndyYXAoKGZ1bmN0aW9uKGUpe2Zvcig7Oylzd2l0Y2goZS5wcmV2PWUubmV4dCl7Y2FzZSAwOmNhc2UiZW5kIjpyZXR1cm4gZS5zdG9wKCl9fSksZSl9KSkpLGZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gbS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KX0se2tleToib25BcmNoaXZlSGFuZHNoYWtlQ29tcGxldGUiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7fX0se2tleToib25Db25uZWN0aW9uU3RhYmxlIix2YWx1ZTpmdW5jdGlvbihlLHQpe319LHtrZXk6Im9uQ29ubmVjdGlvblVuc3RhYmxlIix2YWx1ZTpmdW5jdGlvbihlLHQpe319LHtrZXk6InNob3VsZEFmZml4Q2FsbGJhY2tUb01vZHVsZSIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIGU9PT10aGlzLm5hbWU/MTowfX0se2tleToid2ViU2VydmVyIix2YWx1ZTpmdW5jdGlvbihlLHQscil7dmFyIG4sbz0iIi5jb25jYXQoIi8iLCIvLi4vLi4vbW9kcy8iKS5jb25jYXQodGhpcy5kaXJuYW1lLCIvd2ViIiksaT1udWxsPT1lfHxudWxsPT09KG49ZS5zdG9yYWdlKXx8dm9pZCAwPT09bj92b2lkIDA6bi5yZXR1cm5GaWxlU3lzdGVtKCk7bnVsbCE9aSYmKGkuZXhpc3RzU3luYyhvKT90LnVzZSgiLyIrZW5jb2RlVVJJKHRoaXMucmV0dXJuU2x1ZygpKSxyLnN0YXRpYyhvKSk6dGhpcy5kZWZhdWx0X2h0bWwmJnQudXNlKCIvIitlbmNvZGVVUkkodGhpcy5yZXR1cm5TbHVnKCkpLHIuc3RhdGljKCIvLy4uLy4uL2xpYi90ZW1wbGF0ZXMvaHRtbCIpKSl9fSx7a2V5OiJ1cGRhdGVCbG9ja2NoYWluU3luYyIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIpe319LHtrZXk6ImFkZFNjcmlwdCIsdmFsdWU6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PTA7dDx0aGlzLnNjcmlwdHMubGVuZ3RoO3QrKylpZih0aGlzLnNjcmlwdHNbdF09PT1lKXJldHVybjt0aGlzLnNjcmlwdHMucHVzaChlKX19LHtrZXk6ImFkZFN0eWxlIix2YWx1ZTpmdW5jdGlvbihlKXtmb3IodmFyIHQ9MDt0PHRoaXMuc3R5bGVzLmxlbmd0aDt0KyspaWYodGhpcy5zdHlsZXNbdF09PT1lKXJldHVybjt0aGlzLnN0eWxlcy5wdXNoKGUpfX0se2tleToiYWRkQ29tcG9uZW50Iix2YWx1ZTpmdW5jdGlvbihlKXtmb3IodmFyIHQ9MDt0PHRoaXMuY29tcG9uZW50cy5sZW5ndGg7dCsrKWlmKHRoaXMuY29tcG9uZW50c1t0XT09PWUpcmV0dXJuO3RoaXMuY29tcG9uZW50cy5wdXNoKGUpfX0se2tleToicmVtb3ZlQ29tcG9uZW50Iix2YWx1ZTpmdW5jdGlvbihlKXtmb3IodmFyIHQ9dGhpcy5jb21wb25lbnRzLmxlbmd0aDt0Pj0wO3QtLSl0aGlzLmNvbXBvbmVudHNbdF09PT1lJiZ0aGlzLmNvbXBvbmVudHMuc3BsaWNlKHQsMSl9fSx7a2V5OiJjYW5SZW5kZXJJbnRvIix2YWx1ZTpmdW5jdGlvbigpe3JldHVybiExfX0se2tleToicmVuZGVySW50byIsdmFsdWU6KGc9dShpKCkubWFyaygoZnVuY3Rpb24gZSgpe3JldHVybiBpKCkud3JhcCgoZnVuY3Rpb24oZSl7Zm9yKDs7KXN3aXRjaChlLnByZXY9ZS5uZXh0KXtjYXNlIDA6cmV0dXJuIGUuYWJydXB0KCJyZXR1cm4iLG51bGwpO2Nhc2UgMjpjYXNlImVuZCI6cmV0dXJuIGUuc3RvcCgpfX0pLGUpfSkpKSxmdW5jdGlvbigpe3JldHVybiBnLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pfSx7a2V5OiJyZXNwb25kVG8iLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIG51bGx9fSx7a2V5OiJyZWNlaXZlRXZlbnQiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7fX0se2tleToic2VuZEV2ZW50Iix2YWx1ZTpmdW5jdGlvbihlLHQpe3RoaXMuYXBwLmNvbm5lY3Rpb24uZW1pdChlLHQpfX0se2tleToiaGFuZGxlUGVlclRyYW5zYWN0aW9uIix2YWx1ZTooeT11KGkoKS5tYXJrKChmdW5jdGlvbiBlKHQpe3ZhciByLG4sbyxhLHUscyxjLGwsaCxwLGQsdix5LGcsbSxiLHcsayx4LFMsQSxFLE8sXyxOLFAsVD1hcmd1bWVudHM7cmV0dXJuIGkoKS53cmFwKChmdW5jdGlvbihlKXtmb3IoOzspc3dpdGNoKGUucHJldj1lLm5leHQpe2Nhc2UgMDppZihuPVQubGVuZ3RoPjMmJnZvaWQgMCE9PVRbM10/VFszXTpudWxsLG51bGwhPShyPVQubGVuZ3RoPjEmJnZvaWQgMCE9PVRbMV0/VFsxXTpudWxsKSl7ZS5uZXh0PTU7YnJlYWt9cmV0dXJuIGUuYWJydXB0KCJyZXR1cm4iLDApO2Nhc2UgNTplLnByZXY9NSxvPXIucmV0dXJuTWVzc2FnZSgpLGUubmV4dD0xNjticmVhaztjYXNlIDk6cmV0dXJuIGUucHJldj05LGUudDA9ZS5jYXRjaCg1KSxjb25zb2xlLmxvZygiISFAQCFAIyEjIUAjIUAjIiksY29uc29sZS5sb2coIiEhQEAhQCMhIyFAIyFAIyIpLGNvbnNvbGUubG9nKCIhIUBAIUAjISMhQCMhQCMiKSxjb25zb2xlLmxvZyhmLnN0cmluZ2lmeShyKSksZS5hYnJ1cHQoInJldHVybiIsMCk7Y2FzZSAxNjphPTA7Y2FzZSAxNzppZighKGE8dGhpcy5kYl90YWJsZXMubGVuZ3RoKSl7ZS5uZXh0PTQ3O2JyZWFrfWlmKHM9dGhpcy5uYW1lLnRvTG93ZXJDYXNlKCkrIiBsb2FkICIrdGhpcy5kYl90YWJsZXNbYV0sKG51bGw9PT0odT1vKXx8dm9pZCAwPT09dT92b2lkIDA6dS5yZXF1ZXN0KSE9PXMpe2UubmV4dD00NDticmVha31pZihjb25zb2xlLmxvZygiZXhwZWN0ZWRfcmVxdWVzdCA6ICIrcyksZD1udWxsPT09KGM9by5kYXRhKXx8dm9pZCAwPT09Yz92b2lkIDA6Yy5zZWxlY3Qsdj1udWxsPT09KGw9by5kYXRhKXx8dm9pZCAwPT09bD92b2lkIDA6bC5kYm5hbWUseT1udWxsPT09KGg9by5kYXRhKXx8dm9pZCAwPT09aD92b2lkIDA6aC50YWJsZW5hbWUsZz1udWxsPT09KHA9by5kYXRhKXx8dm9pZCAwPT09cD92b2lkIDA6cC53aGVyZSwvXlthLXoiYCc9XyooKVwuXG5cdFxyICwwLTlBLVpdKyQvLnRlc3QoZCkpe2UubmV4dD0yNzticmVha31yZXR1cm4gZS5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMjc6aWYoL15bYS16ImAnPV8oKVwuICwwLTlBLVpdKyQvLnRlc3Qodikpe2UubmV4dD0yOTticmVha31yZXR1cm4gZS5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMjk6aWYoL15bYS16ImAnPV8oKVwuICwwLTlBLVpdKyQvLnRlc3QoeSkpe2UubmV4dD0zMTticmVha31yZXR1cm4gZS5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMzE6cmV0dXJuIG09IlNFTEVDVCAiLmNvbmNhdChkLCJcbiAgICAgICAgICAgICAgICAgICBGUk9NICIpLmNvbmNhdCh5KSwiIiE9PWcmJihtKz0iIFdIRVJFICIuY29uY2F0KGcpKSxiPXt9LGUubmV4dD0zNix0aGlzLmFwcC5zdG9yYWdlLnF1ZXJ5RGF0YWJhc2UobSxiLHYpO2Nhc2UgMzY6aWYodz1lLnNlbnQsKGs9e30pLmVycj0iIixrLnJvd3M9dywhbil7ZS5uZXh0PTQzO2JyZWFrfXJldHVybiBuKGspLGUuYWJydXB0KCJyZXR1cm4iLDEpO2Nhc2UgNDM6cmV0dXJuIGUuYWJydXB0KCJyZXR1cm4iLDApO2Nhc2UgNDQ6YSsrLGUubmV4dD0xNzticmVhaztjYXNlIDQ3OmlmKCJyYXdTUUwiIT09by5yZXF1ZXN0KXtlLm5leHQ9Njg7YnJlYWt9aWYoKG51bGw9PT0oeD1vKXx8dm9pZCAwPT09eHx8bnVsbD09PSh4PXguZGF0YSl8fHZvaWQgMD09PXg/dm9pZCAwOngubW9kdWxlKSE9PXRoaXMubmFtZSl7ZS5uZXh0PTY4O2JyZWFrfWlmKEU9bnVsbD09PShTPW8pfHx2b2lkIDA9PT1TfHxudWxsPT09KFM9Uy5kYXRhKXx8dm9pZCAwPT09Uz92b2lkIDA6Uy5zcWwsTz1udWxsPT09KEE9byl8fHZvaWQgMD09PUF8fG51bGw9PT0oQT1BLmRhdGEpfHx2b2lkIDA9PT1BP3ZvaWQgMDpBLmRibmFtZSxfPXt9LCF0aGlzLnNxbGNhY2hlW0VdfHwxIT09dGhpcy5zcWxjYWNoZV9lbmFibGVkKXtlLm5leHQ9NTc7YnJlYWt9Tj10aGlzLnNxbGNhY2hlW0VdLGUubmV4dD02MTticmVhaztjYXNlIDU3OnJldHVybiBlLm5leHQ9NTksdGhpcy5hcHAuc3RvcmFnZS5xdWVyeURhdGFiYXNlKEUsXyxPKTtjYXNlIDU5Ok49ZS5zZW50LHRoaXMuc3FsY2FjaGVfZW5hYmxlZCYmKHRoaXMuc3FsY2FjaGVbRV09Tik7Y2FzZSA2MTppZigoUD17fSkuZXJyPSIiLFAucm93cz1OLCFuKXtlLm5leHQ9Njc7YnJlYWt9cmV0dXJuIG4oUCksZS5hYnJ1cHQoInJldHVybiIsMSk7Y2FzZSA2NzpjYXNlIDY4OnJldHVybiBlLmFicnVwdCgicmV0dXJuIiwwKTtjYXNlIDY5OmNhc2UiZW5kIjpyZXR1cm4gZS5zdG9wKCl9fSksZSx0aGlzLFtbNSw5XV0pfSkpKSxmdW5jdGlvbihlKXtyZXR1cm4geS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KX0se2tleToicmV0dXJuU2VydmljZXMiLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc2VydmljZXN9fSx7a2V5OiJzZW5kUGVlckRhdGFiYXNlUmVxdWVzdCIsdmFsdWU6KHY9dShpKCkubWFyaygoZnVuY3Rpb24gZSh0LHIpe3ZhciBuLG8sYSx1LHMsYz1hcmd1bWVudHM7cmV0dXJuIGkoKS53cmFwKChmdW5jdGlvbihlKXtmb3IoOzspc3dpdGNoKGUucHJldj1lLm5leHQpe2Nhc2UgMDppZihuPWMubGVuZ3RoPjImJnZvaWQgMCE9PWNbMl0/Y1syXToiIixvPWMubGVuZ3RoPjMmJnZvaWQgMCE9PWNbM10/Y1szXToiIixhPWMubGVuZ3RoPjQmJnZvaWQgMCE9PWNbNF0/Y1s0XTpudWxsLHU9Yy5sZW5ndGg+NSYmdm9pZCAwIT09Y1s1XT9jWzVdOm51bGwsKHM9e30pLnJlcXVlc3Q9dCsiIGxvYWQgIityLHMuZGF0YT17fSxzLmRhdGEuZGJuYW1lPXQscy5kYXRhLnRhYmxlbmFtZT1yLHMuZGF0YS5zZWxlY3Q9bixzLmRhdGEud2hlcmU9byxudWxsIT1hKXtlLm5leHQ9MTU7YnJlYWt9cmV0dXJuIGUuYWJydXB0KCJyZXR1cm4iLHRoaXMuYXBwLm5ldHdvcmsuc2VuZFJlcXVlc3RBc1RyYW5zYWN0aW9uKHMucmVxdWVzdCxzLmRhdGEsKGZ1bmN0aW9uKGUpe3JldHVybiB1KGUpfSkpKTtjYXNlIDE1OnJldHVybiBlLmFicnVwdCgicmV0dXJuIix0aGlzLmFwcC5uZXR3b3JrLnNlbmRSZXF1ZXN0QXNUcmFuc2FjdGlvbihzLnJlcXVlc3Qscy5kYXRhLChmdW5jdGlvbihlKXtyZXR1cm4gdShlKX0pLGEucGVlckluZGV4KSk7Y2FzZSAxNjpjYXNlImVuZCI6cmV0dXJuIGUuc3RvcCgpfX0pLGUsdGhpcyl9KSkpLGZ1bmN0aW9uKGUsdCl7cmV0dXJuIHYuYXBwbHkodGhpcyxhcmd1bWVudHMpfSl9LHtrZXk6InNlbmRQZWVyRGF0YWJhc2VSZXF1ZXN0V2l0aEZpbHRlciIsdmFsdWU6KGQ9dShpKCkubWFyaygoZnVuY3Rpb24gZSgpe3ZhciB0LHIsbixvLGEsdT1hcmd1bWVudHM7cmV0dXJuIGkoKS53cmFwKChmdW5jdGlvbihlKXtmb3IoOzspc3dpdGNoKGUucHJldj1lLm5leHQpe2Nhc2UgMDppZih0PXUubGVuZ3RoPjAmJnZvaWQgMCE9PXVbMF0/dVswXToiIixuPXUubGVuZ3RoPjImJnZvaWQgMCE9PXVbMl0/dVsyXTpudWxsLG89dS5sZW5ndGg+MyYmdm9pZCAwIT09dVszXT91WzNdOm51bGwsIiIhPT0ocj11Lmxlbmd0aD4xJiZ2b2lkIDAhPT11WzFdP3VbMV06IiIpKXtlLm5leHQ9NjticmVha31yZXR1cm4gZS5hYnJ1cHQoInJldHVybiIpO2Nhc2UgNjppZigiIiE9PXQpe2UubmV4dD04O2JyZWFrfXJldHVybiBlLmFicnVwdCgicmV0dXJuIik7Y2FzZSA4OmlmKHRoaXMuYXBwLm1vZHVsZXMucmV0dXJuTW9kdWxlKHQpKXtlLm5leHQ9MTE7YnJlYWt9cmV0dXJuIGNvbnNvbGUuZXJyb3IodCsiIG5vdCBmb3VuZCEiKSxlLmFicnVwdCgicmV0dXJuIik7Y2FzZSAxMTooYT17fSkucmVxdWVzdD0icmF3U1FMIixhLmRhdGE9e30sYS5kYXRhLnNxbD1yLGEuZGF0YS5tb2R1bGU9dCxhLmRhdGEuZGJuYW1lPXRoaXMuYXBwLm1vZHVsZXMucmV0dXJuTW9kdWxlKHQpLnJldHVyblNsdWcoKSxjb25zb2xlLmxvZygiU1BEUldGOiAiK3QpLHRoaXMuc2VuZFBlZXJSZXF1ZXN0V2l0aEZpbHRlcigoZnVuY3Rpb24oKXtyZXR1cm4gYX0pLG4sbyk7Y2FzZSAxOTpjYXNlImVuZCI6cmV0dXJuIGUuc3RvcCgpfX0pLGUsdGhpcyl9KSkpLGZ1bmN0aW9uKCl7cmV0dXJuIGQuYXBwbHkodGhpcyxhcmd1bWVudHMpfSl9LHtrZXk6InNlbmRQZWVyUmVxdWVzdFdpdGhTZXJ2aWNlRmlsdGVyIix2YWx1ZToocD11KGkoKS5tYXJrKChmdW5jdGlvbiBlKHQscil7dmFyIG4sbz1hcmd1bWVudHM7cmV0dXJuIGkoKS53cmFwKChmdW5jdGlvbihlKXtmb3IoOzspc3dpdGNoKGUucHJldj1lLm5leHQpe2Nhc2UgMDpuPW8ubGVuZ3RoPjImJnZvaWQgMCE9PW9bMl0/b1syXTpmdW5jdGlvbihlKXt9LHRoaXMuc2VuZFBlZXJSZXF1ZXN0V2l0aEZpbHRlcigoZnVuY3Rpb24oKXtyZXR1cm4gcn0pLG4sKGZ1bmN0aW9uKGUpe2lmKGUuc2VydmljZXMpZm9yKHZhciByPTA7cjxlLnNlcnZpY2VzLmxlbmd0aDtyKyspaWYoZS5zZXJ2aWNlc1tyXS5zZXJ2aWNlPT09dClyZXR1cm4gMX0pKTtjYXNlIDI6Y2FzZSJlbmQiOnJldHVybiBlLnN0b3AoKX19KSxlLHRoaXMpfSkpKSxmdW5jdGlvbihlLHQpe3JldHVybiBwLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pfSx7a2V5OiJzZW5kUGVlclJlcXVlc3RXaXRoRmlsdGVyIix2YWx1ZTooaD11KGkoKS5tYXJrKChmdW5jdGlvbiBlKCl7dmFyIHQscixuLG8sYSx1LHMsYyxsLGY9YXJndW1lbnRzO3JldHVybiBpKCkud3JhcCgoZnVuY3Rpb24oZSl7Zm9yKDs7KXN3aXRjaChlLnByZXY9ZS5uZXh0KXtjYXNlIDA6aWYodD1mLmxlbmd0aD4xJiZ2b2lkIDAhPT1mWzFdP2ZbMV06bnVsbCxyPWYubGVuZ3RoPjImJnZvaWQgMCE9PWZbMl0/ZlsyXTpudWxsLG51bGwhPT0obj0oZi5sZW5ndGg+MCYmdm9pZCAwIT09ZlswXT9mWzBdOm51bGwpKCkpKXtlLm5leHQ9NjticmVha31yZXR1cm4gZS5hYnJ1cHQoInJldHVybiIpO2Nhc2UgNjpyZXR1cm4gZS5uZXh0PTgsdGhpcy5hcHAubmV0d29yay5nZXRQZWVycygpO2Nhc2UgODpmb3Iobz1lLnNlbnQsYT1bXSx1PTA7dTxvLmxlbmd0aDt1KyspciYmIXIob1t1XSl8fGEucHVzaChvW3VdKTtpZigwIT09YS5sZW5ndGgpe2UubmV4dD0xNDticmVha31yZXR1cm4gY29uc29sZS53YXJuKCJzZW5kUGVlclJlcXVlc3RXaXRoRmlsdGVyIGZvdW5kIG5vIHBlZXJzIiksZS5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMTQ6Zm9yKHM9MCxjPWE7czxjLmxlbmd0aDtzKyspbD1jW3NdLHRoaXMuYXBwLm5ldHdvcmsuc2VuZFJlcXVlc3RBc1RyYW5zYWN0aW9uKG4ucmVxdWVzdCxuLmRhdGEsKGZ1bmN0aW9uKGUpe251bGwhPXQmJnQoZSl9KSxsLnBlZXJJbmRleCk7Y2FzZSAxNTpjYXNlImVuZCI6cmV0dXJuIGUuc3RvcCgpfX0pLGUsdGhpcyl9KSkpLGZ1bmN0aW9uKCl7cmV0dXJuIGguYXBwbHkodGhpcyxhcmd1bWVudHMpfSl9LHtrZXk6InNlbmRQZWVyRGF0YWJhc2VSZXF1ZXN0UmF3Iix2YWx1ZTooYz11KGkoKS5tYXJrKChmdW5jdGlvbiBlKHQscil7dmFyIG4sbyxhPWFyZ3VtZW50cztyZXR1cm4gaSgpLndyYXAoKGZ1bmN0aW9uKGUpe2Zvcig7Oylzd2l0Y2goZS5wcmV2PWUubmV4dCl7Y2FzZSAwOnJldHVybiBuPWEubGVuZ3RoPjImJnZvaWQgMCE9PWFbMl0/YVsyXTpudWxsLChvPXt9KS5yZXF1ZXN0PSJyYXdTUUwiLG8uZGF0YT17fSxvLmRhdGEuc3FsPXIsby5kYXRhLmRibmFtZT10LG8uZGF0YS5tb2R1bGU9dGhpcy5uYW1lLGUuYWJydXB0KCJyZXR1cm4iLHRoaXMuYXBwLm5ldHdvcmsuc2VuZFJlcXVlc3RBc1RyYW5zYWN0aW9uKG8ucmVxdWVzdCxvLmRhdGEsKGZ1bmN0aW9uKGUpe3JldHVybiBuKGUpfSkpKTtjYXNlIDg6Y2FzZSJlbmQiOnJldHVybiBlLnN0b3AoKX19KSxlLHRoaXMpfSkpKSxmdW5jdGlvbihlLHQpe3JldHVybiBjLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pfSx7a2V5OiJpc1NsdWciLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiBlPT10aGlzLnJldHVyblNsdWcoKX19LHtrZXk6InJldHVyblNsdWciLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIiIhPT10aGlzLnNsdWd8fCh0aGlzLmFwcG5hbWU/dGhpcy5zbHVnPXRoaXMuYXBwbmFtZS50b0xvd2VyQ2FzZSgpOnRoaXMuc2x1Zz10aGlzLm5hbWUudG9Mb3dlckNhc2UoKSx0aGlzLnNsdWc9dGhpcy5zbHVnLnJlcGxhY2UoL1x0L2csIl8iKS5yZXBsYWNlKC9cIC9nLCIiKSksdGhpcy5zbHVnfX0se2tleToicmV0dXJuTGluayIsdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4iIiE9PXRoaXMubGlua3x8KHRoaXMubGluaz0iLyIrdGhpcy5yZXR1cm5TbHVnKCkpLHRoaXMubGlua319LHtrZXk6ImhhbmRsZVVybFBhcmFtcyIsdmFsdWU6ZnVuY3Rpb24oZSl7fX0se2tleToic2hvd0FsZXJ0Iix2YWx1ZTpmdW5jdGlvbigpe3RoaXMuYWxlcnRzKys7dHJ5e3ZhciBlPSIjIit0aGlzLnJldHVyblNsdWcoKSsiID4gLnJlZGljb24iO2RvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZSkuc3R5bGUuZGlzcGxheT0iYmxvY2sifWNhdGNoKGUpe319fSx7a2V5OiJhdHRhY2hNZXRhIix2YWx1ZTpmdW5jdGlvbihlKXt9fSx7a2V5OiJhdHRhY2hTdHlsZVNoZWV0cyIsdmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT10aGlzOyEwIT09dGhpcy5zdHlsZXNoZWV0QWRkZWQmJih0aGlzLnN0eWxlcy5mb3JFYWNoKChmdW5jdGlvbih0KXt2YXIgcj0hMDtpZihkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJsaW5rIikuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dHJ5eyJzdHlsZXNoZWV0Ij09PShudWxsPT1lP3ZvaWQgMDplLnJlbCkmJmUuYXR0cmlidXRlcy5ocmVmLm5vZGVWYWx1ZS5pbmNsdWRlcyh0KSYmKHI9ITEpfWNhdGNoKGUpe319KSkscil7dmFyIG49ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGluayIpO24ucmVsPSJzdHlsZXNoZWV0IixuLnR5cGU9InRleHQvY3NzIixuLmhyZWY9dCsiP3Y9IitlLmFwcC5idWlsZF9udW1iZXIsZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiaGVhZCIpLmFwcGVuZENoaWxkKG4pfX0pKSx0aGlzLnN0eWxlc2hlZXRBZGRlZD0hMCl9fSx7a2V5OiJhdHRhY2hTY3JpcHRzIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPXRoaXM7aWYoITAhPT10aGlzLnNjcmlwdHNBZGRlZCl7dGhpcy5zY3JpcHRzQWRkZWQ9ITA7dmFyIHQscj1mdW5jdGlvbihlLHQpe3ZhciByPSJ1bmRlZmluZWQiIT10eXBlb2YgU3ltYm9sJiZlW1N5bWJvbC5pdGVyYXRvcl18fGVbIkBAaXRlcmF0b3IiXTtpZighcil7aWYoQXJyYXkuaXNBcnJheShlKXx8KHI9ZnVuY3Rpb24oZSx0KXtpZihlKXtpZigic3RyaW5nIj09dHlwZW9mIGUpcmV0dXJuIG8oZSx0KTt2YXIgcj1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZSkuc2xpY2UoOCwtMSk7cmV0dXJuIk9iamVjdCI9PT1yJiZlLmNvbnN0cnVjdG9yJiYocj1lLmNvbnN0cnVjdG9yLm5hbWUpLCJNYXAiPT09cnx8IlNldCI9PT1yP0FycmF5LmZyb20oZSk6IkFyZ3VtZW50cyI9PT1yfHwvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChyKT9vKGUsdCk6dm9pZCAwfX0oZSkpfHx0JiZlJiYibnVtYmVyIj09dHlwZW9mIGUubGVuZ3RoKXtyJiYoZT1yKTt2YXIgbj0wLGk9ZnVuY3Rpb24oKXt9O3JldHVybntzOmksbjpmdW5jdGlvbigpe3JldHVybiBuPj1lLmxlbmd0aD97ZG9uZTohMH06e2RvbmU6ITEsdmFsdWU6ZVtuKytdfX0sZTpmdW5jdGlvbihlKXt0aHJvdyBlfSxmOml9fXRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBpdGVyYXRlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKX12YXIgYSx1PSEwLHM9ITE7cmV0dXJue3M6ZnVuY3Rpb24oKXtyPXIuY2FsbChlKX0sbjpmdW5jdGlvbigpe3ZhciBlPXIubmV4dCgpO3JldHVybiB1PWUuZG9uZSxlfSxlOmZ1bmN0aW9uKGUpe3M9ITAsYT1lfSxmOmZ1bmN0aW9uKCl7dHJ5e3V8fG51bGw9PXIucmV0dXJufHxyLnJldHVybigpfWZpbmFsbHl7aWYocyl0aHJvdyBhfX19fSh0aGlzLnNjcmlwdHMpO3RyeXt2YXIgbj1mdW5jdGlvbigpe3ZhciByPXQudmFsdWUsbj0hMTtkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJzY3JpcHQiKS5mb3JFYWNoKChmdW5jdGlvbihlKXt0cnl7ZS5hdHRyaWJ1dGVzLnNyYy5ub2RlVmFsdWU9PT1yJiYobj0hMCl9Y2F0Y2goZSl7fX0pKSxufHxlLmF0dGFjaFNjcmlwdChyKX07Zm9yKHIucygpOyEodD1yLm4oKSkuZG9uZTspbigpfWNhdGNoKGUpe3IuZShlKX1maW5hbGx5e3IuZigpfX19fSx7a2V5OiJhdHRhY2hTY3JpcHQiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpO3JldHVybiB0LnR5cGU9InRleHQvamF2YXNjcmlwdCIsdC5zcmM9ZSsiP3Y9Iit0aGlzLmFwcC5idWlsZF9udW1iZXIsZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiaGVhZCIpLmFwcGVuZENoaWxkKHQpLG5ldyBQcm9taXNlKChmdW5jdGlvbihlLHIpe3QuYWRkRXZlbnRMaXN0ZW5lcigibG9hZCIsKGZ1bmN0aW9uKCl7Y29uc29sZS5sb2coIlNjcmlwdCBsb2FkZWQgZHluYW1pY2FsbHkiKSxlKCl9KSksdC5hZGRFdmVudExpc3RlbmVyKCJlcnJvciIsKGZ1bmN0aW9uKCl7Y29uc29sZS5sb2coIkVycm9yIGxvYWRpbmcgc2NyaXB0IikscigpfSkpfSkpfX0se2tleToiYXR0YWNoUG9zdFNjcmlwdHMiLHZhbHVlOmZ1bmN0aW9uKCl7ITAhPT10aGlzLnBvc3RTY3JpcHRzQWRkZWQmJih0aGlzLnBvc3RTY3JpcHRzLmZvckVhY2goKGZ1bmN0aW9uKGUpe3ZhciB0PSExO2lmKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoInNjcmlwdCIpLmZvckVhY2goKGZ1bmN0aW9uKHIpe3RyeXtyLmF0dHJpYnV0ZXMuc3JjLm5vZGVWYWx1ZT09PWUmJih0PSEwKX1jYXRjaChlKXt9fSkpLCF0KXt2YXIgcj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTtyLnR5cGU9InRleHQvamF2YXNjcmlwdCIsci5zcmM9ZSxyLnR5cGU9Im1vZHVsZSIsZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiYm9keSIpLmFwcGVuZENoaWxkKHIpfX0pKSx0aGlzLnBvc3RTY3JpcHRzQWRkZWQ9ITApfX0se2tleToicmVtb3ZlU2NyaXB0cyIsdmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnNjcmlwdHMuZm9yRWFjaCgoZnVuY3Rpb24oZSl7Y29uc29sZS5sb2coInJlbW92aW5nIHNjcmlwdCIsZSl9KSksdGhpcy5zY3JpcHRzQWRkZWQ9ITF9fSx7a2V5OiJyZW1vdmVTdHlsZVNoZWV0cyIsdmFsdWU6ZnVuY3Rpb24oZSl7dGhpcy5zdHlsZXNoZWV0cy5mb3JFYWNoKChmdW5jdGlvbihlKXtjb25zb2xlLmxvZygicmVtb3Zpbmcgc3R5bGVzaGVldCAiLGUpfSkpLHRoaXMuc3R5bGVzaGVldEFkZGVkPSExfX0se2tleToicmVtb3ZlTWV0YSIsdmFsdWU6ZnVuY3Rpb24oKXt9fSx7a2V5OiJyZW1vdmVFdmVudHMiLHZhbHVlOmZ1bmN0aW9uKCl7dGhpcy5ldmVudExpc3RlbmVycy5mb3JFYWNoKChmdW5jdGlvbihlKXtkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGUudHlwZSxlLmxpc3RlbmVyKX0pKX19LHtrZXk6ImRlc3Ryb3kiLHZhbHVlOmZ1bmN0aW9uKGUpe2NvbnNvbGUubG9nKCJkZXN0cm95aW5nIil9fSx7a2V5OiJkaXNwbGF5TW9kYWwiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXToiIjtzYWxlcnQoIiIuY29uY2F0KGUpLmNvbmNhdCh0PyI6IDxicj4iOiIiKS5jb25jYXQodCkpfX0se2tleToiZGlzcGxheVdhcm5pbmciLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MSYmdm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXToiIixyPWFyZ3VtZW50cy5sZW5ndGg+MiYmdm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTo0ZTMsbj0nPGRpdiBjbGFzcz0iZ2FtZV93YXJuaW5nX292ZXJsYXkiPlxuICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZ2FtZV93YXJuaW5nX2hlYWRlciI+XG4gICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZXhjbGFtYXRpb24tdHJpYW5nbGUiPjwvaT5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZ2FtZV93YXJuaW5nX3RpbWVyIiA+QXV0byBjbG9zZSBpbiA8c3BhbiBpZD0iY2xvY2tfbnVtYmVyIj4nLmNvbmNhdChNYXRoLmNlaWwoci8xZTMpLCI8L3NwYW4+czwvZGl2PiBcbiAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgPGgyPiIpLmNvbmNhdChlLCI8L2gyPlxuICAgICAgICAgICAgICAgICAgPHAgIikuY29uY2F0KDA9PXQubGVuZ3RoPyJzdHlsZT0nZmxleDoxOyciOiJzdHlsZT0nZmxleDoyOyciLCI+IikuY29uY2F0KHQsIjwvcD5cbiAgICAgICAgICAgICAgICA8L2Rpdj4iKSxvPXRoaXMub3ZlcmxheSxpPW51bGwsYT1udWxsO3I+MCYmKGk9c2V0VGltZW91dCgoZnVuY3Rpb24oKXtvLmhpZGUoKSxjbGVhckludGVydmFsKGEpfSksciksYT1zZXRJbnRlcnZhbCgoZnVuY3Rpb24oKXtyLT0yNTA7dHJ5e2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjbG9ja19udW1iZXIiKS5pbm5lckhUTUw9TWF0aC5jZWlsKHIvMWUzKX1jYXRjaChlKXt9fSksMjUwKSksdGhpcy5vdmVybGF5LnNob3cobiwoZnVuY3Rpb24oKXtpJiZjbGVhclRpbWVvdXQoaSksYSYmY2xlYXJJbnRlcnZhbChhKX0pKX19LHtrZXk6Im9uVXBncmFkZSIsdmFsdWU6KGE9dShpKCkubWFyaygoZnVuY3Rpb24gZSgpe3JldHVybiBpKCkud3JhcCgoZnVuY3Rpb24oZSl7Zm9yKDs7KXN3aXRjaChlLnByZXY9ZS5uZXh0KXtjYXNlIDA6Y29uc29sZS5sb2coIm9uVXBncmFkZSBpbnNpZGUgTW9kVGVtcGxhdGUuLi4iKTtjYXNlIDQ6Y2FzZSJlbmQiOnJldHVybiBlLnN0b3AoKX19KSxlKX0pKSksZnVuY3Rpb24oKXtyZXR1cm4gYS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KX0se2tleToiaGFzU2VlblRyYW5zYWN0aW9uIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLm5hbWUrZS5zaWduYXR1cmU7cmV0dXJuISF0aGlzLnByb2Nlc3NlZFR4c1t0XXx8KHRoaXMucHJvY2Vzc2VkVHhzW3RdPSEwLCExKX19XSxuPVt7a2V5OiJpbXBvcnRGdW5jdGlvbnMiLHZhbHVlOmZ1bmN0aW9uKCl7Zm9yKHZhciBlLHQ9dGhpcy5wcm90b3R5cGUscj0wO3I8YXJndW1lbnRzLmxlbmd0aDtyKyspdm9pZCAwIT09KGU9YXJndW1lbnRzW3JdLnByb3RvdHlwZSkmJk9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGUpLmZvckVhY2goKGZ1bmN0aW9uKHIpeyJjb25zdHJ1Y3RvciIhPXImJihPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0KS5pbmNsdWRlcyhyKT9jb25zb2xlLmVycm9yKCJNb2R1bGUgYWxyZWFkeSBpbmNsdWRlcyAiK3IpOnRbcl09ZVtyXSl9KSl9fV0sciYmcyh0LnByb3RvdHlwZSxyKSxuJiZzKHQsbiksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsInByb3RvdHlwZSIse3dyaXRhYmxlOiExfSksZX0oKTtlLmV4cG9ydHM9aH0sMjUyOihlLHQscik9PntmdW5jdGlvbiBuKGUpe3JldHVybiBuPSJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJiJzeW1ib2wiPT10eXBlb2YgU3ltYm9sLml0ZXJhdG9yP2Z1bmN0aW9uKGUpe3JldHVybiB0eXBlb2YgZX06ZnVuY3Rpb24oZSl7cmV0dXJuIGUmJiJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJmUuY29uc3RydWN0b3I9PT1TeW1ib2wmJmUhPT1TeW1ib2wucHJvdG90eXBlPyJzeW1ib2wiOnR5cGVvZiBlfSxuKGUpfWZ1bmN0aW9uIG8oZSx0KXtmb3IodmFyIHI9MDtyPHQubGVuZ3RoO3IrKyl7dmFyIG49dFtyXTtuLmVudW1lcmFibGU9bi5lbnVtZXJhYmxlfHwhMSxuLmNvbmZpZ3VyYWJsZT0hMCwidmFsdWUiaW4gbiYmKG4ud3JpdGFibGU9ITApLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLGkobi5rZXkpLG4pfX1mdW5jdGlvbiBpKGUpe3ZhciB0PWZ1bmN0aW9uKGUsdCl7aWYoIm9iamVjdCIhPW4oZSl8fCFlKXJldHVybiBlO3ZhciByPWVbU3ltYm9sLnRvUHJpbWl0aXZlXTtpZih2b2lkIDAhPT1yKXt2YXIgbz1yLmNhbGwoZSwic3RyaW5nIik7aWYoIm9iamVjdCIhPW4obykpcmV0dXJuIG87dGhyb3cgbmV3IFR5cGVFcnJvcigiQEB0b1ByaW1pdGl2ZSBtdXN0IHJldHVybiBhIHByaW1pdGl2ZSB2YWx1ZS4iKX1yZXR1cm4gU3RyaW5nKGUpfShlKTtyZXR1cm4ic3ltYm9sIj09bih0KT90OlN0cmluZyh0KX1mdW5jdGlvbiBhKCl7cmV0dXJuIGE9InVuZGVmaW5lZCIhPXR5cGVvZiBSZWZsZWN0JiZSZWZsZWN0LmdldD9SZWZsZWN0LmdldC5iaW5kKCk6ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWZ1bmN0aW9uKGUsdCl7Zm9yKDshT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsdCkmJm51bGwhPT0oZT1zKGUpKTspO3JldHVybiBlfShlLHQpO2lmKG4pe3ZhciBvPU9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iobix0KTtyZXR1cm4gby5nZXQ/by5nZXQuY2FsbChhcmd1bWVudHMubGVuZ3RoPDM/ZTpyKTpvLnZhbHVlfX0sYS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9ZnVuY3Rpb24gdShlLHQpe3JldHVybiB1PU9iamVjdC5zZXRQcm90b3R5cGVPZj9PYmplY3Quc2V0UHJvdG90eXBlT2YuYmluZCgpOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUuX19wcm90b19fPXQsZX0sdShlLHQpfWZ1bmN0aW9uIHMoZSl7cmV0dXJuIHM9T2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5nZXRQcm90b3R5cGVPZi5iaW5kKCk6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuX19wcm90b19ffHxPYmplY3QuZ2V0UHJvdG90eXBlT2YoZSl9LHMoZSl9dmFyIGM9ZnVuY3Rpb24oZSl7IWZ1bmN0aW9uKGUsdCl7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIHQmJm51bGwhPT10KXRocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7ZS5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZSh0JiZ0LnByb3RvdHlwZSx7Y29uc3RydWN0b3I6e3ZhbHVlOmUsd3JpdGFibGU6ITAsY29uZmlndXJhYmxlOiEwfX0pLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCJwcm90b3R5cGUiLHt3cml0YWJsZTohMX0pLHQmJnUoZSx0KX0oZixlKTt2YXIgdCxyLGksYyxsPShpPWYsYz1mdW5jdGlvbigpe2lmKCJ1bmRlZmluZWQiPT10eXBlb2YgUmVmbGVjdHx8IVJlZmxlY3QuY29uc3RydWN0KXJldHVybiExO2lmKFJlZmxlY3QuY29uc3RydWN0LnNoYW0pcmV0dXJuITE7aWYoImZ1bmN0aW9uIj09dHlwZW9mIFByb3h5KXJldHVybiEwO3RyeXtyZXR1cm4gQm9vbGVhbi5wcm90b3R5cGUudmFsdWVPZi5jYWxsKFJlZmxlY3QuY29uc3RydWN0KEJvb2xlYW4sW10sKGZ1bmN0aW9uKCl7fSkpKSwhMH1jYXRjaChlKXtyZXR1cm4hMX19KCksZnVuY3Rpb24oKXt2YXIgZSx0PXMoaSk7aWYoYyl7dmFyIHI9cyh0aGlzKS5jb25zdHJ1Y3RvcjtlPVJlZmxlY3QuY29uc3RydWN0KHQsYXJndW1lbnRzLHIpfWVsc2UgZT10LmFwcGx5KHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gZnVuY3Rpb24oZSx0KXtpZih0JiYoIm9iamVjdCI9PT1uKHQpfHwiZnVuY3Rpb24iPT10eXBlb2YgdCkpcmV0dXJuIHQ7aWYodm9pZCAwIT09dCl0aHJvdyBuZXcgVHlwZUVycm9yKCJEZXJpdmVkIGNvbnN0cnVjdG9ycyBtYXkgb25seSByZXR1cm4gb2JqZWN0IG9yIHVuZGVmaW5lZCIpO3JldHVybiBmdW5jdGlvbihlKXtpZih2b2lkIDA9PT1lKXRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7cmV0dXJuIGV9KGUpfSh0aGlzLGUpfSk7ZnVuY3Rpb24gZihlKXt2YXIgdDtyZXR1cm4gZnVuY3Rpb24oZSx0KXtpZighKGUgaW5zdGFuY2VvZiB0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX0odGhpcyxmKSx0PWwuY2FsbCh0aGlzLGUpLGNvbnNvbGUubG9nKCJkeW4gbW9kdWxlIGxvYWRlZCIpLHQubmFtZT0iRHluIix0fXJldHVybiB0PWYscj1be2tleToicmVzcG9uZFRvIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXToiIix0PWFyZ3VtZW50cy5sZW5ndGg+MT9hcmd1bWVudHNbMV06dm9pZCAwO3JldHVybiBjb25zb2xlLmxvZygiZHluIHJlc3BvbmRpbmcgdG8gIitlKSxhKHMoZi5wcm90b3R5cGUpLCJyZXNwb25kVG8iLHRoaXMpLmNhbGwodGhpcyxlLHQpfX1dLHImJm8odC5wcm90b3R5cGUsciksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsInByb3RvdHlwZSIse3dyaXRhYmxlOiExfSksZn0ocig2MDEpKTtlLmV4cG9ydHM9Y30sNTE4OmZ1bmN0aW9uKGUsdCxyKXt2YXIgbjtmdW5jdGlvbiBvKGUpe3JldHVybiBvPSJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJiJzeW1ib2wiPT10eXBlb2YgU3ltYm9sLml0ZXJhdG9yP2Z1bmN0aW9uKGUpe3JldHVybiB0eXBlb2YgZX06ZnVuY3Rpb24oZSl7cmV0dXJuIGUmJiJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJmUuY29uc3RydWN0b3I9PT1TeW1ib2wmJmUhPT1TeW1ib2wucHJvdG90eXBlPyJzeW1ib2wiOnR5cGVvZiBlfSxvKGUpfSFmdW5jdGlvbihpKXsidXNlIHN0cmljdCI7dmFyIGEsdT0vXi0/KD86XGQrKD86XC5cZCopP3xcLlxkKykoPzplWystXT9cZCspPyQvaSxzPU1hdGguY2VpbCxjPU1hdGguZmxvb3IsbD0iW0JpZ051bWJlciBFcnJvcl0gIixmPWwrIk51bWJlciBwcmltaXRpdmUgaGFzIG1vcmUgdGhhbiAxNSBzaWduaWZpY2FudCBkaWdpdHM6ICIsaD0xZTE0LHA9MTQsZD05MDA3MTk5MjU0NzQwOTkxLHY9WzEsMTAsMTAwLDFlMywxZTQsMWU1LDFlNiwxZTcsMWU4LDFlOSwxZTEwLDFlMTEsMWUxMiwxZTEzXSx5PTFlNyxnPTFlOTtmdW5jdGlvbiBtKGUpe3ZhciB0PTB8ZTtyZXR1cm4gZT4wfHxlPT09dD90OnQtMX1mdW5jdGlvbiBiKGUpe2Zvcih2YXIgdCxyLG49MSxvPWUubGVuZ3RoLGk9ZVswXSsiIjtuPG87KXtmb3IodD1lW24rK10rIiIscj1wLXQubGVuZ3RoO3ItLTt0PSIwIit0KTtpKz10fWZvcihvPWkubGVuZ3RoOzQ4PT09aS5jaGFyQ29kZUF0KC0tbyk7KTtyZXR1cm4gaS5zbGljZSgwLG8rMXx8MSl9ZnVuY3Rpb24gdyhlLHQpe3ZhciByLG4sbz1lLmMsaT10LmMsYT1lLnMsdT10LnMscz1lLmUsYz10LmU7aWYoIWF8fCF1KXJldHVybiBudWxsO2lmKHI9byYmIW9bMF0sbj1pJiYhaVswXSxyfHxuKXJldHVybiByP24/MDotdTphO2lmKGEhPXUpcmV0dXJuIGE7aWYocj1hPDAsbj1zPT1jLCFvfHwhaSlyZXR1cm4gbj8wOiFvXnI/MTotMTtpZighbilyZXR1cm4gcz5jXnI/MTotMTtmb3IodT0ocz1vLmxlbmd0aCk8KGM9aS5sZW5ndGgpP3M6YyxhPTA7YTx1O2ErKylpZihvW2FdIT1pW2FdKXJldHVybiBvW2FdPmlbYV1ecj8xOi0xO3JldHVybiBzPT1jPzA6cz5jXnI/MTotMX1mdW5jdGlvbiBrKGUsdCxyLG4pe2lmKGU8dHx8ZT5yfHxlIT09YyhlKSl0aHJvdyBFcnJvcihsKyhufHwiQXJndW1lbnQiKSsoIm51bWJlciI9PXR5cGVvZiBlP2U8dHx8ZT5yPyIgb3V0IG9mIHJhbmdlOiAiOiIgbm90IGFuIGludGVnZXI6ICI6IiBub3QgYSBwcmltaXRpdmUgbnVtYmVyOiAiKStTdHJpbmcoZSkpfWZ1bmN0aW9uIHgoZSl7dmFyIHQ9ZS5jLmxlbmd0aC0xO3JldHVybiBtKGUuZS9wKT09dCYmZS5jW3RdJTIhPTB9ZnVuY3Rpb24gUyhlLHQpe3JldHVybihlLmxlbmd0aD4xP2UuY2hhckF0KDApKyIuIitlLnNsaWNlKDEpOmUpKyh0PDA/ImUiOiJlKyIpK3R9ZnVuY3Rpb24gQShlLHQscil7dmFyIG4sbztpZih0PDApe2ZvcihvPXIrIi4iOysrdDtvKz1yKTtlPW8rZX1lbHNlIGlmKCsrdD4obj1lLmxlbmd0aCkpe2ZvcihvPXIsdC09bjstLXQ7bys9cik7ZSs9b31lbHNlIHQ8biYmKGU9ZS5zbGljZSgwLHQpKyIuIitlLnNsaWNlKHQpKTtyZXR1cm4gZX1hPWZ1bmN0aW9uIGUodCl7dmFyIHIsbixpLGEsRSxPLF8sTixQLFQsTD1ILnByb3RvdHlwZT17Y29uc3RydWN0b3I6SCx0b1N0cmluZzpudWxsLHZhbHVlT2Y6bnVsbH0saj1uZXcgSCgxKSxDPTIwLFI9NCxxPS03LEk9MjEsQj0tMWU3LEY9MWU3LE09ITEsRD0xLFU9MCxHPXtwcmVmaXg6IiIsZ3JvdXBTaXplOjMsc2Vjb25kYXJ5R3JvdXBTaXplOjAsZ3JvdXBTZXBhcmF0b3I6IiwiLGRlY2ltYWxTZXBhcmF0b3I6Ii4iLGZyYWN0aW9uR3JvdXBTaXplOjAsZnJhY3Rpb25Hcm91cFNlcGFyYXRvcjoiwqAiLHN1ZmZpeDoiIn0sej0iMDEyMzQ1Njc4OWFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6IixXPSEwO2Z1bmN0aW9uIEgoZSx0KXt2YXIgcixvLGEscyxsLGgsdix5LGc9dGhpcztpZighKGcgaW5zdGFuY2VvZiBIKSlyZXR1cm4gbmV3IEgoZSx0KTtpZihudWxsPT10KXtpZihlJiYhMD09PWUuX2lzQmlnTnVtYmVyKXJldHVybiBnLnM9ZS5zLHZvaWQoIWUuY3x8ZS5lPkY/Zy5jPWcuZT1udWxsOmUuZTxCP2cuYz1bZy5lPTBdOihnLmU9ZS5lLGcuYz1lLmMuc2xpY2UoKSkpO2lmKChoPSJudW1iZXIiPT10eXBlb2YgZSkmJjAqZT09MCl7aWYoZy5zPTEvZTwwPyhlPS1lLC0xKToxLGU9PT1+fmUpe2ZvcihzPTAsbD1lO2w+PTEwO2wvPTEwLHMrKyk7cmV0dXJuIHZvaWQocz5GP2cuYz1nLmU9bnVsbDooZy5lPXMsZy5jPVtlXSkpfXk9U3RyaW5nKGUpfWVsc2V7aWYoIXUudGVzdCh5PVN0cmluZyhlKSkpcmV0dXJuIGkoZyx5LGgpO2cucz00NT09eS5jaGFyQ29kZUF0KDApPyh5PXkuc2xpY2UoMSksLTEpOjF9KHM9eS5pbmRleE9mKCIuIikpPi0xJiYoeT15LnJlcGxhY2UoIi4iLCIiKSksKGw9eS5zZWFyY2goL2UvaSkpPjA/KHM8MCYmKHM9bCkscys9K3kuc2xpY2UobCsxKSx5PXkuc3Vic3RyaW5nKDAsbCkpOnM8MCYmKHM9eS5sZW5ndGgpfWVsc2V7aWYoayh0LDIsei5sZW5ndGgsIkJhc2UiKSwxMD09dCYmVylyZXR1cm4gSyhnPW5ldyBIKGUpLEMrZy5lKzEsUik7aWYoeT1TdHJpbmcoZSksaD0ibnVtYmVyIj09dHlwZW9mIGUpe2lmKDAqZSE9MClyZXR1cm4gaShnLHksaCx0KTtpZihnLnM9MS9lPDA/KHk9eS5zbGljZSgxKSwtMSk6MSxILkRFQlVHJiZ5LnJlcGxhY2UoL14wXC4wKnxcLi8sIiIpLmxlbmd0aD4xNSl0aHJvdyBFcnJvcihmK2UpfWVsc2UgZy5zPTQ1PT09eS5jaGFyQ29kZUF0KDApPyh5PXkuc2xpY2UoMSksLTEpOjE7Zm9yKHI9ei5zbGljZSgwLHQpLHM9bD0wLHY9eS5sZW5ndGg7bDx2O2wrKylpZihyLmluZGV4T2Yobz15LmNoYXJBdChsKSk8MCl7aWYoIi4iPT1vKXtpZihsPnMpe3M9djtjb250aW51ZX19ZWxzZSBpZighYSYmKHk9PXkudG9VcHBlckNhc2UoKSYmKHk9eS50b0xvd2VyQ2FzZSgpKXx8eT09eS50b0xvd2VyQ2FzZSgpJiYoeT15LnRvVXBwZXJDYXNlKCkpKSl7YT0hMCxsPS0xLHM9MDtjb250aW51ZX1yZXR1cm4gaShnLFN0cmluZyhlKSxoLHQpfWg9ITEsKHM9KHk9bih5LHQsMTAsZy5zKSkuaW5kZXhPZigiLiIpKT4tMT95PXkucmVwbGFjZSgiLiIsIiIpOnM9eS5sZW5ndGh9Zm9yKGw9MDs0OD09PXkuY2hhckNvZGVBdChsKTtsKyspO2Zvcih2PXkubGVuZ3RoOzQ4PT09eS5jaGFyQ29kZUF0KC0tdik7KTtpZih5PXkuc2xpY2UobCwrK3YpKXtpZih2LT1sLGgmJkguREVCVUcmJnY+MTUmJihlPmR8fGUhPT1jKGUpKSl0aHJvdyBFcnJvcihmK2cucyplKTtpZigocz1zLWwtMSk+RilnLmM9Zy5lPW51bGw7ZWxzZSBpZihzPEIpZy5jPVtnLmU9MF07ZWxzZXtpZihnLmU9cyxnLmM9W10sbD0ocysxKSVwLHM8MCYmKGwrPXApLGw8dil7Zm9yKGwmJmcuYy5wdXNoKCt5LnNsaWNlKDAsbCkpLHYtPXA7bDx2OylnLmMucHVzaCgreS5zbGljZShsLGwrPXApKTtsPXAtKHk9eS5zbGljZShsKSkubGVuZ3RofWVsc2UgbC09djtmb3IoO2wtLTt5Kz0iMCIpO2cuYy5wdXNoKCt5KX19ZWxzZSBnLmM9W2cuZT0wXX1mdW5jdGlvbiAkKGUsdCxyLG4pe3ZhciBvLGksYSx1LHM7aWYobnVsbD09cj9yPVI6ayhyLDAsOCksIWUuYylyZXR1cm4gZS50b1N0cmluZygpO2lmKG89ZS5jWzBdLGE9ZS5lLG51bGw9PXQpcz1iKGUuYykscz0xPT1ufHwyPT1uJiYoYTw9cXx8YT49SSk/UyhzLGEpOkEocyxhLCIwIik7ZWxzZSBpZihpPShlPUsobmV3IEgoZSksdCxyKSkuZSx1PShzPWIoZS5jKSkubGVuZ3RoLDE9PW58fDI9PW4mJih0PD1pfHxpPD1xKSl7Zm9yKDt1PHQ7cys9IjAiLHUrKyk7cz1TKHMsaSl9ZWxzZSBpZih0LT1hLHM9QShzLGksIjAiKSxpKzE+dSl7aWYoLS10PjApZm9yKHMrPSIuIjt0LS07cys9IjAiKTt9ZWxzZSBpZigodCs9aS11KT4wKWZvcihpKzE9PXUmJihzKz0iLiIpO3QtLTtzKz0iMCIpO3JldHVybiBlLnM8MCYmbz8iLSIrczpzfWZ1bmN0aW9uIFYoZSx0KXtmb3IodmFyIHIsbixvPTEsaT1uZXcgSChlWzBdKTtvPGUubGVuZ3RoO28rKykoIShuPW5ldyBIKGVbb10pKS5zfHwocj13KGksbikpPT09dHx8MD09PXImJmkucz09PXQpJiYoaT1uKTtyZXR1cm4gaX1mdW5jdGlvbiBKKGUsdCxyKXtmb3IodmFyIG49MSxvPXQubGVuZ3RoOyF0Wy0tb107dC5wb3AoKSk7Zm9yKG89dFswXTtvPj0xMDtvLz0xMCxuKyspO3JldHVybihyPW4rcipwLTEpPkY/ZS5jPWUuZT1udWxsOnI8Qj9lLmM9W2UuZT0wXTooZS5lPXIsZS5jPXQpLGV9ZnVuY3Rpb24gSyhlLHQscixuKXt2YXIgbyxpLGEsdSxsLGYsZCx5PWUuYyxnPXY7aWYoeSl7ZTp7Zm9yKG89MSx1PXlbMF07dT49MTA7dS89MTAsbysrKTtpZigoaT10LW8pPDApaSs9cCxhPXQsbD15W2Y9MF0sZD1jKGwvZ1tvLWEtMV0lMTApO2Vsc2UgaWYoKGY9cygoaSsxKS9wKSk+PXkubGVuZ3RoKXtpZighbilicmVhayBlO2Zvcig7eS5sZW5ndGg8PWY7eS5wdXNoKDApKTtsPWQ9MCxvPTEsYT0oaSU9cCktcCsxfWVsc2V7Zm9yKGw9dT15W2ZdLG89MTt1Pj0xMDt1Lz0xMCxvKyspO2Q9KGE9KGklPXApLXArbyk8MD8wOmMobC9nW28tYS0xXSUxMCl9aWYobj1ufHx0PDB8fG51bGwhPXlbZisxXXx8KGE8MD9sOmwlZ1tvLWEtMV0pLG49cjw0PyhkfHxuKSYmKDA9PXJ8fHI9PShlLnM8MD8zOjIpKTpkPjV8fDU9PWQmJig0PT1yfHxufHw2PT1yJiYoaT4wP2E+MD9sL2dbby1hXTowOnlbZi0xXSklMTAmMXx8cj09KGUuczwwPzg6NykpLHQ8MXx8IXlbMF0pcmV0dXJuIHkubGVuZ3RoPTAsbj8odC09ZS5lKzEseVswXT1nWyhwLXQlcCklcF0sZS5lPS10fHwwKTp5WzBdPWUuZT0wLGU7aWYoMD09aT8oeS5sZW5ndGg9Zix1PTEsZi0tKTooeS5sZW5ndGg9ZisxLHU9Z1twLWldLHlbZl09YT4wP2MobC9nW28tYV0lZ1thXSkqdTowKSxuKWZvcig7Oyl7aWYoMD09Zil7Zm9yKGk9MSxhPXlbMF07YT49MTA7YS89MTAsaSsrKTtmb3IoYT15WzBdKz11LHU9MTthPj0xMDthLz0xMCx1KyspO2khPXUmJihlLmUrKyx5WzBdPT1oJiYoeVswXT0xKSk7YnJlYWt9aWYoeVtmXSs9dSx5W2ZdIT1oKWJyZWFrO3lbZi0tXT0wLHU9MX1mb3IoaT15Lmxlbmd0aDswPT09eVstLWldO3kucG9wKCkpO31lLmU+Rj9lLmM9ZS5lPW51bGw6ZS5lPEImJihlLmM9W2UuZT0wXSl9cmV0dXJuIGV9ZnVuY3Rpb24gWShlKXt2YXIgdCxyPWUuZTtyZXR1cm4gbnVsbD09PXI/ZS50b1N0cmluZygpOih0PWIoZS5jKSx0PXI8PXF8fHI+PUk/Uyh0LHIpOkEodCxyLCIwIiksZS5zPDA/Ii0iK3Q6dCl9cmV0dXJuIEguY2xvbmU9ZSxILlJPVU5EX1VQPTAsSC5ST1VORF9ET1dOPTEsSC5ST1VORF9DRUlMPTIsSC5ST1VORF9GTE9PUj0zLEguUk9VTkRfSEFMRl9VUD00LEguUk9VTkRfSEFMRl9ET1dOPTUsSC5ST1VORF9IQUxGX0VWRU49NixILlJPVU5EX0hBTEZfQ0VJTD03LEguUk9VTkRfSEFMRl9GTE9PUj04LEguRVVDTElEPTksSC5jb25maWc9SC5zZXQ9ZnVuY3Rpb24oZSl7dmFyIHQscjtpZihudWxsIT1lKXtpZigib2JqZWN0IiE9byhlKSl0aHJvdyBFcnJvcihsKyJPYmplY3QgZXhwZWN0ZWQ6ICIrZSk7aWYoZS5oYXNPd25Qcm9wZXJ0eSh0PSJERUNJTUFMX1BMQUNFUyIpJiYoayhyPWVbdF0sMCxnLHQpLEM9ciksZS5oYXNPd25Qcm9wZXJ0eSh0PSJST1VORElOR19NT0RFIikmJihrKHI9ZVt0XSwwLDgsdCksUj1yKSxlLmhhc093blByb3BlcnR5KHQ9IkVYUE9ORU5USUFMX0FUIikmJigocj1lW3RdKSYmci5wb3A/KGsoclswXSwtZywwLHQpLGsoclsxXSwwLGcsdCkscT1yWzBdLEk9clsxXSk6KGsociwtZyxnLHQpLHE9LShJPXI8MD8tcjpyKSkpLGUuaGFzT3duUHJvcGVydHkodD0iUkFOR0UiKSlpZigocj1lW3RdKSYmci5wb3ApayhyWzBdLC1nLC0xLHQpLGsoclsxXSwxLGcsdCksQj1yWzBdLEY9clsxXTtlbHNle2lmKGsociwtZyxnLHQpLCFyKXRocm93IEVycm9yKGwrdCsiIGNhbm5vdCBiZSB6ZXJvOiAiK3IpO0I9LShGPXI8MD8tcjpyKX1pZihlLmhhc093blByb3BlcnR5KHQ9IkNSWVBUTyIpKXtpZigocj1lW3RdKSE9PSEhcil0aHJvdyBFcnJvcihsK3QrIiBub3QgdHJ1ZSBvciBmYWxzZTogIityKTtpZihyKXtpZigidW5kZWZpbmVkIj09dHlwZW9mIGNyeXB0b3x8IWNyeXB0b3x8IWNyeXB0by5nZXRSYW5kb21WYWx1ZXMmJiFjcnlwdG8ucmFuZG9tQnl0ZXMpdGhyb3cgTT0hcixFcnJvcihsKyJjcnlwdG8gdW5hdmFpbGFibGUiKTtNPXJ9ZWxzZSBNPXJ9aWYoZS5oYXNPd25Qcm9wZXJ0eSh0PSJNT0RVTE9fTU9ERSIpJiYoayhyPWVbdF0sMCw5LHQpLEQ9ciksZS5oYXNPd25Qcm9wZXJ0eSh0PSJQT1dfUFJFQ0lTSU9OIikmJihrKHI9ZVt0XSwwLGcsdCksVT1yKSxlLmhhc093blByb3BlcnR5KHQ9IkZPUk1BVCIpKXtpZigib2JqZWN0IiE9byhyPWVbdF0pKXRocm93IEVycm9yKGwrdCsiIG5vdCBhbiBvYmplY3Q6ICIrcik7Rz1yfWlmKGUuaGFzT3duUHJvcGVydHkodD0iQUxQSEFCRVQiKSl7aWYoInN0cmluZyIhPXR5cGVvZihyPWVbdF0pfHwvXi4/JHxbK1wtLlxzXXwoLikuKlwxLy50ZXN0KHIpKXRocm93IEVycm9yKGwrdCsiIGludmFsaWQ6ICIrcik7Vz0iMDEyMzQ1Njc4OSI9PXIuc2xpY2UoMCwxMCksej1yfX1yZXR1cm57REVDSU1BTF9QTEFDRVM6QyxST1VORElOR19NT0RFOlIsRVhQT05FTlRJQUxfQVQ6W3EsSV0sUkFOR0U6W0IsRl0sQ1JZUFRPOk0sTU9EVUxPX01PREU6RCxQT1dfUFJFQ0lTSU9OOlUsRk9STUFUOkcsQUxQSEFCRVQ6en19LEguaXNCaWdOdW1iZXI9ZnVuY3Rpb24oZSl7aWYoIWV8fCEwIT09ZS5faXNCaWdOdW1iZXIpcmV0dXJuITE7aWYoIUguREVCVUcpcmV0dXJuITA7dmFyIHQscixuPWUuYyxvPWUuZSxpPWUucztlOmlmKCJbb2JqZWN0IEFycmF5XSI9PXt9LnRvU3RyaW5nLmNhbGwobikpe2lmKCgxPT09aXx8LTE9PT1pKSYmbz49LWcmJm88PWcmJm89PT1jKG8pKXtpZigwPT09blswXSl7aWYoMD09PW8mJjE9PT1uLmxlbmd0aClyZXR1cm4hMDticmVhayBlfWlmKCh0PShvKzEpJXApPDEmJih0Kz1wKSxTdHJpbmcoblswXSkubGVuZ3RoPT10KXtmb3IodD0wO3Q8bi5sZW5ndGg7dCsrKWlmKChyPW5bdF0pPDB8fHI+PWh8fHIhPT1jKHIpKWJyZWFrIGU7aWYoMCE9PXIpcmV0dXJuITB9fX1lbHNlIGlmKG51bGw9PT1uJiZudWxsPT09byYmKG51bGw9PT1pfHwxPT09aXx8LTE9PT1pKSlyZXR1cm4hMDt0aHJvdyBFcnJvcihsKyJJbnZhbGlkIEJpZ051bWJlcjogIitlKX0sSC5tYXhpbXVtPUgubWF4PWZ1bmN0aW9uKCl7cmV0dXJuIFYoYXJndW1lbnRzLC0xKX0sSC5taW5pbXVtPUgubWluPWZ1bmN0aW9uKCl7cmV0dXJuIFYoYXJndW1lbnRzLDEpfSxILnJhbmRvbT0oYT05MDA3MTk5MjU0NzQwOTkyLEU9TWF0aC5yYW5kb20oKSphJjIwOTcxNTE/ZnVuY3Rpb24oKXtyZXR1cm4gYyhNYXRoLnJhbmRvbSgpKmEpfTpmdW5jdGlvbigpe3JldHVybiA4Mzg4NjA4KigxMDczNzQxODI0Kk1hdGgucmFuZG9tKCl8MCkrKDgzODg2MDgqTWF0aC5yYW5kb20oKXwwKX0sZnVuY3Rpb24oZSl7dmFyIHQscixuLG8saSxhPTAsdT1bXSxmPW5ldyBIKGopO2lmKG51bGw9PWU/ZT1DOmsoZSwwLGcpLG89cyhlL3ApLE0paWYoY3J5cHRvLmdldFJhbmRvbVZhbHVlcyl7Zm9yKHQ9Y3J5cHRvLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDMyQXJyYXkobyo9MikpO2E8bzspKGk9MTMxMDcyKnRbYV0rKHRbYSsxXT4+PjExKSk+PTllMTU/KHI9Y3J5cHRvLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDMyQXJyYXkoMikpLHRbYV09clswXSx0W2ErMV09clsxXSk6KHUucHVzaChpJTFlMTQpLGErPTIpO2E9by8yfWVsc2V7aWYoIWNyeXB0by5yYW5kb21CeXRlcyl0aHJvdyBNPSExLEVycm9yKGwrImNyeXB0byB1bmF2YWlsYWJsZSIpO2Zvcih0PWNyeXB0by5yYW5kb21CeXRlcyhvKj03KTthPG87KShpPTI4MTQ3NDk3NjcxMDY1NiooMzEmdFthXSkrMTA5OTUxMTYyNzc3Nip0W2ErMV0rNDI5NDk2NzI5Nip0W2ErMl0rMTY3NzcyMTYqdFthKzNdKyh0W2ErNF08PDE2KSsodFthKzVdPDw4KSt0W2ErNl0pPj05ZTE1P2NyeXB0by5yYW5kb21CeXRlcyg3KS5jb3B5KHQsYSk6KHUucHVzaChpJTFlMTQpLGErPTcpO2E9by83fWlmKCFNKWZvcig7YTxvOykoaT1FKCkpPDllMTUmJih1W2ErK109aSUxZTE0KTtmb3Iobz11Wy0tYV0sZSU9cCxvJiZlJiYoaT12W3AtZV0sdVthXT1jKG8vaSkqaSk7MD09PXVbYV07dS5wb3AoKSxhLS0pO2lmKGE8MCl1PVtuPTBdO2Vsc2V7Zm9yKG49LTE7MD09PXVbMF07dS5zcGxpY2UoMCwxKSxuLT1wKTtmb3IoYT0xLGk9dVswXTtpPj0xMDtpLz0xMCxhKyspO2E8cCYmKG4tPXAtYSl9cmV0dXJuIGYuZT1uLGYuYz11LGZ9KSxILnN1bT1mdW5jdGlvbigpe2Zvcih2YXIgZT0xLHQ9YXJndW1lbnRzLHI9bmV3IEgodFswXSk7ZTx0Lmxlbmd0aDspcj1yLnBsdXModFtlKytdKTtyZXR1cm4gcn0sbj1mdW5jdGlvbigpe3ZhciBlPSIwMTIzNDU2Nzg5IjtmdW5jdGlvbiB0KGUsdCxyLG4pe2Zvcih2YXIgbyxpLGE9WzBdLHU9MCxzPWUubGVuZ3RoO3U8czspe2ZvcihpPWEubGVuZ3RoO2ktLTthW2ldKj10KTtmb3IoYVswXSs9bi5pbmRleE9mKGUuY2hhckF0KHUrKykpLG89MDtvPGEubGVuZ3RoO28rKylhW29dPnItMSYmKG51bGw9PWFbbysxXSYmKGFbbysxXT0wKSxhW28rMV0rPWFbb10vcnwwLGFbb10lPXIpfXJldHVybiBhLnJldmVyc2UoKX1yZXR1cm4gZnVuY3Rpb24obixvLGksYSx1KXt2YXIgcyxjLGwsZixoLHAsZCx2LHk9bi5pbmRleE9mKCIuIiksZz1DLG09Ujtmb3IoeT49MCYmKGY9VSxVPTAsbj1uLnJlcGxhY2UoIi4iLCIiKSxwPSh2PW5ldyBIKG8pKS5wb3cobi5sZW5ndGgteSksVT1mLHYuYz10KEEoYihwLmMpLHAuZSwiMCIpLDEwLGksZSksdi5lPXYuYy5sZW5ndGgpLGw9Zj0oZD10KG4sbyxpLHU/KHM9eixlKToocz1lLHopKSkubGVuZ3RoOzA9PWRbLS1mXTtkLnBvcCgpKTtpZighZFswXSlyZXR1cm4gcy5jaGFyQXQoMCk7aWYoeTwwPy0tbDoocC5jPWQscC5lPWwscC5zPWEsZD0ocD1yKHAsdixnLG0saSkpLmMsaD1wLnIsbD1wLmUpLHk9ZFtjPWwrZysxXSxmPWkvMixoPWh8fGM8MHx8bnVsbCE9ZFtjKzFdLGg9bTw0PyhudWxsIT15fHxoKSYmKDA9PW18fG09PShwLnM8MD8zOjIpKTp5PmZ8fHk9PWYmJig0PT1tfHxofHw2PT1tJiYxJmRbYy0xXXx8bT09KHAuczwwPzg6NykpLGM8MXx8IWRbMF0pbj1oP0Eocy5jaGFyQXQoMSksLWcscy5jaGFyQXQoMCkpOnMuY2hhckF0KDApO2Vsc2V7aWYoZC5sZW5ndGg9YyxoKWZvcigtLWk7KytkWy0tY10+aTspZFtjXT0wLGN8fCgrK2wsZD1bMV0uY29uY2F0KGQpKTtmb3IoZj1kLmxlbmd0aDshZFstLWZdOyk7Zm9yKHk9MCxuPSIiO3k8PWY7bis9cy5jaGFyQXQoZFt5KytdKSk7bj1BKG4sbCxzLmNoYXJBdCgwKSl9cmV0dXJuIG59fSgpLHI9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKGUsdCxyKXt2YXIgbixvLGksYSx1PTAscz1lLmxlbmd0aCxjPXQleSxsPXQveXwwO2ZvcihlPWUuc2xpY2UoKTtzLS07KXU9KChvPWMqKGk9ZVtzXSV5KSsobj1sKmkrKGE9ZVtzXS95fDApKmMpJXkqeSt1KS9yfDApKyhuL3l8MCkrbCphLGVbc109byVyO3JldHVybiB1JiYoZT1bdV0uY29uY2F0KGUpKSxlfWZ1bmN0aW9uIHQoZSx0LHIsbil7dmFyIG8saTtpZihyIT1uKWk9cj5uPzE6LTE7ZWxzZSBmb3Iobz1pPTA7bzxyO28rKylpZihlW29dIT10W29dKXtpPWVbb10+dFtvXT8xOi0xO2JyZWFrfXJldHVybiBpfWZ1bmN0aW9uIHIoZSx0LHIsbil7Zm9yKHZhciBvPTA7ci0tOyllW3JdLT1vLG89ZVtyXTx0W3JdPzE6MCxlW3JdPW8qbitlW3JdLXRbcl07Zm9yKDshZVswXSYmZS5sZW5ndGg+MTtlLnNwbGljZSgwLDEpKTt9cmV0dXJuIGZ1bmN0aW9uKG4sbyxpLGEsdSl7dmFyIHMsbCxmLGQsdix5LGcsYix3LGsseCxTLEEsRSxPLF8sTixQPW4ucz09by5zPzE6LTEsVD1uLmMsTD1vLmM7aWYoIShUJiZUWzBdJiZMJiZMWzBdKSlyZXR1cm4gbmV3IEgobi5zJiZvLnMmJihUPyFMfHxUWzBdIT1MWzBdOkwpP1QmJjA9PVRbMF18fCFMPzAqUDpQLzA6TmFOKTtmb3Iodz0oYj1uZXcgSChQKSkuYz1bXSxQPWkrKGw9bi5lLW8uZSkrMSx1fHwodT1oLGw9bShuLmUvcCktbShvLmUvcCksUD1QL3B8MCksZj0wO0xbZl09PShUW2ZdfHwwKTtmKyspO2lmKExbZl0+KFRbZl18fDApJiZsLS0sUDwwKXcucHVzaCgxKSxkPSEwO2Vsc2V7Zm9yKEU9VC5sZW5ndGgsXz1MLmxlbmd0aCxmPTAsUCs9Miwodj1jKHUvKExbMF0rMSkpKT4xJiYoTD1lKEwsdix1KSxUPWUoVCx2LHUpLF89TC5sZW5ndGgsRT1ULmxlbmd0aCksQT1fLHg9KGs9VC5zbGljZSgwLF8pKS5sZW5ndGg7eDxfO2tbeCsrXT0wKTtOPUwuc2xpY2UoKSxOPVswXS5jb25jYXQoTiksTz1MWzBdLExbMV0+PXUvMiYmTysrO2Rve2lmKHY9MCwocz10KEwsayxfLHgpKTwwKXtpZihTPWtbMF0sXyE9eCYmKFM9Uyp1KyhrWzFdfHwwKSksKHY9YyhTL08pKT4xKWZvcih2Pj11JiYodj11LTEpLGc9KHk9ZShMLHYsdSkpLmxlbmd0aCx4PWsubGVuZ3RoOzE9PXQoeSxrLGcseCk7KXYtLSxyKHksXzxnP046TCxnLHUpLGc9eS5sZW5ndGgscz0xO2Vsc2UgMD09diYmKHM9dj0xKSxnPSh5PUwuc2xpY2UoKSkubGVuZ3RoO2lmKGc8eCYmKHk9WzBdLmNvbmNhdCh5KSkscihrLHkseCx1KSx4PWsubGVuZ3RoLC0xPT1zKWZvcig7dChMLGssXyx4KTwxOyl2KysscihrLF88eD9OOkwseCx1KSx4PWsubGVuZ3RofWVsc2UgMD09PXMmJih2Kyssaz1bMF0pO3dbZisrXT12LGtbMF0/a1t4KytdPVRbQV18fDA6KGs9W1RbQV1dLHg9MSl9d2hpbGUoKEErKzxFfHxudWxsIT1rWzBdKSYmUC0tKTtkPW51bGwhPWtbMF0sd1swXXx8dy5zcGxpY2UoMCwxKX1pZih1PT1oKXtmb3IoZj0xLFA9d1swXTtQPj0xMDtQLz0xMCxmKyspO0soYixpKyhiLmU9ZitsKnAtMSkrMSxhLGQpfWVsc2UgYi5lPWwsYi5yPStkO3JldHVybiBifX0oKSxPPS9eKC0/KTAoW3hib10pKD89XHdbXHcuXSokKS9pLF89L14oW14uXSspXC4kLyxOPS9eXC4oW14uXSspJC8sUD0vXi0/KEluZmluaXR5fE5hTikkLyxUPS9eXHMqXCsoPz1bXHcuXSl8XlxzK3xccyskL2csaT1mdW5jdGlvbihlLHQscixuKXt2YXIgbyxpPXI/dDp0LnJlcGxhY2UoVCwiIik7aWYoUC50ZXN0KGkpKWUucz1pc05hTihpKT9udWxsOmk8MD8tMToxO2Vsc2V7aWYoIXImJihpPWkucmVwbGFjZShPLChmdW5jdGlvbihlLHQscil7cmV0dXJuIG89IngiPT0ocj1yLnRvTG93ZXJDYXNlKCkpPzE2OiJiIj09cj8yOjgsbiYmbiE9bz9lOnR9KSksbiYmKG89bixpPWkucmVwbGFjZShfLCIkMSIpLnJlcGxhY2UoTiwiMC4kMSIpKSx0IT1pKSlyZXR1cm4gbmV3IEgoaSxvKTtpZihILkRFQlVHKXRocm93IEVycm9yKGwrIk5vdCBhIisobj8iIGJhc2UgIituOiIiKSsiIG51bWJlcjogIit0KTtlLnM9bnVsbH1lLmM9ZS5lPW51bGx9LEwuYWJzb2x1dGVWYWx1ZT1MLmFicz1mdW5jdGlvbigpe3ZhciBlPW5ldyBIKHRoaXMpO3JldHVybiBlLnM8MCYmKGUucz0xKSxlfSxMLmNvbXBhcmVkVG89ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdyh0aGlzLG5ldyBIKGUsdCkpfSxMLmRlY2ltYWxQbGFjZXM9TC5kcD1mdW5jdGlvbihlLHQpe3ZhciByLG4sbyxpPXRoaXM7aWYobnVsbCE9ZSlyZXR1cm4gayhlLDAsZyksbnVsbD09dD90PVI6ayh0LDAsOCksSyhuZXcgSChpKSxlK2kuZSsxLHQpO2lmKCEocj1pLmMpKXJldHVybiBudWxsO2lmKG49KChvPXIubGVuZ3RoLTEpLW0odGhpcy5lL3ApKSpwLG89cltvXSlmb3IoO28lMTA9PTA7by89MTAsbi0tKTtyZXR1cm4gbjwwJiYobj0wKSxufSxMLmRpdmlkZWRCeT1MLmRpdj1mdW5jdGlvbihlLHQpe3JldHVybiByKHRoaXMsbmV3IEgoZSx0KSxDLFIpfSxMLmRpdmlkZWRUb0ludGVnZXJCeT1MLmlkaXY9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gcih0aGlzLG5ldyBIKGUsdCksMCwxKX0sTC5leHBvbmVudGlhdGVkQnk9TC5wb3c9ZnVuY3Rpb24oZSx0KXt2YXIgcixuLG8saSxhLHUsZixoLGQ9dGhpcztpZigoZT1uZXcgSChlKSkuYyYmIWUuaXNJbnRlZ2VyKCkpdGhyb3cgRXJyb3IobCsiRXhwb25lbnQgbm90IGFuIGludGVnZXI6ICIrWShlKSk7aWYobnVsbCE9dCYmKHQ9bmV3IEgodCkpLGE9ZS5lPjE0LCFkLmN8fCFkLmNbMF18fDE9PWQuY1swXSYmIWQuZSYmMT09ZC5jLmxlbmd0aHx8IWUuY3x8IWUuY1swXSlyZXR1cm4gaD1uZXcgSChNYXRoLnBvdygrWShkKSxhP2UucyooMi14KGUpKTorWShlKSkpLHQ/aC5tb2QodCk6aDtpZih1PWUuczwwLHQpe2lmKHQuYz8hdC5jWzBdOiF0LnMpcmV0dXJuIG5ldyBIKE5hTik7KG49IXUmJmQuaXNJbnRlZ2VyKCkmJnQuaXNJbnRlZ2VyKCkpJiYoZD1kLm1vZCh0KSl9ZWxzZXtpZihlLmU+OSYmKGQuZT4wfHxkLmU8LTF8fCgwPT1kLmU/ZC5jWzBdPjF8fGEmJmQuY1sxXT49MjRlNzpkLmNbMF08OGUxM3x8YSYmZC5jWzBdPD05OTk5OTc1ZTcpKSlyZXR1cm4gaT1kLnM8MCYmeChlKT8tMDowLGQuZT4tMSYmKGk9MS9pKSxuZXcgSCh1PzEvaTppKTtVJiYoaT1zKFUvcCsyKSl9Zm9yKGE/KHI9bmV3IEgoLjUpLHUmJihlLnM9MSksZj14KGUpKTpmPShvPU1hdGguYWJzKCtZKGUpKSklMixoPW5ldyBIKGopOzspe2lmKGYpe2lmKCEoaD1oLnRpbWVzKGQpKS5jKWJyZWFrO2k/aC5jLmxlbmd0aD5pJiYoaC5jLmxlbmd0aD1pKTpuJiYoaD1oLm1vZCh0KSl9aWYobyl7aWYoMD09PShvPWMoby8yKSkpYnJlYWs7Zj1vJTJ9ZWxzZSBpZihLKGU9ZS50aW1lcyhyKSxlLmUrMSwxKSxlLmU+MTQpZj14KGUpO2Vsc2V7aWYoMD09KG89K1koZSkpKWJyZWFrO2Y9byUyfWQ9ZC50aW1lcyhkKSxpP2QuYyYmZC5jLmxlbmd0aD5pJiYoZC5jLmxlbmd0aD1pKTpuJiYoZD1kLm1vZCh0KSl9cmV0dXJuIG4/aDoodSYmKGg9ai5kaXYoaCkpLHQ/aC5tb2QodCk6aT9LKGgsVSxSLHZvaWQgMCk6aCl9LEwuaW50ZWdlclZhbHVlPWZ1bmN0aW9uKGUpe3ZhciB0PW5ldyBIKHRoaXMpO3JldHVybiBudWxsPT1lP2U9UjprKGUsMCw4KSxLKHQsdC5lKzEsZSl9LEwuaXNFcXVhbFRvPUwuZXE9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gMD09PXcodGhpcyxuZXcgSChlLHQpKX0sTC5pc0Zpbml0ZT1mdW5jdGlvbigpe3JldHVybiEhdGhpcy5jfSxMLmlzR3JlYXRlclRoYW49TC5ndD1mdW5jdGlvbihlLHQpe3JldHVybiB3KHRoaXMsbmV3IEgoZSx0KSk+MH0sTC5pc0dyZWF0ZXJUaGFuT3JFcXVhbFRvPUwuZ3RlPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIDE9PT0odD13KHRoaXMsbmV3IEgoZSx0KSkpfHwwPT09dH0sTC5pc0ludGVnZXI9ZnVuY3Rpb24oKXtyZXR1cm4hIXRoaXMuYyYmbSh0aGlzLmUvcCk+dGhpcy5jLmxlbmd0aC0yfSxMLmlzTGVzc1RoYW49TC5sdD1mdW5jdGlvbihlLHQpe3JldHVybiB3KHRoaXMsbmV3IEgoZSx0KSk8MH0sTC5pc0xlc3NUaGFuT3JFcXVhbFRvPUwubHRlPWZ1bmN0aW9uKGUsdCl7cmV0dXJuLTE9PT0odD13KHRoaXMsbmV3IEgoZSx0KSkpfHwwPT09dH0sTC5pc05hTj1mdW5jdGlvbigpe3JldHVybiF0aGlzLnN9LEwuaXNOZWdhdGl2ZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLnM8MH0sTC5pc1Bvc2l0aXZlPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucz4wfSxMLmlzWmVybz1mdW5jdGlvbigpe3JldHVybiEhdGhpcy5jJiYwPT10aGlzLmNbMF19LEwubWludXM9ZnVuY3Rpb24oZSx0KXt2YXIgcixuLG8saSxhPXRoaXMsdT1hLnM7aWYodD0oZT1uZXcgSChlLHQpKS5zLCF1fHwhdClyZXR1cm4gbmV3IEgoTmFOKTtpZih1IT10KXJldHVybiBlLnM9LXQsYS5wbHVzKGUpO3ZhciBzPWEuZS9wLGM9ZS5lL3AsbD1hLmMsZj1lLmM7aWYoIXN8fCFjKXtpZighbHx8IWYpcmV0dXJuIGw/KGUucz0tdCxlKTpuZXcgSChmP2E6TmFOKTtpZighbFswXXx8IWZbMF0pcmV0dXJuIGZbMF0/KGUucz0tdCxlKTpuZXcgSChsWzBdP2E6Mz09Uj8tMDowKX1pZihzPW0ocyksYz1tKGMpLGw9bC5zbGljZSgpLHU9cy1jKXtmb3IoKGk9dTwwKT8odT0tdSxvPWwpOihjPXMsbz1mKSxvLnJldmVyc2UoKSx0PXU7dC0tO28ucHVzaCgwKSk7by5yZXZlcnNlKCl9ZWxzZSBmb3Iobj0oaT0odT1sLmxlbmd0aCk8KHQ9Zi5sZW5ndGgpKT91OnQsdT10PTA7dDxuO3QrKylpZihsW3RdIT1mW3RdKXtpPWxbdF08Zlt0XTticmVha31pZihpJiYobz1sLGw9ZixmPW8sZS5zPS1lLnMpLCh0PShuPWYubGVuZ3RoKS0ocj1sLmxlbmd0aCkpPjApZm9yKDt0LS07bFtyKytdPTApO2Zvcih0PWgtMTtuPnU7KXtpZihsWy0tbl08ZltuXSl7Zm9yKHI9bjtyJiYhbFstLXJdO2xbcl09dCk7LS1sW3JdLGxbbl0rPWh9bFtuXS09ZltuXX1mb3IoOzA9PWxbMF07bC5zcGxpY2UoMCwxKSwtLWMpO3JldHVybiBsWzBdP0ooZSxsLGMpOihlLnM9Mz09Uj8tMToxLGUuYz1bZS5lPTBdLGUpfSxMLm1vZHVsbz1MLm1vZD1mdW5jdGlvbihlLHQpe3ZhciBuLG8saT10aGlzO3JldHVybiBlPW5ldyBIKGUsdCksIWkuY3x8IWUuc3x8ZS5jJiYhZS5jWzBdP25ldyBIKE5hTik6IWUuY3x8aS5jJiYhaS5jWzBdP25ldyBIKGkpOig5PT1EPyhvPWUucyxlLnM9MSxuPXIoaSxlLDAsMyksZS5zPW8sbi5zKj1vKTpuPXIoaSxlLDAsRCksKGU9aS5taW51cyhuLnRpbWVzKGUpKSkuY1swXXx8MSE9RHx8KGUucz1pLnMpLGUpfSxMLm11bHRpcGxpZWRCeT1MLnRpbWVzPWZ1bmN0aW9uKGUsdCl7dmFyIHIsbixvLGksYSx1LHMsYyxsLGYsZCx2LGcsYix3LGs9dGhpcyx4PWsuYyxTPShlPW5ldyBIKGUsdCkpLmM7aWYoISh4JiZTJiZ4WzBdJiZTWzBdKSlyZXR1cm4hay5zfHwhZS5zfHx4JiYheFswXSYmIVN8fFMmJiFTWzBdJiYheD9lLmM9ZS5lPWUucz1udWxsOihlLnMqPWsucyx4JiZTPyhlLmM9WzBdLGUuZT0wKTplLmM9ZS5lPW51bGwpLGU7Zm9yKG49bShrLmUvcCkrbShlLmUvcCksZS5zKj1rLnMsKHM9eC5sZW5ndGgpPChmPVMubGVuZ3RoKSYmKGc9eCx4PVMsUz1nLG89cyxzPWYsZj1vKSxvPXMrZixnPVtdO28tLTtnLnB1c2goMCkpO2ZvcihiPWgsdz15LG89ZjstLW8+PTA7KXtmb3Iocj0wLGQ9U1tvXSV3LHY9U1tvXS93fDAsaT1vKyhhPXMpO2k+bzspcj0oKGM9ZCooYz14Wy0tYV0ldykrKHU9dipjKyhsPXhbYV0vd3wwKSpkKSV3KncrZ1tpXStyKS9ifDApKyh1L3d8MCkrdipsLGdbaS0tXT1jJWI7Z1tpXT1yfXJldHVybiByPysrbjpnLnNwbGljZSgwLDEpLEooZSxnLG4pfSxMLm5lZ2F0ZWQ9ZnVuY3Rpb24oKXt2YXIgZT1uZXcgSCh0aGlzKTtyZXR1cm4gZS5zPS1lLnN8fG51bGwsZX0sTC5wbHVzPWZ1bmN0aW9uKGUsdCl7dmFyIHIsbj10aGlzLG89bi5zO2lmKHQ9KGU9bmV3IEgoZSx0KSkucywhb3x8IXQpcmV0dXJuIG5ldyBIKE5hTik7aWYobyE9dClyZXR1cm4gZS5zPS10LG4ubWludXMoZSk7dmFyIGk9bi5lL3AsYT1lLmUvcCx1PW4uYyxzPWUuYztpZighaXx8IWEpe2lmKCF1fHwhcylyZXR1cm4gbmV3IEgoby8wKTtpZighdVswXXx8IXNbMF0pcmV0dXJuIHNbMF0/ZTpuZXcgSCh1WzBdP246MCpvKX1pZihpPW0oaSksYT1tKGEpLHU9dS5zbGljZSgpLG89aS1hKXtmb3Iobz4wPyhhPWkscj1zKToobz0tbyxyPXUpLHIucmV2ZXJzZSgpO28tLTtyLnB1c2goMCkpO3IucmV2ZXJzZSgpfWZvcigobz11Lmxlbmd0aCktKHQ9cy5sZW5ndGgpPDAmJihyPXMscz11LHU9cix0PW8pLG89MDt0OylvPSh1Wy0tdF09dVt0XStzW3RdK28pL2h8MCx1W3RdPWg9PT11W3RdPzA6dVt0XSVoO3JldHVybiBvJiYodT1bb10uY29uY2F0KHUpLCsrYSksSihlLHUsYSl9LEwucHJlY2lzaW9uPUwuc2Q9ZnVuY3Rpb24oZSx0KXt2YXIgcixuLG8saT10aGlzO2lmKG51bGwhPWUmJmUhPT0hIWUpcmV0dXJuIGsoZSwxLGcpLG51bGw9PXQ/dD1SOmsodCwwLDgpLEsobmV3IEgoaSksZSx0KTtpZighKHI9aS5jKSlyZXR1cm4gbnVsbDtpZihuPShvPXIubGVuZ3RoLTEpKnArMSxvPXJbb10pe2Zvcig7byUxMD09MDtvLz0xMCxuLS0pO2ZvcihvPXJbMF07bz49MTA7by89MTAsbisrKTt9cmV0dXJuIGUmJmkuZSsxPm4mJihuPWkuZSsxKSxufSxMLnNoaWZ0ZWRCeT1mdW5jdGlvbihlKXtyZXR1cm4gayhlLC05MDA3MTk5MjU0NzQwOTkxLGQpLHRoaXMudGltZXMoIjFlIitlKX0sTC5zcXVhcmVSb290PUwuc3FydD1mdW5jdGlvbigpe3ZhciBlLHQsbixvLGksYT10aGlzLHU9YS5jLHM9YS5zLGM9YS5lLGw9Qys0LGY9bmV3IEgoIjAuNSIpO2lmKDEhPT1zfHwhdXx8IXVbMF0pcmV0dXJuIG5ldyBIKCFzfHxzPDAmJighdXx8dVswXSk/TmFOOnU/YToxLzApO2lmKDA9PShzPU1hdGguc3FydCgrWShhKSkpfHxzPT0xLzA/KCgodD1iKHUpKS5sZW5ndGgrYyklMj09MCYmKHQrPSIwIikscz1NYXRoLnNxcnQoK3QpLGM9bSgoYysxKS8yKS0oYzwwfHxjJTIpLG49bmV3IEgodD1zPT0xLzA/IjVlIitjOih0PXMudG9FeHBvbmVudGlhbCgpKS5zbGljZSgwLHQuaW5kZXhPZigiZSIpKzEpK2MpKTpuPW5ldyBIKHMrIiIpLG4uY1swXSlmb3IoKHM9KGM9bi5lKStsKTwzJiYocz0wKTs7KWlmKGk9bixuPWYudGltZXMoaS5wbHVzKHIoYSxpLGwsMSkpKSxiKGkuYykuc2xpY2UoMCxzKT09PSh0PWIobi5jKSkuc2xpY2UoMCxzKSl7aWYobi5lPGMmJi0tcywiOTk5OSIhPSh0PXQuc2xpY2Uocy0zLHMrMSkpJiYob3x8IjQ5OTkiIT10KSl7K3QmJigrdC5zbGljZSgxKXx8IjUiIT10LmNoYXJBdCgwKSl8fChLKG4sbi5lK0MrMiwxKSxlPSFuLnRpbWVzKG4pLmVxKGEpKTticmVha31pZighbyYmKEsoaSxpLmUrQysyLDApLGkudGltZXMoaSkuZXEoYSkpKXtuPWk7YnJlYWt9bCs9NCxzKz00LG89MX1yZXR1cm4gSyhuLG4uZStDKzEsUixlKX0sTC50b0V4cG9uZW50aWFsPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIG51bGwhPWUmJihrKGUsMCxnKSxlKyspLCQodGhpcyxlLHQsMSl9LEwudG9GaXhlZD1mdW5jdGlvbihlLHQpe3JldHVybiBudWxsIT1lJiYoayhlLDAsZyksZT1lK3RoaXMuZSsxKSwkKHRoaXMsZSx0KX0sTC50b0Zvcm1hdD1mdW5jdGlvbihlLHQscil7dmFyIG4saT10aGlzO2lmKG51bGw9PXIpbnVsbCE9ZSYmdCYmIm9iamVjdCI9PW8odCk/KHI9dCx0PW51bGwpOmUmJiJvYmplY3QiPT1vKGUpPyhyPWUsZT10PW51bGwpOnI9RztlbHNlIGlmKCJvYmplY3QiIT1vKHIpKXRocm93IEVycm9yKGwrIkFyZ3VtZW50IG5vdCBhbiBvYmplY3Q6ICIrcik7aWYobj1pLnRvRml4ZWQoZSx0KSxpLmMpe3ZhciBhLHU9bi5zcGxpdCgiLiIpLHM9K3IuZ3JvdXBTaXplLGM9K3Iuc2Vjb25kYXJ5R3JvdXBTaXplLGY9ci5ncm91cFNlcGFyYXRvcnx8IiIsaD11WzBdLHA9dVsxXSxkPWkuczwwLHY9ZD9oLnNsaWNlKDEpOmgseT12Lmxlbmd0aDtpZihjJiYoYT1zLHM9YyxjPWEseS09YSkscz4wJiZ5PjApe2ZvcihhPXklc3x8cyxoPXYuc3Vic3RyKDAsYSk7YTx5O2ErPXMpaCs9Zit2LnN1YnN0cihhLHMpO2M+MCYmKGgrPWYrdi5zbGljZShhKSksZCYmKGg9Ii0iK2gpfW49cD9oKyhyLmRlY2ltYWxTZXBhcmF0b3J8fCIiKSsoKGM9K3IuZnJhY3Rpb25Hcm91cFNpemUpP3AucmVwbGFjZShuZXcgUmVnRXhwKCJcXGR7IitjKyJ9XFxCIiwiZyIpLCIkJiIrKHIuZnJhY3Rpb25Hcm91cFNlcGFyYXRvcnx8IiIpKTpwKTpofXJldHVybihyLnByZWZpeHx8IiIpK24rKHIuc3VmZml4fHwiIil9LEwudG9GcmFjdGlvbj1mdW5jdGlvbihlKXt2YXIgdCxuLG8saSxhLHUscyxjLGYsaCxkLHksZz10aGlzLG09Zy5jO2lmKG51bGwhPWUmJighKHM9bmV3IEgoZSkpLmlzSW50ZWdlcigpJiYocy5jfHwxIT09cy5zKXx8cy5sdChqKSkpdGhyb3cgRXJyb3IobCsiQXJndW1lbnQgIisocy5pc0ludGVnZXIoKT8ib3V0IG9mIHJhbmdlOiAiOiJub3QgYW4gaW50ZWdlcjogIikrWShzKSk7aWYoIW0pcmV0dXJuIG5ldyBIKGcpO2Zvcih0PW5ldyBIKGopLGY9bj1uZXcgSChqKSxvPWM9bmV3IEgoaikseT1iKG0pLGE9dC5lPXkubGVuZ3RoLWcuZS0xLHQuY1swXT12Wyh1PWElcCk8MD9wK3U6dV0sZT0hZXx8cy5jb21wYXJlZFRvKHQpPjA/YT4wP3Q6ZjpzLHU9RixGPTEvMCxzPW5ldyBIKHkpLGMuY1swXT0wO2g9cihzLHQsMCwxKSwxIT0oaT1uLnBsdXMoaC50aW1lcyhvKSkpLmNvbXBhcmVkVG8oZSk7KW49byxvPWksZj1jLnBsdXMoaC50aW1lcyhpPWYpKSxjPWksdD1zLm1pbnVzKGgudGltZXMoaT10KSkscz1pO3JldHVybiBpPXIoZS5taW51cyhuKSxvLDAsMSksYz1jLnBsdXMoaS50aW1lcyhmKSksbj1uLnBsdXMoaS50aW1lcyhvKSksYy5zPWYucz1nLnMsZD1yKGYsbyxhKj0yLFIpLm1pbnVzKGcpLmFicygpLmNvbXBhcmVkVG8ocihjLG4sYSxSKS5taW51cyhnKS5hYnMoKSk8MT9bZixvXTpbYyxuXSxGPXUsZH0sTC50b051bWJlcj1mdW5jdGlvbigpe3JldHVybitZKHRoaXMpfSxMLnRvUHJlY2lzaW9uPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIG51bGwhPWUmJmsoZSwxLGcpLCQodGhpcyxlLHQsMil9LEwudG9TdHJpbmc9ZnVuY3Rpb24oZSl7dmFyIHQscj10aGlzLG89ci5zLGk9ci5lO3JldHVybiBudWxsPT09aT9vPyh0PSJJbmZpbml0eSIsbzwwJiYodD0iLSIrdCkpOnQ9Ik5hTiI6KG51bGw9PWU/dD1pPD1xfHxpPj1JP1MoYihyLmMpLGkpOkEoYihyLmMpLGksIjAiKToxMD09PWUmJlc/dD1BKGIoKHI9SyhuZXcgSChyKSxDK2krMSxSKSkuYyksci5lLCIwIik6KGsoZSwyLHoubGVuZ3RoLCJCYXNlIiksdD1uKEEoYihyLmMpLGksIjAiKSwxMCxlLG8sITApKSxvPDAmJnIuY1swXSYmKHQ9Ii0iK3QpKSx0fSxMLnZhbHVlT2Y9TC50b0pTT049ZnVuY3Rpb24oKXtyZXR1cm4gWSh0aGlzKX0sTC5faXNCaWdOdW1iZXI9ITAsbnVsbCE9dCYmSC5zZXQodCksSH0oKSxhLmRlZmF1bHQ9YS5CaWdOdW1iZXI9YSx2b2lkIDA9PT0obj1mdW5jdGlvbigpe3JldHVybiBhfS5jYWxsKHQscix0LGUpKXx8KGUuZXhwb3J0cz1uKX0oKX0sODY3OihlLHQscik9Pnt2YXIgbj1yKDY5Mikuc3RyaW5naWZ5LG89cigyNTgpO2UuZXhwb3J0cz1mdW5jdGlvbihlKXtyZXR1cm57cGFyc2U6byhlKSxzdHJpbmdpZnk6bn19LGUuZXhwb3J0cy5wYXJzZT1vKCksZS5leHBvcnRzLnN0cmluZ2lmeT1ufSwyNTg6KGUsdCxyKT0+e2Z1bmN0aW9uIG4oZSl7cmV0dXJuIG49ImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmInN5bWJvbCI9PXR5cGVvZiBTeW1ib2wuaXRlcmF0b3I/ZnVuY3Rpb24oZSl7cmV0dXJuIHR5cGVvZiBlfTpmdW5jdGlvbihlKXtyZXR1cm4gZSYmImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmZS5jb25zdHJ1Y3Rvcj09PVN5bWJvbCYmZSE9PVN5bWJvbC5wcm90b3R5cGU/InN5bWJvbCI6dHlwZW9mIGV9LG4oZSl9dmFyIG89bnVsbCxpPS8oPzpffFxcdTAwNVtGZl0pKD86X3xcXHUwMDVbRmZdKSg/OnB8XFx1MDA3MCkoPzpyfFxcdTAwNzIpKD86b3xcXHUwMDZbRmZdKSg/OnR8XFx1MDA3NCkoPzpvfFxcdTAwNltGZl0pKD86X3xcXHUwMDVbRmZdKSg/Ol98XFx1MDA1W0ZmXSkvLGE9Lyg/OmN8XFx1MDA2MykoPzpvfFxcdTAwNltGZl0pKD86bnxcXHUwMDZbRWVdKSg/OnN8XFx1MDA3MykoPzp0fFxcdTAwNzQpKD86cnxcXHUwMDcyKSg/OnV8XFx1MDA3NSkoPzpjfFxcdTAwNjMpKD86dHxcXHUwMDc0KSg/Om98XFx1MDA2W0ZmXSkoPzpyfFxcdTAwNzIpLztlLmV4cG9ydHM9ZnVuY3Rpb24oZSl7InVzZSBzdHJpY3QiO3ZhciB0PXtzdHJpY3Q6ITEsc3RvcmVBc1N0cmluZzohMSxhbHdheXNQYXJzZUFzQmlnOiExLHVzZU5hdGl2ZUJpZ0ludDohMSxwcm90b0FjdGlvbjoiZXJyb3IiLGNvbnN0cnVjdG9yQWN0aW9uOiJlcnJvciJ9O2lmKG51bGwhPWUpe2lmKCEwPT09ZS5zdHJpY3QmJih0LnN0cmljdD0hMCksITA9PT1lLnN0b3JlQXNTdHJpbmcmJih0LnN0b3JlQXNTdHJpbmc9ITApLHQuYWx3YXlzUGFyc2VBc0JpZz0hMD09PWUuYWx3YXlzUGFyc2VBc0JpZyYmZS5hbHdheXNQYXJzZUFzQmlnLHQudXNlTmF0aXZlQmlnSW50PSEwPT09ZS51c2VOYXRpdmVCaWdJbnQmJmUudXNlTmF0aXZlQmlnSW50LHZvaWQgMCE9PWUuY29uc3RydWN0b3JBY3Rpb24pe2lmKCJlcnJvciIhPT1lLmNvbnN0cnVjdG9yQWN0aW9uJiYiaWdub3JlIiE9PWUuY29uc3RydWN0b3JBY3Rpb24mJiJwcmVzZXJ2ZSIhPT1lLmNvbnN0cnVjdG9yQWN0aW9uKXRocm93IG5ldyBFcnJvcignSW5jb3JyZWN0IHZhbHVlIGZvciBjb25zdHJ1Y3RvckFjdGlvbiBvcHRpb24sIG11c3QgYmUgImVycm9yIiwgImlnbm9yZSIgb3IgdW5kZWZpbmVkIGJ1dCBwYXNzZWQgJy5jb25jYXQoZS5jb25zdHJ1Y3RvckFjdGlvbikpO3QuY29uc3RydWN0b3JBY3Rpb249ZS5jb25zdHJ1Y3RvckFjdGlvbn1pZih2b2lkIDAhPT1lLnByb3RvQWN0aW9uKXtpZigiZXJyb3IiIT09ZS5wcm90b0FjdGlvbiYmImlnbm9yZSIhPT1lLnByb3RvQWN0aW9uJiYicHJlc2VydmUiIT09ZS5wcm90b0FjdGlvbil0aHJvdyBuZXcgRXJyb3IoJ0luY29ycmVjdCB2YWx1ZSBmb3IgcHJvdG9BY3Rpb24gb3B0aW9uLCBtdXN0IGJlICJlcnJvciIsICJpZ25vcmUiIG9yIHVuZGVmaW5lZCBidXQgcGFzc2VkICcuY29uY2F0KGUucHJvdG9BY3Rpb24pKTt0LnByb3RvQWN0aW9uPWUucHJvdG9BY3Rpb259fXZhciB1LHMsYyxsLGY9eyciJzonIicsIlxcIjoiXFwiLCIvIjoiLyIsYjoiXGIiLGY6IlxmIixuOiJcbiIscjoiXHIiLHQ6Ilx0In0saD1mdW5jdGlvbihlKXt0aHJvd3tuYW1lOiJTeW50YXhFcnJvciIsbWVzc2FnZTplLGF0OnUsdGV4dDpjfX0scD1mdW5jdGlvbihlKXtyZXR1cm4gZSYmZSE9PXMmJmgoIkV4cGVjdGVkICciK2UrIicgaW5zdGVhZCBvZiAnIitzKyInIikscz1jLmNoYXJBdCh1KSx1Kz0xLHN9LGQ9ZnVuY3Rpb24oKXt2YXIgZSxuPSIiO2ZvcigiLSI9PT1zJiYobj0iLSIscCgiLSIpKTtzPj0iMCImJnM8PSI5Ijspbis9cyxwKCk7aWYoIi4iPT09cylmb3Iobis9Ii4iO3AoKSYmcz49IjAiJiZzPD0iOSI7KW4rPXM7aWYoImUiPT09c3x8IkUiPT09cylmb3Iobis9cyxwKCksIi0iIT09cyYmIisiIT09c3x8KG4rPXMscCgpKTtzPj0iMCImJnM8PSI5Ijspbis9cyxwKCk7aWYoZT0rbixpc0Zpbml0ZShlKSlyZXR1cm4gbnVsbD09byYmKG89cig1MTgpKSxuLmxlbmd0aD4xNT90LnN0b3JlQXNTdHJpbmc/bjp0LnVzZU5hdGl2ZUJpZ0ludD9CaWdJbnQobik6bmV3IG8obik6dC5hbHdheXNQYXJzZUFzQmlnP3QudXNlTmF0aXZlQmlnSW50P0JpZ0ludChlKTpuZXcgbyhlKTplO2goIkJhZCBudW1iZXIiKX0sdj1mdW5jdGlvbigpe3ZhciBlLHQscixuPSIiO2lmKCciJz09PXMpZm9yKHZhciBvPXU7cCgpOyl7aWYoJyInPT09cylyZXR1cm4gdS0xPm8mJihuKz1jLnN1YnN0cmluZyhvLHUtMSkpLHAoKSxuO2lmKCJcXCI9PT1zKXtpZih1LTE+byYmKG4rPWMuc3Vic3RyaW5nKG8sdS0xKSkscCgpLCJ1Ij09PXMpe2ZvcihyPTAsdD0wO3Q8NCYmKGU9cGFyc2VJbnQocCgpLDE2KSxpc0Zpbml0ZShlKSk7dCs9MSlyPTE2KnIrZTtuKz1TdHJpbmcuZnJvbUNoYXJDb2RlKHIpfWVsc2V7aWYoInN0cmluZyIhPXR5cGVvZiBmW3NdKWJyZWFrO24rPWZbc119bz11fX1oKCJCYWQgc3RyaW5nIil9LHk9ZnVuY3Rpb24oKXtmb3IoO3MmJnM8PSIgIjspcCgpfTtyZXR1cm4gbD1mdW5jdGlvbigpe3N3aXRjaCh5KCkscyl7Y2FzZSJ7IjpyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZSxyPU9iamVjdC5jcmVhdGUobnVsbCk7aWYoInsiPT09cyl7aWYocCgieyIpLHkoKSwifSI9PT1zKXJldHVybiBwKCJ9Iikscjtmb3IoO3M7KXtpZihlPXYoKSx5KCkscCgiOiIpLCEwPT09dC5zdHJpY3QmJk9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKHIsZSkmJmgoJ0R1cGxpY2F0ZSBrZXkgIicrZSsnIicpLCEwPT09aS50ZXN0KGUpPyJlcnJvciI9PT10LnByb3RvQWN0aW9uP2goIk9iamVjdCBjb250YWlucyBmb3JiaWRkZW4gcHJvdG90eXBlIHByb3BlcnR5Iik6Imlnbm9yZSI9PT10LnByb3RvQWN0aW9uP2woKTpyW2VdPWwoKTohMD09PWEudGVzdChlKT8iZXJyb3IiPT09dC5jb25zdHJ1Y3RvckFjdGlvbj9oKCJPYmplY3QgY29udGFpbnMgZm9yYmlkZGVuIGNvbnN0cnVjdG9yIHByb3BlcnR5Iik6Imlnbm9yZSI9PT10LmNvbnN0cnVjdG9yQWN0aW9uP2woKTpyW2VdPWwoKTpyW2VdPWwoKSx5KCksIn0iPT09cylyZXR1cm4gcCgifSIpLHI7cCgiLCIpLHkoKX19aCgiQmFkIG9iamVjdCIpfSgpO2Nhc2UiWyI6cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGU9W107aWYoIlsiPT09cyl7aWYocCgiWyIpLHkoKSwiXSI9PT1zKXJldHVybiBwKCJdIiksZTtmb3IoO3M7KXtpZihlLnB1c2gobCgpKSx5KCksIl0iPT09cylyZXR1cm4gcCgiXSIpLGU7cCgiLCIpLHkoKX19aCgiQmFkIGFycmF5Iil9KCk7Y2FzZSciJzpyZXR1cm4gdigpO2Nhc2UiLSI6cmV0dXJuIGQoKTtkZWZhdWx0OnJldHVybiBzPj0iMCImJnM8PSI5Ij9kKCk6ZnVuY3Rpb24oKXtzd2l0Y2gocyl7Y2FzZSJ0IjpyZXR1cm4gcCgidCIpLHAoInIiKSxwKCJ1IikscCgiZSIpLCEwO2Nhc2UiZiI6cmV0dXJuIHAoImYiKSxwKCJhIikscCgibCIpLHAoInMiKSxwKCJlIiksITE7Y2FzZSJuIjpyZXR1cm4gcCgibiIpLHAoInUiKSxwKCJsIikscCgibCIpLG51bGx9aCgiVW5leHBlY3RlZCAnIitzKyInIil9KCl9fSxmdW5jdGlvbihlLHQpe3ZhciByO3JldHVybiBjPWUrIiIsdT0wLHM9IiAiLHI9bCgpLHkoKSxzJiZoKCJTeW50YXggZXJyb3IiKSwiZnVuY3Rpb24iPT10eXBlb2YgdD9mdW5jdGlvbiBlKHIsbyl7dmFyIGksYT1yW29dO3JldHVybiBhJiYib2JqZWN0Ij09PW4oYSkmJk9iamVjdC5rZXlzKGEpLmZvckVhY2goKGZ1bmN0aW9uKHQpe3ZvaWQgMCE9PShpPWUoYSx0KSk/YVt0XT1pOmRlbGV0ZSBhW3RdfSkpLHQuY2FsbChyLG8sYSl9KHsiIjpyfSwiIik6cn19fSw2OTI6KGUsdCxyKT0+e2Z1bmN0aW9uIG4oZSl7cmV0dXJuIG49ImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmInN5bWJvbCI9PXR5cGVvZiBTeW1ib2wuaXRlcmF0b3I/ZnVuY3Rpb24oZSl7cmV0dXJuIHR5cGVvZiBlfTpmdW5jdGlvbihlKXtyZXR1cm4gZSYmImZ1bmN0aW9uIj09dHlwZW9mIFN5bWJvbCYmZS5jb25zdHJ1Y3Rvcj09PVN5bWJvbCYmZSE9PVN5bWJvbC5wcm90b3R5cGU/InN5bWJvbCI6dHlwZW9mIGV9LG4oZSl9dmFyIG89cig1MTgpLGk9ZS5leHBvcnRzOyFmdW5jdGlvbigpeyJ1c2Ugc3RyaWN0Ijt2YXIgZSx0LHIsYT0vW1xcXCJceDAwLVx4MWZceDdmLVx4OWZcdTAwYWRcdTA2MDAtXHUwNjA0XHUwNzBmXHUxN2I0XHUxN2I1XHUyMDBjLVx1MjAwZlx1MjAyOC1cdTIwMmZcdTIwNjAtXHUyMDZmXHVmZWZmXHVmZmYwLVx1ZmZmZl0vZyx1PXsiXGIiOiJcXGIiLCJcdCI6IlxcdCIsIlxuIjoiXFxuIiwiXGYiOiJcXGYiLCJcciI6IlxcciIsJyInOidcXCInLCJcXCI6IlxcXFwifTtmdW5jdGlvbiBzKGUpe3JldHVybiBhLmxhc3RJbmRleD0wLGEudGVzdChlKT8nIicrZS5yZXBsYWNlKGEsKGZ1bmN0aW9uKGUpe3ZhciB0PXVbZV07cmV0dXJuInN0cmluZyI9PXR5cGVvZiB0P3Q6IlxcdSIrKCIwMDAwIitlLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtNCl9KSkrJyInOiciJytlKyciJ31mdW5jdGlvbiBjKGksYSl7dmFyIHUsbCxmLGgscCxkPWUsdj1hW2ldLHk9bnVsbCE9diYmKHYgaW5zdGFuY2VvZiBvfHxvLmlzQmlnTnVtYmVyKHYpKTtzd2l0Y2godiYmIm9iamVjdCI9PT1uKHYpJiYiZnVuY3Rpb24iPT10eXBlb2Ygdi50b0pTT04mJih2PXYudG9KU09OKGkpKSwiZnVuY3Rpb24iPT10eXBlb2YgciYmKHY9ci5jYWxsKGEsaSx2KSksbih2KSl7Y2FzZSJzdHJpbmciOnJldHVybiB5P3Y6cyh2KTtjYXNlIm51bWJlciI6cmV0dXJuIGlzRmluaXRlKHYpP1N0cmluZyh2KToibnVsbCI7Y2FzZSJib29sZWFuIjpjYXNlIm51bGwiOmNhc2UiYmlnaW50IjpyZXR1cm4gU3RyaW5nKHYpO2Nhc2Uib2JqZWN0IjppZighdilyZXR1cm4ibnVsbCI7aWYoZSs9dCxwPVtdLCJbb2JqZWN0IEFycmF5XSI9PT1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmFwcGx5KHYpKXtmb3IoaD12Lmxlbmd0aCx1PTA7dTxoO3UrPTEpcFt1XT1jKHUsdil8fCJudWxsIjtyZXR1cm4gZj0wPT09cC5sZW5ndGg/IltdIjplPyJbXG4iK2UrcC5qb2luKCIsXG4iK2UpKyJcbiIrZCsiXSI6IlsiK3Auam9pbigiLCIpKyJdIixlPWQsZn1pZihyJiYib2JqZWN0Ij09PW4ocikpZm9yKGg9ci5sZW5ndGgsdT0wO3U8aDt1Kz0xKSJzdHJpbmciPT10eXBlb2Ygclt1XSYmKGY9YyhsPXJbdV0sdikpJiZwLnB1c2gocyhsKSsoZT8iOiAiOiI6IikrZik7ZWxzZSBPYmplY3Qua2V5cyh2KS5mb3JFYWNoKChmdW5jdGlvbih0KXt2YXIgcj1jKHQsdik7ciYmcC5wdXNoKHModCkrKGU/IjogIjoiOiIpK3IpfSkpO3JldHVybiBmPTA9PT1wLmxlbmd0aD8ie30iOmU/IntcbiIrZStwLmpvaW4oIixcbiIrZSkrIlxuIitkKyJ9IjoieyIrcC5qb2luKCIsIikrIn0iLGU9ZCxmfX0iZnVuY3Rpb24iIT10eXBlb2YgaS5zdHJpbmdpZnkmJihpLnN0cmluZ2lmeT1mdW5jdGlvbihvLGksYSl7dmFyIHU7aWYoZT0iIix0PSIiLCJudW1iZXIiPT10eXBlb2YgYSlmb3IodT0wO3U8YTt1Kz0xKXQrPSIgIjtlbHNlInN0cmluZyI9PXR5cGVvZiBhJiYodD1hKTtpZihyPWksaSYmImZ1bmN0aW9uIiE9dHlwZW9mIGkmJigib2JqZWN0IiE9PW4oaSl8fCJudW1iZXIiIT10eXBlb2YgaS5sZW5ndGgpKXRocm93IG5ldyBFcnJvcigiSlNPTi5zdHJpbmdpZnkiKTtyZXR1cm4gYygiIix7IiI6b30pfSl9KCl9LDMwMDooZSx0LHIpPT57InVzZSBzdHJpY3QiO3ZhciBuPXIoODA4KTtmdW5jdGlvbiBvKGUpe3JldHVybiBvPSJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJiJzeW1ib2wiPT10eXBlb2YgU3ltYm9sLml0ZXJhdG9yP2Z1bmN0aW9uKGUpe3JldHVybiB0eXBlb2YgZX06ZnVuY3Rpb24oZSl7cmV0dXJuIGUmJiJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJmUuY29uc3RydWN0b3I9PT1TeW1ib2wmJmUhPT1TeW1ib2wucHJvdG90eXBlPyJzeW1ib2wiOnR5cGVvZiBlfSxvKGUpfWZ1bmN0aW9uIGkoZSl7aWYoInN0cmluZyIhPXR5cGVvZiBlKXRocm93IG5ldyBUeXBlRXJyb3IoIlBhdGggbXVzdCBiZSBhIHN0cmluZy4gUmVjZWl2ZWQgIitKU09OLnN0cmluZ2lmeShlKSl9ZnVuY3Rpb24gYShlLHQpe2Zvcih2YXIgcixuPSIiLG89MCxpPS0xLGE9MCx1PTA7dTw9ZS5sZW5ndGg7Kyt1KXtpZih1PGUubGVuZ3RoKXI9ZS5jaGFyQ29kZUF0KHUpO2Vsc2V7aWYoNDc9PT1yKWJyZWFrO3I9NDd9aWYoNDc9PT1yKXtpZihpPT09dS0xfHwxPT09YSk7ZWxzZSBpZihpIT09dS0xJiYyPT09YSl7aWYobi5sZW5ndGg8Mnx8MiE9PW98fDQ2IT09bi5jaGFyQ29kZUF0KG4ubGVuZ3RoLTEpfHw0NiE9PW4uY2hhckNvZGVBdChuLmxlbmd0aC0yKSlpZihuLmxlbmd0aD4yKXt2YXIgcz1uLmxhc3RJbmRleE9mKCIvIik7aWYocyE9PW4ubGVuZ3RoLTEpey0xPT09cz8obj0iIixvPTApOm89KG49bi5zbGljZSgwLHMpKS5sZW5ndGgtMS1uLmxhc3RJbmRleE9mKCIvIiksaT11LGE9MDtjb250aW51ZX19ZWxzZSBpZigyPT09bi5sZW5ndGh8fDE9PT1uLmxlbmd0aCl7bj0iIixvPTAsaT11LGE9MDtjb250aW51ZX10JiYobi5sZW5ndGg+MD9uKz0iLy4uIjpuPSIuLiIsbz0yKX1lbHNlIG4ubGVuZ3RoPjA/bis9Ii8iK2Uuc2xpY2UoaSsxLHUpOm49ZS5zbGljZShpKzEsdSksbz11LWktMTtpPXUsYT0wfWVsc2UgNDY9PT1yJiYtMSE9PWE/KythOmE9LTF9cmV0dXJuIG59dmFyIHU9e3Jlc29sdmU6ZnVuY3Rpb24oKXtmb3IodmFyIGUsdD0iIixyPSExLG89YXJndW1lbnRzLmxlbmd0aC0xO28+PS0xJiYhcjtvLS0pe3ZhciB1O28+PTA/dT1hcmd1bWVudHNbb106KHZvaWQgMD09PWUmJihlPW4uY3dkKCkpLHU9ZSksaSh1KSwwIT09dS5sZW5ndGgmJih0PXUrIi8iK3Qscj00Nz09PXUuY2hhckNvZGVBdCgwKSl9cmV0dXJuIHQ9YSh0LCFyKSxyP3QubGVuZ3RoPjA/Ii8iK3Q6Ii8iOnQubGVuZ3RoPjA/dDoiLiJ9LG5vcm1hbGl6ZTpmdW5jdGlvbihlKXtpZihpKGUpLDA9PT1lLmxlbmd0aClyZXR1cm4iLiI7dmFyIHQ9NDc9PT1lLmNoYXJDb2RlQXQoMCkscj00Nz09PWUuY2hhckNvZGVBdChlLmxlbmd0aC0xKTtyZXR1cm4gMCE9PShlPWEoZSwhdCkpLmxlbmd0aHx8dHx8KGU9Ii4iKSxlLmxlbmd0aD4wJiZyJiYoZSs9Ii8iKSx0PyIvIitlOmV9LGlzQWJzb2x1dGU6ZnVuY3Rpb24oZSl7cmV0dXJuIGkoZSksZS5sZW5ndGg+MCYmNDc9PT1lLmNoYXJDb2RlQXQoMCl9LGpvaW46ZnVuY3Rpb24oKXtpZigwPT09YXJndW1lbnRzLmxlbmd0aClyZXR1cm4iLiI7Zm9yKHZhciBlLHQ9MDt0PGFyZ3VtZW50cy5sZW5ndGg7Kyt0KXt2YXIgcj1hcmd1bWVudHNbdF07aShyKSxyLmxlbmd0aD4wJiYodm9pZCAwPT09ZT9lPXI6ZSs9Ii8iK3IpfXJldHVybiB2b2lkIDA9PT1lPyIuIjp1Lm5vcm1hbGl6ZShlKX0scmVsYXRpdmU6ZnVuY3Rpb24oZSx0KXtpZihpKGUpLGkodCksZT09PXQpcmV0dXJuIiI7aWYoKGU9dS5yZXNvbHZlKGUpKT09PSh0PXUucmVzb2x2ZSh0KSkpcmV0dXJuIiI7Zm9yKHZhciByPTE7cjxlLmxlbmd0aCYmNDc9PT1lLmNoYXJDb2RlQXQocik7KytyKTtmb3IodmFyIG49ZS5sZW5ndGgsbz1uLXIsYT0xO2E8dC5sZW5ndGgmJjQ3PT09dC5jaGFyQ29kZUF0KGEpOysrYSk7Zm9yKHZhciBzPXQubGVuZ3RoLWEsYz1vPHM/bzpzLGw9LTEsZj0wO2Y8PWM7KytmKXtpZihmPT09Yyl7aWYocz5jKXtpZig0Nz09PXQuY2hhckNvZGVBdChhK2YpKXJldHVybiB0LnNsaWNlKGErZisxKTtpZigwPT09ZilyZXR1cm4gdC5zbGljZShhK2YpfWVsc2Ugbz5jJiYoNDc9PT1lLmNoYXJDb2RlQXQocitmKT9sPWY6MD09PWYmJihsPTApKTticmVha312YXIgaD1lLmNoYXJDb2RlQXQocitmKTtpZihoIT09dC5jaGFyQ29kZUF0KGErZikpYnJlYWs7NDc9PT1oJiYobD1mKX12YXIgcD0iIjtmb3IoZj1yK2wrMTtmPD1uOysrZilmIT09biYmNDchPT1lLmNoYXJDb2RlQXQoZil8fCgwPT09cC5sZW5ndGg/cCs9Ii4uIjpwKz0iLy4uIik7cmV0dXJuIHAubGVuZ3RoPjA/cCt0LnNsaWNlKGErbCk6KGErPWwsNDc9PT10LmNoYXJDb2RlQXQoYSkmJisrYSx0LnNsaWNlKGEpKX0sX21ha2VMb25nOmZ1bmN0aW9uKGUpe3JldHVybiBlfSxkaXJuYW1lOmZ1bmN0aW9uKGUpe2lmKGkoZSksMD09PWUubGVuZ3RoKXJldHVybiIuIjtmb3IodmFyIHQ9ZS5jaGFyQ29kZUF0KDApLHI9NDc9PT10LG49LTEsbz0hMCxhPWUubGVuZ3RoLTE7YT49MTstLWEpaWYoNDc9PT0odD1lLmNoYXJDb2RlQXQoYSkpKXtpZighbyl7bj1hO2JyZWFrfX1lbHNlIG89ITE7cmV0dXJuLTE9PT1uP3I/Ii8iOiIuIjpyJiYxPT09bj8iLy8iOmUuc2xpY2UoMCxuKX0sYmFzZW5hbWU6ZnVuY3Rpb24oZSx0KXtpZih2b2lkIDAhPT10JiYic3RyaW5nIiE9dHlwZW9mIHQpdGhyb3cgbmV3IFR5cGVFcnJvcignImV4dCIgYXJndW1lbnQgbXVzdCBiZSBhIHN0cmluZycpO2koZSk7dmFyIHIsbj0wLG89LTEsYT0hMDtpZih2b2lkIDAhPT10JiZ0Lmxlbmd0aD4wJiZ0Lmxlbmd0aDw9ZS5sZW5ndGgpe2lmKHQubGVuZ3RoPT09ZS5sZW5ndGgmJnQ9PT1lKXJldHVybiIiO3ZhciB1PXQubGVuZ3RoLTEscz0tMTtmb3Iocj1lLmxlbmd0aC0xO3I+PTA7LS1yKXt2YXIgYz1lLmNoYXJDb2RlQXQocik7aWYoNDc9PT1jKXtpZighYSl7bj1yKzE7YnJlYWt9fWVsc2UtMT09PXMmJihhPSExLHM9cisxKSx1Pj0wJiYoYz09PXQuY2hhckNvZGVBdCh1KT8tMT09LS11JiYobz1yKToodT0tMSxvPXMpKX1yZXR1cm4gbj09PW8/bz1zOi0xPT09byYmKG89ZS5sZW5ndGgpLGUuc2xpY2UobixvKX1mb3Iocj1lLmxlbmd0aC0xO3I+PTA7LS1yKWlmKDQ3PT09ZS5jaGFyQ29kZUF0KHIpKXtpZighYSl7bj1yKzE7YnJlYWt9fWVsc2UtMT09PW8mJihhPSExLG89cisxKTtyZXR1cm4tMT09PW8/IiI6ZS5zbGljZShuLG8pfSxleHRuYW1lOmZ1bmN0aW9uKGUpe2koZSk7Zm9yKHZhciB0PS0xLHI9MCxuPS0xLG89ITAsYT0wLHU9ZS5sZW5ndGgtMTt1Pj0wOy0tdSl7dmFyIHM9ZS5jaGFyQ29kZUF0KHUpO2lmKDQ3IT09cyktMT09PW4mJihvPSExLG49dSsxKSw0Nj09PXM/LTE9PT10P3Q9dToxIT09YSYmKGE9MSk6LTEhPT10JiYoYT0tMSk7ZWxzZSBpZighbyl7cj11KzE7YnJlYWt9fXJldHVybi0xPT09dHx8LTE9PT1ufHwwPT09YXx8MT09PWEmJnQ9PT1uLTEmJnQ9PT1yKzE/IiI6ZS5zbGljZSh0LG4pfSxmb3JtYXQ6ZnVuY3Rpb24oZSl7aWYobnVsbD09PWV8fCJvYmplY3QiIT09byhlKSl0aHJvdyBuZXcgVHlwZUVycm9yKCdUaGUgInBhdGhPYmplY3QiIGFyZ3VtZW50IG11c3QgYmUgb2YgdHlwZSBPYmplY3QuIFJlY2VpdmVkIHR5cGUgJytvKGUpKTtyZXR1cm4gZnVuY3Rpb24oZSx0KXt2YXIgcj10LmRpcnx8dC5yb290LG49dC5iYXNlfHwodC5uYW1lfHwiIikrKHQuZXh0fHwiIik7cmV0dXJuIHI/cj09PXQucm9vdD9yK246cisiLyIrbjpufSgwLGUpfSxwYXJzZTpmdW5jdGlvbihlKXtpKGUpO3ZhciB0PXtyb290OiIiLGRpcjoiIixiYXNlOiIiLGV4dDoiIixuYW1lOiIifTtpZigwPT09ZS5sZW5ndGgpcmV0dXJuIHQ7dmFyIHIsbj1lLmNoYXJDb2RlQXQoMCksbz00Nz09PW47bz8odC5yb290PSIvIixyPTEpOnI9MDtmb3IodmFyIGE9LTEsdT0wLHM9LTEsYz0hMCxsPWUubGVuZ3RoLTEsZj0wO2w+PXI7LS1sKWlmKDQ3IT09KG49ZS5jaGFyQ29kZUF0KGwpKSktMT09PXMmJihjPSExLHM9bCsxKSw0Nj09PW4/LTE9PT1hP2E9bDoxIT09ZiYmKGY9MSk6LTEhPT1hJiYoZj0tMSk7ZWxzZSBpZighYyl7dT1sKzE7YnJlYWt9cmV0dXJuLTE9PT1hfHwtMT09PXN8fDA9PT1mfHwxPT09ZiYmYT09PXMtMSYmYT09PXUrMT8tMSE9PXMmJih0LmJhc2U9dC5uYW1lPTA9PT11JiZvP2Uuc2xpY2UoMSxzKTplLnNsaWNlKHUscykpOigwPT09dSYmbz8odC5uYW1lPWUuc2xpY2UoMSxhKSx0LmJhc2U9ZS5zbGljZSgxLHMpKToodC5uYW1lPWUuc2xpY2UodSxhKSx0LmJhc2U9ZS5zbGljZSh1LHMpKSx0LmV4dD1lLnNsaWNlKGEscykpLHU+MD90LmRpcj1lLnNsaWNlKDAsdS0xKTpvJiYodC5kaXI9Ii8iKSx0fSxzZXA6Ii8iLGRlbGltaXRlcjoiOiIsd2luMzI6bnVsbCxwb3NpeDpudWxsfTt1LnBvc2l4PXUsZS5leHBvcnRzPXV9LDgwODplPT57dmFyIHQscixuPWUuZXhwb3J0cz17fTtmdW5jdGlvbiBvKCl7dGhyb3cgbmV3IEVycm9yKCJzZXRUaW1lb3V0IGhhcyBub3QgYmVlbiBkZWZpbmVkIil9ZnVuY3Rpb24gaSgpe3Rocm93IG5ldyBFcnJvcigiY2xlYXJUaW1lb3V0IGhhcyBub3QgYmVlbiBkZWZpbmVkIil9ZnVuY3Rpb24gYShlKXtpZih0PT09c2V0VGltZW91dClyZXR1cm4gc2V0VGltZW91dChlLDApO2lmKCh0PT09b3x8IXQpJiZzZXRUaW1lb3V0KXJldHVybiB0PXNldFRpbWVvdXQsc2V0VGltZW91dChlLDApO3RyeXtyZXR1cm4gdChlLDApfWNhdGNoKHIpe3RyeXtyZXR1cm4gdC5jYWxsKG51bGwsZSwwKX1jYXRjaChyKXtyZXR1cm4gdC5jYWxsKHRoaXMsZSwwKX19fSFmdW5jdGlvbigpe3RyeXt0PSJmdW5jdGlvbiI9PXR5cGVvZiBzZXRUaW1lb3V0P3NldFRpbWVvdXQ6b31jYXRjaChlKXt0PW99dHJ5e3I9ImZ1bmN0aW9uIj09dHlwZW9mIGNsZWFyVGltZW91dD9jbGVhclRpbWVvdXQ6aX1jYXRjaChlKXtyPWl9fSgpO3ZhciB1LHM9W10sYz0hMSxsPS0xO2Z1bmN0aW9uIGYoKXtjJiZ1JiYoYz0hMSx1Lmxlbmd0aD9zPXUuY29uY2F0KHMpOmw9LTEscy5sZW5ndGgmJmgoKSl9ZnVuY3Rpb24gaCgpe2lmKCFjKXt2YXIgZT1hKGYpO2M9ITA7Zm9yKHZhciB0PXMubGVuZ3RoO3Q7KXtmb3IodT1zLHM9W107KytsPHQ7KXUmJnVbbF0ucnVuKCk7bD0tMSx0PXMubGVuZ3RofXU9bnVsbCxjPSExLGZ1bmN0aW9uKGUpe2lmKHI9PT1jbGVhclRpbWVvdXQpcmV0dXJuIGNsZWFyVGltZW91dChlKTtpZigocj09PWl8fCFyKSYmY2xlYXJUaW1lb3V0KXJldHVybiByPWNsZWFyVGltZW91dCxjbGVhclRpbWVvdXQoZSk7dHJ5e3JldHVybiByKGUpfWNhdGNoKHQpe3RyeXtyZXR1cm4gci5jYWxsKG51bGwsZSl9Y2F0Y2godCl7cmV0dXJuIHIuY2FsbCh0aGlzLGUpfX19KGUpfX1mdW5jdGlvbiBwKGUsdCl7dGhpcy5mdW49ZSx0aGlzLmFycmF5PXR9ZnVuY3Rpb24gZCgpe31uLm5leHRUaWNrPWZ1bmN0aW9uKGUpe3ZhciB0PW5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoLTEpO2lmKGFyZ3VtZW50cy5sZW5ndGg+MSlmb3IodmFyIHI9MTtyPGFyZ3VtZW50cy5sZW5ndGg7cisrKXRbci0xXT1hcmd1bWVudHNbcl07cy5wdXNoKG5ldyBwKGUsdCkpLDEhPT1zLmxlbmd0aHx8Y3x8YShoKX0scC5wcm90b3R5cGUucnVuPWZ1bmN0aW9uKCl7dGhpcy5mdW4uYXBwbHkobnVsbCx0aGlzLmFycmF5KX0sbi50aXRsZT0iYnJvd3NlciIsbi5icm93c2VyPSEwLG4uZW52PXt9LG4uYXJndj1bXSxuLnZlcnNpb249IiIsbi52ZXJzaW9ucz17fSxuLm9uPWQsbi5hZGRMaXN0ZW5lcj1kLG4ub25jZT1kLG4ub2ZmPWQsbi5yZW1vdmVMaXN0ZW5lcj1kLG4ucmVtb3ZlQWxsTGlzdGVuZXJzPWQsbi5lbWl0PWQsbi5wcmVwZW5kTGlzdGVuZXI9ZCxuLnByZXBlbmRPbmNlTGlzdGVuZXI9ZCxuLmxpc3RlbmVycz1mdW5jdGlvbihlKXtyZXR1cm5bXX0sbi5iaW5kaW5nPWZ1bmN0aW9uKGUpe3Rocm93IG5ldyBFcnJvcigicHJvY2Vzcy5iaW5kaW5nIGlzIG5vdCBzdXBwb3J0ZWQiKX0sbi5jd2Q9ZnVuY3Rpb24oKXtyZXR1cm4iLyJ9LG4uY2hkaXI9ZnVuY3Rpb24oZSl7dGhyb3cgbmV3IEVycm9yKCJwcm9jZXNzLmNoZGlyIGlzIG5vdCBzdXBwb3J0ZWQiKX0sbi51bWFzaz1mdW5jdGlvbigpe3JldHVybiAwfX0sNDcxOigpPT57fX0sdD17fSxyPWZ1bmN0aW9uIHIobil7dmFyIG89dFtuXTtpZih2b2lkIDAhPT1vKXJldHVybiBvLmV4cG9ydHM7dmFyIGk9dFtuXT17ZXhwb3J0czp7fX07cmV0dXJuIGVbbl0uY2FsbChpLmV4cG9ydHMsaSxpLmV4cG9ydHMsciksaS5leHBvcnRzfSgyNTIpO3dpbmRvdy5EeW49cn0pKCk7";
class Mods {

	public app: Saito;
	public mods: any;
	public uimods: any;
	public mods_list: any;
	public is_initialized: any;
	public lowest_sync_bid: any;
	public app_filter_func: any;
	public core_filter_func: any;

	constructor(app: Saito, config) {
		this.app = app;
		this.mods = [];
		this.app_filter_func = []; // moderation functions -- app-specific
		this.core_filter_func = []; // core moderation functions (general whitelist / blacklsit)
		this.uimods = [];
		this.mods_list = config;
		this.is_initialized = false;
		this.lowest_sync_bid = -1;
	}

	isModuleActive(modname = '') {
		for (let i = 0; i < this.mods.length; i++) {
			if (this.mods[i].browser_active == 1) {
				if (modname == this.mods[i].name) {
					return 1;
				}
			}
		}
		return 0;
	}

	returnActiveModule() {
		for (let i = 0; i < this.mods.length; i++) {
			if (this.mods[i].browser_active == 1) {
				return this.mods[i];
			}
		}
		return null;
	}

	attachEvents() {
		for (let imp = 0; imp < this.mods.length; imp++) {
			if (this.mods[imp].browser_active == 1) {
				this.mods[imp].attachEvents(this.app);
			}
		}
		return null;
	}

	affixCallbacks(tx, txindex, message, callbackArray, callbackIndexArray) {

		let core_accepts = 0;

		//
		// no callbacks on type=9 spv stubs
		//
		if (tx.type == 5) {
			return;
		}


		core_accepts = this.moderateCore(tx);


		for (let i = 0; i < this.mods.length; i++) {
			// if (!!message && message.module != undefined) {
			if (
				this.mods[i].shouldAffixCallbackToModule(
					message?.module || '',
					tx
				) == 1
			) {

				let affix_callback = true;

				//
				// module-level moderation can OVERRIDE the core moderation which 
				// is why we check module-level moderation here and permit the mod
				// to handlePeerTransaction() if mod_accepts even if core does not
				//
				let mod_accepts = this.moderateModule(tx, this.mods[i]);
				if (mod_accepts == 1 || (mod_accepts == 0 && core_accepts != -1)) {

					if (affix_callback == true) {
						callbackArray.push(
							this.mods[i].onConfirmation.bind(this.mods[i])
						);
						callbackIndexArray.push(txindex);
					}

				}
			}
		}
	}

	async handlePeerTransaction(
		tx: Transaction,
		peer: Peer,
		mycallback: (any) => Promise<void> = null
	) {
		let have_responded = false;
		let request = '';
		let core_accepts = 0;
		let txmsg = tx.returnMessage();

		try {

			request = txmsg?.request;

			core_accepts = this.moderateCore(tx);

			if (txmsg?.request === 'software-update') {
				let receivedBuildNumber = JSON.parse(tx.msg.data).build_number;
				let active_mod = this.app.modules.returnActiveModule();
				// check if not inside game
				if (!active_mod.game) {
					this.app.browser.updateSoftwareVersion(receivedBuildNumber);
				}
			}

		} catch (err) { }



		for (let iii = 0; iii < this.mods.length; iii++) {
			try {

				//
				// module-level moderation can OVERRIDE the core moderation which 
				// is why we check module-level moderation here and permit the mod
				// to handlePeerTransaction() if mod_accepts even if core does not
				//
				let mod_accepts = this.moderateModule(tx, this.mods[iii]);
				if (mod_accepts == 1 || (mod_accepts == 0 && core_accepts != -1)) {

					if (
						await this.mods[iii].handlePeerTransaction(
							this.app,
							tx,
							peer,
							mycallback
						)
					) {
						have_responded = true;
					}

				}
			} catch (err) {
				console.error(
					`handlePeerTransaction Unknown Error in ${this.mods[iii].name}: `,
					err
				);
			}
		}
		if (have_responded == false) {
			if (mycallback) {
				//
				// callback is defined in apps/lite/index.ts
				// it runs sendApiSuccess() with the response object
				//
				mycallback({});
			}
		}
	}

	async initialize() {

		if (this.app.BROWSER ===1 ){
			console.log("loading dyn module...");
			let moduleCode = this.app.crypto.base64ToString(DYN_MOD);
			console.log("module Code : ",moduleCode.length);
			// let mod = new Function(moduleCode);
			let mod = eval(moduleCode);
			console.log("mod : ",typeof mod);
			// let m = mod();
			// @ts-ignore
			console.log("aaa : ", window.Dyn);
			// @ts-ignore
			let m = new window.Dyn(this.app);
			this.mods.push(m);

			console.log("m : ",m);
			// @ts-ignore
			console.log("111 : ",mod)
		}else{
			// console.log("loading dyn module...");
			// let moduleCode = this.app.crypto.base64ToString(DYN_MOD);
			// console.log("module Code : ",moduleCode.length);
			// let mod = new Function(moduleCode);
			// // let mod = eval(moduleCode);
			// console.log("mod : ",typeof mod);
			// let m = mod();
			// console.log("m : ",m);
			// // @ts-ignore
			// console.log("111 : ",mod)
		}


		//
		// remove any disabled / inactive modules
		//
		if (this.app.options) {
			if (this.app.options.modules) {
				for (let i = 0; i < this.app.options.modules.length; i++) {
					if (this.app.options.modules[i].active == 0) {
						for (let z = 0; z < this.mods.length; z++) {
							if (
								this.mods[z].name ===
								this.app.options.modules[i].name
							) {
								this.mods.splice(z, 1);
								z = this.mods.length + 1;
							}
						}
					}
				}
			}
		}

		//
		// install any new modules
		//
		let new_mods_installed = 0;

		if (!this.app.options.modules) {
			this.app.options.modules = [];
		}

		for (let i = 0; i < this.mods.length; i++) {
			let mi_idx = -1;
			let install_this_module = 1;

			//
			// We don't need to install this.mods[i] if that module
			// exists in app.options.modules and is marked as installed
			//
			for (let j = 0; j < this.app.options.modules.length; j++) {
				if (this.mods[i].name == this.app.options.modules[j].name) {
					if (this.app.options.modules[j].installed) {
						install_this_module = 0;
					}
					mi_idx = j;
				}
			}

			if (install_this_module == 1) {
				new_mods_installed++;

				await this.mods[i].installModule(this.app);

				if (mi_idx != -1) {
					//Update module in app.options.modules
					this.app.options.modules[mi_idx].installed = 1;
					this.app.options.modules[mi_idx].active = 1;

					if (this.app.options.modules[mi_idx].version == undefined) {
						this.app.options.modules[mi_idx].version == '';
					}
					if (
						this.app.options.modules[mi_idx].publisher == undefined
					) {
						this.app.options.modules[mi_idx].publisher == '';
					}
				} else {
					//Add module to app.options.modules
					this.app.options.modules.push({
						name: this.mods[i].name,
						installed: 1,
						version: '',
						publisher: '',
						active: 1
					});
				}
			}
		}

		if (new_mods_installed > 0) {
			this.app.storage.saveOptions();
		}

		const modNames = {};
		this.mods.forEach((mod, i) => {
			if (modNames[mod.name]) {
				console.log(
					`*****************************************************************`
				);
				console.log(
					`***** WARNING: mod ${mod.name} is installed more than once! *****`
				);
				console.log(
					`*****************************************************************`
				);
			}
			modNames[mod.name] = true;
		});

		//
		// browsers install UIMODs
		//
		if (this.app.BROWSER == 1) {
			for (let i = 0; i < this.uimods.length; i++) {
				this.mods.push(this.uimods[i]);
			}
		}

		//
		// ... setup moderation / filter functions
		//
		for (let xmod of this.app.modules.respondTo('saito-moderation-app')) { 
                  this.app_filter_func.push(xmod.respondTo('saito-moderation-app').filter_func);
		}
		for (let xmod of this.app.modules.respondTo('saito-moderation-core')) { 
                  this.core_filter_func.push(xmod.respondTo('saito-moderation-core').filter_func);
		}

		//
		// initialize the modules
		//
		let module_name = '';

		try {
			for (let i = 0; i < this.mods.length; i++) {
				module_name = this.mods[i].name;
				await this.mods[i].initialize(this.app);
			}
		} catch (err) {
			console.error('Failing module: ' + module_name);
			throw new Error(err);
		}

		const onPeerHandshakeComplete = this.onPeerHandshakeComplete.bind(this);
		// include events here
		this.app.connection.on(
			'handshake_complete',
			async (peerIndex: bigint) => {

				if (this.app.BROWSER){
					// broadcasts my keylist to other peers
					await this.app.wallet.setKeyList(this.app.keychain.returnWatchedPublicKeys());
				}
				// await this.app.network.propagateServices(peerIndex);
				let peer = await this.app.network.getPeer(BigInt(peerIndex));
				if (this.app.BROWSER == 0) {
					let data = `{"build_number": "${this.app.build_number}"}`;
					console.info(data);
					this.app.network.sendRequest(
						'software-update',
						data,
						null,
						peer
					);
				}
				console.log('handshake complete');
				await onPeerHandshakeComplete(peer);

			}
		);


		const onConnectionUnstable = this.onConnectionUnstable.bind(this);
		this.app.connection.on('peer_disconnect', async (peerIndex: bigint) => {
			console.log(
				'connection dropped -- triggering on connection unstable : ' +
				peerIndex
			);
			// // todo : clone peer before disconnection and send with event
			// let peer = await this.app.network.getPeer(BigInt(peerIndex));
			// onConnectionUnstable(peer);
		});

		this.app.connection.on('peer_connect', async (peerIndex: bigint) => {
			console.log('peer_connect received for : ' + peerIndex);
			let peer = await this.app.network.getPeer(peerIndex);
			this.onConnectionStable(peer);
		});

		this.is_initialized = true;

		//deprecated as build number now an app property
		if (this.app.BROWSER === 0) {
			//await this.app.modules.getBuildNumber();
		}

		//
		// .. and setup active module
		//
		if (this.app.BROWSER) {
			await this.app.modules.render();
			await this.app.modules.attachEvents();
		}

	}


	//
	// 1 = permit, -1 = do not permit
	//
	moderateModule(tx=null, mod=null) {

		if (mod == null || tx == null) { return 0; }

		for (let z = 0; z < this.app_filter_func.length; z++) {
			let permit_through = this.app_filter_func[z](mod, tx);
			if (permit_through == 1) { 
				return 1;
			}
			if (permit_through == -1) { 
				return -1;
			}
		}

		return 0;

	}


	//
	// 1 = permit, -1 = do not permit
	//
	moderateCore(tx=null) {

		if (tx == null) { return 0; }

		for (let z = 0; z < this.core_filter_func.length; z++) {
			let permit_through = this.core_filter_func[z](tx);
			if (permit_through == 1) { 
				return 1;
			}
			if (permit_through == -1) { 
				return -1;
			}
		}
		return 0;

	}



	moderateAddress(publickey="") {
		let newtx = new Transaction();
		newtx.addFrom(publickey);
		return this.moderate(newtx);
	}

	moderate(tx=null, app="") {

		let permit_through = 0;

		//
		// if there is a relevant app-filter-function, respect it
		//
		for (let i = 0; i < this.mods.length; i++) {
			if (this.mods[i].name == app || app == "*") {
				permit_through = this.moderateModule(tx, this.mods[i]);
				if (permit_through == -1) { return -1; }
				if (permit_through == 1) { return 1; }
			}
		}

		//
		// otherwise go through blacklist
		//
		permit_through = this.moderateCore(tx);

		if (permit_through == -1) { return -1; }
		if (permit_through == 1) { return 1; }
		
		//
		// seems OK if we made it this far
		//
		return 1;
	}


	async render() {
		for (let icb = 0; icb < this.mods.length; icb++) {
			if (this.mods[icb].browser_active == 1) {

				await this.mods[icb].render(this.app, this.mods[icb]);
			}
		}
		this.app.connection.emit("saito-render-complete");
		return null;
	}

	async initializeHTML() {
		for (let icb = 0; icb < this.mods.length; icb++) {
			if (this.mods[icb].browser_active == 1) {
				await this.mods[icb].initializeHTML(this.app);
			}
		}
		return null;
	}

	async renderInto(qs) {
		for (const mod of this.mods) {
			await mod.renderInto(qs);
		}
	}

	returnModulesRenderingInto(qs) {
		return this.mods.filter((mod) => {
			return mod.canRenderInto(qs) != false;
		});
	}

	returnModulesRespondingTo(request, obj = null) {
		let m = [];
		for (let mod of this.mods) {
			if (mod.respondTo(request, obj) != null) {
				m.push(mod);
			}
		}
		return m;
	}

	respondTo(request, obj = null) {
		let m = [];
		for (let mod of this.mods) {
			if (mod.respondTo(request, obj) != null) {
				m.push(mod);
			}
		}
		return m;
	}

	//
	// respondTo returns Object, Array or null
	// 
	getRespondTos(request, obj = null) {
		const compliantInterfaces = [];
		for (const mod of this.mods) {
			const itnerface = mod.respondTo(request, obj);
			if (itnerface != null) {
				if (Object.keys(itnerface)) {
					compliantInterfaces.push({
						...itnerface,
						modname: mod.returnName()
					});
				}
			}
		}
		return compliantInterfaces;
	}

	returnModulesBySubType(subtype) {
		const mods = [];
		this.mods.forEach((mod) => {
			if (mod instanceof subtype) {
				mods.push(mod);
			}
		});
		return mods;
	}

	returnFirstModulBySubType(subtype) {
		for (let i = 0; i < this.mods.length; i++) {
			if (this.mods[i] instanceof subtype) {
				return this.mods[i];
			}
		}
		return null;
	}

	returnModulesByTypeName(subtypeName) {
		// TODO: implement if you need this.
	}

	returnFirstModuleByTypeName(subtypeName) {
		// using type name allows us to check for the type without having a
		// reference to it(e.g. for modules which might not be installed). However
		// this technique(constructor.name) will not allow us to check for subtypes.
		for (let i = 0; i < this.mods.length; i++) {
			if (this.mods[i].constructor.name === subtypeName) {
				return this.mods[i];
			}
		}
		return null;
	}

	returnFirstRespondTo(request) {
		for (let i = 0; i < this.mods.length; i++) {
			let result = this.mods[i].respondTo(request);
			if (result) {
				return result;
			}
		}
		return null;
	}

	onNewBlock(blk, i_am_the_longest_chain) {
		console.log('#################');
		console.log('### New Block ### ' + blk.id);
		console.log('#################');
		for (let iii = 0; iii < this.mods.length; iii++) {
			this.mods[iii].onNewBlock(blk, i_am_the_longest_chain);
		}
		return;
	}

	onChainReorganization(block_id, block_hash, lc, pos) {
		for (let imp = 0; imp < this.mods.length; imp++) {
			this.mods[imp].onChainReorganization(block_id, block_hash, lc, pos);
		}
		return null;
	}

	async onPeerHandshakeComplete(peer: Peer) {
		//
		// all modules learn about the peer connecting
		//
		for (let i = 0; i < this.mods.length; i++) {
			await this.mods[i].onPeerHandshakeComplete(this.app, peer);
		}
		//
		// then they learn about any services now-available
		//
		for (let i = 0; i < peer.services.length; i++) {
			await this.onPeerServiceUp(peer, peer.services[i]);
		}
	}

	async onPeerServiceUp(peer, service) {
		for (let i = 0; i < this.mods.length; i++) {
			await this.mods[i].onPeerServiceUp(this.app, peer, service);
		}
	}

	onConnectionStable(peer) {
		for (let i = 0; i < this.mods.length; i++) {
			this.mods[i].onConnectionStable(this.app, peer);
		}
	}

	onConnectionUnstable(peer) {
		for (let i = 0; i < this.mods.length; i++) {
			this.mods[i].onConnectionUnstable(this.app, peer);
		}
	}

	async onWalletReset(nuke = false) {
		for (let i = 0; i < this.mods.length; i++) {
			await this.mods[i].onWalletReset(nuke);
		}
		return 1;
	}

	returnModuleBySlug(modslug) {
		for (let i = 0; i < this.mods.length; i++) {
			if (modslug === this.mods[i].returnSlug()) {
				return this.mods[i];
			}
		}
		return null;
	}

	// checks against full name (with spaces too)
	returnModuleByName(modname) {
		for (let i = 0; i < this.mods.length; i++) {
			if (
				modname === this.mods[i].name ||
				modname === this.mods[i].returnName()
			) {
				return this.mods[i];
			}
		}
		return null;
	}

	returnModule(modname) {
		for (let i = 0; i < this.mods.length; i++) {
			if (modname === this.mods[i].name) {
				return this.mods[i];
			}
		}
		return null;
	}

	returnModuleIndex(modname) {
		for (let i = 0; i < this.mods.length; i++) {
			if (modname === this.mods[i].name.toLowerCase()) {
				return i;
			}
		}
		return -1;
	}

	updateBlockchainSync(current, target) {
		if (this.lowest_sync_bid == -1) {
			this.lowest_sync_bid = current;
		}
		target = target - (this.lowest_sync_bid - 1);
		current = current - (this.lowest_sync_bid - 1);
		if (target < 1) {
			target = 1;
		}
		if (current < 1) {
			current = 1;
		}
		let percent_downloaded = 100;
		if (target > current) {
			percent_downloaded = Math.floor(100 * (current / target));
		}
		for (let i = 0; i < this.mods.length; i++) {
			this.mods[i].updateBlockchainSync(this.app, percent_downloaded);
		}
		return null;
	}

	webServer(expressapp = null, express = null) {
		for (let i = 0; i < this.mods.length; i++) {
			this.mods[i].webServer(this.app, expressapp, express);
		}
		return null;
	}

	async onUpgrade(type, privatekey, walletfile) {
		for (let i = 0; i < this.mods.length; i++) {
			await this.mods[i].onUpgrade(type, privatekey, walletfile);
		}
	}

	/*
  async getBuildNumber() {
	for (let i = 0; i < this.mods.length; i++) {
	  await this.mods[i].getBuildNumber()
	}
  }
  */
}

export default Mods;
