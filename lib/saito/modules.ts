import { Saito } from '../../apps/core';
import Peer from './peer';
import Transaction from './transaction';
import path from 'path';
import fs from 'fs';
import { fromBase58 } from 'saito-js/lib/util';

const DYN_MOD = "LyoqKioqKi8KKCgpID0+IHsgLy8gd2VicGFja0Jvb3RzdHJhcAoJLyoqKioqKi8KCXZhciBfX3dlYnBhY2tfbW9kdWxlc19fID0gKHsKCgkJLyoqKi8gMjYwMToKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgX19kaXJuYW1lID0gJy8nOwoKCQkJZnVuY3Rpb24gX3R5cGVvZihvKSB7CgkJCQknQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YnOwoJCQkJcmV0dXJuIF90eXBlb2YgPSAnZnVuY3Rpb24nID09IHR5cGVvZiBTeW1ib2wgJiYgJ3N5bWJvbCcgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uKG8pIHsKCQkJCQlyZXR1cm4gdHlwZW9mIG87CgkJCQl9IDogZnVuY3Rpb24obykgewoJCQkJCXJldHVybiBvICYmICdmdW5jdGlvbicgPT0gdHlwZW9mIFN5bWJvbCAmJiBvLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgbyAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICdzeW1ib2wnIDogdHlwZW9mIG87CgkJCQl9LCBfdHlwZW9mKG8pOwoJCQl9CgoJCQlmdW5jdGlvbiBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihvLCBhbGxvd0FycmF5TGlrZSkgewoJCQkJdmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgb1tTeW1ib2wuaXRlcmF0b3JdIHx8IG9bJ0BAaXRlcmF0b3InXTsKCQkJCWlmICghaXQpIHsKCQkJCQlpZiAoQXJyYXkuaXNBcnJheShvKSB8fCAoaXQgPSBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobykpIHx8IGFsbG93QXJyYXlMaWtlICYmIG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAnbnVtYmVyJykgewoJCQkJCQlpZiAoaXQpIG8gPSBpdDsKCQkJCQkJdmFyIGkgPSAwOwoJCQkJCQl2YXIgRiA9IGZ1bmN0aW9uIEYoKSB7CgkJCQkJCX07CgkJCQkJCXJldHVybiB7CgkJCQkJCQlzOiBGLCBuOiBmdW5jdGlvbiBuKCkgewoJCQkJCQkJCWlmIChpID49IG8ubGVuZ3RoKSByZXR1cm4geyBkb25lOiB0cnVlIH07CgkJCQkJCQkJcmV0dXJuIHsgZG9uZTogZmFsc2UsIHZhbHVlOiBvW2krK10gfTsKCQkJCQkJCX0sIGU6IGZ1bmN0aW9uIGUoX2UpIHsKCQkJCQkJCQl0aHJvdyBfZTsKCQkJCQkJCX0sIGY6IEYKCQkJCQkJfTsKCQkJCQl9CgkJCQkJdGhyb3cgbmV3IFR5cGVFcnJvcignSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLicpOwoJCQkJfQoJCQkJdmFyIG5vcm1hbENvbXBsZXRpb24gPSB0cnVlLCBkaWRFcnIgPSBmYWxzZSwgZXJyOwoJCQkJcmV0dXJuIHsKCQkJCQlzOiBmdW5jdGlvbiBzKCkgewoJCQkJCQlpdCA9IGl0LmNhbGwobyk7CgkJCQkJfSwgbjogZnVuY3Rpb24gbigpIHsKCQkJCQkJdmFyIHN0ZXAgPSBpdC5uZXh0KCk7CgkJCQkJCW5vcm1hbENvbXBsZXRpb24gPSBzdGVwLmRvbmU7CgkJCQkJCXJldHVybiBzdGVwOwoJCQkJCX0sIGU6IGZ1bmN0aW9uIGUoX2UyKSB7CgkJCQkJCWRpZEVyciA9IHRydWU7CgkJCQkJCWVyciA9IF9lMjsKCQkJCQl9LCBmOiBmdW5jdGlvbiBmKCkgewoJCQkJCQl0cnkgewoJCQkJCQkJaWYgKCFub3JtYWxDb21wbGV0aW9uICYmIGl0WydyZXR1cm4nXSAhPSBudWxsKSBpdFsncmV0dXJuJ10oKTsKCQkJCQkJfSBmaW5hbGx5IHsKCQkJCQkJCWlmIChkaWRFcnIpIHRocm93IGVycjsKCQkJCQkJfQoJCQkJCX0KCQkJCX07CgkJCX0KCgkJCWZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHsKCQkJCWlmICghbykgcmV0dXJuOwoJCQkJaWYgKHR5cGVvZiBvID09PSAnc3RyaW5nJykgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7CgkJCQl2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7CgkJCQlpZiAobiA9PT0gJ09iamVjdCcgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTsKCQkJCWlmIChuID09PSAnTWFwJyB8fCBuID09PSAnU2V0JykgcmV0dXJuIEFycmF5LmZyb20obyk7CgkJCQlpZiAobiA9PT0gJ0FyZ3VtZW50cycgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pOwoJCQl9CgoJCQlmdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikgewoJCQkJaWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7CgkJCQlmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIGFycjJbaV0gPSBhcnJbaV07CgkJCQlyZXR1cm4gYXJyMjsKCQkJfQoKCQkJZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZSgpIHsKCQkJCSd1c2Ugc3RyaWN0JzsgLyohIHJlZ2VuZXJhdG9yLXJ1bnRpbWUgLS0gQ29weXJpZ2h0IChjKSAyMDE0LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuIC0tIGxpY2Vuc2UgKE1JVCk6IGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWdlbmVyYXRvci9ibG9iL21haW4vTElDRU5TRSAqLwoJCQkJX3JlZ2VuZXJhdG9yUnVudGltZSA9IGZ1bmN0aW9uIF9yZWdlbmVyYXRvclJ1bnRpbWUoKSB7CgkJCQkJcmV0dXJuIGU7CgkJCQl9OwoJCQkJdmFyIHQsIGUgPSB7fSwgciA9IE9iamVjdC5wcm90b3R5cGUsIG4gPSByLmhhc093blByb3BlcnR5LAoJCQkJCW8gPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgfHwgZnVuY3Rpb24odCwgZSwgcikgewoJCQkJCQl0W2VdID0gci52YWx1ZTsKCQkJCQl9LCBpID0gJ2Z1bmN0aW9uJyA9PSB0eXBlb2YgU3ltYm9sID8gU3ltYm9sIDoge30sIGEgPSBpLml0ZXJhdG9yIHx8ICdAQGl0ZXJhdG9yJywKCQkJCQljID0gaS5hc3luY0l0ZXJhdG9yIHx8ICdAQGFzeW5jSXRlcmF0b3InLCB1ID0gaS50b1N0cmluZ1RhZyB8fCAnQEB0b1N0cmluZ1RhZyc7CgoJCQkJZnVuY3Rpb24gZGVmaW5lKHQsIGUsIHIpIHsKCQkJCQlyZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIGUsIHsKCQkJCQkJdmFsdWU6IHIsCgkJCQkJCWVudW1lcmFibGU6ICEwLAoJCQkJCQljb25maWd1cmFibGU6ICEwLAoJCQkJCQl3cml0YWJsZTogITAKCQkJCQl9KSwgdFtlXTsKCQkJCX0KCgkJCQl0cnkgewoJCQkJCWRlZmluZSh7fSwgJycpOwoJCQkJfSBjYXRjaCAodCkgewoJCQkJCWRlZmluZSA9IGZ1bmN0aW9uIGRlZmluZSh0LCBlLCByKSB7CgkJCQkJCXJldHVybiB0W2VdID0gcjsKCQkJCQl9OwoJCQkJfQoKCQkJCWZ1bmN0aW9uIHdyYXAodCwgZSwgciwgbikgewoJCQkJCXZhciBpID0gZSAmJiBlLnByb3RvdHlwZSBpbnN0YW5jZW9mIEdlbmVyYXRvciA/IGUgOiBHZW5lcmF0b3IsIGEgPSBPYmplY3QuY3JlYXRlKGkucHJvdG90eXBlKSwKCQkJCQkJYyA9IG5ldyBDb250ZXh0KG4gfHwgW10pOwoJCQkJCXJldHVybiBvKGEsICdfaW52b2tlJywgeyB2YWx1ZTogbWFrZUludm9rZU1ldGhvZCh0LCByLCBjKSB9KSwgYTsKCQkJCX0KCgkJCQlmdW5jdGlvbiB0cnlDYXRjaCh0LCBlLCByKSB7CgkJCQkJdHJ5IHsKCQkJCQkJcmV0dXJuIHsgdHlwZTogJ25vcm1hbCcsIGFyZzogdC5jYWxsKGUsIHIpIH07CgkJCQkJfSBjYXRjaCAodCkgewoJCQkJCQlyZXR1cm4geyB0eXBlOiAndGhyb3cnLCBhcmc6IHQgfTsKCQkJCQl9CgkJCQl9CgoJCQkJZS53cmFwID0gd3JhcDsKCQkJCXZhciBoID0gJ3N1c3BlbmRlZFN0YXJ0JywgbCA9ICdzdXNwZW5kZWRZaWVsZCcsIGYgPSAnZXhlY3V0aW5nJywgcyA9ICdjb21wbGV0ZWQnLCB5ID0ge307CgoJCQkJZnVuY3Rpb24gR2VuZXJhdG9yKCkgewoJCQkJfQoKCQkJCWZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uKCkgewoJCQkJfQoKCQkJCWZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkgewoJCQkJfQoKCQkJCXZhciBwID0ge307CgkJCQlkZWZpbmUocCwgYSwgZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9KTsKCQkJCXZhciBkID0gT2JqZWN0LmdldFByb3RvdHlwZU9mLCB2ID0gZCAmJiBkKGQodmFsdWVzKFtdKSkpOwoJCQkJdiAmJiB2ICE9PSByICYmIG4uY2FsbCh2LCBhKSAmJiAocCA9IHYpOwoJCQkJdmFyIGcgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5wcm90b3R5cGUgPSBHZW5lcmF0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShwKTsKCgkJCQlmdW5jdGlvbiBkZWZpbmVJdGVyYXRvck1ldGhvZHModCkgewoJCQkJCVsnbmV4dCcsICd0aHJvdycsICdyZXR1cm4nXS5mb3JFYWNoKGZ1bmN0aW9uKGUpIHsKCQkJCQkJZGVmaW5lKHQsIGUsIGZ1bmN0aW9uKHQpIHsKCQkJCQkJCXJldHVybiB0aGlzLl9pbnZva2UoZSwgdCk7CgkJCQkJCX0pOwoJCQkJCX0pOwoJCQkJfQoKCQkJCWZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IodCwgZSkgewoJCQkJCWZ1bmN0aW9uIGludm9rZShyLCBvLCBpLCBhKSB7CgkJCQkJCXZhciBjID0gdHJ5Q2F0Y2godFtyXSwgdCwgbyk7CgkJCQkJCWlmICgndGhyb3cnICE9PSBjLnR5cGUpIHsKCQkJCQkJCXZhciB1ID0gYy5hcmcsIGggPSB1LnZhbHVlOwoJCQkJCQkJcmV0dXJuIGggJiYgJ29iamVjdCcgPT0gX3R5cGVvZihoKSAmJiBuLmNhbGwoaCwgJ19fYXdhaXQnKSA/IGUucmVzb2x2ZShoLl9fYXdhaXQpLnRoZW4oZnVuY3Rpb24odCkgewoJCQkJCQkJCWludm9rZSgnbmV4dCcsIHQsIGksIGEpOwoJCQkJCQkJfSwgZnVuY3Rpb24odCkgewoJCQkJCQkJCWludm9rZSgndGhyb3cnLCB0LCBpLCBhKTsKCQkJCQkJCX0pIDogZS5yZXNvbHZlKGgpLnRoZW4oZnVuY3Rpb24odCkgewoJCQkJCQkJCXUudmFsdWUgPSB0LCBpKHUpOwoJCQkJCQkJfSwgZnVuY3Rpb24odCkgewoJCQkJCQkJCXJldHVybiBpbnZva2UoJ3Rocm93JywgdCwgaSwgYSk7CgkJCQkJCQl9KTsKCQkJCQkJfQoJCQkJCQlhKGMuYXJnKTsKCQkJCQl9CgoJCQkJCXZhciByOwoJCQkJCW8odGhpcywgJ19pbnZva2UnLCB7CgkJCQkJCXZhbHVlOiBmdW5jdGlvbiB2YWx1ZSh0LCBuKSB7CgkJCQkJCQlmdW5jdGlvbiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpIHsKCQkJCQkJCQlyZXR1cm4gbmV3IGUoZnVuY3Rpb24oZSwgcikgewoJCQkJCQkJCQlpbnZva2UodCwgbiwgZSwgcik7CgkJCQkJCQkJfSk7CgkJCQkJCQl9CgoJCQkJCQkJcmV0dXJuIHIgPSByID8gci50aGVuKGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnLCBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZykgOiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpOwoJCQkJCQl9CgkJCQkJfSk7CgkJCQl9CgoJCQkJZnVuY3Rpb24gbWFrZUludm9rZU1ldGhvZChlLCByLCBuKSB7CgkJCQkJdmFyIG8gPSBoOwoJCQkJCXJldHVybiBmdW5jdGlvbihpLCBhKSB7CgkJCQkJCWlmIChvID09PSBmKSB0aHJvdyBuZXcgRXJyb3IoJ0dlbmVyYXRvciBpcyBhbHJlYWR5IHJ1bm5pbmcnKTsKCQkJCQkJaWYgKG8gPT09IHMpIHsKCQkJCQkJCWlmICgndGhyb3cnID09PSBpKSB0aHJvdyBhOwoJCQkJCQkJcmV0dXJuIHsgdmFsdWU6IHQsIGRvbmU6ICEwIH07CgkJCQkJCX0KCQkJCQkJZm9yIChuLm1ldGhvZCA9IGksIG4uYXJnID0gYTsgOykgewoJCQkJCQkJdmFyIGMgPSBuLmRlbGVnYXRlOwoJCQkJCQkJaWYgKGMpIHsKCQkJCQkJCQl2YXIgdSA9IG1heWJlSW52b2tlRGVsZWdhdGUoYywgbik7CgkJCQkJCQkJaWYgKHUpIHsKCQkJCQkJCQkJaWYgKHUgPT09IHkpIGNvbnRpbnVlOwoJCQkJCQkJCQlyZXR1cm4gdTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQlpZiAoJ25leHQnID09PSBuLm1ldGhvZCkgbi5zZW50ID0gbi5fc2VudCA9IG4uYXJnOyBlbHNlIGlmICgndGhyb3cnID09PSBuLm1ldGhvZCkgewoJCQkJCQkJCWlmIChvID09PSBoKSB0aHJvdyBvID0gcywgbi5hcmc7CgkJCQkJCQkJbi5kaXNwYXRjaEV4Y2VwdGlvbihuLmFyZyk7CgkJCQkJCQl9IGVsc2UgJ3JldHVybicgPT09IG4ubWV0aG9kICYmIG4uYWJydXB0KCdyZXR1cm4nLCBuLmFyZyk7CgkJCQkJCQlvID0gZjsKCQkJCQkJCXZhciBwID0gdHJ5Q2F0Y2goZSwgciwgbik7CgkJCQkJCQlpZiAoJ25vcm1hbCcgPT09IHAudHlwZSkgewoJCQkJCQkJCWlmIChvID0gbi5kb25lID8gcyA6IGwsIHAuYXJnID09PSB5KSBjb250aW51ZTsKCQkJCQkJCQlyZXR1cm4geyB2YWx1ZTogcC5hcmcsIGRvbmU6IG4uZG9uZSB9OwoJCQkJCQkJfQoJCQkJCQkJJ3Rocm93JyA9PT0gcC50eXBlICYmIChvID0gcywgbi5tZXRob2QgPSAndGhyb3cnLCBuLmFyZyA9IHAuYXJnKTsKCQkJCQkJfQoJCQkJCX07CgkJCQl9CgoJCQkJZnVuY3Rpb24gbWF5YmVJbnZva2VEZWxlZ2F0ZShlLCByKSB7CgkJCQkJdmFyIG4gPSByLm1ldGhvZCwgbyA9IGUuaXRlcmF0b3Jbbl07CgkJCQkJaWYgKG8gPT09IHQpIHJldHVybiByLmRlbGVnYXRlID0gbnVsbCwgJ3Rocm93JyA9PT0gbiAmJiBlLml0ZXJhdG9yWydyZXR1cm4nXSAmJiAoci5tZXRob2QgPSAncmV0dXJuJywgci5hcmcgPSB0LCBtYXliZUludm9rZURlbGVnYXRlKGUsIHIpLCAndGhyb3cnID09PSByLm1ldGhvZCkgfHwgJ3JldHVybicgIT09IG4gJiYgKHIubWV0aG9kID0gJ3Rocm93Jywgci5hcmcgPSBuZXcgVHlwZUVycm9yKCdUaGUgaXRlcmF0b3IgZG9lcyBub3QgcHJvdmlkZSBhIFwnJyArIG4gKyAnXCcgbWV0aG9kJykpLCB5OwoJCQkJCXZhciBpID0gdHJ5Q2F0Y2gobywgZS5pdGVyYXRvciwgci5hcmcpOwoJCQkJCWlmICgndGhyb3cnID09PSBpLnR5cGUpIHJldHVybiByLm1ldGhvZCA9ICd0aHJvdycsIHIuYXJnID0gaS5hcmcsIHIuZGVsZWdhdGUgPSBudWxsLCB5OwoJCQkJCXZhciBhID0gaS5hcmc7CgkJCQkJcmV0dXJuIGEgPyBhLmRvbmUgPyAocltlLnJlc3VsdE5hbWVdID0gYS52YWx1ZSwgci5uZXh0ID0gZS5uZXh0TG9jLCAncmV0dXJuJyAhPT0gci5tZXRob2QgJiYgKHIubWV0aG9kID0gJ25leHQnLCByLmFyZyA9IHQpLCByLmRlbGVnYXRlID0gbnVsbCwgeSkgOiBhIDogKHIubWV0aG9kID0gJ3Rocm93Jywgci5hcmcgPSBuZXcgVHlwZUVycm9yKCdpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdCcpLCByLmRlbGVnYXRlID0gbnVsbCwgeSk7CgkJCQl9CgoJCQkJZnVuY3Rpb24gcHVzaFRyeUVudHJ5KHQpIHsKCQkJCQl2YXIgZSA9IHsgdHJ5TG9jOiB0WzBdIH07CgkJCQkJMSBpbiB0ICYmIChlLmNhdGNoTG9jID0gdFsxXSksIDIgaW4gdCAmJiAoZS5maW5hbGx5TG9jID0gdFsyXSwgZS5hZnRlckxvYyA9IHRbM10pLCB0aGlzLnRyeUVudHJpZXMucHVzaChlKTsKCQkJCX0KCgkJCQlmdW5jdGlvbiByZXNldFRyeUVudHJ5KHQpIHsKCQkJCQl2YXIgZSA9IHQuY29tcGxldGlvbiB8fCB7fTsKCQkJCQllLnR5cGUgPSAnbm9ybWFsJywgZGVsZXRlIGUuYXJnLCB0LmNvbXBsZXRpb24gPSBlOwoJCQkJfQoKCQkJCWZ1bmN0aW9uIENvbnRleHQodCkgewoJCQkJCXRoaXMudHJ5RW50cmllcyA9IFt7IHRyeUxvYzogJ3Jvb3QnIH1dLCB0LmZvckVhY2gocHVzaFRyeUVudHJ5LCB0aGlzKSwgdGhpcy5yZXNldCghMCk7CgkJCQl9CgoJCQkJZnVuY3Rpb24gdmFsdWVzKGUpIHsKCQkJCQlpZiAoZSB8fCAnJyA9PT0gZSkgewoJCQkJCQl2YXIgciA9IGVbYV07CgkJCQkJCWlmIChyKSByZXR1cm4gci5jYWxsKGUpOwoJCQkJCQlpZiAoJ2Z1bmN0aW9uJyA9PSB0eXBlb2YgZS5uZXh0KSByZXR1cm4gZTsKCQkJCQkJaWYgKCFpc05hTihlLmxlbmd0aCkpIHsKCQkJCQkJCXZhciBvID0gLTEsIGkgPSBmdW5jdGlvbiBuZXh0KCkgewoJCQkJCQkJCWZvciAoOyArK28gPCBlLmxlbmd0aDspIGlmIChuLmNhbGwoZSwgbykpIHJldHVybiBuZXh0LnZhbHVlID0gZVtvXSwgbmV4dC5kb25lID0gITEsIG5leHQ7CgkJCQkJCQkJcmV0dXJuIG5leHQudmFsdWUgPSB0LCBuZXh0LmRvbmUgPSAhMCwgbmV4dDsKCQkJCQkJCX07CgkJCQkJCQlyZXR1cm4gaS5uZXh0ID0gaTsKCQkJCQkJfQoJCQkJCX0KCQkJCQl0aHJvdyBuZXcgVHlwZUVycm9yKF90eXBlb2YoZSkgKyAnIGlzIG5vdCBpdGVyYWJsZScpOwoJCQkJfQoKCQkJCXJldHVybiBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgbyhnLCAnY29uc3RydWN0b3InLCB7CgkJCQkJdmFsdWU6IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLAoJCQkJCWNvbmZpZ3VyYWJsZTogITAKCQkJCX0pLCBvKEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCAnY29uc3RydWN0b3InLCB7CgkJCQkJdmFsdWU6IEdlbmVyYXRvckZ1bmN0aW9uLAoJCQkJCWNvbmZpZ3VyYWJsZTogITAKCQkJCX0pLCBHZW5lcmF0b3JGdW5jdGlvbi5kaXNwbGF5TmFtZSA9IGRlZmluZShHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgdSwgJ0dlbmVyYXRvckZ1bmN0aW9uJyksIGUuaXNHZW5lcmF0b3JGdW5jdGlvbiA9IGZ1bmN0aW9uKHQpIHsKCQkJCQl2YXIgZSA9ICdmdW5jdGlvbicgPT0gdHlwZW9mIHQgJiYgdC5jb25zdHJ1Y3RvcjsKCQkJCQlyZXR1cm4gISFlICYmIChlID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCAnR2VuZXJhdG9yRnVuY3Rpb24nID09PSAoZS5kaXNwbGF5TmFtZSB8fCBlLm5hbWUpKTsKCQkJCX0sIGUubWFyayA9IGZ1bmN0aW9uKHQpIHsKCQkJCQlyZXR1cm4gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHQsIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKSA6ICh0Ll9fcHJvdG9fXyA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBkZWZpbmUodCwgdSwgJ0dlbmVyYXRvckZ1bmN0aW9uJykpLCB0LnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoZyksIHQ7CgkJCQl9LCBlLmF3cmFwID0gZnVuY3Rpb24odCkgewoJCQkJCXJldHVybiB7IF9fYXdhaXQ6IHQgfTsKCQkJCX0sIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSksIGRlZmluZShBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSwgYywgZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9KSwgZS5Bc3luY0l0ZXJhdG9yID0gQXN5bmNJdGVyYXRvciwgZS5hc3luYyA9IGZ1bmN0aW9uKHQsIHIsIG4sIG8sIGkpIHsKCQkJCQl2b2lkIDAgPT09IGkgJiYgKGkgPSBQcm9taXNlKTsKCQkJCQl2YXIgYSA9IG5ldyBBc3luY0l0ZXJhdG9yKHdyYXAodCwgciwgbiwgbyksIGkpOwoJCQkJCXJldHVybiBlLmlzR2VuZXJhdG9yRnVuY3Rpb24ocikgPyBhIDogYS5uZXh0KCkudGhlbihmdW5jdGlvbih0KSB7CgkJCQkJCXJldHVybiB0LmRvbmUgPyB0LnZhbHVlIDogYS5uZXh0KCk7CgkJCQkJfSk7CgkJCQl9LCBkZWZpbmVJdGVyYXRvck1ldGhvZHMoZyksIGRlZmluZShnLCB1LCAnR2VuZXJhdG9yJyksIGRlZmluZShnLCBhLCBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0pLCBkZWZpbmUoZywgJ3RvU3RyaW5nJywgZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuICdbb2JqZWN0IEdlbmVyYXRvcl0nOwoJCQkJfSksIGUua2V5cyA9IGZ1bmN0aW9uKHQpIHsKCQkJCQl2YXIgZSA9IE9iamVjdCh0KSwgciA9IFtdOwoJCQkJCWZvciAodmFyIG4gaW4gZSkgci5wdXNoKG4pOwoJCQkJCXJldHVybiByLnJldmVyc2UoKSwgZnVuY3Rpb24gbmV4dCgpIHsKCQkJCQkJZm9yICg7IHIubGVuZ3RoOykgewoJCQkJCQkJdmFyIHQgPSByLnBvcCgpOwoJCQkJCQkJaWYgKHQgaW4gZSkgcmV0dXJuIG5leHQudmFsdWUgPSB0LCBuZXh0LmRvbmUgPSAhMSwgbmV4dDsKCQkJCQkJfQoJCQkJCQlyZXR1cm4gbmV4dC5kb25lID0gITAsIG5leHQ7CgkJCQkJfTsKCQkJCX0sIGUudmFsdWVzID0gdmFsdWVzLCBDb250ZXh0LnByb3RvdHlwZSA9IHsKCQkJCQljb25zdHJ1Y3RvcjogQ29udGV4dCwgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KGUpIHsKCQkJCQkJaWYgKHRoaXMucHJldiA9IDAsIHRoaXMubmV4dCA9IDAsIHRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSB0LCB0aGlzLmRvbmUgPSAhMSwgdGhpcy5kZWxlZ2F0ZSA9IG51bGwsIHRoaXMubWV0aG9kID0gJ25leHQnLCB0aGlzLmFyZyA9IHQsIHRoaXMudHJ5RW50cmllcy5mb3JFYWNoKHJlc2V0VHJ5RW50cnkpLCAhZSkgZm9yICh2YXIgciBpbiB0aGlzKSAndCcgPT09IHIuY2hhckF0KDApICYmIG4uY2FsbCh0aGlzLCByKSAmJiAhaXNOYU4oK3Iuc2xpY2UoMSkpICYmICh0aGlzW3JdID0gdCk7CgkJCQkJfSwgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHsKCQkJCQkJdGhpcy5kb25lID0gITA7CgkJCQkJCXZhciB0ID0gdGhpcy50cnlFbnRyaWVzWzBdLmNvbXBsZXRpb247CgkJCQkJCWlmICgndGhyb3cnID09PSB0LnR5cGUpIHRocm93IHQuYXJnOwoJCQkJCQlyZXR1cm4gdGhpcy5ydmFsOwoJCQkJCX0sIGRpc3BhdGNoRXhjZXB0aW9uOiBmdW5jdGlvbiBkaXNwYXRjaEV4Y2VwdGlvbihlKSB7CgkJCQkJCWlmICh0aGlzLmRvbmUpIHRocm93IGU7CgkJCQkJCXZhciByID0gdGhpczsKCgkJCQkJCWZ1bmN0aW9uIGhhbmRsZShuLCBvKSB7CgkJCQkJCQlyZXR1cm4gYS50eXBlID0gJ3Rocm93JywgYS5hcmcgPSBlLCByLm5leHQgPSBuLCBvICYmIChyLm1ldGhvZCA9ICduZXh0Jywgci5hcmcgPSB0KSwgISFvOwoJCQkJCQl9CgoJCQkJCQlmb3IgKHZhciBvID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IG8gPj0gMDsgLS1vKSB7CgkJCQkJCQl2YXIgaSA9IHRoaXMudHJ5RW50cmllc1tvXSwgYSA9IGkuY29tcGxldGlvbjsKCQkJCQkJCWlmICgncm9vdCcgPT09IGkudHJ5TG9jKSByZXR1cm4gaGFuZGxlKCdlbmQnKTsKCQkJCQkJCWlmIChpLnRyeUxvYyA8PSB0aGlzLnByZXYpIHsKCQkJCQkJCQl2YXIgYyA9IG4uY2FsbChpLCAnY2F0Y2hMb2MnKSwgdSA9IG4uY2FsbChpLCAnZmluYWxseUxvYycpOwoJCQkJCQkJCWlmIChjICYmIHUpIHsKCQkJCQkJCQkJaWYgKHRoaXMucHJldiA8IGkuY2F0Y2hMb2MpIHJldHVybiBoYW5kbGUoaS5jYXRjaExvYywgITApOwoJCQkJCQkJCQlpZiAodGhpcy5wcmV2IDwgaS5maW5hbGx5TG9jKSByZXR1cm4gaGFuZGxlKGkuZmluYWxseUxvYyk7CgkJCQkJCQkJfSBlbHNlIGlmIChjKSB7CgkJCQkJCQkJCWlmICh0aGlzLnByZXYgPCBpLmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGkuY2F0Y2hMb2MsICEwKTsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQlpZiAoIXUpIHRocm93IG5ldyBFcnJvcigndHJ5IHN0YXRlbWVudCB3aXRob3V0IGNhdGNoIG9yIGZpbmFsbHknKTsKCQkJCQkJCQkJaWYgKHRoaXMucHJldiA8IGkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShpLmZpbmFsbHlMb2MpOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0sIGFicnVwdDogZnVuY3Rpb24gYWJydXB0KHQsIGUpIHsKCQkJCQkJZm9yICh2YXIgciA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyByID49IDA7IC0tcikgewoJCQkJCQkJdmFyIG8gPSB0aGlzLnRyeUVudHJpZXNbcl07CgkJCQkJCQlpZiAoby50cnlMb2MgPD0gdGhpcy5wcmV2ICYmIG4uY2FsbChvLCAnZmluYWxseUxvYycpICYmIHRoaXMucHJldiA8IG8uZmluYWxseUxvYykgewoJCQkJCQkJCXZhciBpID0gbzsKCQkJCQkJCQlicmVhazsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQlpICYmICgnYnJlYWsnID09PSB0IHx8ICdjb250aW51ZScgPT09IHQpICYmIGkudHJ5TG9jIDw9IGUgJiYgZSA8PSBpLmZpbmFsbHlMb2MgJiYgKGkgPSBudWxsKTsKCQkJCQkJdmFyIGEgPSBpID8gaS5jb21wbGV0aW9uIDoge307CgkJCQkJCXJldHVybiBhLnR5cGUgPSB0LCBhLmFyZyA9IGUsIGkgPyAodGhpcy5tZXRob2QgPSAnbmV4dCcsIHRoaXMubmV4dCA9IGkuZmluYWxseUxvYywgeSkgOiB0aGlzLmNvbXBsZXRlKGEpOwoJCQkJCX0sIGNvbXBsZXRlOiBmdW5jdGlvbiBjb21wbGV0ZSh0LCBlKSB7CgkJCQkJCWlmICgndGhyb3cnID09PSB0LnR5cGUpIHRocm93IHQuYXJnOwoJCQkJCQlyZXR1cm4gJ2JyZWFrJyA9PT0gdC50eXBlIHx8ICdjb250aW51ZScgPT09IHQudHlwZSA/IHRoaXMubmV4dCA9IHQuYXJnIDogJ3JldHVybicgPT09IHQudHlwZSA/ICh0aGlzLnJ2YWwgPSB0aGlzLmFyZyA9IHQuYXJnLCB0aGlzLm1ldGhvZCA9ICdyZXR1cm4nLCB0aGlzLm5leHQgPSAnZW5kJykgOiAnbm9ybWFsJyA9PT0gdC50eXBlICYmIGUgJiYgKHRoaXMubmV4dCA9IGUpLCB5OwoJCQkJCX0sIGZpbmlzaDogZnVuY3Rpb24gZmluaXNoKHQpIHsKCQkJCQkJZm9yICh2YXIgZSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBlID49IDA7IC0tZSkgewoJCQkJCQkJdmFyIHIgPSB0aGlzLnRyeUVudHJpZXNbZV07CgkJCQkJCQlpZiAoci5maW5hbGx5TG9jID09PSB0KSByZXR1cm4gdGhpcy5jb21wbGV0ZShyLmNvbXBsZXRpb24sIHIuYWZ0ZXJMb2MpLCByZXNldFRyeUVudHJ5KHIpLCB5OwoJCQkJCQl9CgkJCQkJfSwgJ2NhdGNoJzogZnVuY3Rpb24gX2NhdGNoKHQpIHsKCQkJCQkJZm9yICh2YXIgZSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBlID49IDA7IC0tZSkgewoJCQkJCQkJdmFyIHIgPSB0aGlzLnRyeUVudHJpZXNbZV07CgkJCQkJCQlpZiAoci50cnlMb2MgPT09IHQpIHsKCQkJCQkJCQl2YXIgbiA9IHIuY29tcGxldGlvbjsKCQkJCQkJCQlpZiAoJ3Rocm93JyA9PT0gbi50eXBlKSB7CgkJCQkJCQkJCXZhciBvID0gbi5hcmc7CgkJCQkJCQkJCXJlc2V0VHJ5RW50cnkocik7CgkJCQkJCQkJfQoJCQkJCQkJCXJldHVybiBvOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCXRocm93IG5ldyBFcnJvcignaWxsZWdhbCBjYXRjaCBhdHRlbXB0Jyk7CgkJCQkJfSwgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24gZGVsZWdhdGVZaWVsZChlLCByLCBuKSB7CgkJCQkJCXJldHVybiB0aGlzLmRlbGVnYXRlID0gewoJCQkJCQkJaXRlcmF0b3I6IHZhbHVlcyhlKSwKCQkJCQkJCXJlc3VsdE5hbWU6IHIsCgkJCQkJCQluZXh0TG9jOiBuCgkJCQkJCX0sICduZXh0JyA9PT0gdGhpcy5tZXRob2QgJiYgKHRoaXMuYXJnID0gdCksIHk7CgkJCQkJfQoJCQkJfSwgZTsKCQkJfQoKCQkJZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykgewoJCQkJdHJ5IHsKCQkJCQl2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7CgkJCQkJdmFyIHZhbHVlID0gaW5mby52YWx1ZTsKCQkJCX0gY2F0Y2ggKGVycm9yKSB7CgkJCQkJcmVqZWN0KGVycm9yKTsKCQkJCQlyZXR1cm47CgkJCQl9CgkJCQlpZiAoaW5mby5kb25lKSB7CgkJCQkJcmVzb2x2ZSh2YWx1ZSk7CgkJCQl9IGVsc2UgewoJCQkJCVByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTsKCQkJCX0KCQkJfQoKCQkJZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHsKCQkJCXJldHVybiBmdW5jdGlvbigpIHsKCQkJCQl2YXIgc2VsZiA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHM7CgkJCQkJcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewoJCQkJCQl2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7CgoJCQkJCQlmdW5jdGlvbiBfbmV4dCh2YWx1ZSkgewoJCQkJCQkJYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAnbmV4dCcsIHZhbHVlKTsKCQkJCQkJfQoKCQkJCQkJZnVuY3Rpb24gX3Rocm93KGVycikgewoJCQkJCQkJYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAndGhyb3cnLCBlcnIpOwoJCQkJCQl9CgoJCQkJCQlfbmV4dCh1bmRlZmluZWQpOwoJCQkJCX0pOwoJCQkJfTsKCQkJfQoKCQkJZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewoJCQkJaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKCQkJCQl0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsKCQkJCX0KCQkJfQoKCQkJZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewoJCQkJCXZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CgkJCQkJZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwoJCQkJCWRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKCQkJCQlpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKCQkJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBfdG9Qcm9wZXJ0eUtleShkZXNjcmlwdG9yLmtleSksIGRlc2NyaXB0b3IpOwoJCQkJfQoJCQl9CgoJCQlmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CgkJCQlpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKCQkJCWlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKCQkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvciwgJ3Byb3RvdHlwZScsIHsgd3JpdGFibGU6IGZhbHNlIH0pOwoJCQkJcmV0dXJuIENvbnN0cnVjdG9yOwoJCQl9CgoJCQlmdW5jdGlvbiBfdG9Qcm9wZXJ0eUtleSh0KSB7CgkJCQl2YXIgaSA9IF90b1ByaW1pdGl2ZSh0LCAnc3RyaW5nJyk7CgkJCQlyZXR1cm4gJ3N5bWJvbCcgPT0gX3R5cGVvZihpKSA/IGkgOiBTdHJpbmcoaSk7CgkJCX0KCgkJCWZ1bmN0aW9uIF90b1ByaW1pdGl2ZSh0LCByKSB7CgkJCQlpZiAoJ29iamVjdCcgIT0gX3R5cGVvZih0KSB8fCAhdCkgcmV0dXJuIHQ7CgkJCQl2YXIgZSA9IHRbU3ltYm9sLnRvUHJpbWl0aXZlXTsKCQkJCWlmICh2b2lkIDAgIT09IGUpIHsKCQkJCQl2YXIgaSA9IGUuY2FsbCh0LCByIHx8ICdkZWZhdWx0Jyk7CgkJCQkJaWYgKCdvYmplY3QnICE9IF90eXBlb2YoaSkpIHJldHVybiBpOwoJCQkJCXRocm93IG5ldyBUeXBlRXJyb3IoJ0BAdG9QcmltaXRpdmUgbXVzdCByZXR1cm4gYSBwcmltaXRpdmUgdmFsdWUuJyk7CgkJCQl9CgkJCQlyZXR1cm4gKCdzdHJpbmcnID09PSByID8gU3RyaW5nIDogTnVtYmVyKSh0KTsKCQkJfQoKCQkJdmFyIGZzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNDcxKTsKCQkJdmFyIHBhdGggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUzMDApOwoJCQl2YXIgSlNPTiA9IF9fd2VicGFja19yZXF1aXJlX18oNDg2Nyk7CgkJCXZhciBNb2RUZW1wbGF0ZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbigpIHsKCQkJCWZ1bmN0aW9uIE1vZFRlbXBsYXRlKGFwcCwgbW9kKSB7CgkJCQkJX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE1vZFRlbXBsYXRlKTsKCQkJCQl0aGlzLmFwcCA9IGFwcCB8fCB7fTsKCQkJCQl0aGlzLmRlc2NyaXB0aW9uID0gJyc7CgkJCQkJdGhpcy5kaXJuYW1lID0gJyc7CgkJCQkJdGhpcy5hcHBuYW1lID0gJyc7CgkJCQkJdGhpcy5uYW1lID0gJyc7CgkJCQkJdGhpcy5zbHVnID0gJyc7CgkJCQkJdGhpcy5saW5rID0gJyc7CgkJCQkJdGhpcy5ldmVudHMgPSBbXTsgLy8gZXZlbnRzIHRvIHdoaWNoIGkgcmVzcG9uZAoJCQkJCXRoaXMucmVuZGVySW50b3MgPSB7fTsKCQkJCQl0aGlzLmFsZXJ0cyA9IDA7CgkJCQkJdGhpcy5jYXRlZ29yaWVzID0gJyc7CgkJCQkJdGhpcy5zcWxjYWNoZSA9IHt9OwoJCQkJCXRoaXMuc3FsY2FjaGVfZW5hYmxlZCA9IDA7CgkJCQkJdGhpcy5zZXJ2aWNlcyA9IFtdOwoJCQkJCXRoaXMuY29tcG9uZW50cyA9IFtdOyAvLyBtb2R1bGVzIG9yIFVJIG9iamVjdHMKCQkJCQl0aGlzLnJlcXVlc3Rfbm9faW50ZXJydXB0cyA9IGZhbHNlOyAvLyBpZiB5b3UgZG9uJ3Qgd2FudCB5b3VyIG1vZHVsZSB0byBoYXZlIG90aGVyIG1vZHVsZXMgaW5zZXJ0IEhUTUwgY29tcG9uZW50cywgeW91IGNhbiByZXF1ZXN0IGl0IGhlcmUuCgkJCQkJdGhpcy5kYl90YWJsZXMgPSBbXTsKCQkJCQl0aGlzLnZlcnNpb24gPSAxLjA7CgkJCQkJdGhpcy5tZXRhID0gW107CgkJCQkJdGhpcy5zdHlsZXMgPSBbXTsKCQkJCQl0aGlzLnNjcmlwdHMgPSBbXTsKCQkJCQl0aGlzLmluY2x1ZGVzX2F0dGFjaGVkID0gMDsKCQkJCQl0aGlzLmV2ZW50TGlzdGVuZXJzID0gW107CgkJCQkJdGhpcy50aGVtZV9vcHRpb25zID0gewoJCQkJCQlsaXRlOiAnZmEtc29saWQgZmEtc3VuJywKCQkJCQkJZGFyazogJ2ZhLXNvbGlkIGZhLWNsb3VkLW1vb24nLAoJCQkJCQltaWRuaWdodDogJ2ZhLXNvbGlkIGZhLW1vb24nLAoJCQkJCQltaWxxdWV0b2FzdDogJ2ZhLXNvbGlkIGZhLWNvdycsCgkJCQkJCXNhbmdyZTMwMDA6ICdmYS1zb2xpZCBmYS1kcm9wbGV0LXNsYXNoJwoJCQkJCX07CgkJCQkJdGhpcy5wcm9jZXNzZWRUeHMgPSB7fTsKCQkJCQl0aGlzLnBhcmFtZXRlcnMgPSB7fTsKCgkJCQkJLy8gQSBtb2R1bGUgd2hpY2ggd2lzaGVzIHRvIGJlIHJlbmRlcmVkIGluIHRoZSBjbGllbnQgY2FuIGluY2x1ZGUgaXQncyBvd24KCQkJCQkvLyB3ZWIgZGlyZWN0b3J5IHdoaWNoIHdpbGwgYXV0b21hdGljYWxseSBiZSBzZXJ2ZWQgYnkgdGhlIFNhaXRvIENvcmUncwoJCQkJCS8vIHNlcnZlci4gSG93ZXZlciwgaWYgdGhlIGF1dGhvciBwcmVmZXJzLCBDb3JlIGNhbiBhbHNvIHNpbXBsZSBzZXJ2ZSB0aGUKCQkJCQkvLyBkZWZhdWx0IGluZGV4Lmh0bWwgZm91bmQgaW4gL2xpYi90ZW1wbGF0ZXMvaHRtbCwgd2hpY2ggY2FuIHRoZW4gYmUKCQkJCQkvLyBtYW5pcHVsYXRlZCB2aWEgaW5pdGlhbGl6ZUhUTUwuCgkJCQkJdGhpcy5kZWZhdWx0X2h0bWwgPSAwOwoKCQkJCQkvLyBicm93c2VyIGFjdGl2ZSB3aWxsIGJlIHNldCBieSBTYWl0byBDbGllbnQgaWYgdGhlIG1vZHVsZSBuYW1lIG1hdGNoZXMKCQkJCQkvLyB0aGUgY3VycmVudCBwYXRoLiBlLmcuIHdoZW4gdGhlIHVzZXIgaXMgYXQgL2NoYXQsIGNoYXQuanMgd2hpY2ggaGFzCgkJCQkJLy8gdGhpcy5uYW1lID0gImNoYXQiLCB3aWxsIGhhdmUgdGhpcy5icm93c2VyX2FjdGl2ZSA9IDE7CgkJCQkJdGhpcy5icm93c2VyX2FjdGl2ZSA9IDA7CgoJCQkJCS8vIFNvbWUgbW9kdWxlcyBhcmUgImhvbWUgcGFnZXMiIGFuZCBzZXJ2ZSBhcyBhIGxhdW5jaGluZyBwYWQgZm9yIG90aGVyIGFwcHMKCQkJCQkvLyBXZSB3YW50IHRvIHJlbWVtYmVyIHRoZSB1c2VyJ3MgcHJlZmVycmVkIGhvbWUgKGkuZS4gQXJjYWRlIG9yIFJlZHNxdWFyZSkgdG8gcmV0dXJuCgkJCQkJLy8gdGhlbSB0byB3aGVuIGV4aXRpbmcgYSBub24taG9tZSBtb2R1bGUKCQkJCQl0aGlzLnBvc3NpYmxlSG9tZSA9IDA7CgkJCQkJdGhpcy5wdWJsaWNLZXkgPSAnJzsKCQkJCQkvLyB0aGlzLmRhcmtNb2RlVG9nZ2xlciA9IG5ldyBUb2dnbGVyKGFwcCk7CgkJCQl9CgoJCQkJLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoJCQkJLy8gRXh0ZW5kIHRoZXNlIEZ1bmN0aW9ucyAvLwoJCQkJLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoJCQkJLy8KCQkJCS8vIElOU1RBTEwgTU9EVUxFCgkJCQkvLwoJCQkJLy8gdGhpcyBjYWxsYmFjayBpcyBydW4gdGhlIGZpcnN0IHRpbWUgdGhlIG1vZHVsZSBpcyBsb2FkZWQuIFlvdQoJCQkJLy8gY2FuIG92ZXJyaWRlIHRoaXMgY2FsbGJhY2sgaW4geW91ciBtb2R1bGUgaWYgeW91IHdvdWxkIGxpa2UsCgkJCQkvLyBidXQgc2hvdWxkIGJlIGEgYml0IGNhcmVmdWwgdG8gaW5jbHVkZSB0aGlzIGxpbmUgYXQgdGhlIHRvcDoKCQkJCS8vCgkJCQkvLyAgIGF3YWl0IHN1cGVyLmluc3RhbGxNb2R1bGUoYXBwKTsKCQkJCS8vCgkJCQkvLyAuLi4gaWYgeW91IHdhbnQgdG8ga2VlcCB0aGUgZGVmYXVsdCBmdW5jdGlvbmFsaXR5IG9mIGF1dG8tCgkJCQkvLyBjcmVhdGluZyBhIGRhdGFiYXNlIHdpdGggdGhlIG5lY2Vzc2FyeSB0YWJsZXMgb24gaW5zdGFsbAoJCQkJLy8gaWYgaXQgZG9lcyBub3QgZXhpc3QuCgkJCQkvLwoJCQkJX2NyZWF0ZUNsYXNzKE1vZFRlbXBsYXRlLCBbewoJCQkJCWtleTogJ2luc3RhbGxNb2R1bGUnLAoJCQkJCXZhbHVlOiBmdW5jdGlvbigpIHsKCQkJCQkJdmFyIF9pbnN0YWxsTW9kdWxlID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlKGFwcCkgewoJCQkJCQkJdmFyIHNxbGRpciwgZnMsIGRibmFtZSwgc3FsX2ZpbGVzLCBpLCBmaWxlbmFtZSwgZGF0YTsKCQkJCQkJCXJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewoJCQkJCQkJCXdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CgkJCQkJCQkJCWNhc2UgMDoKCQkJCQkJCQkJCWlmICghKHRoaXMuYXBwLkJST1dTRVIgPT09IDEpKSB7CgkJCQkJCQkJCQkJX2NvbnRleHQubmV4dCA9IDI7CgkJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCQlyZXR1cm4gX2NvbnRleHQuYWJydXB0KCdyZXR1cm4nKTsKCQkJCQkJCQkJY2FzZSAyOgoJCQkJCQkJCQkJLy8KCQkJCQkJCQkJCS8vIGRvZXMgdGhpcyByZXF1aXJlIGRhdGFiYXNlIGluc3RhbGxhdGlvbgoJCQkJCQkJCQkJLy8KCQkJCQkJCQkJCXNxbGRpciA9ICcnLmNvbmNhdChfX2Rpcm5hbWUsICcvLi4vLi4vbW9kcy8nKS5jb25jYXQodGhpcy5kaXJuYW1lLCAnL3NxbCcpOwoJCQkJCQkJCQkJZnMgPSBhcHAuc3RvcmFnZS5yZXR1cm5GaWxlU3lzdGVtKCk7CgkJCQkJCQkJCQlkYm5hbWUgPSBlbmNvZGVVUkkodGhpcy5yZXR1cm5TbHVnKCkpOwoJCQkJCQkJCQkJaWYgKCEoZnMgIT0gbnVsbCkpIHsKCQkJCQkJCQkJCQlfY29udGV4dC5uZXh0ID0gMjM7CgkJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCQlpZiAoIWZzLmV4aXN0c1N5bmMocGF0aC5ub3JtYWxpemUoc3FsZGlyKSkpIHsKCQkJCQkJCQkJCQlfY29udGV4dC5uZXh0ID0gMjM7CgkJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCQkvLwoJCQkJCQkJCQkJLy8gZ2V0IGFsbCBmaWxlcyBpbiBkaXJlY3RvcnkKCQkJCQkJCQkJCS8vCgkJCQkJCQkJCQlzcWxfZmlsZXMgPSBmcy5yZWFkZGlyU3luYyhzcWxkaXIpLnNvcnQoKTsKCQkJCQkJCQkJCWkgPSAwOwoJCQkJCQkJCQljYXNlIDk6CgkJCQkJCQkJCQlpZiAoIShpIDwgc3FsX2ZpbGVzLmxlbmd0aCkpIHsKCQkJCQkJCQkJCQlfY29udGV4dC5uZXh0ID0gMjM7CgkJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCQlfY29udGV4dC5wcmV2ID0gMTA7CgkJCQkJCQkJCQlmaWxlbmFtZSA9IHBhdGguam9pbihzcWxkaXIsIHNxbF9maWxlc1tpXSk7CgkJCQkJCQkJCQlkYXRhID0gZnMucmVhZEZpbGVTeW5jKGZpbGVuYW1lLCAndXRmOCcpOwoJCQkJCQkJCQkJX2NvbnRleHQubmV4dCA9IDE1OwoJCQkJCQkJCQkJcmV0dXJuIGFwcC5zdG9yYWdlLmV4ZWN1dGVEYXRhYmFzZShkYXRhLCBkYm5hbWUpOwoJCQkJCQkJCQljYXNlIDE1OgoJCQkJCQkJCQkJX2NvbnRleHQubmV4dCA9IDIwOwoJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCWNhc2UgMTc6CgkJCQkJCQkJCQlfY29udGV4dC5wcmV2ID0gMTc7CgkJCQkJCQkJCQlfY29udGV4dC50MCA9IF9jb250ZXh0WydjYXRjaCddKDEwKTsKCQkJCQkJCQkJCWNvbnNvbGUuZXJyb3IoX2NvbnRleHQudDApOwoJCQkJCQkJCQljYXNlIDIwOgoJCQkJCQkJCQkJaSsrOwoJCQkJCQkJCQkJX2NvbnRleHQubmV4dCA9IDk7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJY2FzZSAyMzoKCQkJCQkJCQkJY2FzZSAnZW5kJzoKCQkJCQkJCQkJCXJldHVybiBfY29udGV4dC5zdG9wKCk7CgkJCQkJCQkJfQoJCQkJCQkJfSwgX2NhbGxlZSwgdGhpcywgW1sxMCwgMTddXSk7CgkJCQkJCX0pKTsKCgkJCQkJCWZ1bmN0aW9uIGluc3RhbGxNb2R1bGUoX3gpIHsKCQkJCQkJCXJldHVybiBfaW5zdGFsbE1vZHVsZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCQl9CgoJCQkJCQlyZXR1cm4gaW5zdGFsbE1vZHVsZTsKCQkJCQl9KCkKCQkJCX0sIHsKCQkJCQlrZXk6ICdpbml0aWFsaXplJywKCQkJCQl2YWx1ZTogLy8KCQkJCQkvLyBJTklUSUFMSVpFCgkJCQkJLy8KCQkJCQkvLyB0aGlzIGNhbGxiYWNrIGlzIHJ1biBldmVyeSB0aW1lIHRoZSBtb2R1bGUgaXMgaW5pdGlhbGl6ZWQuIEl0CgkJCQkJLy8gdGFrZXMgY2FyZSBvZiB0aGUgZXZlbnRzIHRvIHdoaWNoIHdlIHdhbnQgdG8gbGlzdGVuIGJ5IGRlZmF1bHQKCQkJCQkvLyBzbyBpZiB5b3Ugb3Zlci13cml0ZSBpdCwgYmUgY2FyZWZ1bCB0byBpbmNsdWRlIHRoaXMgbGluZSBhdAoJCQkJCS8vIHRoZSB0b3A6CgkJCQkJLy8KCQkJCQkvLyAgICBhd2FpdCBzdXBlci5pbml0aWFsaXplKGFwcCk7CgkJCQkJLy8KCQkJCQkvLyB0aGF0IHdpbGwgZW5zdXJlIGRlZmF1bHQgYmVoYXZpb3IgYXBwaWVzIHRvIGluaGVyaXRlZCBtb2R1bGVzCgkJCQkJLy8gYW5kIHRoZSB0aGUgc2VuZEV2ZW50IGFuZCByZWNlaXZlRXZlbnQgZnVuY3Rpb25zIHdpbGwgc3RpbGwgd29yawoJCQkJCS8vCgkJCQkJCWZ1bmN0aW9uKCkgewoJCQkJCQkJdmFyIF9pbml0aWFsaXplID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMihhcHApIHsKCQkJCQkJCQl2YXIgX3RoaXMgPSB0aGlzLAoJCQkJCQkJCQlfYXBwJHN0b3JhZ2U7CgkJCQkJCQkJdmFyIF9sb29wLCBpLCBzcWxkaXIsIGZzLCBzcWxfZmlsZXMsIF9pLCB0YWJsZW5hbWU7CgkJCQkJCQkJcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDMpIHsKCQkJCQkJCQkJd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewoJCQkJCQkJCQkJY2FzZSAwOgoJCQkJCQkJCQkJCV9jb250ZXh0My5uZXh0ID0gMjsKCQkJCQkJCQkJCQlyZXR1cm4gdGhpcy5hcHAud2FsbGV0LmdldFB1YmxpY0tleSgpOwoJCQkJCQkJCQkJY2FzZSAyOgoJCQkJCQkJCQkJCXRoaXMucHVibGljS2V5ID0gX2NvbnRleHQzLnNlbnQ7CgkJCQkJCQkJCQkJX2xvb3AgPSAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2xvb3AoaSkgewoJCQkJCQkJCQkJCQlyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2xvb3AkKF9jb250ZXh0MikgewoJCQkJCQkJCQkJCQkJd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewoJCQkJCQkJCQkJCQkJCWNhc2UgMDoKCQkJCQkJCQkJCQkJCQkJYXBwLmNvbm5lY3Rpb24ub24oX3RoaXMuZXZlbnRzW2ldLCBmdW5jdGlvbihkYXRhKSB7CgkJCQkJCQkJCQkJCQkJCQlfdGhpcy5yZWNlaXZlRXZlbnQoX3RoaXMuZXZlbnRzW2ldLCBkYXRhKTsKCQkJCQkJCQkJCQkJCQkJfSk7CgkJCQkJCQkJCQkJCQkJY2FzZSAxOgoJCQkJCQkJCQkJCQkJCWNhc2UgJ2VuZCc6CgkJCQkJCQkJCQkJCQkJCXJldHVybiBfY29udGV4dDIuc3RvcCgpOwoJCQkJCQkJCQkJCQkJfQoJCQkJCQkJCQkJCQl9LCBfbG9vcCk7CgkJCQkJCQkJCQkJfSk7CgkJCQkJCQkJCQkJaSA9IDA7CgkJCQkJCQkJCQljYXNlIDU6CgkJCQkJCQkJCQkJaWYgKCEoaSA8IHRoaXMuZXZlbnRzLmxlbmd0aCkpIHsKCQkJCQkJCQkJCQkJX2NvbnRleHQzLm5leHQgPSAxMDsKCQkJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCQkJfQoJCQkJCQkJCQkJCXJldHVybiBfY29udGV4dDMuZGVsZWdhdGVZaWVsZChfbG9vcChpKSwgJ3QwJywgNyk7CgkJCQkJCQkJCQljYXNlIDc6CgkJCQkJCQkJCQkJaSsrOwoJCQkJCQkJCQkJCV9jb250ZXh0My5uZXh0ID0gNTsKCQkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJCWNhc2UgMTA6CgkJCQkJCQkJCQkJaWYgKCEoYXBwLkJST1dTRVIgPT09IDEpKSB7CgkJCQkJCQkJCQkJCV9jb250ZXh0My5uZXh0ID0gMTI7CgkJCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQkJCX0KCQkJCQkJCQkJCQlyZXR1cm4gX2NvbnRleHQzLmFicnVwdCgncmV0dXJuJyk7CgkJCQkJCQkJCQljYXNlIDEyOgoJCQkJCQkJCQkJCS8vCgkJCQkJCQkJCQkJLy8gY3JlYXRlIGxpc3Qgb2YgdGFibGVzIGZvciBhdXRvLWRiIHJlc3BvbnNlCgkJCQkJCQkJCQkJLy8KCQkJCQkJCQkJCQlzcWxkaXIgPSAnJy5jb25jYXQoX19kaXJuYW1lLCAnLy4uLy4uL21vZHMvJykuY29uY2F0KHRoaXMuZGlybmFtZSwgJy9zcWwnKTsKCQkJCQkJCQkJCQlmcyA9IGFwcCA9PT0gbnVsbCB8fCBhcHAgPT09IHZvaWQgMCB8fCAoX2FwcCRzdG9yYWdlID0gYXBwLnN0b3JhZ2UpID09PSBudWxsIHx8IF9hcHAkc3RvcmFnZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FwcCRzdG9yYWdlLnJldHVybkZpbGVTeXN0ZW0oKTsKCQkJCQkJCQkJCQlpZiAoZnMgIT0gbnVsbCkgewoJCQkJCQkJCQkJCQlpZiAoZnMuZXhpc3RzU3luYyhwYXRoLm5vcm1hbGl6ZShzcWxkaXIpKSkgewoJCQkJCQkJCQkJCQkJLy8KCQkJCQkJCQkJCQkJCS8vIGdldCBhbGwgZmlsZXMgaW4gZGlyZWN0b3J5CgkJCQkJCQkJCQkJCQkvLwoJCQkJCQkJCQkJCQkJc3FsX2ZpbGVzID0gZnMucmVhZGRpclN5bmMoc3FsZGlyKTsKCQkJCQkJCQkJCQkJCWZvciAoX2kgPSAwOyBfaSA8IHNxbF9maWxlcy5sZW5ndGg7IF9pKyspIHsKCQkJCQkJCQkJCQkJCQkvLwoJCQkJCQkJCQkJCQkJCS8vIGFkZGluZyB0YWJsZSB0byBkYXRhYmFzZQoJCQkJCQkJCQkJCQkJCS8vCgkJCQkJCQkJCQkJCQkJdGFibGVuYW1lID0gc3FsX2ZpbGVzW19pXS5zbGljZSgwLCAtNCk7IC8vCgkJCQkJCQkJCQkJCQkJLy8gcmVtb3ZlIGRpZ2l0cyBmcm9tIGVuZCwgdXNlZCBhcyB3ZSBzb21ldGltZXMKCQkJCQkJCQkJCQkJCQkvLyB1c2UgbnVtYmVycyBhdCBlbmQgb2Ygc3FsIGZpbGUgdG8gb3JkZXIgaW5kZXhlcwoJCQkJCQkJCQkJCQkJCS8vIG9yIHJ1biBwb3N0LXByb2Nlc3Npbmcgb24gdGFibGUgY3JlYXRlIGFuZCBuZWVkCgkJCQkJCQkJCQkJCQkJLy8gZ3VhcmFudGVlZCBvcmRlcgoJCQkJCQkJCQkJCQkJCS8vCgkJCQkJCQkJCQkJCQkJdGFibGVuYW1lID0gdGFibGVuYW1lLnJlcGxhY2UoL1xkKyQvLCAnJyk7CgkJCQkJCQkJCQkJCQkJdGhpcy5kYl90YWJsZXMucHVzaCh0YWJsZW5hbWUpOwoJCQkJCQkJCQkJCQkJfQoJCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJfQoJCQkJCQkJCQkJCWlmICh0aGlzLmFwcG5hbWUgPT09ICcnKSB7CgkJCQkJCQkJCQkJCXRoaXMuYXBwbmFtZSA9IHRoaXMubmFtZTsKCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQljYXNlIDE2OgoJCQkJCQkJCQkJY2FzZSAnZW5kJzoKCQkJCQkJCQkJCQlyZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0sIF9jYWxsZWUyLCB0aGlzKTsKCQkJCQkJCX0pKTsKCgkJCQkJCQlmdW5jdGlvbiBpbml0aWFsaXplKF94MikgewoJCQkJCQkJCXJldHVybiBfaW5pdGlhbGl6ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCQkJfQoKCQkJCQkJCXJldHVybiBpbml0aWFsaXplOwoJCQkJCQl9KCkgLy8KCQkJCQkvLyBSRU5ERVIKCQkJCQkvLwoJCQkJCS8vIGFkZHMgZWxlbWVudHMgdG8gdGhlIERPTSBhbmQgdGhlbiBhdHRhY2hlcyBldmVudHMgdG8gdGhlbSBhcyBuZWVkZWQuCgkJCQkJLy8gdGhpcyByZXBsYWNlcyBpbml0aWFsaXplSFRNTCBhbmQgYXR0YWNoRXZlbnRzIHdpdGggYSBzaW5nbGUgZnVuY3Rpb24KCQkJCQkvLwoJCQkJfSwgewoJCQkJCWtleTogJ3JlbmRlcicsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uKCkgewoJCQkJCQl2YXIgX3JlbmRlciA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoKSB7CgkJCQkJCQl2YXIgX3RoaXMkc3R5bGVzLCBfdGhpcyRzY3JpcHRzLCBfdGhpcyRwb3N0U2NyaXB0cywgaTsKCQkJCQkJCXJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQ0KSB7CgkJCQkJCQkJd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewoJCQkJCQkJCQljYXNlIDA6CgkJCQkJCQkJCQlpZiAodGhpcy5icm93c2VyX2FjdGl2ZSAmJiB0aGlzLnBvc3NpYmxlSG9tZSkgewoJCQkJCQkJCQkJCXRoaXMuYXBwLm9wdGlvbnMuaG9tZU1vZHVsZSA9IHRoaXMucmV0dXJuTmFtZSgpOwoJCQkJCQkJCQkJCXRoaXMuYXBwLnN0b3JhZ2Uuc2F2ZU9wdGlvbnMoKTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJCWlmICh0aGlzLmluY2x1ZGVzX2F0dGFjaGVkID09PSAwKSB7CgkJCQkJCQkJCQkJaWYgKHRoaXMubWV0YSkgewoJCQkJCQkJCQkJCQl0aGlzLmF0dGFjaE1ldGEoKTsKCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJaWYgKCgoX3RoaXMkc3R5bGVzID0gdGhpcy5zdHlsZXMpID09PSBudWxsIHx8IF90aGlzJHN0eWxlcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkc3R5bGVzLmxlbmd0aCkgPiAwKSB7CgkJCQkJCQkJCQkJCXRoaXMuYXR0YWNoU3R5bGVTaGVldHMoKTsKCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJaWYgKCgoX3RoaXMkc2NyaXB0cyA9IHRoaXMuc2NyaXB0cykgPT09IG51bGwgfHwgX3RoaXMkc2NyaXB0cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkc2NyaXB0cy5sZW5ndGgpID4gMCkgewoJCQkJCQkJCQkJCQljb25zb2xlLmxvZygnYXR0YWNoU2NyaXB0cyBpbiAnICsgdGhpcy5uYW1lLCB0aGlzLnNjcmlwdHMpOwoJCQkJCQkJCQkJCQl0aGlzLmF0dGFjaFNjcmlwdHMoKTsKCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJaWYgKCgoX3RoaXMkcG9zdFNjcmlwdHMgPSB0aGlzLnBvc3RTY3JpcHRzKSA9PT0gbnVsbCB8fCBfdGhpcyRwb3N0U2NyaXB0cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkcG9zdFNjcmlwdHMubGVuZ3RoKSA+IDApIHsKCQkJCQkJCQkJCQkJdGhpcy5hdHRhY2hQb3N0U2NyaXB0cygpOwoJCQkJCQkJCQkJCX0KCQkJCQkJCQkJCQl0aGlzLmluY2x1ZGVzX2F0dGFjaGVkID0gMTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJCWkgPSAwOwoJCQkJCQkJCQljYXNlIDM6CgkJCQkJCQkJCQlpZiAoIShpIDwgdGhpcy5jb21wb25lbnRzLmxlbmd0aCkpIHsKCQkJCQkJCQkJCQlfY29udGV4dDQubmV4dCA9IDk7CgkJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCQlfY29udGV4dDQubmV4dCA9IDY7CgkJCQkJCQkJCQlyZXR1cm4gdGhpcy5jb21wb25lbnRzW2ldLnJlbmRlcigpOwoJCQkJCQkJCQljYXNlIDY6CgkJCQkJCQkJCQlpKys7CgkJCQkJCQkJCQlfY29udGV4dDQubmV4dCA9IDM7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJY2FzZSA5OgoJCQkJCQkJCQljYXNlICdlbmQnOgoJCQkJCQkJCQkJcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CgkJCQkJCQkJfQoJCQkJCQkJfSwgX2NhbGxlZTMsIHRoaXMpOwoJCQkJCQl9KSk7CgoJCQkJCQlmdW5jdGlvbiByZW5kZXIoKSB7CgkJCQkJCQlyZXR1cm4gX3JlbmRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCQl9CgoJCQkJCQlyZXR1cm4gcmVuZGVyOwoJCQkJCX0oKQoJCQkJfSwgewoJCQkJCWtleTogJ3JldHVybk5hbWUnLAoJCQkJCXZhbHVlOiBmdW5jdGlvbiByZXR1cm5OYW1lKCkgewoJCQkJCQlpZiAodGhpcy5hcHBuYW1lKSB7CgkJCQkJCQlyZXR1cm4gdGhpcy5hcHBuYW1lOwoJCQkJCQl9CgkJCQkJCWlmICh0aGlzLmdhbWVuYW1lKSB7CgkJCQkJCQlyZXR1cm4gdGhpcy5nYW1lbmFtZTsKCQkJCQkJfQoJCQkJCQlpZiAodGhpcy5uYW1lKSB7CgkJCQkJCQlyZXR1cm4gdGhpcy5uYW1lOwoJCQkJCQl9CgkJCQkJCXJldHVybiAnVW5rbm93biBNb2R1bGUnOwoJCQkJCX0KCQkJCX0sIHsKCQkJCQlrZXk6ICdyZXR1cm5UaXRsZScsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uIHJldHVyblRpdGxlKCkgewoJCQkJCQlpZiAodGhpcy50aXRsZSkgewoJCQkJCQkJcmV0dXJuIHRoaXMudGl0bGU7CgkJCQkJCX0KCQkJCQkJcmV0dXJuIHRoaXMucmV0dXJuTmFtZSgpOwoJCQkJCX0KCQkJCX0sIHsKCQkJCQlrZXk6ICdyZXR1cm5JbWFnZScsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uIHJldHVybkltYWdlKCkgewoJCQkJCQlyZXR1cm4gJy9zYWl0by9pbWcvZHJlYW1zY2FwZS5wbmcnOwoJCQkJCX0KCQkJCX0sIHsKCQkJCQlrZXk6ICdyZXR1cm5CYW5uZXInLAoJCQkJCXZhbHVlOiBmdW5jdGlvbiByZXR1cm5CYW5uZXIoKSB7CgkJCQkJCXJldHVybiAnL3NhaXRvL2ltZy9kcmVhbXNjYXBlLnBuZyc7CgkJCQkJfQoJCQkJfSwgewoJCQkJCWtleTogJ2hhc1NldHRpbmdzJywKCQkJCQl2YWx1ZTogZnVuY3Rpb24gaGFzU2V0dGluZ3MoKSB7CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9CgkJCQl9LCB7CgkJCQkJa2V5OiAnbG9hZFNldHRpbmdzJywKCQkJCQl2YWx1ZTogZnVuY3Rpb24gbG9hZFNldHRpbmdzKCkgewoJCQkJCX0KCgkJCQkJLy8KCQkJCQkvLyBJTklUSUFMSVpFIEhUTUwgKGRlcHJlY2F0ZWQgYnkgcmVuZGVyKGFwcCkpCgkJCQkJLy8KCQkJCX0sIHsKCQkJCQlrZXk6ICdpbml0aWFsaXplSFRNTCcsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uKCkgewoJCQkJCQl2YXIgX2luaXRpYWxpemVIVE1MID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlNChhcHApIHsKCQkJCQkJCXJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ1KSB7CgkJCQkJCQkJd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewoJCQkJCQkJCQljYXNlIDA6CgkJCQkJCQkJCWNhc2UgJ2VuZCc6CgkJCQkJCQkJCQlyZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKCQkJCQkJCQl9CgkJCQkJCQl9LCBfY2FsbGVlNCk7CgkJCQkJCX0pKTsKCgkJCQkJCWZ1bmN0aW9uIGluaXRpYWxpemVIVE1MKF94MykgewoJCQkJCQkJcmV0dXJuIF9pbml0aWFsaXplSFRNTC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCQl9CgoJCQkJCQlyZXR1cm4gaW5pdGlhbGl6ZUhUTUw7CgkJCQkJfSgpIC8vCgkJCQkJLy8gQVRUQUNIIEVWRU5UUyAoZGVwcmVjYXRlZCBieSByZW5kZXIoYXBwKSkKCQkJCQkvLwoJCQkJCS8vIHRoaXMgY2FsbGJhY2sgYXR0YWNoZXMgdGhlIGphdmFzY3JpcHQgaW50ZXJhY3RpdmUgYmluZGluZ3MgdG8gdGhlCgkJCQkJLy8gRE9NLCBhbGxvd2luZyB1cyB0byBpbmNvcnBvcmF0ZSB0aGUgd2ViIGFwcGxpY2F0aW9ucyB0byBvdXIgb3duCgkJCQkJLy8gaW50ZXJuYWwgZnVuY3Rpb25zIGFuZCBzZW5kIGFuZCByZWNlaXZlIHRyYW5zYWN0aW9ucyBuYXRpdmVseS4KCQkJCQkvLwoJCQkJfSwgewoJCQkJCWtleTogJ2F0dGFjaEV2ZW50cycsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uIGF0dGFjaEV2ZW50cyhhcHApIHsKCQkJCQl9CgoJCQkJCS8vCgkJCQkJLy8gTE9BRCBGUk9NIEFSQ0hJVkVTCgkJCQkJLy8KCQkJCQkvLyB0aGlzIGNhbGxiYWNrIGlzIHJ1biB3aGVuZXZlciBvdXIgYXJjaGl2ZXMgbG9hZHMgYWRkaXRpb25hbCBkYXRhCgkJCQkJLy8gZWl0aGVyIGZyb20gaXRzIGxvY2FsIG1lbW9yeSBvciB3aGVuZXZlciBpdCBpcyBmZXRjaGVkIGZyb20gYQoJCQkJCS8vIHJlbW90ZSBzZXJ2ZXIKCQkJCQkvLwoJCQkJCS8vbG9hZEZyb21BcmNoaXZlcyhhcHAsIHR4KSB7IH0KCgkJCQkJLy8gaW1wbGVtZW50c0tleXMocmVxdWVzdCkgewoJCQkJCS8vICAgbGV0IHJlc3BvbnNlID0ge307CgkJCQkJLy8gICByZXF1ZXN0LmZvckVhY2goa2V5ID0+IHsKCQkJCQkvLyAgICAgaWYgKHRoaXNba2V5XSkgewoJCQkJCS8vICAgICAgIHJlc3BvbnNlW2tleV0gPSB0aGlzW2tleV07CgkJCQkJLy8gICAgIH0KCQkJCQkvLyAgIH0pOwoJCQkJCS8vICAgaWYgKE9iamVjdC5lbnRyaWVzKHJlc3BvbnNlKS5sZW5ndGggIT0gcmVxdWVzdC5sZW5ndGgpIHsKCQkJCQkvLyAgICAgcmV0dXJuIG51bGw7CgkJCQkJLy8gICB9CgkJCQkJLy8gICByZXR1cm4gdGhpczsKCQkJCQkvLyB9CgoJCQkJCS8vCgkJCQkJLy8gT04gQ09ORklSTUFUSU9OCgkJCQkJLy8KCQkJCQkvLyB0aGlzIGNhbGxiYWNrIGlzIHJ1biBldmVyeSB0aW1lIGEgYmxvY2sgcmVjZWl2ZXMgYSBjb25maXJtYXRpb24uCgkJCQkJLy8gdGhpcyBpcyB3aGVyZSB0aGUgbW9zdCBpbXBvcnRhbnQgY29kZSBpbiB5b3VyIG1vZHVsZSBzaG91bGQgZ28sCgkJCQkJLy8gbGlzdGVuaW5nIHRvIHJlcXVlc3RzIHRoYXQgY29tZSBpbiBvdmVyIHRoZSBibG9ja2NoYWluIGFuZCByZXBseWluZy4KCQkJCQkvLwoJCQkJCS8vIEJ5IGNvbnZlbnRpb24gU2FpdG8gQ29yZSB3aWxsIGZpcmUgdGhlIG9uQ29uZmlybWF0aW9uIGZvciBhbnkgbW9kdWxlcwoJCQkJCS8vIHdob3NlIG5hbWUgbWF0Y2hlcyB0eC5tc2cubW9kdWxlLiBPdGhlciBtb2R1bGVzIHdoaWNoIGFyZSBhbHNvIGludGVyZXN0ZWQKCQkJCQkvLyBpbiB0aG9zZSB0cmFuc2NhdGlvbnMgY2FuIGFsc28gc3Vic2NyaWJlIHRvIHRob3NlIGNvbmZpcm1hdGlvbnMgYnkKCQkJCQkvLyBieSB1c2luZyBzaG91bGRBZmZpeENhbGxiYWNrVG9Nb2R1bGUuCgkJCQkJLy8KCQkJCX0sIHsKCQkJCQlrZXk6ICdvbkNvbmZpcm1hdGlvbicsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uKCkgewoJCQkJCQl2YXIgX29uQ29uZmlybWF0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlNShibGssIHR4LCBjb25mbnVtKSB7CgkJCQkJCQlyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NikgewoJCQkJCQkJCXdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKCQkJCQkJCQkJY2FzZSAwOgoJCQkJCQkJCQljYXNlICdlbmQnOgoJCQkJCQkJCQkJcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CgkJCQkJCQkJfQoJCQkJCQkJfSwgX2NhbGxlZTUpOwoJCQkJCQl9KSk7CgoJCQkJCQlmdW5jdGlvbiBvbkNvbmZpcm1hdGlvbihfeDQsIF94NSwgX3g2KSB7CgkJCQkJCQlyZXR1cm4gX29uQ29uZmlybWF0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQkJCX0KCgkJCQkJCXJldHVybiBvbkNvbmZpcm1hdGlvbjsKCQkJCQl9KCkgLy8KCQkJCQkvLyBzb21lIFVJIGVsZW1lbnRzIG1heSBwcm92aWRlIHNwZWNpYWwgZGlzcGxheSBvcHRpb25zIGZvciBtb2R1bGVzIHdoaWNoCgkJCQkJLy8gaGF2ZSBwZW5kaW5nIGFjdGlvbnMgdGhhdCByZXF1aXJlIHVzZXIgcmV2aWV3IG9yIGFjdGlvbiwgc3VjaCBhcyBSZWRzcXVhcmUKCQkJCQkvLyB3aXRoIFR3ZWV0cywgb3IgR2FtZXMgd2l0aCBwZW5kaW5nIGdhbWUgbW92ZXMgZnJvbSB0aGUgcGxheWVyLgoJCQkJCS8vCgkJCQl9LCB7CgkJCQkJa2V5OiAncmV0dXJuTnVtYmVyT2ZOb3RpZmljYXRpb25zJywKCQkJCQl2YWx1ZTogZnVuY3Rpb24gcmV0dXJuTnVtYmVyT2ZOb3RpZmljYXRpb25zKCkgewoJCQkJCQlyZXR1cm4gMDsKCQkJCQl9CgoJCQkJCS8vCgkJCQkJLy8KCQkJCQkvLyBPTiBORVcgQkxPQ0sKCQkJCQkvLwoJCQkJCS8vIHRoaXMgY2FsbGJhY2sgaXMgcnVuIGV2ZXJ5IHRpbWUgYSBibG9jayBpcyBhZGRlZCB0byB0aGUgbG9uZ2VzdF9jaGFpbgoJCQkJCS8vIGl0IGRpZmZlcnMgZnJvbSB0aGUgb25Db25maXJtYXRpb24gZnVuY3Rpb24gaW4gdGhhdCBpdCBpcyBub3QgbGlua2VkIHRvCgkJCQkJLy8gaW5kaXZpZHVhbCB0cmFuc2FjdGlvbnMgLS0gaS5lLiBpdCB3aWxsIG9ubHkgYmUgcnVuIG9uY2UgcGVyIGJsb2NrLCB3aGlsZQoJCQkJCS8vIHRoZSBvbkNvbmZpcm1hdGlvbiBmdW5jdGlvbiBpcyBydW4gYnkgZXZlcnkgVFJBTlNBQ1RJT04gdGFnZ2VkIGFzCgkJCQkJLy8gdGhpcyBpcyB3aGVyZSB0aGUgbW9zdCBpbXBvcnRhbnQgY29kZSBpbiB5b3VyIG1vZHVsZSBzaG91bGQgZ28sCgkJCQkJLy8gbGlzdGVuaW5nIHRvIHJlcXVlc3RzIHRoYXQgY29tZSBpbiBvdmVyIHRoZSBibG9ja2NoYWluIGFuZCByZXBseWluZy4KCQkJCQkvLwoJCQkJfSwgewoJCQkJCWtleTogJ29uTmV3QmxvY2snLAoJCQkJCXZhbHVlOiBmdW5jdGlvbiBvbk5ld0Jsb2NrKGJsaywgbGMpIHsKCQkJCQl9CgoJCQkJCS8vCgkJCQkJLy8KCQkJCQkvLwoJCQkJCS8vIE9OIENIQUlOIFJFT1JHQU5JWkFUSU9OCgkJCQkJLy8KCQkJCQkvLyB0aGlzIGNhbGxiYWNrIGlzIHJ1biBldmVyeXRpbWUgdGhlIGNoYWluIGlzIHJlb3JnYW5pemVkLCBmb3IgZXZlcnkgYmxvY2sKCQkJCQkvLyB3aXRoIGEgc3RhdHVzIHRoYXQgaXMgY2hhbmdlZC4gc28gaXQgaXMgaW52b2tlZCBmaXJzdCB0byBub3RpZnkgdXMgd2hlbgoJCQkJCS8vIGxvbmdlc3RfY2hhaW4gaXMgc2V0IHRvIFpFUk8gYXMgd2UgdW5tYXJrIHRoZSBwcmV2aW91c2x5IGRvbWluYW50IGNoYWluCgkJCQkJLy8gYW5kIHRoZW4gaXQgaXMgcnVuIGEgc2Vjb25kIHRpbWUgc2V0dGluZyB0aGUgTEMgdG8gMSBmb3IgYWxsIG9mIHRoZQoJCQkJCS8vIGJsb2NrcyB0aGF0IGFyZSBtb3ZlZCAoYmFjaz8pIGludG8gdGhlIGxvbmdlc3RfY2hhaW4KCQkJCQkvLwoJCQkJfSwgewoJCQkJCWtleTogJ29uQ2hhaW5SZW9yZ2FuaXphdGlvbicsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uIG9uQ2hhaW5SZW9yZ2FuaXphdGlvbihibG9ja19pZCwgYmxvY2tfaGFzaCwgbGMsIHBvcykgewoJCQkJCX0KCgkJCQkJLy8KCQkJCQkvLwoJCQkJCS8vCgkJCQkJLy8gT04gV0FMTEVUIFJFU0VUCgkJCQkJLy8KCQkJCQkvLyB0aGlzIGZ1bmN0aW9uIHJ1bnMgaWYgdGhlIHdhbGxldCBpcyByZXNldAoJCQkJCS8vIGRpc3Rpbmd1aXNoIGJldHdlZW4gYSBoYXJkIGFuZCBzb2Z0IHJlc2V0CgkJCQl9LCB7CgkJCQkJa2V5OiAnb25XYWxsZXRSZXNldCcsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uKCkgewoJCQkJCQl2YXIgX29uV2FsbGV0UmVzZXQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KG51a2UpIHsKCQkJCQkJCXJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ3KSB7CgkJCQkJCQkJd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ3LnByZXYgPSBfY29udGV4dDcubmV4dCkgewoJCQkJCQkJCQljYXNlIDA6CgkJCQkJCQkJCQlfY29udGV4dDcubmV4dCA9IDI7CgkJCQkJCQkJCQlyZXR1cm4gdGhpcy5hcHAud2FsbGV0LmdldFB1YmxpY0tleSgpOwoJCQkJCQkJCQljYXNlIDI6CgkJCQkJCQkJCQl0aGlzLnB1YmxpY0tleSA9IF9jb250ZXh0Ny5zZW50OwoJCQkJCQkJCQljYXNlIDM6CgkJCQkJCQkJCWNhc2UgJ2VuZCc6CgkJCQkJCQkJCQlyZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKCQkJCQkJCQl9CgkJCQkJCQl9LCBfY2FsbGVlNiwgdGhpcyk7CgkJCQkJCX0pKTsKCgkJCQkJCWZ1bmN0aW9uIG9uV2FsbGV0UmVzZXQoX3g3KSB7CgkJCQkJCQlyZXR1cm4gX29uV2FsbGV0UmVzZXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQkJCQkJfQoKCQkJCQkJcmV0dXJuIG9uV2FsbGV0UmVzZXQ7CgkJCQkJfSgpIC8vCgkJCQkJLy8KCQkJCQkvLwoJCQkJCS8vIE9OIFBFRVIgSEFORFNIQUtFIENPTVBMRVRFCgkJCQkJLy8KCQkJCQkvLyB0aGlzIGZ1bmN0aW9uIHJ1bnMgd2hlbiBhIG5vZGUgY29tcGxldGVzIGl0cyBoYW5kc2hha2Ugd2l0aCBhbm90aGVyIHBlZXIKCQkJCX0sIHsKCQkJCQlrZXk6ICdvblBlZXJIYW5kc2hha2VDb21wbGV0ZScsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uIG9uUGVlckhhbmRzaGFrZUNvbXBsZXRlKGFwcCkgewoJCQkJCQl2YXIgcGVlciA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogbnVsbDsKCQkJCQkJLy8KCQkJCQkJLy8gaWYgcGVlciBpcyBhbiBhcmNoaXZlLCB3ZSBzaG91bGQgaGl0IGl0IHVwIGZvciBjb250ZW50CgkJCQkJCS8vCgkJCQkJCWlmIChwZWVyLmhhc1NlcnZpY2UoJ2FyY2hpdmUnKSkgewoJCQkJCQkJdGhpcy5vbkFyY2hpdmVIYW5kc2hha2VDb21wbGV0ZShhcHAsIHBlZXIpOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQkvLwoJCQkJCS8vIE9OIFBFRVIgU0VSVklDRSBVUAoJCQkJCS8vCgkJCQkJLy8gdGhpcyBpcyBpbnRlbmRlZCBhcyBhbiBpbml0aWFsaXphdGlvbiBmdW5jdGlvbi4KCQkJCQkvLwoJCQkJCS8vIHdoZW4gYSBwZWVyIGNvbm5lY3RzIGFuZCBjb21wbGV0ZXMgaXRzIGhhbmRzaGFrZSwgdGhpcyBmaXJlcyBzbyBtb2R1bGVzIGNhbgoJCQkJCS8vIGZldGNoIHNlcnZpY2UtbGV2ZWwgZGF0YSBsaWtlIEROUyBpbmZvcm1hdGlvbiBpbnN0ZWFkIG9mIGhhdmluZyB0byBibGluZGx5CgkJCQkJLy8gZ3Vlc3Mgb3IgbWFudWFsbHkgZXhhbWluZSB0aGVpciBwZWVycy4KCQkJCQkvLwoJCQkJfSwgewoJCQkJCWtleTogJ29uUGVlclNlcnZpY2VVcCcsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uKCkgewoJCQkJCQl2YXIgX29uUGVlclNlcnZpY2VVcCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTcoYXBwLCBwZWVyLCBzZXJ2aWNlKSB7CgkJCQkJCQlyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0OCkgewoJCQkJCQkJCXdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0OC5wcmV2ID0gX2NvbnRleHQ4Lm5leHQpIHsKCQkJCQkJCQkJY2FzZSAwOgoJCQkJCQkJCQljYXNlICdlbmQnOgoJCQkJCQkJCQkJcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CgkJCQkJCQkJfQoJCQkJCQkJfSwgX2NhbGxlZTcpOwoJCQkJCQl9KSk7CgoJCQkJCQlmdW5jdGlvbiBvblBlZXJTZXJ2aWNlVXAoX3g4LCBfeDksIF94MTApIHsKCQkJCQkJCXJldHVybiBfb25QZWVyU2VydmljZVVwLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQkJCX0KCgkJCQkJCXJldHVybiBvblBlZXJTZXJ2aWNlVXA7CgkJCQkJfSgpIC8vCgkJCQkJLy8KCQkJCQkvLwoJCQkJCS8vIE9OIEFSQ0hJVkUgSEFORFNIQUtFIENPTVBMRVRFCgkJCQkJLy8KCQkJCQkvLyB0aGlzIGZ1bmN0aW9uIHJ1bnMgd2hlbiBhIG5vZGUgY29tcGxldGVzIGl0cyBoYW5kc2hha2Ugd2l0aCBhIHBlZXIgdGhhdCBvZmZlcnMgYXJjaGl2aW5nIHNlcnZpY2VzCgkJCQl9LCB7CgkJCQkJa2V5OiAnb25BcmNoaXZlSGFuZHNoYWtlQ29tcGxldGUnLAoJCQkJCXZhbHVlOiBmdW5jdGlvbiBvbkFyY2hpdmVIYW5kc2hha2VDb21wbGV0ZShhcHAsIHBlZXIpIHsKCQkJCQl9CgoJCQkJCS8vCgkJCQkJLy8KCQkJCQkvLyBPTiBDT05ORUNUSU9OIFNUQUJMRQoJCQkJCS8vCgkJCQkJLy8gdGhpcyBmdW5jdGlvbiBydW5zICJjb25uZWN0IiBldmVudAoJCQkJfSwgewoJCQkJCWtleTogJ29uQ29ubmVjdGlvblN0YWJsZScsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uIG9uQ29ubmVjdGlvblN0YWJsZShhcHAsIHBlZXIpIHsKCQkJCQl9CgoJCQkJCS8vCgkJCQkJLy8KCQkJCQkvLyBPTiBDT05ORUNUSU9OIFVOU1RBQkxFCgkJCQkJLy8KCQkJCQkvLyB0aGlzIGZ1bmN0aW9uIHJ1bnMgImRpc2Nvbm5lY3QiIGV2ZW50CgkJCQl9LCB7CgkJCQkJa2V5OiAnb25Db25uZWN0aW9uVW5zdGFibGUnLAoJCQkJCXZhbHVlOiBmdW5jdGlvbiBvbkNvbm5lY3Rpb25VbnN0YWJsZShhcHAsIHBlZXIpIHsKCQkJCQl9CgoJCQkJCS8vCgkJCQkJLy8gU0hPVUxEIEFGRklYIENBTExCQUNLIFRPIE1PRFVMRQoJCQkJCS8vCgkJCQkJLy8gc29tZXRpbWVzIG1vZHVsZXMgd2FudCB0byBydW4gdGhlIG9uQ29uZmlybWF0aW9uIGZ1bmN0aW9uIGZvciB0cmFuc2FjdGlvbnMKCQkJCQkvLyB0aGF0IGJlbG9uZyB0byBPVEhFUiBtb2R1bGVzLiBvbkNvbmZpcm1hdGlvbiB3aWxsIGJlIGZpcmVkIGF1dG9tYXRpY2FsbHkKCQkJCQkvLyBmb3IgYW55IG1vZHVsZSB3aG9zZSBuYW1lIG1hdGNoZXMgdHgubXNnLm1vZHVsZS4gT3RoZXIgbW9kdWxlcyB3aG8gYXJlCgkJCQkJLy8gaW50ZXJlc3RlZCBpbiB0aG9zZSB0cmFuc2FjdGlvbnMgY2FuIHVzZSB0aGlzIG1ldGhvZCB0byBzdWJzY3JpYmUgdG8gdGhvc2UKCQkJCQkvLyBvbkNvbmZpcm1hdGlvbiBldmVudHMuIFNlZSBvbkNvbmZpcm1hdGlvbiBmb3IgbW9yZSBkZXRhaWxzLgoJCQkJCS8vCgkJCQkJLy8gQW4gZXhhbXBsZSBpcyBhIHNlcnZlciB0aGF0IHdhbnRzIHRvIG1vbml0b3IKCQkJCQkvLyBBVVRIIG1lc3NhZ2VzLCBvciBhIG1vZHVsZSB0aGF0IG5lZWRzIHRvIHBhcnNlIHRoaXJkLXBhcnR5IGVtYWlsIG1lc3NhZ2VzCgkJCQkJLy8gZm9yIGN1c3RvbSBkYXRhIHByb2Nlc3NpbmcuCgkJCQkJLy8KCQkJCX0sIHsKCQkJCQlrZXk6ICdzaG91bGRBZmZpeENhbGxiYWNrVG9Nb2R1bGUnLAoJCQkJCXZhbHVlOiBmdW5jdGlvbiBzaG91bGRBZmZpeENhbGxiYWNrVG9Nb2R1bGUobW9kbmFtZSkgewoJCQkJCQl2YXIgdHggPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IG51bGw7CgkJCQkJCWlmIChtb2RuYW1lID09PSB0aGlzLm5hbWUpIHsKCQkJCQkJCXJldHVybiAxOwoJCQkJCQl9CgkJCQkJCXJldHVybiAwOwoJCQkJCX0KCgkJCQkJLy8KCQkJCQkvLyBTRVJWRVIKCQkJCQkvLwoJCQkJCS8vIHRoaXMgY2FsbGJhY2sgYWxsb3dzIHRoZSBtb2R1bGUgdG8gc2VydmUgcGFnZXMgdGhyb3VnaCB0aGUgbWFpbiBhcHBsaWNhdGlvbgoJCQkJCS8vIHNlcnZlciwgYnkgbGlzdGVuaW5nIHRvIHNwZWNpZmljIHJvdXRlLXJlcXVlc3RzIGFuZCBzZXJ2aW5nIGRhdGEgZnJvbSBpdHMgb3duCgkJCQkJLy8gc2VwYXJhdGUgd2ViIGRpcmVjdG9yeS4KCQkJCQkvLwoJCQkJCS8vIFRoaXMgY2FuIGJlIG92ZXJyaWRkZW4gdG8gcHJvdmlkZSBhZHZhbmNlZCBpbnRlcmZhY2VzLCBmb3IgZXhhbXBsZSB5b3UgbWF5CgkJCQkJLy8gd2FudCB0byBjcmVhdGUgYSBtb2R1bGUgd2hpY2ggc2VydmVzIEpTT04gb2JqZWN0cyBhcyBhbiBSRVNURlVMIEFQSS4gU2VlCgkJCQkJLy8gRXhwcmVzcy5qcyBmb3IgZGV0YWlscy4KCQkJCQkvLwoJCQkJfSwgewoJCQkJCWtleTogJ3dlYlNlcnZlcicsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uIHdlYlNlcnZlcihhcHAsIGV4cHJlc3NhcHAsIGV4cHJlc3MpIHsKCQkJCQkJdmFyIF9hcHAkc3RvcmFnZTI7CgkJCQkJCS8vCgkJCQkJCS8vIGlmIGEgd2ViIGRpcmVjdG9yeSBleGlzdHMsIHdlIG1ha2UgaXQgYnJvc3dhYmxlIGlmIHNlcnZlcgoJCQkJCQkvLyBmdW5jdGlvbmFsaXR5IGV4aXN0cyBvbiB0aGlzIG1hY2hpbmUuIHRoZSBjb250ZW50cyBvZiB0aGUKCQkJCQkJLy8gd2ViIGRpcmVjdG9yeSB3aWxsIGJlIGluIGEgc3ViZm9sZGVyIHVuZGVyIHRoZSBjbGllbnQgbmFtZQoJCQkJCQkvLwoJCQkJCQl2YXIgd2ViZGlyID0gJycuY29uY2F0KF9fZGlybmFtZSwgJy8uLi8uLi9tb2RzLycpLmNvbmNhdCh0aGlzLmRpcm5hbWUsICcvd2ViJyk7CgkJCQkJCS8vIGxldCB3ZWJkaXIgPSBgJHtfX2Rpcm5hbWV9Ly4uLy4uL3dlYmA7CgkJCQkJCS8vIGNvbnNvbGUubG9nKCd3ZWJkaXIgJywgd2ViZGlyLCAnc2x1ZzogJywgdGhpcy5yZXR1cm5TbHVnKCkpOwoJCQkJCQl2YXIgZnMgPSBhcHAgPT09IG51bGwgfHwgYXBwID09PSB2b2lkIDAgfHwgKF9hcHAkc3RvcmFnZTIgPSBhcHAuc3RvcmFnZSkgPT09IG51bGwgfHwgX2FwcCRzdG9yYWdlMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FwcCRzdG9yYWdlMi5yZXR1cm5GaWxlU3lzdGVtKCk7CgkJCQkJCWlmIChmcyAhPSBudWxsKSB7CgkJCQkJCQlpZiAoZnMuZXhpc3RzU3luYyh3ZWJkaXIpKSB7CgkJCQkJCQkJZXhwcmVzc2FwcC51c2UoJy8nICsgZW5jb2RlVVJJKHRoaXMucmV0dXJuU2x1ZygpKSwgZXhwcmVzc1snc3RhdGljJ10od2ViZGlyKSk7CgkJCQkJCQl9IGVsc2UgaWYgKHRoaXMuZGVmYXVsdF9odG1sKSB7CgkJCQkJCQkJZXhwcmVzc2FwcC51c2UoJy8nICsgZW5jb2RlVVJJKHRoaXMucmV0dXJuU2x1ZygpKSwgZXhwcmVzc1snc3RhdGljJ10oX19kaXJuYW1lICsgJy8uLi8uLi9saWIvdGVtcGxhdGVzL2h0bWwnKSk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vCgkJCQkJLy8gVVBEQVRFIEJMT0NLQ0hBSU4gU1lOQwoJCQkJCS8vCgkJCQkJLy8gdGhpcyBjYWxsYmFjayBpcyBydW4gdG8gbm90aWZ5IGFwcGxpY2F0aW9ucyBvZiB0aGUgc3RhdGUgb2YKCQkJCQkvLyBibG9ja2NoYWluIHN5bmNpbmcuIEl0IHdpbGwgYmUgdHJpZ2dlcmVkIG9uIHN0YXJ0dXAgYW5kIHdpdGgKCQkJCQkvLyBldmVyeSBhZGRpdGlvbmFsIGJsb2NrIGFkZGVkLgoJCQkJCS8vCgkJCQl9LCB7CgkJCQkJa2V5OiAndXBkYXRlQmxvY2tjaGFpblN5bmMnLAoJCQkJCXZhbHVlOiBmdW5jdGlvbiB1cGRhdGVCbG9ja2NoYWluU3luYyhhcHAsIGN1cnJlbnQsIHRhcmdldCkgewoJCQkJCX0KCgkJCQkJLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoJCQkJCS8vIE1PRFVMRSBJTlRFUkFDVElPTlMgLy8KCQkJCQkvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgkJCQkJLy8KCQkJCQkvLyB0aGVzZSBmdW5jdGlvbnMgYWxsb3cgeW91ciBtb2R1bGUgdG8gY29tbXVuaWNhdGUgYW5kIGludGVyYWN0IHdpdGgKCQkJCQkvLyBvdGhlciBtb2R1bGVzLiBUaGV5IGF1dG9tYXRlIGlzc3VpbmcgYW5kIGxpc3RlbmluZyB0byBldmVudHMgYW5kCgkJCQkJLy8gYWxsb3cgbW9kdWxlcyB0byByZXNwb25kIHRvIHJlcXVlc3RzIGZyb20gb3RoZXIgbW9kdWxlcyBieSByZXR1cm5pbmcKCQkJCQkvLyBkYXRhIG9iamVjdHMgdGhhdCBjYW4gYmUgdXNlZCB0byB1cGRhdGUgdGhlIERPTVMgbWFuYWdlZCBieSBvdGhlcgoJCQkJCS8vIG1vZHVsZXMuCgkJCQkJLy8KCgkJCQkJLy8KCQkJCQkvLyBtb2R1bGVzIG1heSBhc2sgb3RoZXIgbW9kdWxlcyB0byByZXNwb25kIHRvICJyZXF1ZXN0X3R5cGVzIi4gVGhlCgkJCQkJLy8gcmVzcG9uc2UgdGhhdCB0aGV5IGdldCBtYXkgb3IgbWF5IG5vdCBiZSBzdWl0YWJsZSwgYnV0IGlmIHN1aXRhYmxlCgkJCQkJLy8gY2FuIGJlIHVzZWQgYnkgdGhlIHJlcXVlc3RpbmcgbW9kdWxlIHRvIGZvcm1hdCBkYXRhIG9yIHVwZGF0ZQoJCQkJCS8vIGl0cyBET00gYXMgbmVlZGVkLiBUaGlzIGlzIGEgYmFzaWMgbWV0aG9kIG9mIHByb3ZpZGluZyBpbnRlci1hcHAKCQkJCQkvLyBpbnRlcmFjdGl2aXR5IGFuZCBleHRlbnNpYmlsaXR5LgoJCQkJCS8vCgkJCQl9LCB7CgkJCQkJa2V5OiAnYWRkU2NyaXB0JywKCQkJCQl2YWx1ZTogZnVuY3Rpb24gYWRkU2NyaXB0KHMpIHsKCQkJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNjcmlwdHMubGVuZ3RoOyBpKyspIHsKCQkJCQkJCWlmICh0aGlzLnNjcmlwdHNbaV0gPT09IHMpIHsKCQkJCQkJCQlyZXR1cm47CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJdGhpcy5zY3JpcHRzLnB1c2gocyk7CgkJCQkJfQoJCQkJfSwgewoJCQkJCWtleTogJ2FkZFN0eWxlJywKCQkJCQl2YWx1ZTogZnVuY3Rpb24gYWRkU3R5bGUocykgewoJCQkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc3R5bGVzLmxlbmd0aDsgaSsrKSB7CgkJCQkJCQlpZiAodGhpcy5zdHlsZXNbaV0gPT09IHMpIHsKCQkJCQkJCQlyZXR1cm47CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJdGhpcy5zdHlsZXMucHVzaChzKTsKCQkJCQl9CgkJCQl9LCB7CgkJCQkJa2V5OiAnYWRkQ29tcG9uZW50JywKCQkJCQl2YWx1ZTogZnVuY3Rpb24gYWRkQ29tcG9uZW50KG9iaikgewoJCQkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY29tcG9uZW50cy5sZW5ndGg7IGkrKykgewoJCQkJCQkJaWYgKHRoaXMuY29tcG9uZW50c1tpXSA9PT0gb2JqKSB7CgkJCQkJCQkJcmV0dXJuOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCXRoaXMuY29tcG9uZW50cy5wdXNoKG9iaik7CgkJCQkJfQoJCQkJfSwgewoJCQkJCWtleTogJ3JlbW92ZUNvbXBvbmVudCcsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUNvbXBvbmVudChvYmopIHsKCQkJCQkJZm9yICh2YXIgaSA9IHRoaXMuY29tcG9uZW50cy5sZW5ndGg7IGkgPj0gMDsgaS0tKSB7CgkJCQkJCQlpZiAodGhpcy5jb21wb25lbnRzW2ldID09PSBvYmopIHsKCQkJCQkJCQl0aGlzLmNvbXBvbmVudHMuc3BsaWNlKGksIDEpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoKCQkJCQkvLwoJCQkJCS8vCgkJCQkJLy8gYSBjb252ZW5pZW50IGZ1bmN0aW9uIHRoYXQgbGV0cyBvdGhlciBtb2R1bGVzIGtub3cgeW91IGNhbiBvcgoJCQkJCS8vIGNhbm5vdCByZW5kZXIgaW50byB0aGVtIG9uIHJlcXVlc3QuIHRoaXMgaXMgdXNlZCB0byBnZW5lcmF0ZSBhCgkJCQkJLy8gbGlzdCBvZiBtb2R1bGVzIGZvciBjcmVhdGlvbiBvZiB0aGluZ3MgbGlrZSBtZW51IGNvbXBvbmVudHMgd2hlcmUKCQkJCQkvLyB0aGUgYWN0dWFsIHJlbmRlcmluZyBoYXBwZW5zIHBvc3QgY29udGVudCBzZWxlY3Rpb24uCgkJCQkJLy8KCQkJCX0sIHsKCQkJCQlrZXk6ICdjYW5SZW5kZXJJbnRvJywKCQkJCQl2YWx1ZTogZnVuY3Rpb24gY2FuUmVuZGVySW50bygpIHsKCQkJCQkJdmFyIHF1ZXJ5U2VsZWN0b3IgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6ICcnOwoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoKCQkJCQkvLwoJCQkJCS8vCgkJCQkJLy8gbW9kdWxlcyBtYXkgYXNrIG90aGVyIG1vZHVsZXMgaWYgdGhleSB3YW50IHRvIGluc2VydCBhbnkgY29tcG9uZW50cwoJCQkJCS8vIGludG8gYSBVSSBlbGVtZW50IGxpa2UgImFwcHNwYWNlIi4gVGhpcyBwcm92aWRlcyBhIHNpbXBsZSB3YXkgZm9yCgkJCQkJLy8gbW9kdWxlcyB0byByZXNwb25kLiB0aGUgZXhwZWN0YXRpb24gaXMgdGhhdCBhbnkgVUkgQ29tcG9uZW50cyBhcmUKCQkJCQkvLyBjcmVhdGVkIGJ5IHRoZSByZWNlaXZpbmcgbW9kdWxlIGFuZCB0aGUgcXVlcnlTZWxlY3RvciBpcyBwcm92aWRlZAoJCQkJCS8vIHRvIHRoZW0gYXMgYSBjb250YWluZXIgc28gdGhleSByZW5kZXIgcHJvcGVybHkgaW50byB0aGUgcmlnaHQKCQkJCQkvLyBjb21wb25lbnQuCgkJCQkJLy8KCQkJCQkvLyBtb2R1bGVzIHNob3VsZCBjYWNoZSBjb21wb25lbnRzIGluIHRoaXMucmVuZGVySW50b3MgYW5kIHJlbmRlcigpCgkJCQkJLy8gZXhpc3RpbmcgY29tcG9uZW50cyByYXRoZXIgdGhhbiBuZXcgb25lcyB0byBhdm9pZCB0aGUgY3JlYXRpb24gb2YKCQkJCQkvLyBtdWx0aXBsZSBjb21wb25lbnRzIHdpdGggcGFyYWxsZWwgZXZlbnQtbGlzdGVuZXJzLCBldGMuCgkJCQkJLy8KCQkJCX0sIHsKCQkJCQlrZXk6ICdyZW5kZXJJbnRvJywKCQkJCQl2YWx1ZTogZnVuY3Rpb24oKSB7CgkJCQkJCXZhciBfcmVuZGVySW50byA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTgoKSB7CgkJCQkJCQl2YXIgcXVlcnlTZWxlY3RvciwKCQkJCQkJCQlfYXJnczkgPSBhcmd1bWVudHM7CgkJCQkJCQlyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OSkgewoJCQkJCQkJCXdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHsKCQkJCQkJCQkJY2FzZSAwOgoJCQkJCQkJCQkJcXVlcnlTZWxlY3RvciA9IF9hcmdzOS5sZW5ndGggPiAwICYmIF9hcmdzOVswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3M5WzBdIDogJyc7CgkJCQkJCQkJCQlyZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgncmV0dXJuJywgbnVsbCk7CgkJCQkJCQkJCWNhc2UgMjoKCQkJCQkJCQkJY2FzZSAnZW5kJzoKCQkJCQkJCQkJCXJldHVybiBfY29udGV4dDkuc3RvcCgpOwoJCQkJCQkJCX0KCQkJCQkJCX0sIF9jYWxsZWU4KTsKCQkJCQkJfSkpOwoKCQkJCQkJZnVuY3Rpb24gcmVuZGVySW50bygpIHsKCQkJCQkJCXJldHVybiBfcmVuZGVySW50by5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCQl9CgoJCQkJCQlyZXR1cm4gcmVuZGVySW50bzsKCQkJCQl9KCkgLy8KCQkJCQkvLwoJCQkJCS8vIG1vZHVsZXMgbWF5IGFzayBvdGhlciBtb2R1bGVzIHRvIHJlc3BvbmQgdG8gInJlcXVlc3RfdHlwZXMiLiBUaGUKCQkJCQkvLyByZXNwb25zZSB0aGF0IHRoZXkgZ2V0IG1heSBvciBtYXkgbm90IGJlIHN1aXRhYmxlLCBidXQgaWYgc3VpdGFibGUKCQkJCQkvLyBjYW4gYmUgdXNlZCBieSB0aGUgcmVxdWVzdGluZyBtb2R1bGUgdG8gZm9ybWF0IGRhdGEgb3IgdXBkYXRlCgkJCQkJLy8gaXRzIERPTSBhcyBuZWVkZWQuIFRoaXMgaXMgYSBiYXNpYyBtZXRob2Qgb2YgcHJvdmlkaW5nIGludGVyLWFwcAoJCQkJCS8vIGludGVyYWN0aXZpdHkgYW5kIGV4dGVuc2liaWxpdHkuCgkJCQkJLy8KCQkJCX0sIHsKCQkJCQlrZXk6ICdyZXNwb25kVG8nLAoJCQkJCXZhbHVlOiBmdW5jdGlvbiByZXNwb25kVG8oKSB7CgkJCQkJCXZhciByZXF1ZXN0X3R5cGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6ICcnOwoJCQkJCQl2YXIgb2JqID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CgkJCQkJCXJldHVybiBudWxsOwoJCQkJCX0KCgkJCQkJLy8KCQkJCQkvLyBERVBSRUNBVEVEIC0tIHBvcnQgdG8gYXBwLmNvbm5lY3Rpb24ub24oJ2V2ZW50JywgZnVuY3Rpb24uLi4KCQkJCQkvLwoJCQkJCS8vIHdoZW4gYW4gZXZlbnQgdG8gd2hpY2ggbW9kdWxlcyBhcmUgbGlzdGVuaW5nIHRyaWdnZXJzLCB3ZSBwdXNoIHRoZQoJCQkJCS8vIGRhdGEgb3V0IGludG8gdGhpcyBmdW5jdGlvbiwgd2hpY2ggY2FuIGJlIG92ZXJyaWRkZW4gYXMgbmVlZGVkIGluCgkJCQkJLy8gb3JkZXIgdG8KCQkJCQkvLwoJCQkJfSwgewoJCQkJCWtleTogJ3JlY2VpdmVFdmVudCcsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uIHJlY2VpdmVFdmVudChldmVudG5hbWUsIGRhdGEpIHsKCQkJCQl9CgoJCQkJCS8vCgkJCQkJLy8gREVQUkVDQVRFRCAtLSBwb3J0IHRvIGFwcC5jb25uZWN0aW9uLmVtaXQoJ2V2ZW50Jywge30pOwoJCQkJCS8vCgkJCQkJLy8geW91IHByb2JhYmx5IGRvbid0IHdhbnQgdG8gb3Zlci13cml0ZSB0aGlzLCBpdCBpcyBiYXNpY2FseSBqdXN0CgkJCQkJLy8gc2ltcGxpZnlpbmcgdGhlIGV2ZW50LWVtaXR0aW5nIGFuZCByZWNlaXZpbmcgZnVuY3Rpb25hbGl0eSBpbiB0aGUKCQkJCQkvLyBjb25uZWN0aW9uIGNsYXNzLCBzbyB0aGF0IGRldmVsb3BlcnMgY2FuIHVzZSB0aGlzIHdpdGhvdXQgd29ycnlpbmcKCQkJCQkvLyBhYm91dCB0aGVpciBvd24gZXZlbnRzLgoJCQkJCS8vCgkJCQl9LCB7CgkJCQkJa2V5OiAnc2VuZEV2ZW50JywKCQkJCQl2YWx1ZTogZnVuY3Rpb24gc2VuZEV2ZW50KGV2ZW50bmFtZSwgZGF0YSkgewoJCQkJCQl0aGlzLmFwcC5jb25uZWN0aW9uLmVtaXQoZXZlbnRuYW1lLCBkYXRhKTsKCQkJCQl9CgoJCQkJCS8vCgkJCQkJLy8gSEFORExFIFBFRVIgVFJBTlNBQ1RJT04KCQkJCQkvLwoJCQkJCS8vIGlmIHlvdXIgd2ViIGFwcGxpY2F0aW9uIGRlZmluZXMgYSBsb3dlci1sZXZlbCBtYXNzYWdlIGZvcm1hdCwgaXQgY2FuCgkJCQkJLy8gc2VuZCBhbmQgcmVjZWl2ZSBkYXRhIFdJVEhPVVQgdGhlIG5lZWQgZm9yIHRoYXQgZGF0YSB0byBiZSBjb25maXJtZWQKCQkJCQkvLyBpbiB0aGUgYmxvY2tjaGFpbi4gU2VlIG91ciBzZWFyY2ggbW9kdWxlIGZvciBhbiBleGFtcGxlIG9mIHRoaXMgaW4KCQkJCQkvLyBhY3Rpb24uIFRoaXMgaXMgdXNlZnVsIGZvciBhcHBsaWNhdGlvbnMgdGhhdCBhcmUgaGFwcHkgdG8gcGFzcyBkYXRhCgkJCQkJLy8gZGlyZWN0bHkgYmV0d2VlbiBwZWVycywgYnV0IHN0aWxsIHdhbnQgdG8gdXNlIHRoZSBibG9ja2NoYWluIGZvciBwZWVyCgkJCQkJLy8gZGlzY292ZXJ5IChpLmUuICJ3aGF0IGlzIHlvdXIgSVAgYWRkcmVzcyIgcmVxdWVzdHMpCgkJCQkJLy8KCQkJCX0sIHsKCQkJCQlrZXk6ICdoYW5kbGVQZWVyVHJhbnNhY3Rpb24nLAoJCQkJCXZhbHVlOiBmdW5jdGlvbigpIHsKCQkJCQkJdmFyIF9oYW5kbGVQZWVyVHJhbnNhY3Rpb24gPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KGFwcCkgewoJCQkJCQkJdmFyIHR4LAoJCQkJCQkJCXBlZXIsCgkJCQkJCQkJbXljYWxsYmFjaywKCQkJCQkJCQl0eG1zZywKCQkJCQkJCQlpLAoJCQkJCQkJCV90eG1zZywKCQkJCQkJCQlleHBlY3RlZF9yZXF1ZXN0LAoJCQkJCQkJCV90eG1zZyRkYXRhLAoJCQkJCQkJCV90eG1zZyRkYXRhMiwKCQkJCQkJCQlfdHhtc2ckZGF0YTMsCgkJCQkJCQkJX3R4bXNnJGRhdGE0LAoJCQkJCQkJCXNlbGVjdCwKCQkJCQkJCQlkYm5hbWUsCgkJCQkJCQkJdGFibGVuYW1lLAoJCQkJCQkJCXdoZXJlLAoJCQkJCQkJCXNxbCwKCQkJCQkJCQlwYXJhbXMsCgkJCQkJCQkJcm93cywKCQkJCQkJCQlyZXMsCgkJCQkJCQkJdHhyZXEsCgkJCQkJCQkJX3R4bXNnMiwKCQkJCQkJCQlfdHhtc2czLAoJCQkJCQkJCV90eG1zZzQsCgkJCQkJCQkJX3NxbCwKCQkJCQkJCQlfZGJuYW1lLAoJCQkJCQkJCV9wYXJhbXMsCgkJCQkJCQkJX3Jvd3MsCgkJCQkJCQkJX3JlcywKCQkJCQkJCQlfYXJnczEwID0gYXJndW1lbnRzOwoJCQkJCQkJcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU5JChfY29udGV4dDEwKSB7CgkJCQkJCQkJd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQxMC5wcmV2ID0gX2NvbnRleHQxMC5uZXh0KSB7CgkJCQkJCQkJCWNhc2UgMDoKCQkJCQkJCQkJCXR4ID0gX2FyZ3MxMC5sZW5ndGggPiAxICYmIF9hcmdzMTBbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTBbMV0gOiBudWxsOwoJCQkJCQkJCQkJcGVlciA9IF9hcmdzMTAubGVuZ3RoID4gMiA/IF9hcmdzMTBbMl0gOiB1bmRlZmluZWQ7CgkJCQkJCQkJCQlteWNhbGxiYWNrID0gX2FyZ3MxMC5sZW5ndGggPiAzICYmIF9hcmdzMTBbM10gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTBbM10gOiBudWxsOwoJCQkJCQkJCQkJaWYgKCEodHggPT0gbnVsbCkpIHsKCQkJCQkJCQkJCQlfY29udGV4dDEwLm5leHQgPSA1OwoJCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQkJcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCdyZXR1cm4nLCAwKTsKCQkJCQkJCQkJY2FzZSA1OgoJCQkJCQkJCQkJX2NvbnRleHQxMC5wcmV2ID0gNTsKCQkJCQkJCQkJCXR4bXNnID0gdHgucmV0dXJuTWVzc2FnZSgpOwoJCQkJCQkJCQkJX2NvbnRleHQxMC5uZXh0ID0gMTY7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJY2FzZSA5OgoJCQkJCQkJCQkJX2NvbnRleHQxMC5wcmV2ID0gOTsKCQkJCQkJCQkJCV9jb250ZXh0MTAudDAgPSBfY29udGV4dDEwWydjYXRjaCddKDUpOwoJCQkJCQkJCQkJLy8KCQkJCQkJCQkJCS8vIHNlZSBlcnJvciBtZXNzYWdlIGJlbG93LCB3ZSBoYXZlIHJ1biBpbnRvIG9kZCB3ZWJwYWNrIGlzc3VlcwoJCQkJCQkJCQkJLy8gaGVyZSBzbyBhcmUgbGVhdmluZyBhIHZpc2libGUgYW5kIG9idmlvdXMgZXJyb3IgaW5kaWNhdG9yIGhlcmUKCQkJCQkJCQkJCS8vIHRvIGNhdGNoIGFueSBwcm9ibGVtcy4KCQkJCQkJCQkJCS8vCgkJCQkJCQkJCQljb25zb2xlLmxvZygnISFAQCFAIyEjIUAjIUAjJyk7CgkJCQkJCQkJCQljb25zb2xlLmxvZygnISFAQCFAIyEjIUAjIUAjJyk7CgkJCQkJCQkJCQljb25zb2xlLmxvZygnISFAQCFAIyEjIUAjIUAjJyk7CgkJCQkJCQkJCQljb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeSh0eCkpOwoJCQkJCQkJCQkJcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCdyZXR1cm4nLCAwKTsKCQkJCQkJCQkJY2FzZSAxNjoKCQkJCQkJCQkJCWkgPSAwOwoJCQkJCQkJCQljYXNlIDE3OgoJCQkJCQkJCQkJaWYgKCEoaSA8IHRoaXMuZGJfdGFibGVzLmxlbmd0aCkpIHsKCQkJCQkJCQkJCQlfY29udGV4dDEwLm5leHQgPSA0NzsKCQkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJCWV4cGVjdGVkX3JlcXVlc3QgPSB0aGlzLm5hbWUudG9Mb3dlckNhc2UoKSArICcgbG9hZCAnICsgdGhpcy5kYl90YWJsZXNbaV07CgkJCQkJCQkJCQlpZiAoISgoKF90eG1zZyA9IHR4bXNnKSA9PT0gbnVsbCB8fCBfdHhtc2cgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90eG1zZy5yZXF1ZXN0KSA9PT0gZXhwZWN0ZWRfcmVxdWVzdCkpIHsKCQkJCQkJCQkJCQlfY29udGV4dDEwLm5leHQgPSA0NDsKCQkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJCWNvbnNvbGUubG9nKCdleHBlY3RlZF9yZXF1ZXN0IDogJyArIGV4cGVjdGVkX3JlcXVlc3QpOwoJCQkJCQkJCQkJc2VsZWN0ID0gKF90eG1zZyRkYXRhID0gdHhtc2cuZGF0YSkgPT09IG51bGwgfHwgX3R4bXNnJGRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90eG1zZyRkYXRhLnNlbGVjdDsKCQkJCQkJCQkJCWRibmFtZSA9IChfdHhtc2ckZGF0YTIgPSB0eG1zZy5kYXRhKSA9PT0gbnVsbCB8fCBfdHhtc2ckZGF0YTIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90eG1zZyRkYXRhMi5kYm5hbWU7CgkJCQkJCQkJCQl0YWJsZW5hbWUgPSAoX3R4bXNnJGRhdGEzID0gdHhtc2cuZGF0YSkgPT09IG51bGwgfHwgX3R4bXNnJGRhdGEzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdHhtc2ckZGF0YTMudGFibGVuYW1lOwoJCQkJCQkJCQkJd2hlcmUgPSAoX3R4bXNnJGRhdGE0ID0gdHhtc2cuZGF0YSkgPT09IG51bGwgfHwgX3R4bXNnJGRhdGE0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdHhtc2ckZGF0YTQud2hlcmU7CgkJCQkJCQkJCQlpZiAoL15bYS16ImAnPV8qKClcLlxuXHRcciAsMC05QS1aXSskLy50ZXN0KHNlbGVjdCkpIHsKCQkJCQkJCQkJCQlfY29udGV4dDEwLm5leHQgPSAyNzsKCQkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJCXJldHVybiBfY29udGV4dDEwLmFicnVwdCgncmV0dXJuJyk7CgkJCQkJCQkJCWNhc2UgMjc6CgkJCQkJCQkJCQlpZiAoL15bYS16ImAnPV8oKVwuICwwLTlBLVpdKyQvLnRlc3QoZGJuYW1lKSkgewoJCQkJCQkJCQkJCV9jb250ZXh0MTAubmV4dCA9IDI5OwoJCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQkJcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCdyZXR1cm4nKTsKCQkJCQkJCQkJY2FzZSAyOToKCQkJCQkJCQkJCWlmICgvXlthLXoiYCc9XygpXC4gLDAtOUEtWl0rJC8udGVzdCh0YWJsZW5hbWUpKSB7CgkJCQkJCQkJCQkJX2NvbnRleHQxMC5uZXh0ID0gMzE7CgkJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCQlyZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoJ3JldHVybicpOwoJCQkJCQkJCQljYXNlIDMxOgoJCQkJCQkJCQkJc3FsID0gJ1NFTEVDVCAnLmNvbmNhdChzZWxlY3QsICdcbiAgICAgICAgICAgICAgICAgICBGUk9NICcpLmNvbmNhdCh0YWJsZW5hbWUpOwoJCQkJCQkJCQkJaWYgKHdoZXJlICE9PSAnJykgewoJCQkJCQkJCQkJCXNxbCArPSAnIFdIRVJFICcuY29uY2F0KHdoZXJlKTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJCXBhcmFtcyA9IHt9OwoJCQkJCQkJCQkJX2NvbnRleHQxMC5uZXh0ID0gMzY7CgkJCQkJCQkJCQlyZXR1cm4gdGhpcy5hcHAuc3RvcmFnZS5xdWVyeURhdGFiYXNlKHNxbCwgcGFyYW1zLCBkYm5hbWUpOwoJCQkJCQkJCQljYXNlIDM2OgoJCQkJCQkJCQkJcm93cyA9IF9jb250ZXh0MTAuc2VudDsKCQkJCQkJCQkJCXJlcyA9IHt9OwoJCQkJCQkJCQkJcmVzLmVyciA9ICcnOwoJCQkJCQkJCQkJcmVzLnJvd3MgPSByb3dzOwoJCQkJCQkJCQkJaWYgKCFteWNhbGxiYWNrKSB7CgkJCQkJCQkJCQkJX2NvbnRleHQxMC5uZXh0ID0gNDM7CgkJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCQlteWNhbGxiYWNrKHJlcyk7CgkJCQkJCQkJCQlyZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoJ3JldHVybicsIDEpOwoJCQkJCQkJCQljYXNlIDQzOgoJCQkJCQkJCQkJcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCdyZXR1cm4nLCAwKTsKCQkJCQkJCQkJY2FzZSA0NDoKCQkJCQkJCQkJCWkrKzsKCQkJCQkJCQkJCV9jb250ZXh0MTAubmV4dCA9IDE3OwoJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCWNhc2UgNDc6CgkJCQkJCQkJCQkvLwoJCQkJCQkJCQkJLy8gb2RkIGVycm9yIHByZXZpb3VzbHkgaWYgcmVmZXJlbmNpbmcgdHhtc2cucmVxdWVzdCBkaXJlY3RseQoJCQkJCQkJCQkJLy8gd2VicGFjayBzZWVtcyB0byBzdHJ1Z2dsZSBmb3Igc29tZSByZWFzb24uIHN1Z2dlc3QgZXh0cmFjdGluZwoJCQkJCQkJCQkJLy8gdmFsdWUgYW5kIHRoZW4gcnVubmluZyBhIHN0cmluZyBjb21wYXJpc29uIHRoaXMgd2F5LgoJCQkJCQkJCQkJLy8KCQkJCQkJCQkJCXR4cmVxID0gdHhtc2cucmVxdWVzdDsKCQkJCQkJCQkJCWlmICghKHR4cmVxID09PSAncmF3U1FMJykpIHsKCQkJCQkJCQkJCQlfY29udGV4dDEwLm5leHQgPSA2ODsKCQkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJCWlmICghKCgoX3R4bXNnMiA9IHR4bXNnKSA9PT0gbnVsbCB8fCBfdHhtc2cyID09PSB2b2lkIDAgfHwgKF90eG1zZzIgPSBfdHhtc2cyLmRhdGEpID09PSBudWxsIHx8IF90eG1zZzIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90eG1zZzIubW9kdWxlKSA9PT0gdGhpcy5uYW1lKSkgewoJCQkJCQkJCQkJCV9jb250ZXh0MTAubmV4dCA9IDY4OwoJCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQkJX3NxbCA9IChfdHhtc2czID0gdHhtc2cpID09PSBudWxsIHx8IF90eG1zZzMgPT09IHZvaWQgMCB8fCAoX3R4bXNnMyA9IF90eG1zZzMuZGF0YSkgPT09IG51bGwgfHwgX3R4bXNnMyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3R4bXNnMy5zcWw7CgkJCQkJCQkJCQlfZGJuYW1lID0gKF90eG1zZzQgPSB0eG1zZykgPT09IG51bGwgfHwgX3R4bXNnNCA9PT0gdm9pZCAwIHx8IChfdHhtc2c0ID0gX3R4bXNnNC5kYXRhKSA9PT0gbnVsbCB8fCBfdHhtc2c0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdHhtc2c0LmRibmFtZTsKCQkJCQkJCQkJCV9wYXJhbXMgPSB7fTsKCQkJCQkJCQkJCWlmICghKHRoaXMuc3FsY2FjaGVbX3NxbF0gJiYgdGhpcy5zcWxjYWNoZV9lbmFibGVkID09PSAxKSkgewoJCQkJCQkJCQkJCV9jb250ZXh0MTAubmV4dCA9IDU3OwoJCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQkJX3Jvd3MgPSB0aGlzLnNxbGNhY2hlW19zcWxdOwoJCQkJCQkJCQkJX2NvbnRleHQxMC5uZXh0ID0gNjE7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJY2FzZSA1NzoKCQkJCQkJCQkJCV9jb250ZXh0MTAubmV4dCA9IDU5OwoJCQkJCQkJCQkJcmV0dXJuIHRoaXMuYXBwLnN0b3JhZ2UucXVlcnlEYXRhYmFzZShfc3FsLCBfcGFyYW1zLCBfZGJuYW1lKTsKCQkJCQkJCQkJY2FzZSA1OToKCQkJCQkJCQkJCV9yb3dzID0gX2NvbnRleHQxMC5zZW50OwoJCQkJCQkJCQkJaWYgKHRoaXMuc3FsY2FjaGVfZW5hYmxlZCkgewoJCQkJCQkJCQkJCXRoaXMuc3FsY2FjaGVbX3NxbF0gPSBfcm93czsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJY2FzZSA2MToKCQkJCQkJCQkJCV9yZXMgPSB7fTsKCQkJCQkJCQkJCV9yZXMuZXJyID0gJyc7CgkJCQkJCQkJCQlfcmVzLnJvd3MgPSBfcm93czsKCQkJCQkJCQkJCWlmICghbXljYWxsYmFjaykgewoJCQkJCQkJCQkJCV9jb250ZXh0MTAubmV4dCA9IDY3OwoJCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQkJbXljYWxsYmFjayhfcmVzKTsKCQkJCQkJCQkJCXJldHVybiBfY29udGV4dDEwLmFicnVwdCgncmV0dXJuJywgMSk7CgkJCQkJCQkJCWNhc2UgNjc6CgkJCQkJCQkJCQlyZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoJ3JldHVybicsIDApOwoJCQkJCQkJCQljYXNlIDY4OgoJCQkJCQkJCQkJcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCdyZXR1cm4nLCAwKTsKCQkJCQkJCQkJY2FzZSA2OToKCQkJCQkJCQkJY2FzZSAnZW5kJzoKCQkJCQkJCQkJCXJldHVybiBfY29udGV4dDEwLnN0b3AoKTsKCQkJCQkJCQl9CgkJCQkJCQl9LCBfY2FsbGVlOSwgdGhpcywgW1s1LCA5XV0pOwoJCQkJCQl9KSk7CgoJCQkJCQlmdW5jdGlvbiBoYW5kbGVQZWVyVHJhbnNhY3Rpb24oX3gxMSkgewoJCQkJCQkJcmV0dXJuIF9oYW5kbGVQZWVyVHJhbnNhY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQkJCQkJfQoKCQkJCQkJcmV0dXJuIGhhbmRsZVBlZXJUcmFuc2FjdGlvbjsKCQkJCQl9KCkKCQkJCX0sIHsKCQkJCQlrZXk6ICdyZXR1cm5TZXJ2aWNlcycsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uIHJldHVyblNlcnZpY2VzKCkgewoJCQkJCQlyZXR1cm4gdGhpcy5zZXJ2aWNlczsKCQkJCQl9CgoJCQkJCS8vCgkJCQkJLy8gUEVFUiBEQVRBQkFTRSBDSEVDSwoJCQkJCS8vCgkJCQkJLy8gdGhpcyBwaWdneWJhY2tzIG9uIGhhbmRsZVBlZXJSZXF1ZXN0IHRvIHByb3ZpZGUgYXV0b21hdGVkIGRhdGFiYXNlCgkJCQkJLy8gcm93LXJldHJpZXZhbCBmb3IgY2xpZW50cyB3aG8gYXJlIGNvbm5lY3RlZCB0byBzZXJ2ZXJzIHRoYXQgcnVuIHRoZQoJCQkJCS8vIGRhdGEgc2lsb3MuCgkJCQkJLy8KCQkJCX0sIHsKCQkJCQlrZXk6ICdzZW5kUGVlckRhdGFiYXNlUmVxdWVzdCcsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uKCkgewoJCQkJCQl2YXIgX3NlbmRQZWVyRGF0YWJhc2VSZXF1ZXN0ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTAoZGJuYW1lLCB0YWJsZW5hbWUpIHsKCQkJCQkJCXZhciBzZWxlY3QsCgkJCQkJCQkJd2hlcmUsCgkJCQkJCQkJcGVlciwKCQkJCQkJCQlteWNhbGxiYWNrLAoJCQkJCQkJCW1lc3NhZ2UsCgkJCQkJCQkJX2FyZ3MxMSA9IGFyZ3VtZW50czsKCQkJCQkJCXJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTAkKF9jb250ZXh0MTEpIHsKCQkJCQkJCQl3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDExLnByZXYgPSBfY29udGV4dDExLm5leHQpIHsKCQkJCQkJCQkJY2FzZSAwOgoJCQkJCQkJCQkJc2VsZWN0ID0gX2FyZ3MxMS5sZW5ndGggPiAyICYmIF9hcmdzMTFbMl0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTFbMl0gOiAnJzsKCQkJCQkJCQkJCXdoZXJlID0gX2FyZ3MxMS5sZW5ndGggPiAzICYmIF9hcmdzMTFbM10gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTFbM10gOiAnJzsKCQkJCQkJCQkJCXBlZXIgPSBfYXJnczExLmxlbmd0aCA+IDQgJiYgX2FyZ3MxMVs0XSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxMVs0XSA6IG51bGw7CgkJCQkJCQkJCQlteWNhbGxiYWNrID0gX2FyZ3MxMS5sZW5ndGggPiA1ICYmIF9hcmdzMTFbNV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTFbNV0gOiBudWxsOwoJCQkJCQkJCQkJbWVzc2FnZSA9IHt9OwoJCQkJCQkJCQkJbWVzc2FnZS5yZXF1ZXN0ID0gZGJuYW1lICsgJyBsb2FkICcgKyB0YWJsZW5hbWU7CgkJCQkJCQkJCQltZXNzYWdlLmRhdGEgPSB7fTsKCQkJCQkJCQkJCW1lc3NhZ2UuZGF0YS5kYm5hbWUgPSBkYm5hbWU7CgkJCQkJCQkJCQltZXNzYWdlLmRhdGEudGFibGVuYW1lID0gdGFibGVuYW1lOwoJCQkJCQkJCQkJbWVzc2FnZS5kYXRhLnNlbGVjdCA9IHNlbGVjdDsKCQkJCQkJCQkJCW1lc3NhZ2UuZGF0YS53aGVyZSA9IHdoZXJlOwoJCQkJCQkJCQkJaWYgKCEocGVlciA9PSBudWxsKSkgewoJCQkJCQkJCQkJCV9jb250ZXh0MTEubmV4dCA9IDE1OwoJCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQkJcmV0dXJuIF9jb250ZXh0MTEuYWJydXB0KCdyZXR1cm4nLCB0aGlzLmFwcC5uZXR3b3JrLnNlbmRSZXF1ZXN0QXNUcmFuc2FjdGlvbihtZXNzYWdlLnJlcXVlc3QsIG1lc3NhZ2UuZGF0YSwgZnVuY3Rpb24ocmVzKSB7CgkJCQkJCQkJCQkJcmV0dXJuIG15Y2FsbGJhY2socmVzKTsKCQkJCQkJCQkJCX0pKTsKCQkJCQkJCQkJY2FzZSAxNToKCQkJCQkJCQkJCXJldHVybiBfY29udGV4dDExLmFicnVwdCgncmV0dXJuJywgdGhpcy5hcHAubmV0d29yay5zZW5kUmVxdWVzdEFzVHJhbnNhY3Rpb24obWVzc2FnZS5yZXF1ZXN0LCBtZXNzYWdlLmRhdGEsIGZ1bmN0aW9uKHJlcykgewoJCQkJCQkJCQkJCXJldHVybiBteWNhbGxiYWNrKHJlcyk7CgkJCQkJCQkJCQl9LCBwZWVyLnBlZXJJbmRleCkpOwoJCQkJCQkJCQljYXNlIDE2OgoJCQkJCQkJCQljYXNlICdlbmQnOgoJCQkJCQkJCQkJcmV0dXJuIF9jb250ZXh0MTEuc3RvcCgpOwoJCQkJCQkJCX0KCQkJCQkJCX0sIF9jYWxsZWUxMCwgdGhpcyk7CgkJCQkJCX0pKTsKCgkJCQkJCWZ1bmN0aW9uIHNlbmRQZWVyRGF0YWJhc2VSZXF1ZXN0KF94MTIsIF94MTMpIHsKCQkJCQkJCXJldHVybiBfc2VuZFBlZXJEYXRhYmFzZVJlcXVlc3QuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQkJCQkJfQoKCQkJCQkJcmV0dXJuIHNlbmRQZWVyRGF0YWJhc2VSZXF1ZXN0OwoJCQkJCX0oKQoJCQkJfSwgewoJCQkJCWtleTogJ3NlbmRQZWVyRGF0YWJhc2VSZXF1ZXN0V2l0aEZpbHRlcicsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uKCkgewoJCQkJCQl2YXIgX3NlbmRQZWVyRGF0YWJhc2VSZXF1ZXN0V2l0aEZpbHRlciA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTExKCkgewoJCQkJCQkJdmFyIG1vZG5hbWUsCgkJCQkJCQkJc3FsLAoJCQkJCQkJCXN1Y2Nlc3NfY2FsbGJhY2ssCgkJCQkJCQkJcGVlcmZpbHRlciwKCQkJCQkJCQltc2csCgkJCQkJCQkJX2FyZ3MxMiA9IGFyZ3VtZW50czsKCQkJCQkJCXJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTEkKF9jb250ZXh0MTIpIHsKCQkJCQkJCQl3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDEyLnByZXYgPSBfY29udGV4dDEyLm5leHQpIHsKCQkJCQkJCQkJY2FzZSAwOgoJCQkJCQkJCQkJbW9kbmFtZSA9IF9hcmdzMTIubGVuZ3RoID4gMCAmJiBfYXJnczEyWzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczEyWzBdIDogJyc7CgkJCQkJCQkJCQlzcWwgPSBfYXJnczEyLmxlbmd0aCA+IDEgJiYgX2FyZ3MxMlsxXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxMlsxXSA6ICcnOwoJCQkJCQkJCQkJc3VjY2Vzc19jYWxsYmFjayA9IF9hcmdzMTIubGVuZ3RoID4gMiAmJiBfYXJnczEyWzJdICE9PSB1bmRlZmluZWQgPyBfYXJnczEyWzJdIDogbnVsbDsKCQkJCQkJCQkJCXBlZXJmaWx0ZXIgPSBfYXJnczEyLmxlbmd0aCA+IDMgJiYgX2FyZ3MxMlszXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxMlszXSA6IG51bGw7CgkJCQkJCQkJCQlpZiAoIShzcWwgPT09ICcnKSkgewoJCQkJCQkJCQkJCV9jb250ZXh0MTIubmV4dCA9IDY7CgkJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCQlyZXR1cm4gX2NvbnRleHQxMi5hYnJ1cHQoJ3JldHVybicpOwoJCQkJCQkJCQljYXNlIDY6CgkJCQkJCQkJCQlpZiAoIShtb2RuYW1lID09PSAnJykpIHsKCQkJCQkJCQkJCQlfY29udGV4dDEyLm5leHQgPSA4OwoJCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQkJcmV0dXJuIF9jb250ZXh0MTIuYWJydXB0KCdyZXR1cm4nKTsKCQkJCQkJCQkJY2FzZSA4OgoJCQkJCQkJCQkJaWYgKHRoaXMuYXBwLm1vZHVsZXMucmV0dXJuTW9kdWxlKG1vZG5hbWUpKSB7CgkJCQkJCQkJCQkJX2NvbnRleHQxMi5uZXh0ID0gMTE7CgkJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCQljb25zb2xlLmVycm9yKG1vZG5hbWUgKyAnIG5vdCBmb3VuZCEnKTsKCQkJCQkJCQkJCXJldHVybiBfY29udGV4dDEyLmFicnVwdCgncmV0dXJuJyk7CgkJCQkJCQkJCWNhc2UgMTE6CgkJCQkJCQkJCQkvL2NvbnNvbGUubG9nKCJtb2R0ZW1wbGF0ZS5zZW5kUGVlckRhdGFiYXNlUmVxdWVzdFdpdGhGaWx0ZXIgOiAiICsgbW9kbmFtZSwgc3FsKTsKCQkJCQkJCQkJCW1zZyA9IHt9OwoJCQkJCQkJCQkJbXNnLnJlcXVlc3QgPSAncmF3U1FMJzsKCQkJCQkJCQkJCW1zZy5kYXRhID0ge307CgkJCQkJCQkJCQltc2cuZGF0YS5zcWwgPSBzcWw7CgkJCQkJCQkJCQltc2cuZGF0YS5tb2R1bGUgPSBtb2RuYW1lOwoJCQkJCQkJCQkJbXNnLmRhdGEuZGJuYW1lID0gdGhpcy5hcHAubW9kdWxlcy5yZXR1cm5Nb2R1bGUobW9kbmFtZSkucmV0dXJuU2x1ZygpOwoJCQkJCQkJCQkJY29uc29sZS5sb2coJ1NQRFJXRjogJyArIG1vZG5hbWUpOwoJCQkJCQkJCQkJdGhpcy5zZW5kUGVlclJlcXVlc3RXaXRoRmlsdGVyKGZ1bmN0aW9uKCkgewoJCQkJCQkJCQkJCXJldHVybiBtc2c7CgkJCQkJCQkJCQl9LCBzdWNjZXNzX2NhbGxiYWNrLCBwZWVyZmlsdGVyKTsKCQkJCQkJCQkJY2FzZSAxOToKCQkJCQkJCQkJY2FzZSAnZW5kJzoKCQkJCQkJCQkJCXJldHVybiBfY29udGV4dDEyLnN0b3AoKTsKCQkJCQkJCQl9CgkJCQkJCQl9LCBfY2FsbGVlMTEsIHRoaXMpOwoJCQkJCQl9KSk7CgoJCQkJCQlmdW5jdGlvbiBzZW5kUGVlckRhdGFiYXNlUmVxdWVzdFdpdGhGaWx0ZXIoKSB7CgkJCQkJCQlyZXR1cm4gX3NlbmRQZWVyRGF0YWJhc2VSZXF1ZXN0V2l0aEZpbHRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCQl9CgoJCQkJCQlyZXR1cm4gc2VuZFBlZXJEYXRhYmFzZVJlcXVlc3RXaXRoRmlsdGVyOwoJCQkJCX0oKQoJCQkJfSwgewoJCQkJCWtleTogJ3NlbmRQZWVyUmVxdWVzdFdpdGhTZXJ2aWNlRmlsdGVyJywKCQkJCQl2YWx1ZTogZnVuY3Rpb24oKSB7CgkJCQkJCXZhciBfc2VuZFBlZXJSZXF1ZXN0V2l0aFNlcnZpY2VGaWx0ZXIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMihzZXJ2aWNlbmFtZSwgbXNnKSB7CgkJCQkJCQl2YXIgc3VjY2Vzc19jYWxsYmFjaywKCQkJCQkJCQlfYXJnczEzID0gYXJndW1lbnRzOwoJCQkJCQkJcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMiQoX2NvbnRleHQxMykgewoJCQkJCQkJCXdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MTMucHJldiA9IF9jb250ZXh0MTMubmV4dCkgewoJCQkJCQkJCQljYXNlIDA6CgkJCQkJCQkJCQlzdWNjZXNzX2NhbGxiYWNrID0gX2FyZ3MxMy5sZW5ndGggPiAyICYmIF9hcmdzMTNbMl0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTNbMl0gOiBmdW5jdGlvbihyZXMpIHsKCQkJCQkJCQkJCX07CgkJCQkJCQkJCQl0aGlzLnNlbmRQZWVyUmVxdWVzdFdpdGhGaWx0ZXIoZnVuY3Rpb24oKSB7CgkJCQkJCQkJCQkJcmV0dXJuIG1zZzsKCQkJCQkJCQkJCX0sIHN1Y2Nlc3NfY2FsbGJhY2ssIGZ1bmN0aW9uKHBlZXIpIHsKCQkJCQkJCQkJCQlpZiAocGVlci5zZXJ2aWNlcykgewoJCQkJCQkJCQkJCQlmb3IgKHZhciB6ID0gMDsgeiA8IHBlZXIuc2VydmljZXMubGVuZ3RoOyB6KyspIHsKCQkJCQkJCQkJCQkJCWlmIChwZWVyLnNlcnZpY2VzW3pdLnNlcnZpY2UgPT09IHNlcnZpY2VuYW1lKSB7CgkJCQkJCQkJCQkJCQkJcmV0dXJuIDE7CgkJCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJCX0KCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQl9KTsKCQkJCQkJCQkJY2FzZSAyOgoJCQkJCQkJCQljYXNlICdlbmQnOgoJCQkJCQkJCQkJcmV0dXJuIF9jb250ZXh0MTMuc3RvcCgpOwoJCQkJCQkJCX0KCQkJCQkJCX0sIF9jYWxsZWUxMiwgdGhpcyk7CgkJCQkJCX0pKTsKCgkJCQkJCWZ1bmN0aW9uIHNlbmRQZWVyUmVxdWVzdFdpdGhTZXJ2aWNlRmlsdGVyKF94MTQsIF94MTUpIHsKCQkJCQkJCXJldHVybiBfc2VuZFBlZXJSZXF1ZXN0V2l0aFNlcnZpY2VGaWx0ZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQkJCQkJfQoKCQkJCQkJcmV0dXJuIHNlbmRQZWVyUmVxdWVzdFdpdGhTZXJ2aWNlRmlsdGVyOwoJCQkJCX0oKQoJCQkJfSwgewoJCQkJCWtleTogJ3NlbmRQZWVyUmVxdWVzdFdpdGhGaWx0ZXInLAoJCQkJCXZhbHVlOiBmdW5jdGlvbigpIHsKCQkJCQkJdmFyIF9zZW5kUGVlclJlcXVlc3RXaXRoRmlsdGVyID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTMoKSB7CgkJCQkJCQl2YXIgbXNnX2NhbGxiYWNrLAoJCQkJCQkJCXN1Y2Nlc3NfY2FsbGJhY2ssCgkJCQkJCQkJcGVlcmZpbHRlciwKCQkJCQkJCQltZXNzYWdlLAoJCQkJCQkJCXAsCgkJCQkJCQkJcGVlcnMsCgkJCQkJCQkJaSwKCQkJCQkJCQlfaTIsCgkJCQkJCQkJX3BlZXJzLAoJCQkJCQkJCXBlZXIsCgkJCQkJCQkJX2FyZ3MxNCA9IGFyZ3VtZW50czsKCQkJCQkJCXJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTMkKF9jb250ZXh0MTQpIHsKCQkJCQkJCQl3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDE0LnByZXYgPSBfY29udGV4dDE0Lm5leHQpIHsKCQkJCQkJCQkJY2FzZSAwOgoJCQkJCQkJCQkJbXNnX2NhbGxiYWNrID0gX2FyZ3MxNC5sZW5ndGggPiAwICYmIF9hcmdzMTRbMF0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTRbMF0gOiBudWxsOwoJCQkJCQkJCQkJc3VjY2Vzc19jYWxsYmFjayA9IF9hcmdzMTQubGVuZ3RoID4gMSAmJiBfYXJnczE0WzFdICE9PSB1bmRlZmluZWQgPyBfYXJnczE0WzFdIDogbnVsbDsKCQkJCQkJCQkJCXBlZXJmaWx0ZXIgPSBfYXJnczE0Lmxlbmd0aCA+IDIgJiYgX2FyZ3MxNFsyXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxNFsyXSA6IG51bGw7CgkJCQkJCQkJCQltZXNzYWdlID0gbXNnX2NhbGxiYWNrKCk7CgkJCQkJCQkJCQlpZiAoIShtZXNzYWdlID09PSBudWxsKSkgewoJCQkJCQkJCQkJCV9jb250ZXh0MTQubmV4dCA9IDY7CgkJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCQlyZXR1cm4gX2NvbnRleHQxNC5hYnJ1cHQoJ3JldHVybicpOwoJCQkJCQkJCQljYXNlIDY6CgkJCQkJCQkJCQlfY29udGV4dDE0Lm5leHQgPSA4OwoJCQkJCQkJCQkJcmV0dXJuIHRoaXMuYXBwLm5ldHdvcmsuZ2V0UGVlcnMoKTsKCQkJCQkJCQkJY2FzZSA4OgoJCQkJCQkJCQkJcCA9IF9jb250ZXh0MTQuc2VudDsKCQkJCQkJCQkJCXBlZXJzID0gW107CgkJCQkJCQkJCQlmb3IgKGkgPSAwOyBpIDwgcC5sZW5ndGg7IGkrKykgewoJCQkJCQkJCQkJCWlmICghcGVlcmZpbHRlciB8fCBwZWVyZmlsdGVyKHBbaV0pKSB7CgkJCQkJCQkJCQkJCXBlZXJzLnB1c2gocFtpXSk7CgkJCQkJCQkJCQkJfQoJCQkJCQkJCQkJfQoJCQkJCQkJCQkJaWYgKCEocGVlcnMubGVuZ3RoID09PSAwKSkgewoJCQkJCQkJCQkJCV9jb250ZXh0MTQubmV4dCA9IDE0OwoJCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQkJY29uc29sZS53YXJuKCdzZW5kUGVlclJlcXVlc3RXaXRoRmlsdGVyIGZvdW5kIG5vIHBlZXJzJyk7CgkJCQkJCQkJCQlyZXR1cm4gX2NvbnRleHQxNC5hYnJ1cHQoJ3JldHVybicpOwoJCQkJCQkJCQljYXNlIDE0OgoJCQkJCQkJCQkJZm9yIChfaTIgPSAwLCBfcGVlcnMgPSBwZWVyczsgX2kyIDwgX3BlZXJzLmxlbmd0aDsgX2kyKyspIHsKCQkJCQkJCQkJCQlwZWVyID0gX3BlZXJzW19pMl07CgkJCQkJCQkJCQkJdGhpcy5hcHAubmV0d29yay5zZW5kUmVxdWVzdEFzVHJhbnNhY3Rpb24obWVzc2FnZS5yZXF1ZXN0LCBtZXNzYWdlLmRhdGEsIGZ1bmN0aW9uKHJlcykgewoJCQkJCQkJCQkJCQlpZiAoc3VjY2Vzc19jYWxsYmFjayAhPSBudWxsKSB7CgkJCQkJCQkJCQkJCQlzdWNjZXNzX2NhbGxiYWNrKHJlcyk7CgkJCQkJCQkJCQkJCX0KCQkJCQkJCQkJCQl9LCBwZWVyLnBlZXJJbmRleCk7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCWNhc2UgMTU6CgkJCQkJCQkJCWNhc2UgJ2VuZCc6CgkJCQkJCQkJCQlyZXR1cm4gX2NvbnRleHQxNC5zdG9wKCk7CgkJCQkJCQkJfQoJCQkJCQkJfSwgX2NhbGxlZTEzLCB0aGlzKTsKCQkJCQkJfSkpOwoKCQkJCQkJZnVuY3Rpb24gc2VuZFBlZXJSZXF1ZXN0V2l0aEZpbHRlcigpIHsKCQkJCQkJCXJldHVybiBfc2VuZFBlZXJSZXF1ZXN0V2l0aEZpbHRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCQl9CgoJCQkJCQlyZXR1cm4gc2VuZFBlZXJSZXF1ZXN0V2l0aEZpbHRlcjsKCQkJCQl9KCkKCQkJCX0sIHsKCQkJCQlrZXk6ICdzZW5kUGVlckRhdGFiYXNlUmVxdWVzdFJhdycsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uKCkgewoJCQkJCQl2YXIgX3NlbmRQZWVyRGF0YWJhc2VSZXF1ZXN0UmF3ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTQoZGIsIHNxbCkgewoJCQkJCQkJdmFyIG15Y2FsbGJhY2ssCgkJCQkJCQkJbWVzc2FnZSwKCQkJCQkJCQlfYXJnczE1ID0gYXJndW1lbnRzOwoJCQkJCQkJcmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNCQoX2NvbnRleHQxNSkgewoJCQkJCQkJCXdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MTUucHJldiA9IF9jb250ZXh0MTUubmV4dCkgewoJCQkJCQkJCQljYXNlIDA6CgkJCQkJCQkJCQlteWNhbGxiYWNrID0gX2FyZ3MxNS5sZW5ndGggPiAyICYmIF9hcmdzMTVbMl0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTVbMl0gOiBudWxsOwoJCQkJCQkJCQkJbWVzc2FnZSA9IHt9OwoJCQkJCQkJCQkJbWVzc2FnZS5yZXF1ZXN0ID0gJ3Jhd1NRTCc7CgkJCQkJCQkJCQltZXNzYWdlLmRhdGEgPSB7fTsKCQkJCQkJCQkJCW1lc3NhZ2UuZGF0YS5zcWwgPSBzcWw7CgkJCQkJCQkJCQltZXNzYWdlLmRhdGEuZGJuYW1lID0gZGI7CgkJCQkJCQkJCQltZXNzYWdlLmRhdGEubW9kdWxlID0gdGhpcy5uYW1lOwoJCQkJCQkJCQkJcmV0dXJuIF9jb250ZXh0MTUuYWJydXB0KCdyZXR1cm4nLCB0aGlzLmFwcC5uZXR3b3JrLnNlbmRSZXF1ZXN0QXNUcmFuc2FjdGlvbihtZXNzYWdlLnJlcXVlc3QsIG1lc3NhZ2UuZGF0YSwgZnVuY3Rpb24ocmVzKSB7CgkJCQkJCQkJCQkJLy9KU09OLnN0cmluZ2lmeSgiY2FsbGJhY2sgZGF0YTE6ICIgKyBKU09OLnN0cmluZ2lmeShyZXMpKTsKCQkJCQkJCQkJCQlyZXR1cm4gbXljYWxsYmFjayhyZXMpOwoJCQkJCQkJCQkJfSkpOwoJCQkJCQkJCQljYXNlIDg6CgkJCQkJCQkJCWNhc2UgJ2VuZCc6CgkJCQkJCQkJCQlyZXR1cm4gX2NvbnRleHQxNS5zdG9wKCk7CgkJCQkJCQkJfQoJCQkJCQkJfSwgX2NhbGxlZTE0LCB0aGlzKTsKCQkJCQkJfSkpOwoKCQkJCQkJZnVuY3Rpb24gc2VuZFBlZXJEYXRhYmFzZVJlcXVlc3RSYXcoX3gxNiwgX3gxNykgewoJCQkJCQkJcmV0dXJuIF9zZW5kUGVlckRhdGFiYXNlUmVxdWVzdFJhdy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwoJCQkJCQl9CgoJCQkJCQlyZXR1cm4gc2VuZFBlZXJEYXRhYmFzZVJlcXVlc3RSYXc7CgkJCQkJfSgpCgkJCQl9LCB7CgkJCQkJa2V5OiAnaXNTbHVnJywKCQkJCQl2YWx1ZTogZnVuY3Rpb24gaXNTbHVnKHNsdWcpIHsKCQkJCQkJcmV0dXJuIHNsdWcgPT0gdGhpcy5yZXR1cm5TbHVnKCk7CgkJCQkJfQoJCQkJfSwgewoJCQkJCWtleTogJ3JldHVyblNsdWcnLAoJCQkJCXZhbHVlOiBmdW5jdGlvbiByZXR1cm5TbHVnKCkgewoJCQkJCQlpZiAodGhpcy5zbHVnICE9PSAnJykgewoJCQkJCQkJcmV0dXJuIHRoaXMuc2x1ZzsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCWlmICh0aGlzLmFwcG5hbWUpIHsKCQkJCQkJCQl0aGlzLnNsdWcgPSB0aGlzLmFwcG5hbWUudG9Mb3dlckNhc2UoKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJdGhpcy5zbHVnID0gdGhpcy5uYW1lLnRvTG93ZXJDYXNlKCk7CgkJCQkJCQl9CgkJCQkJCQl0aGlzLnNsdWcgPSB0aGlzLnNsdWcucmVwbGFjZSgvXHQvZywgJ18nKS5yZXBsYWNlKC9cIC9nLCAnJyk7CgkJCQkJCQlyZXR1cm4gdGhpcy5zbHVnOwoJCQkJCQl9CgkJCQkJfQoJCQkJfSwgewoJCQkJCWtleTogJ3JldHVybkxpbmsnLAoJCQkJCXZhbHVlOiBmdW5jdGlvbiByZXR1cm5MaW5rKCkgewoJCQkJCQlpZiAodGhpcy5saW5rICE9PSAnJykgewoJCQkJCQkJcmV0dXJuIHRoaXMubGluazsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXRoaXMubGluayA9ICcvJyArIHRoaXMucmV0dXJuU2x1ZygpOwoJCQkJCQkJcmV0dXJuIHRoaXMubGluazsKCQkJCQkJfQoJCQkJCX0KCQkJCX0sIHsKCQkJCQlrZXk6ICdoYW5kbGVVcmxQYXJhbXMnLAoJCQkJCXZhbHVlOiBmdW5jdGlvbiBoYW5kbGVVcmxQYXJhbXModXJsUGFyYW1zKSB7CgkJCQkJfQoJCQkJfSwgewoJCQkJCWtleTogJ3Nob3dBbGVydCcsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uIHNob3dBbGVydCgpIHsKCQkJCQkJdGhpcy5hbGVydHMrKzsKCQkJCQkJdHJ5IHsKCQkJCQkJCXZhciBxcyA9ICcjJyArIHRoaXMucmV0dXJuU2x1ZygpICsgJyA+IC5yZWRpY29uJzsKCQkJCQkJCWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocXMpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwoJCQkJCQl9IGNhdGNoIChlcnIpIHsKCQkJCQkJfQoJCQkJCX0KCQkJCX0sIHsKCQkJCQlrZXk6ICdhdHRhY2hNZXRhJywKCQkJCQl2YWx1ZTogZnVuY3Rpb24gYXR0YWNoTWV0YShhcHApIHsKCQkJCQl9CgkJCQl9LCB7CgkJCQkJa2V5OiAnYXR0YWNoU3R5bGVTaGVldHMnLAoJCQkJCXZhbHVlOiBmdW5jdGlvbiBhdHRhY2hTdHlsZVNoZWV0cygpIHsKCQkJCQkJdmFyIF90aGlzMiA9IHRoaXM7CgkJCQkJCWlmICh0aGlzLnN0eWxlc2hlZXRBZGRlZCA9PT0gdHJ1ZSkgcmV0dXJuOwoJCQkJCQl0aGlzLnN0eWxlcy5mb3JFYWNoKGZ1bmN0aW9uKHN0eWxlc2hlZXQpIHsKCQkJCQkJCXZhciBzaG91bGRfYXR0YWNoX3NoZWV0ID0gdHJ1ZTsKCQkJCQkJCWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpbmsnKS5mb3JFYWNoKGZ1bmN0aW9uKGVsKSB7CgkJCQkJCQkJdHJ5IHsKCQkJCQkJCQkJaWYgKChlbCA9PT0gbnVsbCB8fCBlbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZWwucmVsKSA9PT0gJ3N0eWxlc2hlZXQnICYmIGVsLmF0dHJpYnV0ZXMuaHJlZi5ub2RlVmFsdWUuaW5jbHVkZXMoc3R5bGVzaGVldCkpIHsKCQkJCQkJCQkJCXNob3VsZF9hdHRhY2hfc2hlZXQgPSBmYWxzZTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0gY2F0Y2ggKGVycikgewoJCQkJCQkJCX0KCQkJCQkJCX0pOwoJCQkJCQkJaWYgKHNob3VsZF9hdHRhY2hfc2hlZXQpIHsKCQkJCQkJCQl2YXIgcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpbmsnKTsKCQkJCQkJCQlzLnJlbCA9ICdzdHlsZXNoZWV0JzsKCQkJCQkJCQlzLnR5cGUgPSAndGV4dC9jc3MnOwoJCQkJCQkJCXMuaHJlZiA9IHN0eWxlc2hlZXQgKyAnP3Y9JyArIF90aGlzMi5hcHAuYnVpbGRfbnVtYmVyOwoJCQkJCQkJCWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2hlYWQnKS5hcHBlbmRDaGlsZChzKTsKCQkJCQkJCX0KCQkJCQkJfSk7CgkJCQkJCXRoaXMuc3R5bGVzaGVldEFkZGVkID0gdHJ1ZTsKCQkJCQl9CgkJCQl9LCB7CgkJCQkJa2V5OiAnYXR0YWNoU2NyaXB0cycsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uIGF0dGFjaFNjcmlwdHMoKSB7CgkJCQkJCXZhciBfdGhpczMgPSB0aGlzOwoJCQkJCQlpZiAodGhpcy5zY3JpcHRzQWRkZWQgPT09IHRydWUpIHsKCQkJCQkJCXJldHVybjsKCQkJCQkJfQoJCQkJCQl0aGlzLnNjcmlwdHNBZGRlZCA9IHRydWU7CgkJCQkJCXZhciBzY3JpcHRDb3VudCA9IDA7CgkJCQkJCXZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0aGlzLnNjcmlwdHMpLAoJCQkJCQkJX3N0ZXA7CgkJCQkJCXRyeSB7CgkJCQkJCQl2YXIgX2xvb3AyID0gZnVuY3Rpb24gX2xvb3AyKCkgewoJCQkJCQkJCXZhciBzY3JpcHQgPSBfc3RlcC52YWx1ZTsKCQkJCQkJCQl2YXIgc2NyaXB0X2F0dGFjaGVkID0gZmFsc2U7CgkJCQkJCQkJZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnc2NyaXB0JykuZm9yRWFjaChmdW5jdGlvbihlbCkgewoJCQkJCQkJCQl0cnkgewoJCQkJCQkJCQkJaWYgKGVsLmF0dHJpYnV0ZXMuc3JjLm5vZGVWYWx1ZSA9PT0gc2NyaXB0KSB7CgkJCQkJCQkJCQkJc2NyaXB0X2F0dGFjaGVkID0gdHJ1ZTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJfSBjYXRjaCAoZXJyKSB7CgkJCQkJCQkJCX0KCQkJCQkJCQl9KTsKCQkJCQkJCQlzY3JpcHRDb3VudCsrOwoJCQkJCQkJCWlmICghc2NyaXB0X2F0dGFjaGVkKSB7CgkJCQkJCQkJCV90aGlzMy5hdHRhY2hTY3JpcHQoc2NyaXB0KTsKCQkJCQkJCQl9CgkJCQkJCQl9OwoJCQkJCQkJZm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHsKCQkJCQkJCQlfbG9vcDIoKTsKCQkJCQkJCX0KCQkJCQkJfSBjYXRjaCAoZXJyKSB7CgkJCQkJCQlfaXRlcmF0b3IuZShlcnIpOwoJCQkJCQl9IGZpbmFsbHkgewoJCQkJCQkJX2l0ZXJhdG9yLmYoKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0sIHsKCQkJCQlrZXk6ICdhdHRhY2hTY3JpcHQnLAoJCQkJCXZhbHVlOiBmdW5jdGlvbiBhdHRhY2hTY3JpcHQoc2NyaXB0KSB7CgkJCQkJCXZhciBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CgkJCQkJCXMudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnOwoJCQkJCQlzLnNyYyA9IHNjcmlwdCArICc/dj0nICsgdGhpcy5hcHAuYnVpbGRfbnVtYmVyOwoJCQkJCQlkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdoZWFkJykuYXBwZW5kQ2hpbGQocyk7CgkJCQkJCXJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKCQkJCQkJCXMuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uKCkgewoJCQkJCQkJCWNvbnNvbGUubG9nKCdTY3JpcHQgbG9hZGVkIGR5bmFtaWNhbGx5Jyk7CgkJCQkJCQkJcmVzb2x2ZSgpOwoJCQkJCQkJfSk7CgkJCQkJCQlzLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZnVuY3Rpb24oKSB7CgkJCQkJCQkJY29uc29sZS5sb2coJ0Vycm9yIGxvYWRpbmcgc2NyaXB0Jyk7CgkJCQkJCQkJcmVqZWN0KCk7CgkJCQkJCQl9KTsKCQkJCQkJfSk7CgkJCQkJfQoJCQkJfSwgewoJCQkJCWtleTogJ2F0dGFjaFBvc3RTY3JpcHRzJywKCQkJCQl2YWx1ZTogZnVuY3Rpb24gYXR0YWNoUG9zdFNjcmlwdHMoKSB7CgkJCQkJCWlmICh0aGlzLnBvc3RTY3JpcHRzQWRkZWQgPT09IHRydWUpIHsKCQkJCQkJCXJldHVybjsKCQkJCQkJfQoJCQkJCQl0aGlzLnBvc3RTY3JpcHRzLmZvckVhY2goZnVuY3Rpb24oc2NyaXB0KSB7CgkJCQkJCQl2YXIgc2NyaXB0X2F0dGFjaGVkID0gZmFsc2U7CgkJCQkJCQlkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdzY3JpcHQnKS5mb3JFYWNoKGZ1bmN0aW9uKGVsKSB7CgkJCQkJCQkJdHJ5IHsKCQkJCQkJCQkJaWYgKGVsLmF0dHJpYnV0ZXMuc3JjLm5vZGVWYWx1ZSA9PT0gc2NyaXB0KSB7CgkJCQkJCQkJCQlzY3JpcHRfYXR0YWNoZWQgPSB0cnVlOwoJCQkJCQkJCQl9CgkJCQkJCQkJfSBjYXRjaCAoZXJyKSB7CgkJCQkJCQkJfQoJCQkJCQkJfSk7CgkJCQkJCQlpZiAoIXNjcmlwdF9hdHRhY2hlZCkgewoJCQkJCQkJCXZhciBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CgkJCQkJCQkJcy50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7CgkJCQkJCQkJcy5zcmMgPSBzY3JpcHQ7CgkJCQkJCQkJcy50eXBlID0gJ21vZHVsZSc7CgkJCQkJCQkJZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpLmFwcGVuZENoaWxkKHMpOwoJCQkJCQkJfQoJCQkJCQl9KTsKCQkJCQkJdGhpcy5wb3N0U2NyaXB0c0FkZGVkID0gdHJ1ZTsKCQkJCQl9CgkJCQl9LCB7CgkJCQkJa2V5OiAncmVtb3ZlU2NyaXB0cycsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZVNjcmlwdHMoKSB7CgkJCQkJCXRoaXMuc2NyaXB0cy5mb3JFYWNoKGZ1bmN0aW9uKHNjcmlwdCkgewoJCQkJCQkJY29uc29sZS5sb2coJ3JlbW92aW5nIHNjcmlwdCcsIHNjcmlwdCk7CgkJCQkJCQkvLyAkKGBzY3JpcHRbc3JjKj0iJHtzY3JpcHR9Il1gKS5yZW1vdmUoKTsKCQkJCQkJfSk7CgkJCQkJCXRoaXMuc2NyaXB0c0FkZGVkID0gZmFsc2U7CgkJCQkJfQoJCQkJfSwgewoJCQkJCWtleTogJ3JlbW92ZVN0eWxlU2hlZXRzJywKCQkJCQl2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlU3R5bGVTaGVldHMoYXBwKSB7CgkJCQkJCXRoaXMuc3R5bGVzaGVldHMuZm9yRWFjaChmdW5jdGlvbihzdHlsZXNoZWV0KSB7CgkJCQkJCQljb25zb2xlLmxvZygncmVtb3Zpbmcgc3R5bGVzaGVldCAnLCBzdHlsZXNoZWV0KTsKCQkJCQkJCS8vICQoYGxpbmtbcmVsPXN0eWxlc2hlZXRdW2hyZWZ+PSIke3N0eWxlc2hlZXR9ImApLnJlbW92ZSgpOwoJCQkJCQl9KTsKCQkJCQkJdGhpcy5zdHlsZXNoZWV0QWRkZWQgPSBmYWxzZTsKCQkJCQl9CgkJCQl9LCB7CgkJCQkJa2V5OiAncmVtb3ZlTWV0YScsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZU1ldGEoKSB7CgkJCQkJfQoJCQkJfSwgewoJCQkJCWtleTogJ3JlbW92ZUV2ZW50cycsCgkJCQkJdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUV2ZW50cygpIHsKCQkJCQkJdGhpcy5ldmVudExpc3RlbmVycy5mb3JFYWNoKGZ1bmN0aW9uKGV2ZW50TGlzdGVuZXIpIHsKCQkJCQkJCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnRMaXN0ZW5lci50eXBlLCBldmVudExpc3RlbmVyLmxpc3RlbmVyKTsKCQkJCQkJfSk7CgkJCQkJfQoJCQkJfSwgewoJCQkJCWtleTogJ2Rlc3Ryb3knLAoJCQkJCXZhbHVlOiBmdW5jdGlvbiBkZXN0cm95KGFwcCkgewoJCQkJCQljb25zb2xlLmxvZygnZGVzdHJveWluZycpOwoJCQkJCQkvLyB0aGlzLnJlbW92ZU1ldGEoKTsKCQkJCQkJLy8gdGhpcy5yZW1vdmVTdHlsZVNoZWV0cygpOwoJCQkJCQkvLyB0aGlzLnJlbW92ZUhUTUwoKTsKCQkJCQkJLy8gdGhpcy5yZW1vdmVTY3JpcHRzKCk7CgkJCQkJCS8vIHRoaXMucmVtb3ZlRXZlbnRzKCk7CgkJCQkJCS8vIHRoaXMuc3R5bGVzaGVldHMgPSBudWxsOwoJCQkJCQkvLyB0aGlzLnN0eWxlc2hlZXRBZGRlZCA9IGZhbHNlOwoJCQkJCQkvLyB0aGlzLnNjcmlwdHNBZGRlZCA9IGZhbHNlOwoJCQkJCQkvLyB0aGlzLmJyb3dzZXJfYWN0aXZlID0gMDsKCQkJCQl9CgkJCQl9LCB7CgkJCQkJa2V5OiAnZGlzcGxheU1vZGFsJywKCQkJCQl2YWx1ZTogZnVuY3Rpb24gZGlzcGxheU1vZGFsKG1vZGFsSGVhZGVyVGV4dCkgewoJCQkJCQl2YXIgbW9kYWxCb2R5VGV4dCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogJyc7CgkJCQkJCS8vc2FsZXJ0IGlzIG5vdCBhc3luYyEKCQkJCQkJc2FsZXJ0KCcnLmNvbmNhdChtb2RhbEhlYWRlclRleHQpLmNvbmNhdChtb2RhbEJvZHlUZXh0ID8gJzogPGJyPicgOiAnJykuY29uY2F0KG1vZGFsQm9keVRleHQpKTsKCQkJCQl9CgkJCQl9LCB7CgkJCQkJa2V5OiAnZGlzcGxheVdhcm5pbmcnLAoJCQkJCXZhbHVlOiBmdW5jdGlvbiBkaXNwbGF5V2FybmluZyh3YXJuaW5nVGl0bGUpIHsKCQkJCQkJdmFyIHdhcm5pbmdUZXh0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAnJzsKCQkJCQkJdmFyIHRpbWUgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IDQwMDA7CgkJCQkJCXZhciBodG1sID0gJzxkaXYgY2xhc3M9ImdhbWVfd2FybmluZ19vdmVybGF5Ij5cbiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImdhbWVfd2FybmluZ19oZWFkZXIiPlxuICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLXRyaWFuZ2xlIj48L2k+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImdhbWVfd2FybmluZ190aW1lciIgPkF1dG8gY2xvc2UgaW4gPHNwYW4gaWQ9ImNsb2NrX251bWJlciI+Jy5jb25jYXQoTWF0aC5jZWlsKHRpbWUgLyAxMDAwKSwgJzwvc3Bhbj5zPC9kaXY+IFxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICA8aDI+JykuY29uY2F0KHdhcm5pbmdUaXRsZSwgJzwvaDI+XG4gICAgICAgICAgICAgICAgICA8cCAnKS5jb25jYXQod2FybmluZ1RleHQubGVuZ3RoID09IDAgPyAnc3R5bGU9XCdmbGV4OjE7XCcnIDogJ3N0eWxlPVwnZmxleDoyO1wnJywgJz4nKS5jb25jYXQod2FybmluZ1RleHQsICc8L3A+XG4gICAgICAgICAgICAgICAgPC9kaXY+Jyk7CgkJCQkJCXZhciBvdmVybGF5X3NlbGYgPSB0aGlzLm92ZXJsYXk7CgkJCQkJCXZhciB0aW1lb3V0aGFzaCA9IG51bGwsCgkJCQkJCQlpbnRlcnZhbEhhc2ggPSBudWxsOwoJCQkJCQlpZiAodGltZSA+IDApIHsKCQkJCQkJCXRpbWVvdXRoYXNoID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKCQkJCQkJCQlvdmVybGF5X3NlbGYuaGlkZSgpOwoJCQkJCQkJCWNsZWFySW50ZXJ2YWwoaW50ZXJ2YWxIYXNoKTsKCQkJCQkJCX0sIHRpbWUpOwoJCQkJCQkJaW50ZXJ2YWxIYXNoID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CgkJCQkJCQkJdGltZSAtPSAyNTA7CgkJCQkJCQkJdHJ5IHsKCQkJCQkJCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb2NrX251bWJlcicpLmlubmVySFRNTCA9IE1hdGguY2VpbCh0aW1lIC8gMTAwMCk7CgkJCQkJCQkJfSBjYXRjaCAoZXJyKSB7CgkJCQkJCQkJfQoJCQkJCQkJfSwgMjUwKTsKCQkJCQkJfQoJCQkJCQl0aGlzLm92ZXJsYXkuc2hvdyhodG1sLCBmdW5jdGlvbigpIHsKCQkJCQkJCWlmICh0aW1lb3V0aGFzaCkgewoJCQkJCQkJCWNsZWFyVGltZW91dCh0aW1lb3V0aGFzaCk7CgkJCQkJCQl9CgkJCQkJCQlpZiAoaW50ZXJ2YWxIYXNoKSB7CgkJCQkJCQkJY2xlYXJJbnRlcnZhbChpbnRlcnZhbEhhc2gpOwoJCQkJCQkJfQoJCQkJCQl9KTsKCQkJCQl9CgkJCQl9LCB7CgkJCQkJa2V5OiAnb25VcGdyYWRlJywKCQkJCQl2YWx1ZTogZnVuY3Rpb24oKSB7CgkJCQkJCXZhciBfb25VcGdyYWRlID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTUoKSB7CgkJCQkJCQl2YXIgdHlwZSwKCQkJCQkJCQlwcml2YXRla2V5LAoJCQkJCQkJCXdhbGxldGZpbGUsCgkJCQkJCQkJX2FyZ3MxNiA9IGFyZ3VtZW50czsKCQkJCQkJCXJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTUkKF9jb250ZXh0MTYpIHsKCQkJCQkJCQl3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDE2LnByZXYgPSBfY29udGV4dDE2Lm5leHQpIHsKCQkJCQkJCQkJY2FzZSAwOgoJCQkJCQkJCQkJdHlwZSA9IF9hcmdzMTYubGVuZ3RoID4gMCAmJiBfYXJnczE2WzBdICE9PSB1bmRlZmluZWQgPyBfYXJnczE2WzBdIDogJyc7CgkJCQkJCQkJCQlwcml2YXRla2V5ID0gX2FyZ3MxNi5sZW5ndGggPiAxICYmIF9hcmdzMTZbMV0gIT09IHVuZGVmaW5lZCA/IF9hcmdzMTZbMV0gOiAnJzsKCQkJCQkJCQkJCXdhbGxldGZpbGUgPSBfYXJnczE2Lmxlbmd0aCA+IDIgJiYgX2FyZ3MxNlsyXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3MxNlsyXSA6IG51bGw7CgkJCQkJCQkJCQljb25zb2xlLmxvZygnb25VcGdyYWRlIGluc2lkZSBNb2RUZW1wbGF0ZS4uLicpOwoJCQkJCQkJCQljYXNlIDQ6CgkJCQkJCQkJCWNhc2UgJ2VuZCc6CgkJCQkJCQkJCQlyZXR1cm4gX2NvbnRleHQxNi5zdG9wKCk7CgkJCQkJCQkJfQoJCQkJCQkJfSwgX2NhbGxlZTE1KTsKCQkJCQkJfSkpOwoKCQkJCQkJZnVuY3Rpb24gb25VcGdyYWRlKCkgewoJCQkJCQkJcmV0dXJuIF9vblVwZ3JhZGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQkJCQkJfQoKCQkJCQkJcmV0dXJuIG9uVXBncmFkZTsKCQkJCQl9KCkKCQkJCX0sIHsKCQkJCQlrZXk6ICdoYXNTZWVuVHJhbnNhY3Rpb24nLAoJCQkJCXZhbHVlOiBmdW5jdGlvbiBoYXNTZWVuVHJhbnNhY3Rpb24odHgpIHsKCQkJCQkJdmFyIGhhc2hlZF9kYXRhID0gdGhpcy5uYW1lICsgdHguc2lnbmF0dXJlOwoJCQkJCQlpZiAodGhpcy5wcm9jZXNzZWRUeHNbaGFzaGVkX2RhdGFdKSB7CgkJCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCQkJfQoJCQkJCQl0aGlzLnByb2Nlc3NlZFR4c1toYXNoZWRfZGF0YV0gPSB0cnVlOwoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJfV0sIFt7CgkJCQkJa2V5OiAnaW1wb3J0RnVuY3Rpb25zJywKCQkJCQl2YWx1ZTogZnVuY3Rpb24gaW1wb3J0RnVuY3Rpb25zKCkgewoJCQkJCQl2YXIgY2xzID0gdGhpcy5wcm90b3R5cGU7CgkJCQkJCXZhciBtaXhpbjsKCQkJCQkJZm9yICh2YXIgYXJnID0gMDsgYXJnIDwgYXJndW1lbnRzLmxlbmd0aDsgYXJnKyspIHsKCQkJCQkJCW1peGluID0gYXJndW1lbnRzW2FyZ10ucHJvdG90eXBlOwoJCQkJCQkJaWYgKHR5cGVvZiBtaXhpbiAhPSAndW5kZWZpbmVkJykgewoJCQkJCQkJCU9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKG1peGluKS5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHsKCQkJCQkJCQkJaWYgKHByb3AgPT0gJ2NvbnN0cnVjdG9yJykgcmV0dXJuOwoJCQkJCQkJCQlpZiAoT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoY2xzKS5pbmNsdWRlcyhwcm9wKSkgewoJCQkJCQkJCQkJY29uc29sZS5lcnJvcignTW9kdWxlIGFscmVhZHkgaW5jbHVkZXMgJyArIHByb3ApOwoJCQkJCQkJCQkJcmV0dXJuOwoJCQkJCQkJCQl9CgkJCQkJCQkJCWNsc1twcm9wXSA9IG1peGluW3Byb3BdOwoJCQkJCQkJCX0pOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfV0pOwoJCQkJcmV0dXJuIE1vZFRlbXBsYXRlOwoJCQl9KCk7CgkJCW1vZHVsZS5leHBvcnRzID0gTW9kVGVtcGxhdGU7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA4MjUyOgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCWZ1bmN0aW9uIF90eXBlb2YobykgewoJCQkJJ0BiYWJlbC9oZWxwZXJzIC0gdHlwZW9mJzsKCQkJCXJldHVybiBfdHlwZW9mID0gJ2Z1bmN0aW9uJyA9PSB0eXBlb2YgU3ltYm9sICYmICdzeW1ib2wnID09IHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPyBmdW5jdGlvbihvKSB7CgkJCQkJcmV0dXJuIHR5cGVvZiBvOwoJCQkJfSA6IGZ1bmN0aW9uKG8pIHsKCQkJCQlyZXR1cm4gbyAmJiAnZnVuY3Rpb24nID09IHR5cGVvZiBTeW1ib2wgJiYgby5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG8gIT09IFN5bWJvbC5wcm90b3R5cGUgPyAnc3ltYm9sJyA6IHR5cGVvZiBvOwoJCQkJfSwgX3R5cGVvZihvKTsKCQkJfQoKCQkJZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgewoJCQkJaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsKCQkJCQl0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsKCQkJCX0KCQkJfQoKCQkJZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgewoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewoJCQkJCXZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CgkJCQkJZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwoJCQkJCWRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKCQkJCQlpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKCQkJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBfdG9Qcm9wZXJ0eUtleShkZXNjcmlwdG9yLmtleSksIGRlc2NyaXB0b3IpOwoJCQkJfQoJCQl9CgoJCQlmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7CgkJCQlpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKCQkJCWlmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsKCQkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvciwgJ3Byb3RvdHlwZScsIHsgd3JpdGFibGU6IGZhbHNlIH0pOwoJCQkJcmV0dXJuIENvbnN0cnVjdG9yOwoJCQl9CgoJCQlmdW5jdGlvbiBfdG9Qcm9wZXJ0eUtleSh0KSB7CgkJCQl2YXIgaSA9IF90b1ByaW1pdGl2ZSh0LCAnc3RyaW5nJyk7CgkJCQlyZXR1cm4gJ3N5bWJvbCcgPT0gX3R5cGVvZihpKSA/IGkgOiBTdHJpbmcoaSk7CgkJCX0KCgkJCWZ1bmN0aW9uIF90b1ByaW1pdGl2ZSh0LCByKSB7CgkJCQlpZiAoJ29iamVjdCcgIT0gX3R5cGVvZih0KSB8fCAhdCkgcmV0dXJuIHQ7CgkJCQl2YXIgZSA9IHRbU3ltYm9sLnRvUHJpbWl0aXZlXTsKCQkJCWlmICh2b2lkIDAgIT09IGUpIHsKCQkJCQl2YXIgaSA9IGUuY2FsbCh0LCByIHx8ICdkZWZhdWx0Jyk7CgkJCQkJaWYgKCdvYmplY3QnICE9IF90eXBlb2YoaSkpIHJldHVybiBpOwoJCQkJCXRocm93IG5ldyBUeXBlRXJyb3IoJ0BAdG9QcmltaXRpdmUgbXVzdCByZXR1cm4gYSBwcmltaXRpdmUgdmFsdWUuJyk7CgkJCQl9CgkJCQlyZXR1cm4gKCdzdHJpbmcnID09PSByID8gU3RyaW5nIDogTnVtYmVyKSh0KTsKCQkJfQoKCQkJZnVuY3Rpb24gX2dldCgpIHsKCQkJCWlmICh0eXBlb2YgUmVmbGVjdCAhPT0gJ3VuZGVmaW5lZCcgJiYgUmVmbGVjdC5nZXQpIHsKCQkJCQlfZ2V0ID0gUmVmbGVjdC5nZXQuYmluZCgpOwoJCQkJfSBlbHNlIHsKCQkJCQlfZ2V0ID0gZnVuY3Rpb24gX2dldCh0YXJnZXQsIHByb3BlcnR5LCByZWNlaXZlcikgewoJCQkJCQl2YXIgYmFzZSA9IF9zdXBlclByb3BCYXNlKHRhcmdldCwgcHJvcGVydHkpOwoJCQkJCQlpZiAoIWJhc2UpIHJldHVybjsKCQkJCQkJdmFyIGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGJhc2UsIHByb3BlcnR5KTsKCQkJCQkJaWYgKGRlc2MuZ2V0KSB7CgkJCQkJCQlyZXR1cm4gZGVzYy5nZXQuY2FsbChhcmd1bWVudHMubGVuZ3RoIDwgMyA/IHRhcmdldCA6IHJlY2VpdmVyKTsKCQkJCQkJfQoJCQkJCQlyZXR1cm4gZGVzYy52YWx1ZTsKCQkJCQl9OwoJCQkJfQoJCQkJcmV0dXJuIF9nZXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKCQkJfQoKCQkJZnVuY3Rpb24gX3N1cGVyUHJvcEJhc2Uob2JqZWN0LCBwcm9wZXJ0eSkgewoJCQkJd2hpbGUgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSkpIHsKCQkJCQlvYmplY3QgPSBfZ2V0UHJvdG90eXBlT2Yob2JqZWN0KTsKCQkJCQlpZiAob2JqZWN0ID09PSBudWxsKSBicmVhazsKCQkJCX0KCQkJCXJldHVybiBvYmplY3Q7CgkJCX0KCgkJCWZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykgewoJCQkJaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAnZnVuY3Rpb24nICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsKCQkJCQl0aHJvdyBuZXcgVHlwZUVycm9yKCdTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbicpOwoJCQkJfQoJCQkJc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7CgkJCQkJY29uc3RydWN0b3I6IHsKCQkJCQkJdmFsdWU6IHN1YkNsYXNzLAoJCQkJCQl3cml0YWJsZTogdHJ1ZSwKCQkJCQkJY29uZmlndXJhYmxlOiB0cnVlCgkJCQkJfQoJCQkJfSk7CgkJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoc3ViQ2xhc3MsICdwcm90b3R5cGUnLCB7IHdyaXRhYmxlOiBmYWxzZSB9KTsKCQkJCWlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOwoJCQl9CgoJCQlmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgewoJCQkJX3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mLmJpbmQoKSA6IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7CgkJCQkJby5fX3Byb3RvX18gPSBwOwoJCQkJCXJldHVybiBvOwoJCQkJfTsKCQkJCXJldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7CgkJCX0KCgkJCWZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7CgkJCQl2YXIgaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCA9IF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKTsKCQkJCXJldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHsKCQkJCQl2YXIgU3VwZXIgPSBfZ2V0UHJvdG90eXBlT2YoRGVyaXZlZCksIHJlc3VsdDsKCQkJCQlpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkgewoJCQkJCQl2YXIgTmV3VGFyZ2V0ID0gX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yOwoJCQkJCQlyZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXJlc3VsdCA9IFN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQkJfQoJCQkJCXJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCByZXN1bHQpOwoJCQkJfTsKCQkJfQoKCQkJZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgewoJCQkJaWYgKGNhbGwgJiYgKF90eXBlb2YoY2FsbCkgPT09ICdvYmplY3QnIHx8IHR5cGVvZiBjYWxsID09PSAnZnVuY3Rpb24nKSkgewoJCQkJCXJldHVybiBjYWxsOwoJCQkJfSBlbHNlIGlmIChjYWxsICE9PSB2b2lkIDApIHsKCQkJCQl0aHJvdyBuZXcgVHlwZUVycm9yKCdEZXJpdmVkIGNvbnN0cnVjdG9ycyBtYXkgb25seSByZXR1cm4gb2JqZWN0IG9yIHVuZGVmaW5lZCcpOwoJCQkJfQoJCQkJcmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7CgkJCX0KCgkJCWZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikgewoJCQkJaWYgKHNlbGYgPT09IHZvaWQgMCkgewoJCQkJCXRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigndGhpcyBoYXNuXCd0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc25cJ3QgYmVlbiBjYWxsZWQnKTsKCQkJCX0KCQkJCXJldHVybiBzZWxmOwoJCQl9CgoJCQlmdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkgewoJCQkJaWYgKHR5cGVvZiBSZWZsZWN0ID09PSAndW5kZWZpbmVkJyB8fCAhUmVmbGVjdC5jb25zdHJ1Y3QpIHJldHVybiBmYWxzZTsKCQkJCWlmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7CgkJCQlpZiAodHlwZW9mIFByb3h5ID09PSAnZnVuY3Rpb24nKSByZXR1cm4gdHJ1ZTsKCQkJCXRyeSB7CgkJCQkJQm9vbGVhbi5wcm90b3R5cGUudmFsdWVPZi5jYWxsKFJlZmxlY3QuY29uc3RydWN0KEJvb2xlYW4sIFtdLCBmdW5jdGlvbigpIHsKCQkJCQl9KSk7CgkJCQkJcmV0dXJuIHRydWU7CgkJCQl9IGNhdGNoIChlKSB7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9CgoJCQlmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgewoJCQkJX2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mLmJpbmQoKSA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7CgkJCQkJcmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTsKCQkJCX07CgkJCQlyZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOwoJCQl9CgoJCQl2YXIgTW9kVGVtcGxhdGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI2MDEpOwoJCQl2YXIgRHluID0gLyojX19QVVJFX18qL2Z1bmN0aW9uKF9Nb2RUZW1wbGF0ZSkgewoJCQkJX2luaGVyaXRzKER5biwgX01vZFRlbXBsYXRlKTsKCQkJCXZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIoRHluKTsKCgkJCQlmdW5jdGlvbiBEeW4oYXBwKSB7CgkJCQkJdmFyIF90aGlzOwoJCQkJCV9jbGFzc0NhbGxDaGVjayh0aGlzLCBEeW4pOwoJCQkJCV90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgYXBwKTsKCQkJCQljb25zb2xlLmxvZygnZHluIG1vZHVsZSBsb2FkZWQnKTsKCQkJCQlfdGhpcy5uYW1lID0gJ0R5bic7CgkJCQkJcmV0dXJuIF90aGlzOwoJCQkJfQoKCQkJCV9jcmVhdGVDbGFzcyhEeW4sIFt7CgkJCQkJa2V5OiAncmVzcG9uZFRvJywKCQkJCQl2YWx1ZTogZnVuY3Rpb24gcmVzcG9uZFRvKCkgewoJCQkJCQl2YXIgcmVxdWVzdF90eXBlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAnJzsKCQkJCQkJdmFyIG9iaiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkOwoJCQkJCQljb25zb2xlLmxvZygnZHluIHJlc3BvbmRpbmcgdG8gJyArIHJlcXVlc3RfdHlwZSk7CgkJCQkJCXJldHVybiBfZ2V0KF9nZXRQcm90b3R5cGVPZihEeW4ucHJvdG90eXBlKSwgJ3Jlc3BvbmRUbycsIHRoaXMpLmNhbGwodGhpcywgcmVxdWVzdF90eXBlLCBvYmopOwoJCQkJCX0KCQkJCX1dKTsKCQkJCXJldHVybiBEeW47CgkJCX0oTW9kVGVtcGxhdGUpOwoJCQltb2R1bGUuZXhwb3J0cyA9IER5bjsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDU5NzoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDU0NDkpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDY1NDYpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDI3NDEpOwoJCQlpZiAoX193ZWJwYWNrX3JlcXVpcmVfXy5nLl9iYWJlbFBvbHlmaWxsKSB7CgkJCQl0aHJvdyBuZXcgRXJyb3IoJ29ubHkgb25lIGluc3RhbmNlIG9mIGJhYmVsLXBvbHlmaWxsIGlzIGFsbG93ZWQnKTsKCQkJfQoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fLmcuX2JhYmVsUG9seWZpbGwgPSB0cnVlOwoJCQl2YXIgREVGSU5FX1BST1BFUlRZID0gJ2RlZmluZVByb3BlcnR5JzsKCgkJCWZ1bmN0aW9uIGRlZmluZShPLCBrZXksIHZhbHVlKSB7CgkJCQlPW2tleV0gfHwgT2JqZWN0W0RFRklORV9QUk9QRVJUWV0oTywga2V5LCB7CgkJCQkJd3JpdGFibGU6IHRydWUsCgkJCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCQkJCXZhbHVlOiB2YWx1ZQoJCQkJfSk7CgkJCX0KCgkJCWRlZmluZShTdHJpbmcucHJvdG90eXBlLCAncGFkTGVmdCcsICcnLnBhZFN0YXJ0KTsKCQkJZGVmaW5lKFN0cmluZy5wcm90b3R5cGUsICdwYWRSaWdodCcsICcnLnBhZEVuZCk7CgkJCSdwb3AscmV2ZXJzZSxzaGlmdCxrZXlzLHZhbHVlcyxlbnRyaWVzLGluZGV4T2YsZXZlcnksc29tZSxmb3JFYWNoLG1hcCxmaWx0ZXIsZmluZCxmaW5kSW5kZXgsaW5jbHVkZXMsam9pbixzbGljZSxjb25jYXQscHVzaCxzcGxpY2UsdW5zaGlmdCxzb3J0LGxhc3RJbmRleE9mLHJlZHVjZSxyZWR1Y2VSaWdodCxjb3B5V2l0aGluLGZpbGwnLnNwbGl0KCcsJykuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKCQkJCVtdW2tleV0gJiYgZGVmaW5lKEFycmF5LCBrZXksIEZ1bmN0aW9uLmNhbGwuYmluZChbXVtrZXldKSk7CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNjU0NjoKCQkvKioqLyAoZnVuY3Rpb24obW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCgkJCS8qIG1vZHVsZSBkZWNvcmF0b3IgKi8KCQkJbW9kdWxlID0gX193ZWJwYWNrX3JlcXVpcmVfXy5ubWQobW9kdWxlKTsKCgkJCWZ1bmN0aW9uIF90eXBlb2YobykgewoJCQkJJ0BiYWJlbC9oZWxwZXJzIC0gdHlwZW9mJzsKCQkJCXJldHVybiBfdHlwZW9mID0gJ2Z1bmN0aW9uJyA9PSB0eXBlb2YgU3ltYm9sICYmICdzeW1ib2wnID09IHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPyBmdW5jdGlvbihvKSB7CgkJCQkJcmV0dXJuIHR5cGVvZiBvOwoJCQkJfSA6IGZ1bmN0aW9uKG8pIHsKCQkJCQlyZXR1cm4gbyAmJiAnZnVuY3Rpb24nID09IHR5cGVvZiBTeW1ib2wgJiYgby5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG8gIT09IFN5bWJvbC5wcm90b3R5cGUgPyAnc3ltYm9sJyA6IHR5cGVvZiBvOwoJCQkJfSwgX3R5cGVvZihvKTsKCQkJfQoKCQkJLyoqCgkJCSAqIENvcHlyaWdodCAoYykgMjAxNCwgRmFjZWJvb2ssIEluYy4KCQkJICogQWxsIHJpZ2h0cyByZXNlcnZlZC4KCQkJICoKCQkJICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlCgkJCSAqIGh0dHBzOi8vcmF3LmdpdGh1Yi5jb20vZmFjZWJvb2svcmVnZW5lcmF0b3IvbWFzdGVyL0xJQ0VOU0UgZmlsZS4gQW4KCQkJICogYWRkaXRpb25hbCBncmFudCBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluCgkJCSAqIHRoZSBzYW1lIGRpcmVjdG9yeS4KCQkJICovCgoJCQkhZnVuY3Rpb24oZ2xvYmFsKSB7CgkJCQkndXNlIHN0cmljdCc7CgoJCQkJdmFyIE9wID0gT2JqZWN0LnByb3RvdHlwZTsKCQkJCXZhciBoYXNPd24gPSBPcC5oYXNPd25Qcm9wZXJ0eTsKCQkJCXZhciB1bmRlZmluZWQ7IC8vIE1vcmUgY29tcHJlc3NpYmxlIHRoYW4gdm9pZCAwLgoJCQkJdmFyICRTeW1ib2wgPSB0eXBlb2YgU3ltYm9sID09PSAnZnVuY3Rpb24nID8gU3ltYm9sIDoge307CgkJCQl2YXIgaXRlcmF0b3JTeW1ib2wgPSAkU3ltYm9sLml0ZXJhdG9yIHx8ICdAQGl0ZXJhdG9yJzsKCQkJCXZhciBhc3luY0l0ZXJhdG9yU3ltYm9sID0gJFN5bWJvbC5hc3luY0l0ZXJhdG9yIHx8ICdAQGFzeW5jSXRlcmF0b3InOwoJCQkJdmFyIHRvU3RyaW5nVGFnU3ltYm9sID0gJFN5bWJvbC50b1N0cmluZ1RhZyB8fCAnQEB0b1N0cmluZ1RhZyc7CgkJCQl2YXIgaW5Nb2R1bGUgPSAoZmFsc2UgPyAwIDogX3R5cGVvZihtb2R1bGUpKSA9PT0gJ29iamVjdCc7CgkJCQl2YXIgcnVudGltZSA9IGdsb2JhbC5yZWdlbmVyYXRvclJ1bnRpbWU7CgkJCQlpZiAocnVudGltZSkgewoJCQkJCWlmIChpbk1vZHVsZSkgewoJCQkJCQkvLyBJZiByZWdlbmVyYXRvclJ1bnRpbWUgaXMgZGVmaW5lZCBnbG9iYWxseSBhbmQgd2UncmUgaW4gYSBtb2R1bGUsCgkJCQkJCS8vIG1ha2UgdGhlIGV4cG9ydHMgb2JqZWN0IGlkZW50aWNhbCB0byByZWdlbmVyYXRvclJ1bnRpbWUuCgkJCQkJCW1vZHVsZS5leHBvcnRzID0gcnVudGltZTsKCQkJCQl9CgkJCQkJLy8gRG9uJ3QgYm90aGVyIGV2YWx1YXRpbmcgdGhlIHJlc3Qgb2YgdGhpcyBmaWxlIGlmIHRoZSBydW50aW1lIHdhcwoJCQkJCS8vIGFscmVhZHkgZGVmaW5lZCBnbG9iYWxseS4KCQkJCQlyZXR1cm47CgkJCQl9CgoJCQkJLy8gRGVmaW5lIHRoZSBydW50aW1lIGdsb2JhbGx5IChhcyBleHBlY3RlZCBieSBnZW5lcmF0ZWQgY29kZSkgYXMgZWl0aGVyCgkJCQkvLyBtb2R1bGUuZXhwb3J0cyAoaWYgd2UncmUgaW4gYSBtb2R1bGUpIG9yIGEgbmV3LCBlbXB0eSBvYmplY3QuCgkJCQlydW50aW1lID0gZ2xvYmFsLnJlZ2VuZXJhdG9yUnVudGltZSA9IGluTW9kdWxlID8gbW9kdWxlLmV4cG9ydHMgOiB7fTsKCgkJCQlmdW5jdGlvbiB3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSB7CgkJCQkJLy8gSWYgb3V0ZXJGbiBwcm92aWRlZCBhbmQgb3V0ZXJGbi5wcm90b3R5cGUgaXMgYSBHZW5lcmF0b3IsIHRoZW4gb3V0ZXJGbi5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IuCgkJCQkJdmFyIHByb3RvR2VuZXJhdG9yID0gb3V0ZXJGbiAmJiBvdXRlckZuLnByb3RvdHlwZSBpbnN0YW5jZW9mIEdlbmVyYXRvciA/IG91dGVyRm4gOiBHZW5lcmF0b3I7CgkJCQkJdmFyIGdlbmVyYXRvciA9IE9iamVjdC5jcmVhdGUocHJvdG9HZW5lcmF0b3IucHJvdG90eXBlKTsKCQkJCQl2YXIgY29udGV4dCA9IG5ldyBDb250ZXh0KHRyeUxvY3NMaXN0IHx8IFtdKTsKCgkJCQkJLy8gVGhlIC5faW52b2tlIG1ldGhvZCB1bmlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbnMgb2YgdGhlIC5uZXh0LAoJCQkJCS8vIC50aHJvdywgYW5kIC5yZXR1cm4gbWV0aG9kcy4KCQkJCQlnZW5lcmF0b3IuX2ludm9rZSA9IG1ha2VJbnZva2VNZXRob2QoaW5uZXJGbiwgc2VsZiwgY29udGV4dCk7CgkJCQkJcmV0dXJuIGdlbmVyYXRvcjsKCQkJCX0KCgkJCQlydW50aW1lLndyYXAgPSB3cmFwOwoKCQkJCS8vIFRyeS9jYXRjaCBoZWxwZXIgdG8gbWluaW1pemUgZGVvcHRpbWl6YXRpb25zLiBSZXR1cm5zIGEgY29tcGxldGlvbgoJCQkJLy8gcmVjb3JkIGxpa2UgY29udGV4dC50cnlFbnRyaWVzW2ldLmNvbXBsZXRpb24uIFRoaXMgaW50ZXJmYWNlIGNvdWxkCgkJCQkvLyBoYXZlIGJlZW4gKGFuZCB3YXMgcHJldmlvdXNseSkgZGVzaWduZWQgdG8gdGFrZSBhIGNsb3N1cmUgdG8gYmUKCQkJCS8vIGludm9rZWQgd2l0aG91dCBhcmd1bWVudHMsIGJ1dCBpbiBhbGwgdGhlIGNhc2VzIHdlIGNhcmUgYWJvdXQgd2UKCQkJCS8vIGFscmVhZHkgaGF2ZSBhbiBleGlzdGluZyBtZXRob2Qgd2Ugd2FudCB0byBjYWxsLCBzbyB0aGVyZSdzIG5vIG5lZWQKCQkJCS8vIHRvIGNyZWF0ZSBhIG5ldyBmdW5jdGlvbiBvYmplY3QuIFdlIGNhbiBldmVuIGdldCBhd2F5IHdpdGggYXNzdW1pbmcKCQkJCS8vIHRoZSBtZXRob2QgdGFrZXMgZXhhY3RseSBvbmUgYXJndW1lbnQsIHNpbmNlIHRoYXQgaGFwcGVucyB0byBiZSB0cnVlCgkJCQkvLyBpbiBldmVyeSBjYXNlLCBzbyB3ZSBkb24ndCBoYXZlIHRvIHRvdWNoIHRoZSBhcmd1bWVudHMgb2JqZWN0LiBUaGUKCQkJCS8vIG9ubHkgYWRkaXRpb25hbCBhbGxvY2F0aW9uIHJlcXVpcmVkIGlzIHRoZSBjb21wbGV0aW9uIHJlY29yZCwgd2hpY2gKCQkJCS8vIGhhcyBhIHN0YWJsZSBzaGFwZSBhbmQgc28gaG9wZWZ1bGx5IHNob3VsZCBiZSBjaGVhcCB0byBhbGxvY2F0ZS4KCQkJCWZ1bmN0aW9uIHRyeUNhdGNoKGZuLCBvYmosIGFyZykgewoJCQkJCXRyeSB7CgkJCQkJCXJldHVybiB7CgkJCQkJCQl0eXBlOiAnbm9ybWFsJywKCQkJCQkJCWFyZzogZm4uY2FsbChvYmosIGFyZykKCQkJCQkJfTsKCQkJCQl9IGNhdGNoIChlcnIpIHsKCQkJCQkJcmV0dXJuIHsKCQkJCQkJCXR5cGU6ICd0aHJvdycsCgkJCQkJCQlhcmc6IGVycgoJCQkJCQl9OwoJCQkJCX0KCQkJCX0KCgkJCQl2YXIgR2VuU3RhdGVTdXNwZW5kZWRTdGFydCA9ICdzdXNwZW5kZWRTdGFydCc7CgkJCQl2YXIgR2VuU3RhdGVTdXNwZW5kZWRZaWVsZCA9ICdzdXNwZW5kZWRZaWVsZCc7CgkJCQl2YXIgR2VuU3RhdGVFeGVjdXRpbmcgPSAnZXhlY3V0aW5nJzsKCQkJCXZhciBHZW5TdGF0ZUNvbXBsZXRlZCA9ICdjb21wbGV0ZWQnOwoKCQkJCS8vIFJldHVybmluZyB0aGlzIG9iamVjdCBmcm9tIHRoZSBpbm5lckZuIGhhcyB0aGUgc2FtZSBlZmZlY3QgYXMKCQkJCS8vIGJyZWFraW5nIG91dCBvZiB0aGUgZGlzcGF0Y2ggc3dpdGNoIHN0YXRlbWVudC4KCQkJCXZhciBDb250aW51ZVNlbnRpbmVsID0ge307CgoJCQkJLy8gRHVtbXkgY29uc3RydWN0b3IgZnVuY3Rpb25zIHRoYXQgd2UgdXNlIGFzIHRoZSAuY29uc3RydWN0b3IgYW5kCgkJCQkvLyAuY29uc3RydWN0b3IucHJvdG90eXBlIHByb3BlcnRpZXMgZm9yIGZ1bmN0aW9ucyB0aGF0IHJldHVybiBHZW5lcmF0b3IKCQkJCS8vIG9iamVjdHMuIEZvciBmdWxsIHNwZWMgY29tcGxpYW5jZSwgeW91IG1heSB3aXNoIHRvIGNvbmZpZ3VyZSB5b3VyCgkJCQkvLyBtaW5pZmllciBub3QgdG8gbWFuZ2xlIHRoZSBuYW1lcyBvZiB0aGVzZSB0d28gZnVuY3Rpb25zLgoJCQkJZnVuY3Rpb24gR2VuZXJhdG9yKCkgewoJCQkJfQoKCQkJCWZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uKCkgewoJCQkJfQoKCQkJCWZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkgewoJCQkJfQoKCQkJCS8vIFRoaXMgaXMgYSBwb2x5ZmlsbCBmb3IgJUl0ZXJhdG9yUHJvdG90eXBlJSBmb3IgZW52aXJvbm1lbnRzIHRoYXQKCQkJCS8vIGRvbid0IG5hdGl2ZWx5IHN1cHBvcnQgaXQuCgkJCQl2YXIgSXRlcmF0b3JQcm90b3R5cGUgPSB7fTsKCQkJCUl0ZXJhdG9yUHJvdG90eXBlW2l0ZXJhdG9yU3ltYm9sXSA9IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiB0aGlzOwoJCQkJfTsKCQkJCXZhciBnZXRQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZjsKCQkJCXZhciBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvICYmIGdldFByb3RvKGdldFByb3RvKHZhbHVlcyhbXSkpKTsKCQkJCWlmIChOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAmJiBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAhPT0gT3AgJiYgaGFzT3duLmNhbGwoTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUsIGl0ZXJhdG9yU3ltYm9sKSkgewoJCQkJCS8vIFRoaXMgZW52aXJvbm1lbnQgaGFzIGEgbmF0aXZlICVJdGVyYXRvclByb3RvdHlwZSU7IHVzZSBpdCBpbnN0ZWFkCgkJCQkJLy8gb2YgdGhlIHBvbHlmaWxsLgoJCQkJCUl0ZXJhdG9yUHJvdG90eXBlID0gTmF0aXZlSXRlcmF0b3JQcm90b3R5cGU7CgkJCQl9CgkJCQl2YXIgR3AgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5wcm90b3R5cGUgPSBHZW5lcmF0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShJdGVyYXRvclByb3RvdHlwZSk7CgkJCQlHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHcC5jb25zdHJ1Y3RvciA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlOwoJCQkJR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUuY29uc3RydWN0b3IgPSBHZW5lcmF0b3JGdW5jdGlvbjsKCQkJCUdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlW3RvU3RyaW5nVGFnU3ltYm9sXSA9IEdlbmVyYXRvckZ1bmN0aW9uLmRpc3BsYXlOYW1lID0gJ0dlbmVyYXRvckZ1bmN0aW9uJzsKCgkJCQkvLyBIZWxwZXIgZm9yIGRlZmluaW5nIHRoZSAubmV4dCwgLnRocm93LCBhbmQgLnJldHVybiBtZXRob2RzIG9mIHRoZQoJCQkJLy8gSXRlcmF0b3IgaW50ZXJmYWNlIGluIHRlcm1zIG9mIGEgc2luZ2xlIC5faW52b2tlIG1ldGhvZC4KCQkJCWZ1bmN0aW9uIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhwcm90b3R5cGUpIHsKCQkJCQlbJ25leHQnLCAndGhyb3cnLCAncmV0dXJuJ10uZm9yRWFjaChmdW5jdGlvbihtZXRob2QpIHsKCQkJCQkJcHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbihhcmcpIHsKCQkJCQkJCXJldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBhcmcpOwoJCQkJCQl9OwoJCQkJCX0pOwoJCQkJfQoKCQkJCXJ1bnRpbWUuaXNHZW5lcmF0b3JGdW5jdGlvbiA9IGZ1bmN0aW9uKGdlbkZ1bikgewoJCQkJCXZhciBjdG9yID0gdHlwZW9mIGdlbkZ1biA9PT0gJ2Z1bmN0aW9uJyAmJiBnZW5GdW4uY29uc3RydWN0b3I7CgkJCQkJcmV0dXJuIGN0b3IgPyBjdG9yID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fAoJCQkJCQkvLyBGb3IgdGhlIG5hdGl2ZSBHZW5lcmF0b3JGdW5jdGlvbiBjb25zdHJ1Y3RvciwgdGhlIGJlc3Qgd2UgY2FuCgkJCQkJCS8vIGRvIGlzIHRvIGNoZWNrIGl0cyAubmFtZSBwcm9wZXJ0eS4KCQkJCQkJKGN0b3IuZGlzcGxheU5hbWUgfHwgY3Rvci5uYW1lKSA9PT0gJ0dlbmVyYXRvckZ1bmN0aW9uJyA6IGZhbHNlOwoJCQkJfTsKCQkJCXJ1bnRpbWUubWFyayA9IGZ1bmN0aW9uKGdlbkZ1bikgewoJCQkJCWlmIChPYmplY3Quc2V0UHJvdG90eXBlT2YpIHsKCQkJCQkJT2JqZWN0LnNldFByb3RvdHlwZU9mKGdlbkZ1biwgR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUpOwoJCQkJCX0gZWxzZSB7CgkJCQkJCWdlbkZ1bi5fX3Byb3RvX18gPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZTsKCQkJCQkJaWYgKCEodG9TdHJpbmdUYWdTeW1ib2wgaW4gZ2VuRnVuKSkgewoJCQkJCQkJZ2VuRnVuW3RvU3RyaW5nVGFnU3ltYm9sXSA9ICdHZW5lcmF0b3JGdW5jdGlvbic7CgkJCQkJCX0KCQkJCQl9CgkJCQkJZ2VuRnVuLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoR3ApOwoJCQkJCXJldHVybiBnZW5GdW47CgkJCQl9OwoKCQkJCS8vIFdpdGhpbiB0aGUgYm9keSBvZiBhbnkgYXN5bmMgZnVuY3Rpb24sIGBhd2FpdCB4YCBpcyB0cmFuc2Zvcm1lZCB0bwoJCQkJLy8gYHlpZWxkIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcCh4KWAsIHNvIHRoYXQgdGhlIHJ1bnRpbWUgY2FuIHRlc3QKCQkJCS8vIGBoYXNPd24uY2FsbCh2YWx1ZSwgIl9fYXdhaXQiKWAgdG8gZGV0ZXJtaW5lIGlmIHRoZSB5aWVsZGVkIHZhbHVlIGlzCgkJCQkvLyBtZWFudCB0byBiZSBhd2FpdGVkLgoJCQkJcnVudGltZS5hd3JhcCA9IGZ1bmN0aW9uKGFyZykgewoJCQkJCXJldHVybiB7CgkJCQkJCV9fYXdhaXQ6IGFyZwoJCQkJCX07CgkJCQl9OwoKCQkJCWZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IoZ2VuZXJhdG9yKSB7CgkJCQkJZnVuY3Rpb24gaW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpIHsKCQkJCQkJdmFyIHJlY29yZCA9IHRyeUNhdGNoKGdlbmVyYXRvclttZXRob2RdLCBnZW5lcmF0b3IsIGFyZyk7CgkJCQkJCWlmIChyZWNvcmQudHlwZSA9PT0gJ3Rocm93JykgewoJCQkJCQkJcmVqZWN0KHJlY29yZC5hcmcpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdmFyIHJlc3VsdCA9IHJlY29yZC5hcmc7CgkJCQkJCQl2YXIgdmFsdWUgPSByZXN1bHQudmFsdWU7CgkJCQkJCQlpZiAodmFsdWUgJiYgX3R5cGVvZih2YWx1ZSkgPT09ICdvYmplY3QnICYmIGhhc093bi5jYWxsKHZhbHVlLCAnX19hd2FpdCcpKSB7CgkJCQkJCQkJcmV0dXJuIFByb21pc2UucmVzb2x2ZSh2YWx1ZS5fX2F3YWl0KS50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7CgkJCQkJCQkJCWludm9rZSgnbmV4dCcsIHZhbHVlLCByZXNvbHZlLCByZWplY3QpOwoJCQkJCQkJCX0sIGZ1bmN0aW9uKGVycikgewoJCQkJCQkJCQlpbnZva2UoJ3Rocm93JywgZXJyLCByZXNvbHZlLCByZWplY3QpOwoJCQkJCQkJCX0pOwoJCQkJCQkJfQoJCQkJCQkJcmV0dXJuIFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihmdW5jdGlvbih1bndyYXBwZWQpIHsKCQkJCQkJCQkvLyBXaGVuIGEgeWllbGRlZCBQcm9taXNlIGlzIHJlc29sdmVkLCBpdHMgZmluYWwgdmFsdWUgYmVjb21lcwoJCQkJCQkJCS8vIHRoZSAudmFsdWUgb2YgdGhlIFByb21pc2U8e3ZhbHVlLGRvbmV9PiByZXN1bHQgZm9yIHRoZQoJCQkJCQkJCS8vIGN1cnJlbnQgaXRlcmF0aW9uLiBJZiB0aGUgUHJvbWlzZSBpcyByZWplY3RlZCwgaG93ZXZlciwgdGhlCgkJCQkJCQkJLy8gcmVzdWx0IGZvciB0aGlzIGl0ZXJhdGlvbiB3aWxsIGJlIHJlamVjdGVkIHdpdGggdGhlIHNhbWUKCQkJCQkJCQkvLyByZWFzb24uIE5vdGUgdGhhdCByZWplY3Rpb25zIG9mIHlpZWxkZWQgUHJvbWlzZXMgYXJlIG5vdAoJCQkJCQkJCS8vIHRocm93biBiYWNrIGludG8gdGhlIGdlbmVyYXRvciBmdW5jdGlvbiwgYXMgaXMgdGhlIGNhc2UKCQkJCQkJCQkvLyB3aGVuIGFuIGF3YWl0ZWQgUHJvbWlzZSBpcyByZWplY3RlZC4gVGhpcyBkaWZmZXJlbmNlIGluCgkJCQkJCQkJLy8gYmVoYXZpb3IgYmV0d2VlbiB5aWVsZCBhbmQgYXdhaXQgaXMgaW1wb3J0YW50LCBiZWNhdXNlIGl0CgkJCQkJCQkJLy8gYWxsb3dzIHRoZSBjb25zdW1lciB0byBkZWNpZGUgd2hhdCB0byBkbyB3aXRoIHRoZSB5aWVsZGVkCgkJCQkJCQkJLy8gcmVqZWN0aW9uIChzd2FsbG93IGl0IGFuZCBjb250aW51ZSwgbWFudWFsbHkgLnRocm93IGl0IGJhY2sKCQkJCQkJCQkvLyBpbnRvIHRoZSBnZW5lcmF0b3IsIGFiYW5kb24gaXRlcmF0aW9uLCB3aGF0ZXZlcikuIFdpdGgKCQkJCQkJCQkvLyBhd2FpdCwgYnkgY29udHJhc3QsIHRoZXJlIGlzIG5vIG9wcG9ydHVuaXR5IHRvIGV4YW1pbmUgdGhlCgkJCQkJCQkJLy8gcmVqZWN0aW9uIHJlYXNvbiBvdXRzaWRlIHRoZSBnZW5lcmF0b3IgZnVuY3Rpb24sIHNvIHRoZQoJCQkJCQkJCS8vIG9ubHkgb3B0aW9uIGlzIHRvIHRocm93IGl0IGZyb20gdGhlIGF3YWl0IGV4cHJlc3Npb24sIGFuZAoJCQkJCQkJCS8vIGxldCB0aGUgZ2VuZXJhdG9yIGZ1bmN0aW9uIGhhbmRsZSB0aGUgZXhjZXB0aW9uLgoJCQkJCQkJCXJlc3VsdC52YWx1ZSA9IHVud3JhcHBlZDsKCQkJCQkJCQlyZXNvbHZlKHJlc3VsdCk7CgkJCQkJCQl9LCByZWplY3QpOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQlpZiAoX3R5cGVvZihnbG9iYWwucHJvY2VzcykgPT09ICdvYmplY3QnICYmIGdsb2JhbC5wcm9jZXNzLmRvbWFpbikgewoJCQkJCQlpbnZva2UgPSBnbG9iYWwucHJvY2Vzcy5kb21haW4uYmluZChpbnZva2UpOwoJCQkJCX0KCQkJCQl2YXIgcHJldmlvdXNQcm9taXNlOwoKCQkJCQlmdW5jdGlvbiBlbnF1ZXVlKG1ldGhvZCwgYXJnKSB7CgkJCQkJCWZ1bmN0aW9uIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCkgewoJCQkJCQkJcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewoJCQkJCQkJCWludm9rZShtZXRob2QsIGFyZywgcmVzb2x2ZSwgcmVqZWN0KTsKCQkJCQkJCX0pOwoJCQkJCQl9CgoJCQkJCQlyZXR1cm4gcHJldmlvdXNQcm9taXNlID0KCQkJCQkJCS8vIElmIGVucXVldWUgaGFzIGJlZW4gY2FsbGVkIGJlZm9yZSwgdGhlbiB3ZSB3YW50IHRvIHdhaXQgdW50aWwKCQkJCQkJCS8vIGFsbCBwcmV2aW91cyBQcm9taXNlcyBoYXZlIGJlZW4gcmVzb2x2ZWQgYmVmb3JlIGNhbGxpbmcgaW52b2tlLAoJCQkJCQkJLy8gc28gdGhhdCByZXN1bHRzIGFyZSBhbHdheXMgZGVsaXZlcmVkIGluIHRoZSBjb3JyZWN0IG9yZGVyLiBJZgoJCQkJCQkJLy8gZW5xdWV1ZSBoYXMgbm90IGJlZW4gY2FsbGVkIGJlZm9yZSwgdGhlbiBpdCBpcyBpbXBvcnRhbnQgdG8KCQkJCQkJCS8vIGNhbGwgaW52b2tlIGltbWVkaWF0ZWx5LCB3aXRob3V0IHdhaXRpbmcgb24gYSBjYWxsYmFjayB0byBmaXJlLAoJCQkJCQkJLy8gc28gdGhhdCB0aGUgYXN5bmMgZ2VuZXJhdG9yIGZ1bmN0aW9uIGhhcyB0aGUgb3Bwb3J0dW5pdHkgdG8gZG8KCQkJCQkJCS8vIGFueSBuZWNlc3Nhcnkgc2V0dXAgaW4gYSBwcmVkaWN0YWJsZSB3YXkuIFRoaXMgcHJlZGljdGFiaWxpdHkKCQkJCQkJCS8vIGlzIHdoeSB0aGUgUHJvbWlzZSBjb25zdHJ1Y3RvciBzeW5jaHJvbm91c2x5IGludm9rZXMgaXRzCgkJCQkJCQkvLyBleGVjdXRvciBjYWxsYmFjaywgYW5kIHdoeSBhc3luYyBmdW5jdGlvbnMgc3luY2hyb25vdXNseQoJCQkJCQkJLy8gZXhlY3V0ZSBjb2RlIGJlZm9yZSB0aGUgZmlyc3QgYXdhaXQuIFNpbmNlIHdlIGltcGxlbWVudCBzaW1wbGUKCQkJCQkJCS8vIGFzeW5jIGZ1bmN0aW9ucyBpbiB0ZXJtcyBvZiBhc3luYyBnZW5lcmF0b3JzLCBpdCBpcyBlc3BlY2lhbGx5CgkJCQkJCQkvLyBpbXBvcnRhbnQgdG8gZ2V0IHRoaXMgcmlnaHQsIGV2ZW4gdGhvdWdoIGl0IHJlcXVpcmVzIGNhcmUuCgkJCQkJCQlwcmV2aW91c1Byb21pc2UgPyBwcmV2aW91c1Byb21pc2UudGhlbihjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZywKCQkJCQkJCQkvLyBBdm9pZCBwcm9wYWdhdGluZyBmYWlsdXJlcyB0byBQcm9taXNlcyByZXR1cm5lZCBieSBsYXRlcgoJCQkJCQkJCS8vIGludm9jYXRpb25zIG9mIHRoZSBpdGVyYXRvci4KCQkJCQkJCQljYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZykgOiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpOwoJCQkJCX0KCgkJCQkJLy8gRGVmaW5lIHRoZSB1bmlmaWVkIGhlbHBlciBtZXRob2QgdGhhdCBpcyB1c2VkIHRvIGltcGxlbWVudCAubmV4dCwKCQkJCQkvLyAudGhyb3csIGFuZCAucmV0dXJuIChzZWUgZGVmaW5lSXRlcmF0b3JNZXRob2RzKS4KCQkJCQl0aGlzLl9pbnZva2UgPSBlbnF1ZXVlOwoJCQkJfQoKCQkJCWRlZmluZUl0ZXJhdG9yTWV0aG9kcyhBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSk7CgkJCQlBc3luY0l0ZXJhdG9yLnByb3RvdHlwZVthc3luY0l0ZXJhdG9yU3ltYm9sXSA9IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiB0aGlzOwoJCQkJfTsKCQkJCXJ1bnRpbWUuQXN5bmNJdGVyYXRvciA9IEFzeW5jSXRlcmF0b3I7CgoJCQkJLy8gTm90ZSB0aGF0IHNpbXBsZSBhc3luYyBmdW5jdGlvbnMgYXJlIGltcGxlbWVudGVkIG9uIHRvcCBvZgoJCQkJLy8gQXN5bmNJdGVyYXRvciBvYmplY3RzOyB0aGV5IGp1c3QgcmV0dXJuIGEgUHJvbWlzZSBmb3IgdGhlIHZhbHVlIG9mCgkJCQkvLyB0aGUgZmluYWwgcmVzdWx0IHByb2R1Y2VkIGJ5IHRoZSBpdGVyYXRvci4KCQkJCXJ1bnRpbWUuYXN5bmMgPSBmdW5jdGlvbihpbm5lckZuLCBvdXRlckZuLCBzZWxmLCB0cnlMb2NzTGlzdCkgewoJCQkJCXZhciBpdGVyID0gbmV3IEFzeW5jSXRlcmF0b3Iod3JhcChpbm5lckZuLCBvdXRlckZuLCBzZWxmLCB0cnlMb2NzTGlzdCkpOwoJCQkJCXJldHVybiBydW50aW1lLmlzR2VuZXJhdG9yRnVuY3Rpb24ob3V0ZXJGbikgPyBpdGVyIC8vIElmIG91dGVyRm4gaXMgYSBnZW5lcmF0b3IsIHJldHVybiB0aGUgZnVsbCBpdGVyYXRvci4KCQkJCQkJOiBpdGVyLm5leHQoKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkgewoJCQkJCQkJcmV0dXJuIHJlc3VsdC5kb25lID8gcmVzdWx0LnZhbHVlIDogaXRlci5uZXh0KCk7CgkJCQkJCX0pOwoJCQkJfTsKCgkJCQlmdW5jdGlvbiBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpIHsKCQkJCQl2YXIgc3RhdGUgPSBHZW5TdGF0ZVN1c3BlbmRlZFN0YXJ0OwoJCQkJCXJldHVybiBmdW5jdGlvbiBpbnZva2UobWV0aG9kLCBhcmcpIHsKCQkJCQkJaWYgKHN0YXRlID09PSBHZW5TdGF0ZUV4ZWN1dGluZykgewoJCQkJCQkJdGhyb3cgbmV3IEVycm9yKCdHZW5lcmF0b3IgaXMgYWxyZWFkeSBydW5uaW5nJyk7CgkJCQkJCX0KCQkJCQkJaWYgKHN0YXRlID09PSBHZW5TdGF0ZUNvbXBsZXRlZCkgewoJCQkJCQkJaWYgKG1ldGhvZCA9PT0gJ3Rocm93JykgewoJCQkJCQkJCXRocm93IGFyZzsKCQkJCQkJCX0KCgkJCQkJCQkvLyBCZSBmb3JnaXZpbmcsIHBlciAyNS4zLjMuMy4zIG9mIHRoZSBzcGVjOgoJCQkJCQkJLy8gaHR0cHM6Ly9wZW9wbGUubW96aWxsYS5vcmcvfmpvcmVuZG9yZmYvZXM2LWRyYWZ0Lmh0bWwjc2VjLWdlbmVyYXRvcnJlc3VtZQoJCQkJCQkJcmV0dXJuIGRvbmVSZXN1bHQoKTsKCQkJCQkJfQoJCQkJCQljb250ZXh0Lm1ldGhvZCA9IG1ldGhvZDsKCQkJCQkJY29udGV4dC5hcmcgPSBhcmc7CgkJCQkJCXdoaWxlICh0cnVlKSB7CgkJCQkJCQl2YXIgZGVsZWdhdGUgPSBjb250ZXh0LmRlbGVnYXRlOwoJCQkJCQkJaWYgKGRlbGVnYXRlKSB7CgkJCQkJCQkJdmFyIGRlbGVnYXRlUmVzdWx0ID0gbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCk7CgkJCQkJCQkJaWYgKGRlbGVnYXRlUmVzdWx0KSB7CgkJCQkJCQkJCWlmIChkZWxlZ2F0ZVJlc3VsdCA9PT0gQ29udGludWVTZW50aW5lbCkgY29udGludWU7CgkJCQkJCQkJCXJldHVybiBkZWxlZ2F0ZVJlc3VsdDsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQlpZiAoY29udGV4dC5tZXRob2QgPT09ICduZXh0JykgewoJCQkJCQkJCS8vIFNldHRpbmcgY29udGV4dC5fc2VudCBmb3IgbGVnYWN5IHN1cHBvcnQgb2YgQmFiZWwncwoJCQkJCQkJCS8vIGZ1bmN0aW9uLnNlbnQgaW1wbGVtZW50YXRpb24uCgkJCQkJCQkJY29udGV4dC5zZW50ID0gY29udGV4dC5fc2VudCA9IGNvbnRleHQuYXJnOwoJCQkJCQkJfSBlbHNlIGlmIChjb250ZXh0Lm1ldGhvZCA9PT0gJ3Rocm93JykgewoJCQkJCQkJCWlmIChzdGF0ZSA9PT0gR2VuU3RhdGVTdXNwZW5kZWRTdGFydCkgewoJCQkJCQkJCQlzdGF0ZSA9IEdlblN0YXRlQ29tcGxldGVkOwoJCQkJCQkJCQl0aHJvdyBjb250ZXh0LmFyZzsKCQkJCQkJCQl9CgkJCQkJCQkJY29udGV4dC5kaXNwYXRjaEV4Y2VwdGlvbihjb250ZXh0LmFyZyk7CgkJCQkJCQl9IGVsc2UgaWYgKGNvbnRleHQubWV0aG9kID09PSAncmV0dXJuJykgewoJCQkJCQkJCWNvbnRleHQuYWJydXB0KCdyZXR1cm4nLCBjb250ZXh0LmFyZyk7CgkJCQkJCQl9CgkJCQkJCQlzdGF0ZSA9IEdlblN0YXRlRXhlY3V0aW5nOwoJCQkJCQkJdmFyIHJlY29yZCA9IHRyeUNhdGNoKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpOwoJCQkJCQkJaWYgKHJlY29yZC50eXBlID09PSAnbm9ybWFsJykgewoJCQkJCQkJCS8vIElmIGFuIGV4Y2VwdGlvbiBpcyB0aHJvd24gZnJvbSBpbm5lckZuLCB3ZSBsZWF2ZSBzdGF0ZSA9PT0KCQkJCQkJCQkvLyBHZW5TdGF0ZUV4ZWN1dGluZyBhbmQgbG9vcCBiYWNrIGZvciBhbm90aGVyIGludm9jYXRpb24uCgkJCQkJCQkJc3RhdGUgPSBjb250ZXh0LmRvbmUgPyBHZW5TdGF0ZUNvbXBsZXRlZCA6IEdlblN0YXRlU3VzcGVuZGVkWWllbGQ7CgkJCQkJCQkJaWYgKHJlY29yZC5hcmcgPT09IENvbnRpbnVlU2VudGluZWwpIHsKCQkJCQkJCQkJY29udGludWU7CgkJCQkJCQkJfQoJCQkJCQkJCXJldHVybiB7CgkJCQkJCQkJCXZhbHVlOiByZWNvcmQuYXJnLAoJCQkJCQkJCQlkb25lOiBjb250ZXh0LmRvbmUKCQkJCQkJCQl9OwoJCQkJCQkJfSBlbHNlIGlmIChyZWNvcmQudHlwZSA9PT0gJ3Rocm93JykgewoJCQkJCQkJCXN0YXRlID0gR2VuU3RhdGVDb21wbGV0ZWQ7CgkJCQkJCQkJLy8gRGlzcGF0Y2ggdGhlIGV4Y2VwdGlvbiBieSBsb29waW5nIGJhY2sgYXJvdW5kIHRvIHRoZQoJCQkJCQkJCS8vIGNvbnRleHQuZGlzcGF0Y2hFeGNlcHRpb24oY29udGV4dC5hcmcpIGNhbGwgYWJvdmUuCgkJCQkJCQkJY29udGV4dC5tZXRob2QgPSAndGhyb3cnOwoJCQkJCQkJCWNvbnRleHQuYXJnID0gcmVjb3JkLmFyZzsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX07CgkJCQl9CgoJCQkJLy8gQ2FsbCBkZWxlZ2F0ZS5pdGVyYXRvcltjb250ZXh0Lm1ldGhvZF0oY29udGV4dC5hcmcpIGFuZCBoYW5kbGUgdGhlCgkJCQkvLyByZXN1bHQsIGVpdGhlciBieSByZXR1cm5pbmcgYSB7IHZhbHVlLCBkb25lIH0gcmVzdWx0IGZyb20gdGhlCgkJCQkvLyBkZWxlZ2F0ZSBpdGVyYXRvciwgb3IgYnkgbW9kaWZ5aW5nIGNvbnRleHQubWV0aG9kIGFuZCBjb250ZXh0LmFyZywKCQkJCS8vIHNldHRpbmcgY29udGV4dC5kZWxlZ2F0ZSB0byBudWxsLCBhbmQgcmV0dXJuaW5nIHRoZSBDb250aW51ZVNlbnRpbmVsLgoJCQkJZnVuY3Rpb24gbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCkgewoJCQkJCXZhciBtZXRob2QgPSBkZWxlZ2F0ZS5pdGVyYXRvcltjb250ZXh0Lm1ldGhvZF07CgkJCQkJaWYgKG1ldGhvZCA9PT0gdW5kZWZpbmVkKSB7CgkJCQkJCS8vIEEgLnRocm93IG9yIC5yZXR1cm4gd2hlbiB0aGUgZGVsZWdhdGUgaXRlcmF0b3IgaGFzIG5vIC50aHJvdwoJCQkJCQkvLyBtZXRob2QgYWx3YXlzIHRlcm1pbmF0ZXMgdGhlIHlpZWxkKiBsb29wLgoJCQkJCQljb250ZXh0LmRlbGVnYXRlID0gbnVsbDsKCQkJCQkJaWYgKGNvbnRleHQubWV0aG9kID09PSAndGhyb3cnKSB7CgkJCQkJCQlpZiAoZGVsZWdhdGUuaXRlcmF0b3JbJ3JldHVybiddKSB7CgkJCQkJCQkJLy8gSWYgdGhlIGRlbGVnYXRlIGl0ZXJhdG9yIGhhcyBhIHJldHVybiBtZXRob2QsIGdpdmUgaXQgYQoJCQkJCQkJCS8vIGNoYW5jZSB0byBjbGVhbiB1cC4KCQkJCQkJCQljb250ZXh0Lm1ldGhvZCA9ICdyZXR1cm4nOwoJCQkJCQkJCWNvbnRleHQuYXJnID0gdW5kZWZpbmVkOwoJCQkJCQkJCW1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpOwoJCQkJCQkJCWlmIChjb250ZXh0Lm1ldGhvZCA9PT0gJ3Rocm93JykgewoJCQkJCQkJCQkvLyBJZiBtYXliZUludm9rZURlbGVnYXRlKGNvbnRleHQpIGNoYW5nZWQgY29udGV4dC5tZXRob2QgZnJvbQoJCQkJCQkJCQkvLyAicmV0dXJuIiB0byAidGhyb3ciLCBsZXQgdGhhdCBvdmVycmlkZSB0aGUgVHlwZUVycm9yIGJlbG93LgoJCQkJCQkJCQlyZXR1cm4gQ29udGludWVTZW50aW5lbDsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQljb250ZXh0Lm1ldGhvZCA9ICd0aHJvdyc7CgkJCQkJCQljb250ZXh0LmFyZyA9IG5ldyBUeXBlRXJyb3IoJ1RoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgXCd0aHJvd1wnIG1ldGhvZCcpOwoJCQkJCQl9CgkJCQkJCXJldHVybiBDb250aW51ZVNlbnRpbmVsOwoJCQkJCX0KCQkJCQl2YXIgcmVjb3JkID0gdHJ5Q2F0Y2gobWV0aG9kLCBkZWxlZ2F0ZS5pdGVyYXRvciwgY29udGV4dC5hcmcpOwoJCQkJCWlmIChyZWNvcmQudHlwZSA9PT0gJ3Rocm93JykgewoJCQkJCQljb250ZXh0Lm1ldGhvZCA9ICd0aHJvdyc7CgkJCQkJCWNvbnRleHQuYXJnID0gcmVjb3JkLmFyZzsKCQkJCQkJY29udGV4dC5kZWxlZ2F0ZSA9IG51bGw7CgkJCQkJCXJldHVybiBDb250aW51ZVNlbnRpbmVsOwoJCQkJCX0KCQkJCQl2YXIgaW5mbyA9IHJlY29yZC5hcmc7CgkJCQkJaWYgKCFpbmZvKSB7CgkJCQkJCWNvbnRleHQubWV0aG9kID0gJ3Rocm93JzsKCQkJCQkJY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKCdpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdCcpOwoJCQkJCQljb250ZXh0LmRlbGVnYXRlID0gbnVsbDsKCQkJCQkJcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CgkJCQkJfQoJCQkJCWlmIChpbmZvLmRvbmUpIHsKCQkJCQkJLy8gQXNzaWduIHRoZSByZXN1bHQgb2YgdGhlIGZpbmlzaGVkIGRlbGVnYXRlIHRvIHRoZSB0ZW1wb3JhcnkKCQkJCQkJLy8gdmFyaWFibGUgc3BlY2lmaWVkIGJ5IGRlbGVnYXRlLnJlc3VsdE5hbWUgKHNlZSBkZWxlZ2F0ZVlpZWxkKS4KCQkJCQkJY29udGV4dFtkZWxlZ2F0ZS5yZXN1bHROYW1lXSA9IGluZm8udmFsdWU7CgoJCQkJCQkvLyBSZXN1bWUgZXhlY3V0aW9uIGF0IHRoZSBkZXNpcmVkIGxvY2F0aW9uIChzZWUgZGVsZWdhdGVZaWVsZCkuCgkJCQkJCWNvbnRleHQubmV4dCA9IGRlbGVnYXRlLm5leHRMb2M7CgoJCQkJCQkvLyBJZiBjb250ZXh0Lm1ldGhvZCB3YXMgInRocm93IiBidXQgdGhlIGRlbGVnYXRlIGhhbmRsZWQgdGhlCgkJCQkJCS8vIGV4Y2VwdGlvbiwgbGV0IHRoZSBvdXRlciBnZW5lcmF0b3IgcHJvY2VlZCBub3JtYWxseS4gSWYKCQkJCQkJLy8gY29udGV4dC5tZXRob2Qgd2FzICJuZXh0IiwgZm9yZ2V0IGNvbnRleHQuYXJnIHNpbmNlIGl0IGhhcyBiZWVuCgkJCQkJCS8vICJjb25zdW1lZCIgYnkgdGhlIGRlbGVnYXRlIGl0ZXJhdG9yLiBJZiBjb250ZXh0Lm1ldGhvZCB3YXMKCQkJCQkJLy8gInJldHVybiIsIGFsbG93IHRoZSBvcmlnaW5hbCAucmV0dXJuIGNhbGwgdG8gY29udGludWUgaW4gdGhlCgkJCQkJCS8vIG91dGVyIGdlbmVyYXRvci4KCQkJCQkJaWYgKGNvbnRleHQubWV0aG9kICE9PSAncmV0dXJuJykgewoJCQkJCQkJY29udGV4dC5tZXRob2QgPSAnbmV4dCc7CgkJCQkJCQljb250ZXh0LmFyZyA9IHVuZGVmaW5lZDsKCQkJCQkJfQoJCQkJCX0gZWxzZSB7CgkJCQkJCS8vIFJlLXlpZWxkIHRoZSByZXN1bHQgcmV0dXJuZWQgYnkgdGhlIGRlbGVnYXRlIG1ldGhvZC4KCQkJCQkJcmV0dXJuIGluZm87CgkJCQkJfQoKCQkJCQkvLyBUaGUgZGVsZWdhdGUgaXRlcmF0b3IgaXMgZmluaXNoZWQsIHNvIGZvcmdldCBpdCBhbmQgY29udGludWUgd2l0aAoJCQkJCS8vIHRoZSBvdXRlciBnZW5lcmF0b3IuCgkJCQkJY29udGV4dC5kZWxlZ2F0ZSA9IG51bGw7CgkJCQkJcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CgkJCQl9CgoJCQkJLy8gRGVmaW5lIEdlbmVyYXRvci5wcm90b3R5cGUue25leHQsdGhyb3cscmV0dXJufSBpbiB0ZXJtcyBvZiB0aGUKCQkJCS8vIHVuaWZpZWQgLl9pbnZva2UgaGVscGVyIG1ldGhvZC4KCQkJCWRlZmluZUl0ZXJhdG9yTWV0aG9kcyhHcCk7CgkJCQlHcFt0b1N0cmluZ1RhZ1N5bWJvbF0gPSAnR2VuZXJhdG9yJzsKCgkJCQkvLyBBIEdlbmVyYXRvciBzaG91bGQgYWx3YXlzIHJldHVybiBpdHNlbGYgYXMgdGhlIGl0ZXJhdG9yIG9iamVjdCB3aGVuIHRoZQoJCQkJLy8gQEBpdGVyYXRvciBmdW5jdGlvbiBpcyBjYWxsZWQgb24gaXQuIFNvbWUgYnJvd3NlcnMnIGltcGxlbWVudGF0aW9ucyBvZiB0aGUKCQkJCS8vIGl0ZXJhdG9yIHByb3RvdHlwZSBjaGFpbiBpbmNvcnJlY3RseSBpbXBsZW1lbnQgdGhpcywgY2F1c2luZyB0aGUgR2VuZXJhdG9yCgkJCQkvLyBvYmplY3QgdG8gbm90IGJlIHJldHVybmVkIGZyb20gdGhpcyBjYWxsLiBUaGlzIGVuc3VyZXMgdGhhdCBkb2Vzbid0IGhhcHBlbi4KCQkJCS8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVnZW5lcmF0b3IvaXNzdWVzLzI3NCBmb3IgbW9yZSBkZXRhaWxzLgoJCQkJR3BbaXRlcmF0b3JTeW1ib2xdID0gZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9OwoJCQkJR3AudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gJ1tvYmplY3QgR2VuZXJhdG9yXSc7CgkJCQl9OwoKCQkJCWZ1bmN0aW9uIHB1c2hUcnlFbnRyeShsb2NzKSB7CgkJCQkJdmFyIGVudHJ5ID0gewoJCQkJCQl0cnlMb2M6IGxvY3NbMF0KCQkJCQl9OwoJCQkJCWlmICgxIGluIGxvY3MpIHsKCQkJCQkJZW50cnkuY2F0Y2hMb2MgPSBsb2NzWzFdOwoJCQkJCX0KCQkJCQlpZiAoMiBpbiBsb2NzKSB7CgkJCQkJCWVudHJ5LmZpbmFsbHlMb2MgPSBsb2NzWzJdOwoJCQkJCQllbnRyeS5hZnRlckxvYyA9IGxvY3NbM107CgkJCQkJfQoJCQkJCXRoaXMudHJ5RW50cmllcy5wdXNoKGVudHJ5KTsKCQkJCX0KCgkJCQlmdW5jdGlvbiByZXNldFRyeUVudHJ5KGVudHJ5KSB7CgkJCQkJdmFyIHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb24gfHwge307CgkJCQkJcmVjb3JkLnR5cGUgPSAnbm9ybWFsJzsKCQkJCQlkZWxldGUgcmVjb3JkLmFyZzsKCQkJCQllbnRyeS5jb21wbGV0aW9uID0gcmVjb3JkOwoJCQkJfQoKCQkJCWZ1bmN0aW9uIENvbnRleHQodHJ5TG9jc0xpc3QpIHsKCQkJCQkvLyBUaGUgcm9vdCBlbnRyeSBvYmplY3QgKGVmZmVjdGl2ZWx5IGEgdHJ5IHN0YXRlbWVudCB3aXRob3V0IGEgY2F0Y2gKCQkJCQkvLyBvciBhIGZpbmFsbHkgYmxvY2spIGdpdmVzIHVzIGEgcGxhY2UgdG8gc3RvcmUgdmFsdWVzIHRocm93biBmcm9tCgkJCQkJLy8gbG9jYXRpb25zIHdoZXJlIHRoZXJlIGlzIG5vIGVuY2xvc2luZyB0cnkgc3RhdGVtZW50LgoJCQkJCXRoaXMudHJ5RW50cmllcyA9IFt7CgkJCQkJCXRyeUxvYzogJ3Jvb3QnCgkJCQkJfV07CgkJCQkJdHJ5TG9jc0xpc3QuZm9yRWFjaChwdXNoVHJ5RW50cnksIHRoaXMpOwoJCQkJCXRoaXMucmVzZXQodHJ1ZSk7CgkJCQl9CgoJCQkJcnVudGltZS5rZXlzID0gZnVuY3Rpb24ob2JqZWN0KSB7CgkJCQkJdmFyIGtleXMgPSBbXTsKCQkJCQlmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7CgkJCQkJCWtleXMucHVzaChrZXkpOwoJCQkJCX0KCQkJCQlrZXlzLnJldmVyc2UoKTsKCgkJCQkJLy8gUmF0aGVyIHRoYW4gcmV0dXJuaW5nIGFuIG9iamVjdCB3aXRoIGEgbmV4dCBtZXRob2QsIHdlIGtlZXAKCQkJCQkvLyB0aGluZ3Mgc2ltcGxlIGFuZCByZXR1cm4gdGhlIG5leHQgZnVuY3Rpb24gaXRzZWxmLgoJCQkJCXJldHVybiBmdW5jdGlvbiBuZXh0KCkgewoJCQkJCQl3aGlsZSAoa2V5cy5sZW5ndGgpIHsKCQkJCQkJCXZhciBrZXkgPSBrZXlzLnBvcCgpOwoJCQkJCQkJaWYgKGtleSBpbiBvYmplY3QpIHsKCQkJCQkJCQluZXh0LnZhbHVlID0ga2V5OwoJCQkJCQkJCW5leHQuZG9uZSA9IGZhbHNlOwoJCQkJCQkJCXJldHVybiBuZXh0OwoJCQkJCQkJfQoJCQkJCQl9CgoJCQkJCQkvLyBUbyBhdm9pZCBjcmVhdGluZyBhbiBhZGRpdGlvbmFsIG9iamVjdCwgd2UganVzdCBoYW5nIHRoZSAudmFsdWUKCQkJCQkJLy8gYW5kIC5kb25lIHByb3BlcnRpZXMgb2ZmIHRoZSBuZXh0IGZ1bmN0aW9uIG9iamVjdCBpdHNlbGYuIFRoaXMKCQkJCQkJLy8gYWxzbyBlbnN1cmVzIHRoYXQgdGhlIG1pbmlmaWVyIHdpbGwgbm90IGFub255bWl6ZSB0aGUgZnVuY3Rpb24uCgkJCQkJCW5leHQuZG9uZSA9IHRydWU7CgkJCQkJCXJldHVybiBuZXh0OwoJCQkJCX07CgkJCQl9OwoKCQkJCWZ1bmN0aW9uIHZhbHVlcyhpdGVyYWJsZSkgewoJCQkJCWlmIChpdGVyYWJsZSkgewoJCQkJCQl2YXIgaXRlcmF0b3JNZXRob2QgPSBpdGVyYWJsZVtpdGVyYXRvclN5bWJvbF07CgkJCQkJCWlmIChpdGVyYXRvck1ldGhvZCkgewoJCQkJCQkJcmV0dXJuIGl0ZXJhdG9yTWV0aG9kLmNhbGwoaXRlcmFibGUpOwoJCQkJCQl9CgkJCQkJCWlmICh0eXBlb2YgaXRlcmFibGUubmV4dCA9PT0gJ2Z1bmN0aW9uJykgewoJCQkJCQkJcmV0dXJuIGl0ZXJhYmxlOwoJCQkJCQl9CgkJCQkJCWlmICghaXNOYU4oaXRlcmFibGUubGVuZ3RoKSkgewoJCQkJCQkJdmFyIGkgPSAtMSwKCQkJCQkJCQluZXh0ID0gZnVuY3Rpb24gbmV4dCgpIHsKCQkJCQkJCQkJd2hpbGUgKCsraSA8IGl0ZXJhYmxlLmxlbmd0aCkgewoJCQkJCQkJCQkJaWYgKGhhc093bi5jYWxsKGl0ZXJhYmxlLCBpKSkgewoJCQkJCQkJCQkJCW5leHQudmFsdWUgPSBpdGVyYWJsZVtpXTsKCQkJCQkJCQkJCQluZXh0LmRvbmUgPSBmYWxzZTsKCQkJCQkJCQkJCQlyZXR1cm4gbmV4dDsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJfQoJCQkJCQkJCQluZXh0LnZhbHVlID0gdW5kZWZpbmVkOwoJCQkJCQkJCQluZXh0LmRvbmUgPSB0cnVlOwoJCQkJCQkJCQlyZXR1cm4gbmV4dDsKCQkJCQkJCQl9OwoJCQkJCQkJcmV0dXJuIG5leHQubmV4dCA9IG5leHQ7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vIFJldHVybiBhbiBpdGVyYXRvciB3aXRoIG5vIHZhbHVlcy4KCQkJCQlyZXR1cm4gewoJCQkJCQluZXh0OiBkb25lUmVzdWx0CgkJCQkJfTsKCQkJCX0KCgkJCQlydW50aW1lLnZhbHVlcyA9IHZhbHVlczsKCgkJCQlmdW5jdGlvbiBkb25lUmVzdWx0KCkgewoJCQkJCXJldHVybiB7CgkJCQkJCXZhbHVlOiB1bmRlZmluZWQsCgkJCQkJCWRvbmU6IHRydWUKCQkJCQl9OwoJCQkJfQoKCQkJCUNvbnRleHQucHJvdG90eXBlID0gewoJCQkJCWNvbnN0cnVjdG9yOiBDb250ZXh0LAoJCQkJCXJlc2V0OiBmdW5jdGlvbiByZXNldChza2lwVGVtcFJlc2V0KSB7CgkJCQkJCXRoaXMucHJldiA9IDA7CgkJCQkJCXRoaXMubmV4dCA9IDA7CgkJCQkJCS8vIFJlc2V0dGluZyBjb250ZXh0Ll9zZW50IGZvciBsZWdhY3kgc3VwcG9ydCBvZiBCYWJlbCdzCgkJCQkJCS8vIGZ1bmN0aW9uLnNlbnQgaW1wbGVtZW50YXRpb24uCgkJCQkJCXRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSB1bmRlZmluZWQ7CgkJCQkJCXRoaXMuZG9uZSA9IGZhbHNlOwoJCQkJCQl0aGlzLmRlbGVnYXRlID0gbnVsbDsKCQkJCQkJdGhpcy5tZXRob2QgPSAnbmV4dCc7CgkJCQkJCXRoaXMuYXJnID0gdW5kZWZpbmVkOwoJCQkJCQl0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChyZXNldFRyeUVudHJ5KTsKCQkJCQkJaWYgKCFza2lwVGVtcFJlc2V0KSB7CgkJCQkJCQlmb3IgKHZhciBuYW1lIGluIHRoaXMpIHsKCQkJCQkJCQkvLyBOb3Qgc3VyZSBhYm91dCB0aGUgb3B0aW1hbCBvcmRlciBvZiB0aGVzZSBjb25kaXRpb25zOgoJCQkJCQkJCWlmIChuYW1lLmNoYXJBdCgwKSA9PT0gJ3QnICYmIGhhc093bi5jYWxsKHRoaXMsIG5hbWUpICYmICFpc05hTigrbmFtZS5zbGljZSgxKSkpIHsKCQkJCQkJCQkJdGhpc1tuYW1lXSA9IHVuZGVmaW5lZDsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9LAoJCQkJCXN0b3A6IGZ1bmN0aW9uIHN0b3AoKSB7CgkJCQkJCXRoaXMuZG9uZSA9IHRydWU7CgkJCQkJCXZhciByb290RW50cnkgPSB0aGlzLnRyeUVudHJpZXNbMF07CgkJCQkJCXZhciByb290UmVjb3JkID0gcm9vdEVudHJ5LmNvbXBsZXRpb247CgkJCQkJCWlmIChyb290UmVjb3JkLnR5cGUgPT09ICd0aHJvdycpIHsKCQkJCQkJCXRocm93IHJvb3RSZWNvcmQuYXJnOwoJCQkJCQl9CgkJCQkJCXJldHVybiB0aGlzLnJ2YWw7CgkJCQkJfSwKCQkJCQlkaXNwYXRjaEV4Y2VwdGlvbjogZnVuY3Rpb24gZGlzcGF0Y2hFeGNlcHRpb24oZXhjZXB0aW9uKSB7CgkJCQkJCWlmICh0aGlzLmRvbmUpIHsKCQkJCQkJCXRocm93IGV4Y2VwdGlvbjsKCQkJCQkJfQoJCQkJCQl2YXIgY29udGV4dCA9IHRoaXM7CgoJCQkJCQlmdW5jdGlvbiBoYW5kbGUobG9jLCBjYXVnaHQpIHsKCQkJCQkJCXJlY29yZC50eXBlID0gJ3Rocm93JzsKCQkJCQkJCXJlY29yZC5hcmcgPSBleGNlcHRpb247CgkJCQkJCQljb250ZXh0Lm5leHQgPSBsb2M7CgkJCQkJCQlpZiAoY2F1Z2h0KSB7CgkJCQkJCQkJLy8gSWYgdGhlIGRpc3BhdGNoZWQgZXhjZXB0aW9uIHdhcyBjYXVnaHQgYnkgYSBjYXRjaCBibG9jaywKCQkJCQkJCQkvLyB0aGVuIGxldCB0aGF0IGNhdGNoIGJsb2NrIGhhbmRsZSB0aGUgZXhjZXB0aW9uIG5vcm1hbGx5LgoJCQkJCQkJCWNvbnRleHQubWV0aG9kID0gJ25leHQnOwoJCQkJCQkJCWNvbnRleHQuYXJnID0gdW5kZWZpbmVkOwoJCQkJCQkJfQoJCQkJCQkJcmV0dXJuICEhY2F1Z2h0OwoJCQkJCQl9CgoJCQkJCQlmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CgkJCQkJCQl2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07CgkJCQkJCQl2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbjsKCQkJCQkJCWlmIChlbnRyeS50cnlMb2MgPT09ICdyb290JykgewoJCQkJCQkJCS8vIEV4Y2VwdGlvbiB0aHJvd24gb3V0c2lkZSBvZiBhbnkgdHJ5IGJsb2NrIHRoYXQgY291bGQgaGFuZGxlCgkJCQkJCQkJLy8gaXQsIHNvIHNldCB0aGUgY29tcGxldGlvbiB2YWx1ZSBvZiB0aGUgZW50aXJlIGZ1bmN0aW9uIHRvCgkJCQkJCQkJLy8gdGhyb3cgdGhlIGV4Y2VwdGlvbi4KCQkJCQkJCQlyZXR1cm4gaGFuZGxlKCdlbmQnKTsKCQkJCQkJCX0KCQkJCQkJCWlmIChlbnRyeS50cnlMb2MgPD0gdGhpcy5wcmV2KSB7CgkJCQkJCQkJdmFyIGhhc0NhdGNoID0gaGFzT3duLmNhbGwoZW50cnksICdjYXRjaExvYycpOwoJCQkJCQkJCXZhciBoYXNGaW5hbGx5ID0gaGFzT3duLmNhbGwoZW50cnksICdmaW5hbGx5TG9jJyk7CgkJCQkJCQkJaWYgKGhhc0NhdGNoICYmIGhhc0ZpbmFsbHkpIHsKCQkJCQkJCQkJaWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSB7CgkJCQkJCQkJCQlyZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCB0cnVlKTsKCQkJCQkJCQkJfSBlbHNlIGlmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7CgkJCQkJCQkJCQlyZXR1cm4gaGFuZGxlKGVudHJ5LmZpbmFsbHlMb2MpOwoJCQkJCQkJCQl9CgkJCQkJCQkJfSBlbHNlIGlmIChoYXNDYXRjaCkgewoJCQkJCQkJCQlpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHsKCQkJCQkJCQkJCXJldHVybiBoYW5kbGUoZW50cnkuY2F0Y2hMb2MsIHRydWUpOwoJCQkJCQkJCQl9CgkJCQkJCQkJfSBlbHNlIGlmIChoYXNGaW5hbGx5KSB7CgkJCQkJCQkJCWlmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7CgkJCQkJCQkJCQlyZXR1cm4gaGFuZGxlKGVudHJ5LmZpbmFsbHlMb2MpOwoJCQkJCQkJCQl9CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJdGhyb3cgbmV3IEVycm9yKCd0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseScpOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0sCgkJCQkJYWJydXB0OiBmdW5jdGlvbiBhYnJ1cHQodHlwZSwgYXJnKSB7CgkJCQkJCWZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKCQkJCQkJCXZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTsKCQkJCQkJCWlmIChlbnRyeS50cnlMb2MgPD0gdGhpcy5wcmV2ICYmIGhhc093bi5jYWxsKGVudHJ5LCAnZmluYWxseUxvYycpICYmIHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHsKCQkJCQkJCQl2YXIgZmluYWxseUVudHJ5ID0gZW50cnk7CgkJCQkJCQkJYnJlYWs7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJaWYgKGZpbmFsbHlFbnRyeSAmJiAodHlwZSA9PT0gJ2JyZWFrJyB8fCB0eXBlID09PSAnY29udGludWUnKSAmJiBmaW5hbGx5RW50cnkudHJ5TG9jIDw9IGFyZyAmJiBhcmcgPD0gZmluYWxseUVudHJ5LmZpbmFsbHlMb2MpIHsKCQkJCQkJCS8vIElnbm9yZSB0aGUgZmluYWxseSBlbnRyeSBpZiBjb250cm9sIGlzIG5vdCBqdW1waW5nIHRvIGEKCQkJCQkJCS8vIGxvY2F0aW9uIG91dHNpZGUgdGhlIHRyeS9jYXRjaCBibG9jay4KCQkJCQkJCWZpbmFsbHlFbnRyeSA9IG51bGw7CgkJCQkJCX0KCQkJCQkJdmFyIHJlY29yZCA9IGZpbmFsbHlFbnRyeSA/IGZpbmFsbHlFbnRyeS5jb21wbGV0aW9uIDoge307CgkJCQkJCXJlY29yZC50eXBlID0gdHlwZTsKCQkJCQkJcmVjb3JkLmFyZyA9IGFyZzsKCQkJCQkJaWYgKGZpbmFsbHlFbnRyeSkgewoJCQkJCQkJdGhpcy5tZXRob2QgPSAnbmV4dCc7CgkJCQkJCQl0aGlzLm5leHQgPSBmaW5hbGx5RW50cnkuZmluYWxseUxvYzsKCQkJCQkJCXJldHVybiBDb250aW51ZVNlbnRpbmVsOwoJCQkJCQl9CgkJCQkJCXJldHVybiB0aGlzLmNvbXBsZXRlKHJlY29yZCk7CgkJCQkJfSwKCQkJCQljb21wbGV0ZTogZnVuY3Rpb24gY29tcGxldGUocmVjb3JkLCBhZnRlckxvYykgewoJCQkJCQlpZiAocmVjb3JkLnR5cGUgPT09ICd0aHJvdycpIHsKCQkJCQkJCXRocm93IHJlY29yZC5hcmc7CgkJCQkJCX0KCQkJCQkJaWYgKHJlY29yZC50eXBlID09PSAnYnJlYWsnIHx8IHJlY29yZC50eXBlID09PSAnY29udGludWUnKSB7CgkJCQkJCQl0aGlzLm5leHQgPSByZWNvcmQuYXJnOwoJCQkJCQl9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSAncmV0dXJuJykgewoJCQkJCQkJdGhpcy5ydmFsID0gdGhpcy5hcmcgPSByZWNvcmQuYXJnOwoJCQkJCQkJdGhpcy5tZXRob2QgPSAncmV0dXJuJzsKCQkJCQkJCXRoaXMubmV4dCA9ICdlbmQnOwoJCQkJCQl9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSAnbm9ybWFsJyAmJiBhZnRlckxvYykgewoJCQkJCQkJdGhpcy5uZXh0ID0gYWZ0ZXJMb2M7CgkJCQkJCX0KCQkJCQkJcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CgkJCQkJfSwKCQkJCQlmaW5pc2g6IGZ1bmN0aW9uIGZpbmlzaChmaW5hbGx5TG9jKSB7CgkJCQkJCWZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKCQkJCQkJCXZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTsKCQkJCQkJCWlmIChlbnRyeS5maW5hbGx5TG9jID09PSBmaW5hbGx5TG9jKSB7CgkJCQkJCQkJdGhpcy5jb21wbGV0ZShlbnRyeS5jb21wbGV0aW9uLCBlbnRyeS5hZnRlckxvYyk7CgkJCQkJCQkJcmVzZXRUcnlFbnRyeShlbnRyeSk7CgkJCQkJCQkJcmV0dXJuIENvbnRpbnVlU2VudGluZWw7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9LAoJCQkJCSdjYXRjaCc6IGZ1bmN0aW9uIF9jYXRjaCh0cnlMb2MpIHsKCQkJCQkJZm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewoJCQkJCQkJdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldOwoJCQkJCQkJaWYgKGVudHJ5LnRyeUxvYyA9PT0gdHJ5TG9jKSB7CgkJCQkJCQkJdmFyIHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247CgkJCQkJCQkJaWYgKHJlY29yZC50eXBlID09PSAndGhyb3cnKSB7CgkJCQkJCQkJCXZhciB0aHJvd24gPSByZWNvcmQuYXJnOwoJCQkJCQkJCQlyZXNldFRyeUVudHJ5KGVudHJ5KTsKCQkJCQkJCQl9CgkJCQkJCQkJcmV0dXJuIHRocm93bjsKCQkJCQkJCX0KCQkJCQkJfQoKCQkJCQkJLy8gVGhlIGNvbnRleHQuY2F0Y2ggbWV0aG9kIG11c3Qgb25seSBiZSBjYWxsZWQgd2l0aCBhIGxvY2F0aW9uCgkJCQkJCS8vIGFyZ3VtZW50IHRoYXQgY29ycmVzcG9uZHMgdG8gYSBrbm93biBjYXRjaCBibG9jay4KCQkJCQkJdGhyb3cgbmV3IEVycm9yKCdpbGxlZ2FsIGNhdGNoIGF0dGVtcHQnKTsKCQkJCQl9LAoJCQkJCWRlbGVnYXRlWWllbGQ6IGZ1bmN0aW9uIGRlbGVnYXRlWWllbGQoaXRlcmFibGUsIHJlc3VsdE5hbWUsIG5leHRMb2MpIHsKCQkJCQkJdGhpcy5kZWxlZ2F0ZSA9IHsKCQkJCQkJCWl0ZXJhdG9yOiB2YWx1ZXMoaXRlcmFibGUpLAoJCQkJCQkJcmVzdWx0TmFtZTogcmVzdWx0TmFtZSwKCQkJCQkJCW5leHRMb2M6IG5leHRMb2MKCQkJCQkJfTsKCQkJCQkJaWYgKHRoaXMubWV0aG9kID09PSAnbmV4dCcpIHsKCQkJCQkJCS8vIERlbGliZXJhdGVseSBmb3JnZXQgdGhlIGxhc3Qgc2VudCB2YWx1ZSBzbyB0aGF0IHdlIGRvbid0CgkJCQkJCQkvLyBhY2NpZGVudGFsbHkgcGFzcyBpdCBvbiB0byB0aGUgZGVsZWdhdGUuCgkJCQkJCQl0aGlzLmFyZyA9IHVuZGVmaW5lZDsKCQkJCQkJfQoJCQkJCQlyZXR1cm4gQ29udGludWVTZW50aW5lbDsKCQkJCQl9CgkJCQl9OwoJCQl9KAovLyBBbW9uZyB0aGUgdmFyaW91cyB0cmlja3MgZm9yIG9idGFpbmluZyBhIHJlZmVyZW5jZSB0byB0aGUgZ2xvYmFsCi8vIG9iamVjdCwgdGhpcyBzZWVtcyB0byBiZSB0aGUgbW9zdCByZWxpYWJsZSB0ZWNobmlxdWUgdGhhdCBkb2VzIG5vdAovLyB1c2UgaW5kaXJlY3QgZXZhbCAod2hpY2ggdmlvbGF0ZXMgQ29udGVudCBTZWN1cml0eSBQb2xpY3kpLgoJCQkJKHR5cGVvZiBfX3dlYnBhY2tfcmVxdWlyZV9fLmcgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKF9fd2VicGFja19yZXF1aXJlX18uZykpID09PSAnb2JqZWN0JyA/IF9fd2VicGFja19yZXF1aXJlX18uZyA6ICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZih3aW5kb3cpKSA9PT0gJ29iamVjdCcgPyB3aW5kb3cgOiAodHlwZW9mIHNlbGYgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKHNlbGYpKSA9PT0gJ29iamVjdCcgPyBzZWxmIDogdGhpcyk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA1NTE4OgoJCS8qKiovIChmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pIHsKCgkJCXZhciBfX1dFQlBBQ0tfQU1EX0RFRklORV9SRVNVTFRfXzsKCgkJCWZ1bmN0aW9uIF90eXBlb2YobykgewoJCQkJJ0BiYWJlbC9oZWxwZXJzIC0gdHlwZW9mJzsKCQkJCXJldHVybiBfdHlwZW9mID0gJ2Z1bmN0aW9uJyA9PSB0eXBlb2YgU3ltYm9sICYmICdzeW1ib2wnID09IHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPyBmdW5jdGlvbihvKSB7CgkJCQkJcmV0dXJuIHR5cGVvZiBvOwoJCQkJfSA6IGZ1bmN0aW9uKG8pIHsKCQkJCQlyZXR1cm4gbyAmJiAnZnVuY3Rpb24nID09IHR5cGVvZiBTeW1ib2wgJiYgby5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG8gIT09IFN5bWJvbC5wcm90b3R5cGUgPyAnc3ltYm9sJyA6IHR5cGVvZiBvOwoJCQkJfSwgX3R5cGVvZihvKTsKCQkJfQoJCQk7CgkJCShmdW5jdGlvbihnbG9iYWxPYmplY3QpIHsKCQkJCSd1c2Ugc3RyaWN0JzsKCgkJCQkvKgogICAqICAgICAgYmlnbnVtYmVyLmpzIHY5LjEuMgogICAqICAgICAgQSBKYXZhU2NyaXB0IGxpYnJhcnkgZm9yIGFyYml0cmFyeS1wcmVjaXNpb24gYXJpdGhtZXRpYy4KICAgKiAgICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9NaWtlTWNsL2JpZ251bWJlci5qcwogICAqICAgICAgQ29weXJpZ2h0IChjKSAyMDIyIE1pY2hhZWwgTWNsYXVnaGxpbiA8TThjaDg4bEBnbWFpbC5jb20+CiAgICogICAgICBNSVQgTGljZW5zZWQuCiAgICoKICAgKiAgICAgIEJpZ051bWJlci5wcm90b3R5cGUgbWV0aG9kcyAgICAgfCAgQmlnTnVtYmVyIG1ldGhvZHMKICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAogICAqICAgICAgYWJzb2x1dGVWYWx1ZSAgICAgICAgICAgIGFicyAgICB8ICBjbG9uZQogICAqICAgICAgY29tcGFyZWRUbyAgICAgICAgICAgICAgICAgICAgICB8ICBjb25maWcgICAgICAgICAgICAgICBzZXQKICAgKiAgICAgIGRlY2ltYWxQbGFjZXMgICAgICAgICAgICBkcCAgICAgfCAgICAgIERFQ0lNQUxfUExBQ0VTCiAgICogICAgICBkaXZpZGVkQnkgICAgICAgICAgICAgICAgZGl2ICAgIHwgICAgICBST1VORElOR19NT0RFCiAgICogICAgICBkaXZpZGVkVG9JbnRlZ2VyQnkgICAgICAgaWRpdiAgIHwgICAgICBFWFBPTkVOVElBTF9BVAogICAqICAgICAgZXhwb25lbnRpYXRlZEJ5ICAgICAgICAgIHBvdyAgICB8ICAgICAgUkFOR0UKICAgKiAgICAgIGludGVnZXJWYWx1ZSAgICAgICAgICAgICAgICAgICAgfCAgICAgIENSWVBUTwogICAqICAgICAgaXNFcXVhbFRvICAgICAgICAgICAgICAgIGVxICAgICB8ICAgICAgTU9EVUxPX01PREUKICAgKiAgICAgIGlzRmluaXRlICAgICAgICAgICAgICAgICAgICAgICAgfCAgICAgIFBPV19QUkVDSVNJT04KICAgKiAgICAgIGlzR3JlYXRlclRoYW4gICAgICAgICAgICBndCAgICAgfCAgICAgIEZPUk1BVAogICAqICAgICAgaXNHcmVhdGVyVGhhbk9yRXF1YWxUbyAgIGd0ZSAgICB8ICAgICAgQUxQSEFCRVQKICAgKiAgICAgIGlzSW50ZWdlciAgICAgICAgICAgICAgICAgICAgICAgfCAgaXNCaWdOdW1iZXIKICAgKiAgICAgIGlzTGVzc1RoYW4gICAgICAgICAgICAgICBsdCAgICAgfCAgbWF4aW11bSAgICAgICAgICAgICAgbWF4CiAgICogICAgICBpc0xlc3NUaGFuT3JFcXVhbFRvICAgICAgbHRlICAgIHwgIG1pbmltdW0gICAgICAgICAgICAgIG1pbgogICAqICAgICAgaXNOYU4gICAgICAgICAgICAgICAgICAgICAgICAgICB8ICByYW5kb20KICAgKiAgICAgIGlzTmVnYXRpdmUgICAgICAgICAgICAgICAgICAgICAgfCAgc3VtCiAgICogICAgICBpc1Bvc2l0aXZlICAgICAgICAgICAgICAgICAgICAgIHwKICAgKiAgICAgIGlzWmVybyAgICAgICAgICAgICAgICAgICAgICAgICAgfAogICAqICAgICAgbWludXMgICAgICAgICAgICAgICAgICAgICAgICAgICB8CiAgICogICAgICBtb2R1bG8gICAgICAgICAgICAgICAgICAgbW9kICAgIHwKICAgKiAgICAgIG11bHRpcGxpZWRCeSAgICAgICAgICAgICB0aW1lcyAgfAogICAqICAgICAgbmVnYXRlZCAgICAgICAgICAgICAgICAgICAgICAgICB8CiAgICogICAgICBwbHVzICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwKICAgKiAgICAgIHByZWNpc2lvbiAgICAgICAgICAgICAgICBzZCAgICAgfAogICAqICAgICAgc2hpZnRlZEJ5ICAgICAgICAgICAgICAgICAgICAgICB8CiAgICogICAgICBzcXVhcmVSb290ICAgICAgICAgICAgICAgc3FydCAgIHwKICAgKiAgICAgIHRvRXhwb25lbnRpYWwgICAgICAgICAgICAgICAgICAgfAogICAqICAgICAgdG9GaXhlZCAgICAgICAgICAgICAgICAgICAgICAgICB8CiAgICogICAgICB0b0Zvcm1hdCAgICAgICAgICAgICAgICAgICAgICAgIHwKICAgKiAgICAgIHRvRnJhY3Rpb24gICAgICAgICAgICAgICAgICAgICAgfAogICAqICAgICAgdG9KU09OICAgICAgICAgICAgICAgICAgICAgICAgICB8CiAgICogICAgICB0b051bWJlciAgICAgICAgICAgICAgICAgICAgICAgIHwKICAgKiAgICAgIHRvUHJlY2lzaW9uICAgICAgICAgICAgICAgICAgICAgfAogICAqICAgICAgdG9TdHJpbmcgICAgICAgICAgICAgICAgICAgICAgICB8CiAgICogICAgICB2YWx1ZU9mICAgICAgICAgICAgICAgICAgICAgICAgIHwKICAgKgogICAqLwoJCQkJdmFyIEJpZ051bWJlciwKCQkJCQlpc051bWVyaWMgPSAvXi0/KD86XGQrKD86XC5cZCopP3xcLlxkKykoPzplWystXT9cZCspPyQvaSwKCQkJCQltYXRoY2VpbCA9IE1hdGguY2VpbCwKCQkJCQltYXRoZmxvb3IgPSBNYXRoLmZsb29yLAoJCQkJCWJpZ251bWJlckVycm9yID0gJ1tCaWdOdW1iZXIgRXJyb3JdICcsCgkJCQkJdG9vTWFueURpZ2l0cyA9IGJpZ251bWJlckVycm9yICsgJ051bWJlciBwcmltaXRpdmUgaGFzIG1vcmUgdGhhbiAxNSBzaWduaWZpY2FudCBkaWdpdHM6ICcsCgkJCQkJQkFTRSA9IDFlMTQsCgkJCQkJTE9HX0JBU0UgPSAxNCwKCQkJCQlNQVhfU0FGRV9JTlRFR0VSID0gMHgxZmZmZmZmZmZmZmZmZiwKCQkJCQkvLyAyXjUzIC0gMQoJCQkJCS8vIE1BWF9JTlQzMiA9IDB4N2ZmZmZmZmYsICAgICAgICAgICAgICAgICAgIC8vIDJeMzEgLSAxCgkJCQkJUE9XU19URU4gPSBbMSwgMTAsIDEwMCwgMWUzLCAxZTQsIDFlNSwgMWU2LCAxZTcsIDFlOCwgMWU5LCAxZTEwLCAxZTExLCAxZTEyLCAxZTEzXSwKCQkJCQlTUVJUX0JBU0UgPSAxZTcsCgkJCQkJLy8gRURJVEFCTEUKCQkJCQkvLyBUaGUgbGltaXQgb24gdGhlIHZhbHVlIG9mIERFQ0lNQUxfUExBQ0VTLCBUT19FWFBfTkVHLCBUT19FWFBfUE9TLCBNSU5fRVhQLCBNQVhfRVhQLCBhbmQKCQkJCQkvLyB0aGUgYXJndW1lbnRzIHRvIHRvRXhwb25lbnRpYWwsIHRvRml4ZWQsIHRvRm9ybWF0LCBhbmQgdG9QcmVjaXNpb24uCgkJCQkJTUFYID0gMUU5OyAvLyAwIHRvIE1BWF9JTlQzMgoKCQkJCS8qCiAgICogQ3JlYXRlIGFuZCByZXR1cm4gYSBCaWdOdW1iZXIgY29uc3RydWN0b3IuCiAgICovCgkJCQlmdW5jdGlvbiBjbG9uZShjb25maWdPYmplY3QpIHsKCQkJCQl2YXIgZGl2LAoJCQkJCQljb252ZXJ0QmFzZSwKCQkJCQkJcGFyc2VOdW1lcmljLAoJCQkJCQlQID0gQmlnTnVtYmVyLnByb3RvdHlwZSA9IHsKCQkJCQkJCWNvbnN0cnVjdG9yOiBCaWdOdW1iZXIsCgkJCQkJCQl0b1N0cmluZzogbnVsbCwKCQkJCQkJCXZhbHVlT2Y6IG51bGwKCQkJCQkJfSwKCQkJCQkJT05FID0gbmV3IEJpZ051bWJlcigxKSwKCQkJCQkJLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBFRElUQUJMRSBDT05GSUcgREVGQVVMVFMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKCQkJCQkJLy8gVGhlIGRlZmF1bHQgdmFsdWVzIGJlbG93IG11c3QgYmUgaW50ZWdlcnMgd2l0aGluIHRoZSBpbmNsdXNpdmUgcmFuZ2VzIHN0YXRlZC4KCQkJCQkJLy8gVGhlIHZhbHVlcyBjYW4gYWxzbyBiZSBjaGFuZ2VkIGF0IHJ1bi10aW1lIHVzaW5nIEJpZ051bWJlci5zZXQuCgoJCQkJCQkvLyBUaGUgbWF4aW11bSBudW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMgZm9yIG9wZXJhdGlvbnMgaW52b2x2aW5nIGRpdmlzaW9uLgoJCQkJCQlERUNJTUFMX1BMQUNFUyA9IDIwLAoJCQkJCQkvLyAwIHRvIE1BWAoKCQkJCQkJLy8gVGhlIHJvdW5kaW5nIG1vZGUgdXNlZCB3aGVuIHJvdW5kaW5nIHRvIHRoZSBhYm92ZSBkZWNpbWFsIHBsYWNlcywgYW5kIHdoZW4gdXNpbmcKCQkJCQkJLy8gdG9FeHBvbmVudGlhbCwgdG9GaXhlZCwgdG9Gb3JtYXQgYW5kIHRvUHJlY2lzaW9uLCBhbmQgcm91bmQgKGRlZmF1bHQgdmFsdWUpLgoJCQkJCQkvLyBVUCAgICAgICAgIDAgQXdheSBmcm9tIHplcm8uCgkJCQkJCS8vIERPV04gICAgICAgMSBUb3dhcmRzIHplcm8uCgkJCQkJCS8vIENFSUwgICAgICAgMiBUb3dhcmRzICtJbmZpbml0eS4KCQkJCQkJLy8gRkxPT1IgICAgICAzIFRvd2FyZHMgLUluZmluaXR5LgoJCQkJCQkvLyBIQUxGX1VQICAgIDQgVG93YXJkcyBuZWFyZXN0IG5laWdoYm91ci4gSWYgZXF1aWRpc3RhbnQsIHVwLgoJCQkJCQkvLyBIQUxGX0RPV04gIDUgVG93YXJkcyBuZWFyZXN0IG5laWdoYm91ci4gSWYgZXF1aWRpc3RhbnQsIGRvd24uCgkJCQkJCS8vIEhBTEZfRVZFTiAgNiBUb3dhcmRzIG5lYXJlc3QgbmVpZ2hib3VyLiBJZiBlcXVpZGlzdGFudCwgdG93YXJkcyBldmVuIG5laWdoYm91ci4KCQkJCQkJLy8gSEFMRl9DRUlMICA3IFRvd2FyZHMgbmVhcmVzdCBuZWlnaGJvdXIuIElmIGVxdWlkaXN0YW50LCB0b3dhcmRzICtJbmZpbml0eS4KCQkJCQkJLy8gSEFMRl9GTE9PUiA4IFRvd2FyZHMgbmVhcmVzdCBuZWlnaGJvdXIuIElmIGVxdWlkaXN0YW50LCB0b3dhcmRzIC1JbmZpbml0eS4KCQkJCQkJUk9VTkRJTkdfTU9ERSA9IDQsCgkJCQkJCS8vIDAgdG8gOAoKCQkJCQkJLy8gRVhQT05FTlRJQUxfQVQgOiBbVE9fRVhQX05FRyAsIFRPX0VYUF9QT1NdCgoJCQkJCQkvLyBUaGUgZXhwb25lbnQgdmFsdWUgYXQgYW5kIGJlbmVhdGggd2hpY2ggdG9TdHJpbmcgcmV0dXJucyBleHBvbmVudGlhbCBub3RhdGlvbi4KCQkJCQkJLy8gTnVtYmVyIHR5cGU6IC03CgkJCQkJCVRPX0VYUF9ORUcgPSAtNywKCQkJCQkJLy8gMCB0byAtTUFYCgoJCQkJCQkvLyBUaGUgZXhwb25lbnQgdmFsdWUgYXQgYW5kIGFib3ZlIHdoaWNoIHRvU3RyaW5nIHJldHVybnMgZXhwb25lbnRpYWwgbm90YXRpb24uCgkJCQkJCS8vIE51bWJlciB0eXBlOiAyMQoJCQkJCQlUT19FWFBfUE9TID0gMjEsCgkJCQkJCS8vIDAgdG8gTUFYCgoJCQkJCQkvLyBSQU5HRSA6IFtNSU5fRVhQLCBNQVhfRVhQXQoKCQkJCQkJLy8gVGhlIG1pbmltdW0gZXhwb25lbnQgdmFsdWUsIGJlbmVhdGggd2hpY2ggdW5kZXJmbG93IHRvIHplcm8gb2NjdXJzLgoJCQkJCQkvLyBOdW1iZXIgdHlwZTogLTMyNCAgKDVlLTMyNCkKCQkJCQkJTUlOX0VYUCA9IC0xZTcsCgkJCQkJCS8vIC0xIHRvIC1NQVgKCgkJCQkJCS8vIFRoZSBtYXhpbXVtIGV4cG9uZW50IHZhbHVlLCBhYm92ZSB3aGljaCBvdmVyZmxvdyB0byBJbmZpbml0eSBvY2N1cnMuCgkJCQkJCS8vIE51bWJlciB0eXBlOiAgMzA4ICAoMS43OTc2OTMxMzQ4NjIzMTU3ZSszMDgpCgkJCQkJCS8vIEZvciBNQVhfRVhQID4gMWU3LCBlLmcuIG5ldyBCaWdOdW1iZXIoJzFlMTAwMDAwMDAwJykucGx1cygxKSBtYXkgYmUgc2xvdy4KCQkJCQkJTUFYX0VYUCA9IDFlNywKCQkJCQkJLy8gMSB0byBNQVgKCgkJCQkJCS8vIFdoZXRoZXIgdG8gdXNlIGNyeXB0b2dyYXBoaWNhbGx5LXNlY3VyZSByYW5kb20gbnVtYmVyIGdlbmVyYXRpb24sIGlmIGF2YWlsYWJsZS4KCQkJCQkJQ1JZUFRPID0gZmFsc2UsCgkJCQkJCS8vIHRydWUgb3IgZmFsc2UKCgkJCQkJCS8vIFRoZSBtb2R1bG8gbW9kZSB1c2VkIHdoZW4gY2FsY3VsYXRpbmcgdGhlIG1vZHVsdXM6IGEgbW9kIG4uCgkJCQkJCS8vIFRoZSBxdW90aWVudCAocSA9IGEgLyBuKSBpcyBjYWxjdWxhdGVkIGFjY29yZGluZyB0byB0aGUgY29ycmVzcG9uZGluZyByb3VuZGluZyBtb2RlLgoJCQkJCQkvLyBUaGUgcmVtYWluZGVyIChyKSBpcyBjYWxjdWxhdGVkIGFzOiByID0gYSAtIG4gKiBxLgoJCQkJCQkvLwoJCQkJCQkvLyBVUCAgICAgICAgMCBUaGUgcmVtYWluZGVyIGlzIHBvc2l0aXZlIGlmIHRoZSBkaXZpZGVuZCBpcyBuZWdhdGl2ZSwgZWxzZSBpcyBuZWdhdGl2ZS4KCQkJCQkJLy8gRE9XTiAgICAgIDEgVGhlIHJlbWFpbmRlciBoYXMgdGhlIHNhbWUgc2lnbiBhcyB0aGUgZGl2aWRlbmQuCgkJCQkJCS8vICAgICAgICAgICAgIFRoaXMgbW9kdWxvIG1vZGUgaXMgY29tbW9ubHkga25vd24gYXMgJ3RydW5jYXRlZCBkaXZpc2lvbicgYW5kIGlzCgkJCQkJCS8vICAgICAgICAgICAgIGVxdWl2YWxlbnQgdG8gKGEgJSBuKSBpbiBKYXZhU2NyaXB0LgoJCQkJCQkvLyBGTE9PUiAgICAgMyBUaGUgcmVtYWluZGVyIGhhcyB0aGUgc2FtZSBzaWduIGFzIHRoZSBkaXZpc29yIChQeXRob24gJSkuCgkJCQkJCS8vIEhBTEZfRVZFTiA2IFRoaXMgbW9kdWxvIG1vZGUgaW1wbGVtZW50cyB0aGUgSUVFRSA3NTQgcmVtYWluZGVyIGZ1bmN0aW9uLgoJCQkJCQkvLyBFVUNMSUQgICAgOSBFdWNsaWRpYW4gZGl2aXNpb24uIHEgPSBzaWduKG4pICogZmxvb3IoYSAvIGFicyhuKSkuCgkJCQkJCS8vICAgICAgICAgICAgIFRoZSByZW1haW5kZXIgaXMgYWx3YXlzIHBvc2l0aXZlLgoJCQkJCQkvLwoJCQkJCQkvLyBUaGUgdHJ1bmNhdGVkIGRpdmlzaW9uLCBmbG9vcmVkIGRpdmlzaW9uLCBFdWNsaWRpYW4gZGl2aXNpb24gYW5kIElFRUUgNzU0IHJlbWFpbmRlcgoJCQkJCQkvLyBtb2RlcyBhcmUgY29tbW9ubHkgdXNlZCBmb3IgdGhlIG1vZHVsdXMgb3BlcmF0aW9uLgoJCQkJCQkvLyBBbHRob3VnaCB0aGUgb3RoZXIgcm91bmRpbmcgbW9kZXMgY2FuIGFsc28gYmUgdXNlZCwgdGhleSBtYXkgbm90IGdpdmUgdXNlZnVsIHJlc3VsdHMuCgkJCQkJCU1PRFVMT19NT0RFID0gMSwKCQkJCQkJLy8gMCB0byA5CgoJCQkJCQkvLyBUaGUgbWF4aW11bSBudW1iZXIgb2Ygc2lnbmlmaWNhbnQgZGlnaXRzIG9mIHRoZSByZXN1bHQgb2YgdGhlIGV4cG9uZW50aWF0ZWRCeSBvcGVyYXRpb24uCgkJCQkJCS8vIElmIFBPV19QUkVDSVNJT04gaXMgMCwgdGhlcmUgd2lsbCBiZSB1bmxpbWl0ZWQgc2lnbmlmaWNhbnQgZGlnaXRzLgoJCQkJCQlQT1dfUFJFQ0lTSU9OID0gMCwKCQkJCQkJLy8gMCB0byBNQVgKCgkJCQkJCS8vIFRoZSBmb3JtYXQgc3BlY2lmaWNhdGlvbiB1c2VkIGJ5IHRoZSBCaWdOdW1iZXIucHJvdG90eXBlLnRvRm9ybWF0IG1ldGhvZC4KCQkJCQkJRk9STUFUID0gewoJCQkJCQkJcHJlZml4OiAnJywKCQkJCQkJCWdyb3VwU2l6ZTogMywKCQkJCQkJCXNlY29uZGFyeUdyb3VwU2l6ZTogMCwKCQkJCQkJCWdyb3VwU2VwYXJhdG9yOiAnLCcsCgkJCQkJCQlkZWNpbWFsU2VwYXJhdG9yOiAnLicsCgkJCQkJCQlmcmFjdGlvbkdyb3VwU2l6ZTogMCwKCQkJCQkJCWZyYWN0aW9uR3JvdXBTZXBhcmF0b3I6ICdceEEwJywKCQkJCQkJCS8vIG5vbi1icmVha2luZyBzcGFjZQoJCQkJCQkJc3VmZml4OiAnJwoJCQkJCQl9LAoJCQkJCQkvLyBUaGUgYWxwaGFiZXQgdXNlZCBmb3IgYmFzZSBjb252ZXJzaW9uLiBJdCBtdXN0IGJlIGF0IGxlYXN0IDIgY2hhcmFjdGVycyBsb25nLCB3aXRoIG5vICcrJywKCQkJCQkJLy8gJy0nLCAnLicsIHdoaXRlc3BhY2UsIG9yIHJlcGVhdGVkIGNoYXJhY3Rlci4KCQkJCQkJLy8gJzAxMjM0NTY3ODlhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ekFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaJF8nCgkJCQkJCUFMUEhBQkVUID0gJzAxMjM0NTY3ODlhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eicsCgkJCQkJCWFscGhhYmV0SGFzTm9ybWFsRGVjaW1hbERpZ2l0cyA9IHRydWU7CgoJCQkJCS8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoJCQkJCS8vIENPTlNUUlVDVE9SCgoJCQkJCS8qCiAgICAgKiBUaGUgQmlnTnVtYmVyIGNvbnN0cnVjdG9yIGFuZCBleHBvcnRlZCBmdW5jdGlvbi4KICAgICAqIENyZWF0ZSBhbmQgcmV0dXJuIGEgbmV3IGluc3RhbmNlIG9mIGEgQmlnTnVtYmVyIG9iamVjdC4KICAgICAqCiAgICAgKiB2IHtudW1iZXJ8c3RyaW5nfEJpZ051bWJlcn0gQSBudW1lcmljIHZhbHVlLgogICAgICogW2JdIHtudW1iZXJ9IFRoZSBiYXNlIG9mIHYuIEludGVnZXIsIDIgdG8gQUxQSEFCRVQubGVuZ3RoIGluY2x1c2l2ZS4KICAgICAqLwoJCQkJCWZ1bmN0aW9uIEJpZ051bWJlcih2LCBiKSB7CgkJCQkJCXZhciBhbHBoYWJldCwKCQkJCQkJCWMsCgkJCQkJCQljYXNlQ2hhbmdlZCwKCQkJCQkJCWUsCgkJCQkJCQlpLAoJCQkJCQkJaXNOdW0sCgkJCQkJCQlsZW4sCgkJCQkJCQlzdHIsCgkJCQkJCQl4ID0gdGhpczsKCgkJCQkJCS8vIEVuYWJsZSBjb25zdHJ1Y3RvciBjYWxsIHdpdGhvdXQgYG5ld2AuCgkJCQkJCWlmICghKHggaW5zdGFuY2VvZiBCaWdOdW1iZXIpKSByZXR1cm4gbmV3IEJpZ051bWJlcih2LCBiKTsKCQkJCQkJaWYgKGIgPT0gbnVsbCkgewoJCQkJCQkJaWYgKHYgJiYgdi5faXNCaWdOdW1iZXIgPT09IHRydWUpIHsKCQkJCQkJCQl4LnMgPSB2LnM7CgkJCQkJCQkJaWYgKCF2LmMgfHwgdi5lID4gTUFYX0VYUCkgewoJCQkJCQkJCQl4LmMgPSB4LmUgPSBudWxsOwoJCQkJCQkJCX0gZWxzZSBpZiAodi5lIDwgTUlOX0VYUCkgewoJCQkJCQkJCQl4LmMgPSBbeC5lID0gMF07CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJeC5lID0gdi5lOwoJCQkJCQkJCQl4LmMgPSB2LmMuc2xpY2UoKTsKCQkJCQkJCQl9CgkJCQkJCQkJcmV0dXJuOwoJCQkJCQkJfQoJCQkJCQkJaWYgKChpc051bSA9IHR5cGVvZiB2ID09ICdudW1iZXInKSAmJiB2ICogMCA9PSAwKSB7CgkJCQkJCQkJLy8gVXNlIGAxIC8gbmAgdG8gaGFuZGxlIG1pbnVzIHplcm8gYWxzby4KCQkJCQkJCQl4LnMgPSAxIC8gdiA8IDAgPyAodiA9IC12LCAtMSkgOiAxOwoKCQkJCQkJCQkvLyBGYXN0IHBhdGggZm9yIGludGVnZXJzLCB3aGVyZSBuIDwgMjE0NzQ4MzY0OCAoMioqMzEpLgoJCQkJCQkJCWlmICh2ID09PSB+fnYpIHsKCQkJCQkJCQkJZm9yIChlID0gMCwgaSA9IHY7IGkgPj0gMTA7IGkgLz0gMTAsIGUrKykgOwoJCQkJCQkJCQlpZiAoZSA+IE1BWF9FWFApIHsKCQkJCQkJCQkJCXguYyA9IHguZSA9IG51bGw7CgkJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCQl4LmUgPSBlOwoJCQkJCQkJCQkJeC5jID0gW3ZdOwoJCQkJCQkJCQl9CgkJCQkJCQkJCXJldHVybjsKCQkJCQkJCQl9CgkJCQkJCQkJc3RyID0gU3RyaW5nKHYpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlpZiAoIWlzTnVtZXJpYy50ZXN0KHN0ciA9IFN0cmluZyh2KSkpIHJldHVybiBwYXJzZU51bWVyaWMoeCwgc3RyLCBpc051bSk7CgkJCQkJCQkJeC5zID0gc3RyLmNoYXJDb2RlQXQoMCkgPT0gNDUgPyAoc3RyID0gc3RyLnNsaWNlKDEpLCAtMSkgOiAxOwoJCQkJCQkJfQoKCQkJCQkJCS8vIERlY2ltYWwgcG9pbnQ/CgkJCQkJCQlpZiAoKGUgPSBzdHIuaW5kZXhPZignLicpKSA+IC0xKSBzdHIgPSBzdHIucmVwbGFjZSgnLicsICcnKTsKCgkJCQkJCQkvLyBFeHBvbmVudGlhbCBmb3JtPwoJCQkJCQkJaWYgKChpID0gc3RyLnNlYXJjaCgvZS9pKSkgPiAwKSB7CgkJCQkJCQkJLy8gRGV0ZXJtaW5lIGV4cG9uZW50LgoJCQkJCQkJCWlmIChlIDwgMCkgZSA9IGk7CgkJCQkJCQkJZSArPSArc3RyLnNsaWNlKGkgKyAxKTsKCQkJCQkJCQlzdHIgPSBzdHIuc3Vic3RyaW5nKDAsIGkpOwoJCQkJCQkJfSBlbHNlIGlmIChlIDwgMCkgewoJCQkJCQkJCS8vIEludGVnZXIuCgkJCQkJCQkJZSA9IHN0ci5sZW5ndGg7CgkJCQkJCQl9CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkvLyAnW0JpZ051bWJlciBFcnJvcl0gQmFzZSB7bm90IGEgcHJpbWl0aXZlIG51bWJlcnxub3QgYW4gaW50ZWdlcnxvdXQgb2YgcmFuZ2V9OiB7Yn0nCgkJCQkJCQlpbnRDaGVjayhiLCAyLCBBTFBIQUJFVC5sZW5ndGgsICdCYXNlJyk7CgoJCQkJCQkJLy8gQWxsb3cgZXhwb25lbnRpYWwgbm90YXRpb24gdG8gYmUgdXNlZCB3aXRoIGJhc2UgMTAgYXJndW1lbnQsIHdoaWxlCgkJCQkJCQkvLyBhbHNvIHJvdW5kaW5nIHRvIERFQ0lNQUxfUExBQ0VTIGFzIHdpdGggb3RoZXIgYmFzZXMuCgkJCQkJCQlpZiAoYiA9PSAxMCAmJiBhbHBoYWJldEhhc05vcm1hbERlY2ltYWxEaWdpdHMpIHsKCQkJCQkJCQl4ID0gbmV3IEJpZ051bWJlcih2KTsKCQkJCQkJCQlyZXR1cm4gcm91bmQoeCwgREVDSU1BTF9QTEFDRVMgKyB4LmUgKyAxLCBST1VORElOR19NT0RFKTsKCQkJCQkJCX0KCQkJCQkJCXN0ciA9IFN0cmluZyh2KTsKCQkJCQkJCWlmIChpc051bSA9IHR5cGVvZiB2ID09ICdudW1iZXInKSB7CgkJCQkJCQkJLy8gQXZvaWQgcG90ZW50aWFsIGludGVycHJldGF0aW9uIG9mIEluZmluaXR5IGFuZCBOYU4gYXMgYmFzZSA0NCsgdmFsdWVzLgoJCQkJCQkJCWlmICh2ICogMCAhPSAwKSByZXR1cm4gcGFyc2VOdW1lcmljKHgsIHN0ciwgaXNOdW0sIGIpOwoJCQkJCQkJCXgucyA9IDEgLyB2IDwgMCA/IChzdHIgPSBzdHIuc2xpY2UoMSksIC0xKSA6IDE7CgoJCQkJCQkJCS8vICdbQmlnTnVtYmVyIEVycm9yXSBOdW1iZXIgcHJpbWl0aXZlIGhhcyBtb3JlIHRoYW4gMTUgc2lnbmlmaWNhbnQgZGlnaXRzOiB7bn0nCgkJCQkJCQkJaWYgKEJpZ051bWJlci5ERUJVRyAmJiBzdHIucmVwbGFjZSgvXjBcLjAqfFwuLywgJycpLmxlbmd0aCA+IDE1KSB7CgkJCQkJCQkJCXRocm93IEVycm9yKHRvb01hbnlEaWdpdHMgKyB2KTsKCQkJCQkJCQl9CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXgucyA9IHN0ci5jaGFyQ29kZUF0KDApID09PSA0NSA/IChzdHIgPSBzdHIuc2xpY2UoMSksIC0xKSA6IDE7CgkJCQkJCQl9CgkJCQkJCQlhbHBoYWJldCA9IEFMUEhBQkVULnNsaWNlKDAsIGIpOwoJCQkJCQkJZSA9IGkgPSAwOwoKCQkJCQkJCS8vIENoZWNrIHRoYXQgc3RyIGlzIGEgdmFsaWQgYmFzZSBiIG51bWJlci4KCQkJCQkJCS8vIERvbid0IHVzZSBSZWdFeHAsIHNvIGFscGhhYmV0IGNhbiBjb250YWluIHNwZWNpYWwgY2hhcmFjdGVycy4KCQkJCQkJCWZvciAobGVuID0gc3RyLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CgkJCQkJCQkJaWYgKGFscGhhYmV0LmluZGV4T2YoYyA9IHN0ci5jaGFyQXQoaSkpIDwgMCkgewoJCQkJCQkJCQlpZiAoYyA9PSAnLicpIHsKCQkJCQkJCQkJCS8vIElmICcuJyBpcyBub3QgdGhlIGZpcnN0IGNoYXJhY3RlciBhbmQgaXQgaGFzIG5vdCBiZSBmb3VuZCBiZWZvcmUuCgkJCQkJCQkJCQlpZiAoaSA+IGUpIHsKCQkJCQkJCQkJCQllID0gbGVuOwoJCQkJCQkJCQkJCWNvbnRpbnVlOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQl9IGVsc2UgaWYgKCFjYXNlQ2hhbmdlZCkgewoJCQkJCQkJCQkJLy8gQWxsb3cgZS5nLiBoZXhhZGVjaW1hbCAnRkYnIGFzIHdlbGwgYXMgJ2ZmJy4KCQkJCQkJCQkJCWlmIChzdHIgPT0gc3RyLnRvVXBwZXJDYXNlKCkgJiYgKHN0ciA9IHN0ci50b0xvd2VyQ2FzZSgpKSB8fCBzdHIgPT0gc3RyLnRvTG93ZXJDYXNlKCkgJiYgKHN0ciA9IHN0ci50b1VwcGVyQ2FzZSgpKSkgewoJCQkJCQkJCQkJCWNhc2VDaGFuZ2VkID0gdHJ1ZTsKCQkJCQkJCQkJCQlpID0gLTE7CgkJCQkJCQkJCQkJZSA9IDA7CgkJCQkJCQkJCQkJY29udGludWU7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0KCQkJCQkJCQkJcmV0dXJuIHBhcnNlTnVtZXJpYyh4LCBTdHJpbmcodiksIGlzTnVtLCBiKTsKCQkJCQkJCQl9CgkJCQkJCQl9CgoJCQkJCQkJLy8gUHJldmVudCBsYXRlciBjaGVjayBmb3IgbGVuZ3RoIG9uIGNvbnZlcnRlZCBudW1iZXIuCgkJCQkJCQlpc051bSA9IGZhbHNlOwoJCQkJCQkJc3RyID0gY29udmVydEJhc2Uoc3RyLCBiLCAxMCwgeC5zKTsKCgkJCQkJCQkvLyBEZWNpbWFsIHBvaW50PwoJCQkJCQkJaWYgKChlID0gc3RyLmluZGV4T2YoJy4nKSkgPiAtMSkgc3RyID0gc3RyLnJlcGxhY2UoJy4nLCAnJyk7IGVsc2UgZSA9IHN0ci5sZW5ndGg7CgkJCQkJCX0KCgkJCQkJCS8vIERldGVybWluZSBsZWFkaW5nIHplcm9zLgoJCQkJCQlmb3IgKGkgPSAwOyBzdHIuY2hhckNvZGVBdChpKSA9PT0gNDg7IGkrKykgOwoKCQkJCQkJLy8gRGV0ZXJtaW5lIHRyYWlsaW5nIHplcm9zLgoJCQkJCQlmb3IgKGxlbiA9IHN0ci5sZW5ndGg7IHN0ci5jaGFyQ29kZUF0KC0tbGVuKSA9PT0gNDg7KSA7CgkJCQkJCWlmIChzdHIgPSBzdHIuc2xpY2UoaSwgKytsZW4pKSB7CgkJCQkJCQlsZW4gLT0gaTsKCgkJCQkJCQkvLyAnW0JpZ051bWJlciBFcnJvcl0gTnVtYmVyIHByaW1pdGl2ZSBoYXMgbW9yZSB0aGFuIDE1IHNpZ25pZmljYW50IGRpZ2l0czoge259JwoJCQkJCQkJaWYgKGlzTnVtICYmIEJpZ051bWJlci5ERUJVRyAmJiBsZW4gPiAxNSAmJiAodiA+IE1BWF9TQUZFX0lOVEVHRVIgfHwgdiAhPT0gbWF0aGZsb29yKHYpKSkgewoJCQkJCQkJCXRocm93IEVycm9yKHRvb01hbnlEaWdpdHMgKyB4LnMgKiB2KTsKCQkJCQkJCX0KCgkJCQkJCQkvLyBPdmVyZmxvdz8KCQkJCQkJCWlmICgoZSA9IGUgLSBpIC0gMSkgPiBNQVhfRVhQKSB7CgkJCQkJCQkJLy8gSW5maW5pdHkuCgkJCQkJCQkJeC5jID0geC5lID0gbnVsbDsKCgkJCQkJCQkJLy8gVW5kZXJmbG93PwoJCQkJCQkJfSBlbHNlIGlmIChlIDwgTUlOX0VYUCkgewoJCQkJCQkJCS8vIFplcm8uCgkJCQkJCQkJeC5jID0gW3guZSA9IDBdOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQl4LmUgPSBlOwoJCQkJCQkJCXguYyA9IFtdOwoKCQkJCQkJCQkvLyBUcmFuc2Zvcm0gYmFzZQoKCQkJCQkJCQkvLyBlIGlzIHRoZSBiYXNlIDEwIGV4cG9uZW50LgoJCQkJCQkJCS8vIGkgaXMgd2hlcmUgdG8gc2xpY2Ugc3RyIHRvIGdldCB0aGUgZmlyc3QgZWxlbWVudCBvZiB0aGUgY29lZmZpY2llbnQgYXJyYXkuCgkJCQkJCQkJaSA9IChlICsgMSkgJSBMT0dfQkFTRTsKCQkJCQkJCQlpZiAoZSA8IDApIGkgKz0gTE9HX0JBU0U7IC8vIGkgPCAxCgoJCQkJCQkJCWlmIChpIDwgbGVuKSB7CgkJCQkJCQkJCWlmIChpKSB4LmMucHVzaCgrc3RyLnNsaWNlKDAsIGkpKTsKCQkJCQkJCQkJZm9yIChsZW4gLT0gTE9HX0JBU0U7IGkgPCBsZW47KSB7CgkJCQkJCQkJCQl4LmMucHVzaCgrc3RyLnNsaWNlKGksIGkgKz0gTE9HX0JBU0UpKTsKCQkJCQkJCQkJfQoJCQkJCQkJCQlpID0gTE9HX0JBU0UgLSAoc3RyID0gc3RyLnNsaWNlKGkpKS5sZW5ndGg7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJaSAtPSBsZW47CgkJCQkJCQkJfQoJCQkJCQkJCWZvciAoOyBpLS07IHN0ciArPSAnMCcpIDsKCQkJCQkJCQl4LmMucHVzaCgrc3RyKTsKCQkJCQkJCX0KCQkJCQkJfSBlbHNlIHsKCQkJCQkJCS8vIFplcm8uCgkJCQkJCQl4LmMgPSBbeC5lID0gMF07CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vIENPTlNUUlVDVE9SIFBST1BFUlRJRVMKCgkJCQkJQmlnTnVtYmVyLmNsb25lID0gY2xvbmU7CgkJCQkJQmlnTnVtYmVyLlJPVU5EX1VQID0gMDsKCQkJCQlCaWdOdW1iZXIuUk9VTkRfRE9XTiA9IDE7CgkJCQkJQmlnTnVtYmVyLlJPVU5EX0NFSUwgPSAyOwoJCQkJCUJpZ051bWJlci5ST1VORF9GTE9PUiA9IDM7CgkJCQkJQmlnTnVtYmVyLlJPVU5EX0hBTEZfVVAgPSA0OwoJCQkJCUJpZ051bWJlci5ST1VORF9IQUxGX0RPV04gPSA1OwoJCQkJCUJpZ051bWJlci5ST1VORF9IQUxGX0VWRU4gPSA2OwoJCQkJCUJpZ051bWJlci5ST1VORF9IQUxGX0NFSUwgPSA3OwoJCQkJCUJpZ051bWJlci5ST1VORF9IQUxGX0ZMT09SID0gODsKCQkJCQlCaWdOdW1iZXIuRVVDTElEID0gOTsKCgkJCQkJLyoKICAgICAqIENvbmZpZ3VyZSBpbmZyZXF1ZW50bHktY2hhbmdpbmcgbGlicmFyeS13aWRlIHNldHRpbmdzLgogICAgICoKICAgICAqIEFjY2VwdCBhbiBvYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIG9wdGlvbmFsIHByb3BlcnRpZXMgKGlmIHRoZSB2YWx1ZSBvZiBhIHByb3BlcnR5IGlzCiAgICAgKiBhIG51bWJlciwgaXQgbXVzdCBiZSBhbiBpbnRlZ2VyIHdpdGhpbiB0aGUgaW5jbHVzaXZlIHJhbmdlIHN0YXRlZCk6CiAgICAgKgogICAgICogICBERUNJTUFMX1BMQUNFUyAgIHtudW1iZXJ9ICAgICAgICAgICAwIHRvIE1BWAogICAgICogICBST1VORElOR19NT0RFICAgIHtudW1iZXJ9ICAgICAgICAgICAwIHRvIDgKICAgICAqICAgRVhQT05FTlRJQUxfQVQgICB7bnVtYmVyfG51bWJlcltdfSAgLU1BWCB0byBNQVggIG9yICBbLU1BWCB0byAwLCAwIHRvIE1BWF0KICAgICAqICAgUkFOR0UgICAgICAgICAgICB7bnVtYmVyfG51bWJlcltdfSAgLU1BWCB0byBNQVggKG5vdCB6ZXJvKSAgb3IgIFstTUFYIHRvIC0xLCAxIHRvIE1BWF0KICAgICAqICAgQ1JZUFRPICAgICAgICAgICB7Ym9vbGVhbn0gICAgICAgICAgdHJ1ZSBvciBmYWxzZQogICAgICogICBNT0RVTE9fTU9ERSAgICAgIHtudW1iZXJ9ICAgICAgICAgICAwIHRvIDkKICAgICAqICAgUE9XX1BSRUNJU0lPTiAgICAgICB7bnVtYmVyfSAgICAgICAgICAgMCB0byBNQVgKICAgICAqICAgQUxQSEFCRVQgICAgICAgICB7c3RyaW5nfSAgICAgICAgICAgQSBzdHJpbmcgb2YgdHdvIG9yIG1vcmUgdW5pcXVlIGNoYXJhY3RlcnMgd2hpY2ggZG9lcwogICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub3QgY29udGFpbiAnLicuCiAgICAgKiAgIEZPUk1BVCAgICAgICAgICAge29iamVjdH0gICAgICAgICAgIEFuIG9iamVjdCB3aXRoIHNvbWUgb2YgdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgogICAgICogICAgIHByZWZpeCAgICAgICAgICAgICAgICAge3N0cmluZ30KICAgICAqICAgICBncm91cFNpemUgICAgICAgICAgICAgIHtudW1iZXJ9CiAgICAgKiAgICAgc2Vjb25kYXJ5R3JvdXBTaXplICAgICB7bnVtYmVyfQogICAgICogICAgIGdyb3VwU2VwYXJhdG9yICAgICAgICAge3N0cmluZ30KICAgICAqICAgICBkZWNpbWFsU2VwYXJhdG9yICAgICAgIHtzdHJpbmd9CiAgICAgKiAgICAgZnJhY3Rpb25Hcm91cFNpemUgICAgICB7bnVtYmVyfQogICAgICogICAgIGZyYWN0aW9uR3JvdXBTZXBhcmF0b3Ige3N0cmluZ30KICAgICAqICAgICBzdWZmaXggICAgICAgICAgICAgICAgIHtzdHJpbmd9CiAgICAgKgogICAgICogKFRoZSB2YWx1ZXMgYXNzaWduZWQgdG8gdGhlIGFib3ZlIEZPUk1BVCBvYmplY3QgcHJvcGVydGllcyBhcmUgbm90IGNoZWNrZWQgZm9yIHZhbGlkaXR5LikKICAgICAqCiAgICAgKiBFLmcuCiAgICAgKiBCaWdOdW1iZXIuY29uZmlnKHsgREVDSU1BTF9QTEFDRVMgOiAyMCwgUk9VTkRJTkdfTU9ERSA6IDQgfSkKICAgICAqCiAgICAgKiBJZ25vcmUgcHJvcGVydGllcy9wYXJhbWV0ZXJzIHNldCB0byBudWxsIG9yIHVuZGVmaW5lZCwgZXhjZXB0IGZvciBBTFBIQUJFVC4KICAgICAqCiAgICAgKiBSZXR1cm4gYW4gb2JqZWN0IHdpdGggdGhlIHByb3BlcnRpZXMgY3VycmVudCB2YWx1ZXMuCiAgICAgKi8KCQkJCQlCaWdOdW1iZXIuY29uZmlnID0gQmlnTnVtYmVyLnNldCA9IGZ1bmN0aW9uKG9iaikgewoJCQkJCQl2YXIgcCwgdjsKCQkJCQkJaWYgKG9iaiAhPSBudWxsKSB7CgkJCQkJCQlpZiAoX3R5cGVvZihvYmopID09ICdvYmplY3QnKSB7CgkJCQkJCQkJLy8gREVDSU1BTF9QTEFDRVMge251bWJlcn0gSW50ZWdlciwgMCB0byBNQVggaW5jbHVzaXZlLgoJCQkJCQkJCS8vICdbQmlnTnVtYmVyIEVycm9yXSBERUNJTUFMX1BMQUNFUyB7bm90IGEgcHJpbWl0aXZlIG51bWJlcnxub3QgYW4gaW50ZWdlcnxvdXQgb2YgcmFuZ2V9OiB7dn0nCgkJCQkJCQkJaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShwID0gJ0RFQ0lNQUxfUExBQ0VTJykpIHsKCQkJCQkJCQkJdiA9IG9ialtwXTsKCQkJCQkJCQkJaW50Q2hlY2sodiwgMCwgTUFYLCBwKTsKCQkJCQkJCQkJREVDSU1BTF9QTEFDRVMgPSB2OwoJCQkJCQkJCX0KCgkJCQkJCQkJLy8gUk9VTkRJTkdfTU9ERSB7bnVtYmVyfSBJbnRlZ2VyLCAwIHRvIDggaW5jbHVzaXZlLgoJCQkJCQkJCS8vICdbQmlnTnVtYmVyIEVycm9yXSBST1VORElOR19NT0RFIHtub3QgYSBwcmltaXRpdmUgbnVtYmVyfG5vdCBhbiBpbnRlZ2VyfG91dCBvZiByYW5nZX06IHt2fScKCQkJCQkJCQlpZiAob2JqLmhhc093blByb3BlcnR5KHAgPSAnUk9VTkRJTkdfTU9ERScpKSB7CgkJCQkJCQkJCXYgPSBvYmpbcF07CgkJCQkJCQkJCWludENoZWNrKHYsIDAsIDgsIHApOwoJCQkJCQkJCQlST1VORElOR19NT0RFID0gdjsKCQkJCQkJCQl9CgoJCQkJCQkJCS8vIEVYUE9ORU5USUFMX0FUIHtudW1iZXJ8bnVtYmVyW119CgkJCQkJCQkJLy8gSW50ZWdlciwgLU1BWCB0byBNQVggaW5jbHVzaXZlIG9yCgkJCQkJCQkJLy8gW2ludGVnZXIgLU1BWCB0byAwIGluY2x1c2l2ZSwgMCB0byBNQVggaW5jbHVzaXZlXS4KCQkJCQkJCQkvLyAnW0JpZ051bWJlciBFcnJvcl0gRVhQT05FTlRJQUxfQVQge25vdCBhIHByaW1pdGl2ZSBudW1iZXJ8bm90IGFuIGludGVnZXJ8b3V0IG9mIHJhbmdlfToge3Z9JwoJCQkJCQkJCWlmIChvYmouaGFzT3duUHJvcGVydHkocCA9ICdFWFBPTkVOVElBTF9BVCcpKSB7CgkJCQkJCQkJCXYgPSBvYmpbcF07CgkJCQkJCQkJCWlmICh2ICYmIHYucG9wKSB7CgkJCQkJCQkJCQlpbnRDaGVjayh2WzBdLCAtTUFYLCAwLCBwKTsKCQkJCQkJCQkJCWludENoZWNrKHZbMV0sIDAsIE1BWCwgcCk7CgkJCQkJCQkJCQlUT19FWFBfTkVHID0gdlswXTsKCQkJCQkJCQkJCVRPX0VYUF9QT1MgPSB2WzFdOwoJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJaW50Q2hlY2sodiwgLU1BWCwgTUFYLCBwKTsKCQkJCQkJCQkJCVRPX0VYUF9ORUcgPSAtKFRPX0VYUF9QT1MgPSB2IDwgMCA/IC12IDogdik7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgoJCQkJCQkJCS8vIFJBTkdFIHtudW1iZXJ8bnVtYmVyW119IE5vbi16ZXJvIGludGVnZXIsIC1NQVggdG8gTUFYIGluY2x1c2l2ZSBvcgoJCQkJCQkJCS8vIFtpbnRlZ2VyIC1NQVggdG8gLTEgaW5jbHVzaXZlLCBpbnRlZ2VyIDEgdG8gTUFYIGluY2x1c2l2ZV0uCgkJCQkJCQkJLy8gJ1tCaWdOdW1iZXIgRXJyb3JdIFJBTkdFIHtub3QgYSBwcmltaXRpdmUgbnVtYmVyfG5vdCBhbiBpbnRlZ2VyfG91dCBvZiByYW5nZXxjYW5ub3QgYmUgemVyb306IHt2fScKCQkJCQkJCQlpZiAob2JqLmhhc093blByb3BlcnR5KHAgPSAnUkFOR0UnKSkgewoJCQkJCQkJCQl2ID0gb2JqW3BdOwoJCQkJCQkJCQlpZiAodiAmJiB2LnBvcCkgewoJCQkJCQkJCQkJaW50Q2hlY2sodlswXSwgLU1BWCwgLTEsIHApOwoJCQkJCQkJCQkJaW50Q2hlY2sodlsxXSwgMSwgTUFYLCBwKTsKCQkJCQkJCQkJCU1JTl9FWFAgPSB2WzBdOwoJCQkJCQkJCQkJTUFYX0VYUCA9IHZbMV07CgkJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCQlpbnRDaGVjayh2LCAtTUFYLCBNQVgsIHApOwoJCQkJCQkJCQkJaWYgKHYpIHsKCQkJCQkJCQkJCQlNSU5fRVhQID0gLShNQVhfRVhQID0gdiA8IDAgPyAtdiA6IHYpOwoJCQkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJCQl0aHJvdyBFcnJvcihiaWdudW1iZXJFcnJvciArIHAgKyAnIGNhbm5vdCBiZSB6ZXJvOiAnICsgdik7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgoJCQkJCQkJCS8vIENSWVBUTyB7Ym9vbGVhbn0gdHJ1ZSBvciBmYWxzZS4KCQkJCQkJCQkvLyAnW0JpZ051bWJlciBFcnJvcl0gQ1JZUFRPIG5vdCB0cnVlIG9yIGZhbHNlOiB7dn0nCgkJCQkJCQkJLy8gJ1tCaWdOdW1iZXIgRXJyb3JdIGNyeXB0byB1bmF2YWlsYWJsZScKCQkJCQkJCQlpZiAob2JqLmhhc093blByb3BlcnR5KHAgPSAnQ1JZUFRPJykpIHsKCQkJCQkJCQkJdiA9IG9ialtwXTsKCQkJCQkJCQkJaWYgKHYgPT09ICEhdikgewoJCQkJCQkJCQkJaWYgKHYpIHsKCQkJCQkJCQkJCQlpZiAodHlwZW9mIGNyeXB0byAhPSAndW5kZWZpbmVkJyAmJiBjcnlwdG8gJiYgKGNyeXB0by5nZXRSYW5kb21WYWx1ZXMgfHwgY3J5cHRvLnJhbmRvbUJ5dGVzKSkgewoJCQkJCQkJCQkJCQlDUllQVE8gPSB2OwoJCQkJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCQkJCUNSWVBUTyA9ICF2OwoJCQkJCQkJCQkJCQl0aHJvdyBFcnJvcihiaWdudW1iZXJFcnJvciArICdjcnlwdG8gdW5hdmFpbGFibGUnKTsKCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJCUNSWVBUTyA9IHY7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCQl0aHJvdyBFcnJvcihiaWdudW1iZXJFcnJvciArIHAgKyAnIG5vdCB0cnVlIG9yIGZhbHNlOiAnICsgdik7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgoJCQkJCQkJCS8vIE1PRFVMT19NT0RFIHtudW1iZXJ9IEludGVnZXIsIDAgdG8gOSBpbmNsdXNpdmUuCgkJCQkJCQkJLy8gJ1tCaWdOdW1iZXIgRXJyb3JdIE1PRFVMT19NT0RFIHtub3QgYSBwcmltaXRpdmUgbnVtYmVyfG5vdCBhbiBpbnRlZ2VyfG91dCBvZiByYW5nZX06IHt2fScKCQkJCQkJCQlpZiAob2JqLmhhc093blByb3BlcnR5KHAgPSAnTU9EVUxPX01PREUnKSkgewoJCQkJCQkJCQl2ID0gb2JqW3BdOwoJCQkJCQkJCQlpbnRDaGVjayh2LCAwLCA5LCBwKTsKCQkJCQkJCQkJTU9EVUxPX01PREUgPSB2OwoJCQkJCQkJCX0KCgkJCQkJCQkJLy8gUE9XX1BSRUNJU0lPTiB7bnVtYmVyfSBJbnRlZ2VyLCAwIHRvIE1BWCBpbmNsdXNpdmUuCgkJCQkJCQkJLy8gJ1tCaWdOdW1iZXIgRXJyb3JdIFBPV19QUkVDSVNJT04ge25vdCBhIHByaW1pdGl2ZSBudW1iZXJ8bm90IGFuIGludGVnZXJ8b3V0IG9mIHJhbmdlfToge3Z9JwoJCQkJCQkJCWlmIChvYmouaGFzT3duUHJvcGVydHkocCA9ICdQT1dfUFJFQ0lTSU9OJykpIHsKCQkJCQkJCQkJdiA9IG9ialtwXTsKCQkJCQkJCQkJaW50Q2hlY2sodiwgMCwgTUFYLCBwKTsKCQkJCQkJCQkJUE9XX1BSRUNJU0lPTiA9IHY7CgkJCQkJCQkJfQoKCQkJCQkJCQkvLyBGT1JNQVQge29iamVjdH0KCQkJCQkJCQkvLyAnW0JpZ051bWJlciBFcnJvcl0gRk9STUFUIG5vdCBhbiBvYmplY3Q6IHt2fScKCQkJCQkJCQlpZiAob2JqLmhhc093blByb3BlcnR5KHAgPSAnRk9STUFUJykpIHsKCQkJCQkJCQkJdiA9IG9ialtwXTsKCQkJCQkJCQkJaWYgKF90eXBlb2YodikgPT0gJ29iamVjdCcpIEZPUk1BVCA9IHY7IGVsc2UgdGhyb3cgRXJyb3IoYmlnbnVtYmVyRXJyb3IgKyBwICsgJyBub3QgYW4gb2JqZWN0OiAnICsgdik7CgkJCQkJCQkJfQoKCQkJCQkJCQkvLyBBTFBIQUJFVCB7c3RyaW5nfQoJCQkJCQkJCS8vICdbQmlnTnVtYmVyIEVycm9yXSBBTFBIQUJFVCBpbnZhbGlkOiB7dn0nCgkJCQkJCQkJaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShwID0gJ0FMUEhBQkVUJykpIHsKCQkJCQkJCQkJdiA9IG9ialtwXTsKCgkJCQkJCQkJCS8vIERpc2FsbG93IGlmIGxlc3MgdGhhbiB0d28gY2hhcmFjdGVycywKCQkJCQkJCQkJLy8gb3IgaWYgaXQgY29udGFpbnMgJysnLCAnLScsICcuJywgd2hpdGVzcGFjZSwgb3IgYSByZXBlYXRlZCBjaGFyYWN0ZXIuCgkJCQkJCQkJCWlmICh0eXBlb2YgdiA9PSAnc3RyaW5nJyAmJiAhL14uPyR8WytcLS5cc118KC4pLipcMS8udGVzdCh2KSkgewoJCQkJCQkJCQkJYWxwaGFiZXRIYXNOb3JtYWxEZWNpbWFsRGlnaXRzID0gdi5zbGljZSgwLCAxMCkgPT0gJzAxMjM0NTY3ODknOwoJCQkJCQkJCQkJQUxQSEFCRVQgPSB2OwoJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJdGhyb3cgRXJyb3IoYmlnbnVtYmVyRXJyb3IgKyBwICsgJyBpbnZhbGlkOiAnICsgdik7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCS8vICdbQmlnTnVtYmVyIEVycm9yXSBPYmplY3QgZXhwZWN0ZWQ6IHt2fScKCQkJCQkJCQl0aHJvdyBFcnJvcihiaWdudW1iZXJFcnJvciArICdPYmplY3QgZXhwZWN0ZWQ6ICcgKyBvYmopOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCXJldHVybiB7CgkJCQkJCQlERUNJTUFMX1BMQUNFUzogREVDSU1BTF9QTEFDRVMsCgkJCQkJCQlST1VORElOR19NT0RFOiBST1VORElOR19NT0RFLAoJCQkJCQkJRVhQT05FTlRJQUxfQVQ6IFtUT19FWFBfTkVHLCBUT19FWFBfUE9TXSwKCQkJCQkJCVJBTkdFOiBbTUlOX0VYUCwgTUFYX0VYUF0sCgkJCQkJCQlDUllQVE86IENSWVBUTywKCQkJCQkJCU1PRFVMT19NT0RFOiBNT0RVTE9fTU9ERSwKCQkJCQkJCVBPV19QUkVDSVNJT046IFBPV19QUkVDSVNJT04sCgkJCQkJCQlGT1JNQVQ6IEZPUk1BVCwKCQkJCQkJCUFMUEhBQkVUOiBBTFBIQUJFVAoJCQkJCQl9OwoJCQkJCX07CgoJCQkJCS8qCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB2IGlzIGEgQmlnTnVtYmVyIGluc3RhbmNlLCBvdGhlcndpc2UgcmV0dXJuIGZhbHNlLgogICAgICoKICAgICAqIElmIEJpZ051bWJlci5ERUJVRyBpcyB0cnVlLCB0aHJvdyBpZiBhIEJpZ051bWJlciBpbnN0YW5jZSBpcyBub3Qgd2VsbC1mb3JtZWQuCiAgICAgKgogICAgICogdiB7YW55fQogICAgICoKICAgICAqICdbQmlnTnVtYmVyIEVycm9yXSBJbnZhbGlkIEJpZ051bWJlcjoge3Z9JwogICAgICovCgkJCQkJQmlnTnVtYmVyLmlzQmlnTnVtYmVyID0gZnVuY3Rpb24odikgewoJCQkJCQlpZiAoIXYgfHwgdi5faXNCaWdOdW1iZXIgIT09IHRydWUpIHJldHVybiBmYWxzZTsKCQkJCQkJaWYgKCFCaWdOdW1iZXIuREVCVUcpIHJldHVybiB0cnVlOwoJCQkJCQl2YXIgaSwKCQkJCQkJCW4sCgkJCQkJCQljID0gdi5jLAoJCQkJCQkJZSA9IHYuZSwKCQkJCQkJCXMgPSB2LnM7CgkJCQkJCW91dDogaWYgKHt9LnRvU3RyaW5nLmNhbGwoYykgPT0gJ1tvYmplY3QgQXJyYXldJykgewoJCQkJCQkJaWYgKChzID09PSAxIHx8IHMgPT09IC0xKSAmJiBlID49IC1NQVggJiYgZSA8PSBNQVggJiYgZSA9PT0gbWF0aGZsb29yKGUpKSB7CgkJCQkJCQkJLy8gSWYgdGhlIGZpcnN0IGVsZW1lbnQgaXMgemVybywgdGhlIEJpZ051bWJlciB2YWx1ZSBtdXN0IGJlIHplcm8uCgkJCQkJCQkJaWYgKGNbMF0gPT09IDApIHsKCQkJCQkJCQkJaWYgKGUgPT09IDAgJiYgYy5sZW5ndGggPT09IDEpIHJldHVybiB0cnVlOwoJCQkJCQkJCQlicmVhayBvdXQ7CgkJCQkJCQkJfQoKCQkJCQkJCQkvLyBDYWxjdWxhdGUgbnVtYmVyIG9mIGRpZ2l0cyB0aGF0IGNbMF0gc2hvdWxkIGhhdmUsIGJhc2VkIG9uIHRoZSBleHBvbmVudC4KCQkJCQkJCQlpID0gKGUgKyAxKSAlIExPR19CQVNFOwoJCQkJCQkJCWlmIChpIDwgMSkgaSArPSBMT0dfQkFTRTsKCgkJCQkJCQkJLy8gQ2FsY3VsYXRlIG51bWJlciBvZiBkaWdpdHMgb2YgY1swXS4KCQkJCQkJCQkvL2lmIChNYXRoLmNlaWwoTWF0aC5sb2coY1swXSArIDEpIC8gTWF0aC5MTjEwKSA9PSBpKSB7CgkJCQkJCQkJaWYgKFN0cmluZyhjWzBdKS5sZW5ndGggPT0gaSkgewoJCQkJCQkJCQlmb3IgKGkgPSAwOyBpIDwgYy5sZW5ndGg7IGkrKykgewoJCQkJCQkJCQkJbiA9IGNbaV07CgkJCQkJCQkJCQlpZiAobiA8IDAgfHwgbiA+PSBCQVNFIHx8IG4gIT09IG1hdGhmbG9vcihuKSkgYnJlYWsgb3V0OwoJCQkJCQkJCQl9CgoJCQkJCQkJCQkvLyBMYXN0IGVsZW1lbnQgY2Fubm90IGJlIHplcm8sIHVubGVzcyBpdCBpcyB0aGUgb25seSBlbGVtZW50LgoJCQkJCQkJCQlpZiAobiAhPT0gMCkgcmV0dXJuIHRydWU7CgkJCQkJCQkJfQoJCQkJCQkJfQoKCQkJCQkJCS8vIEluZmluaXR5L05hTgoJCQkJCQl9IGVsc2UgaWYgKGMgPT09IG51bGwgJiYgZSA9PT0gbnVsbCAmJiAocyA9PT0gbnVsbCB8fCBzID09PSAxIHx8IHMgPT09IC0xKSkgewoJCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJCX0KCQkJCQkJdGhyb3cgRXJyb3IoYmlnbnVtYmVyRXJyb3IgKyAnSW52YWxpZCBCaWdOdW1iZXI6ICcgKyB2KTsKCQkJCQl9OwoKCQkJCQkvKgogICAgICogUmV0dXJuIGEgbmV3IEJpZ051bWJlciB3aG9zZSB2YWx1ZSBpcyB0aGUgbWF4aW11bSBvZiB0aGUgYXJndW1lbnRzLgogICAgICoKICAgICAqIGFyZ3VtZW50cyB7bnVtYmVyfHN0cmluZ3xCaWdOdW1iZXJ9CiAgICAgKi8KCQkJCQlCaWdOdW1iZXIubWF4aW11bSA9IEJpZ051bWJlci5tYXggPSBmdW5jdGlvbigpIHsKCQkJCQkJcmV0dXJuIG1heE9yTWluKGFyZ3VtZW50cywgLTEpOwoJCQkJCX07CgoJCQkJCS8qCiAgICAgKiBSZXR1cm4gYSBuZXcgQmlnTnVtYmVyIHdob3NlIHZhbHVlIGlzIHRoZSBtaW5pbXVtIG9mIHRoZSBhcmd1bWVudHMuCiAgICAgKgogICAgICogYXJndW1lbnRzIHtudW1iZXJ8c3RyaW5nfEJpZ051bWJlcn0KICAgICAqLwoJCQkJCUJpZ051bWJlci5taW5pbXVtID0gQmlnTnVtYmVyLm1pbiA9IGZ1bmN0aW9uKCkgewoJCQkJCQlyZXR1cm4gbWF4T3JNaW4oYXJndW1lbnRzLCAxKTsKCQkJCQl9OwoKCQkJCQkvKgogICAgICogUmV0dXJuIGEgbmV3IEJpZ051bWJlciB3aXRoIGEgcmFuZG9tIHZhbHVlIGVxdWFsIHRvIG9yIGdyZWF0ZXIgdGhhbiAwIGFuZCBsZXNzIHRoYW4gMSwKICAgICAqIGFuZCB3aXRoIGRwLCBvciBERUNJTUFMX1BMQUNFUyBpZiBkcCBpcyBvbWl0dGVkLCBkZWNpbWFsIHBsYWNlcyAob3IgbGVzcyBpZiB0cmFpbGluZwogICAgICogemVyb3MgYXJlIHByb2R1Y2VkKS4KICAgICAqCiAgICAgKiBbZHBdIHtudW1iZXJ9IERlY2ltYWwgcGxhY2VzLiBJbnRlZ2VyLCAwIHRvIE1BWCBpbmNsdXNpdmUuCiAgICAgKgogICAgICogJ1tCaWdOdW1iZXIgRXJyb3JdIEFyZ3VtZW50IHtub3QgYSBwcmltaXRpdmUgbnVtYmVyfG5vdCBhbiBpbnRlZ2VyfG91dCBvZiByYW5nZX06IHtkcH0nCiAgICAgKiAnW0JpZ051bWJlciBFcnJvcl0gY3J5cHRvIHVuYXZhaWxhYmxlJwogICAgICovCgkJCQkJQmlnTnVtYmVyLnJhbmRvbSA9IGZ1bmN0aW9uKCkgewoJCQkJCQl2YXIgcG93Ml81MyA9IDB4MjAwMDAwMDAwMDAwMDA7CgoJCQkJCQkvLyBSZXR1cm4gYSA1MyBiaXQgaW50ZWdlciBuLCB3aGVyZSAwIDw9IG4gPCA5MDA3MTk5MjU0NzQwOTkyLgoJCQkJCQkvLyBDaGVjayBpZiBNYXRoLnJhbmRvbSgpIHByb2R1Y2VzIG1vcmUgdGhhbiAzMiBiaXRzIG9mIHJhbmRvbW5lc3MuCgkJCQkJCS8vIElmIGl0IGRvZXMsIGFzc3VtZSBhdCBsZWFzdCA1MyBiaXRzIGFyZSBwcm9kdWNlZCwgb3RoZXJ3aXNlIGFzc3VtZSBhdCBsZWFzdCAzMCBiaXRzLgoJCQkJCQkvLyAweDQwMDAwMDAwIGlzIDJeMzAsIDB4ODAwMDAwIGlzIDJeMjMsIDB4MWZmZmZmIGlzIDJeMjEgLSAxLgoJCQkJCQl2YXIgcmFuZG9tNTNiaXRJbnQgPSBNYXRoLnJhbmRvbSgpICogcG93Ml81MyAmIDB4MWZmZmZmID8gZnVuY3Rpb24oKSB7CgkJCQkJCQlyZXR1cm4gbWF0aGZsb29yKE1hdGgucmFuZG9tKCkgKiBwb3cyXzUzKTsKCQkJCQkJfSA6IGZ1bmN0aW9uKCkgewoJCQkJCQkJcmV0dXJuIChNYXRoLnJhbmRvbSgpICogMHg0MDAwMDAwMCB8IDApICogMHg4MDAwMDAgKyAoTWF0aC5yYW5kb20oKSAqIDB4ODAwMDAwIHwgMCk7CgkJCQkJCX07CgkJCQkJCXJldHVybiBmdW5jdGlvbihkcCkgewoJCQkJCQkJdmFyIGEsCgkJCQkJCQkJYiwKCQkJCQkJCQllLAoJCQkJCQkJCWssCgkJCQkJCQkJdiwKCQkJCQkJCQlpID0gMCwKCQkJCQkJCQljID0gW10sCgkJCQkJCQkJcmFuZCA9IG5ldyBCaWdOdW1iZXIoT05FKTsKCQkJCQkJCWlmIChkcCA9PSBudWxsKSBkcCA9IERFQ0lNQUxfUExBQ0VTOyBlbHNlIGludENoZWNrKGRwLCAwLCBNQVgpOwoJCQkJCQkJayA9IG1hdGhjZWlsKGRwIC8gTE9HX0JBU0UpOwoJCQkJCQkJaWYgKENSWVBUTykgewoJCQkJCQkJCS8vIEJyb3dzZXJzIHN1cHBvcnRpbmcgY3J5cHRvLmdldFJhbmRvbVZhbHVlcy4KCQkJCQkJCQlpZiAoY3J5cHRvLmdldFJhbmRvbVZhbHVlcykgewoJCQkJCQkJCQlhID0gY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDMyQXJyYXkoayAqPSAyKSk7CgkJCQkJCQkJCWZvciAoOyBpIDwgazspIHsKCQkJCQkJCQkJCS8vIDUzIGJpdHM6CgkJCQkJCQkJCQkvLyAoKE1hdGgucG93KDIsIDMyKSAtIDEpICogTWF0aC5wb3coMiwgMjEpKS50b1N0cmluZygyKQoJCQkJCQkJCQkJLy8gMTExMTEgMTExMTExMTEgMTExMTExMTEgMTExMTExMTEgMTExMDAwMDAgMDAwMDAwMDAgMDAwMDAwMDAKCQkJCQkJCQkJCS8vICgoTWF0aC5wb3coMiwgMzIpIC0gMSkgPj4+IDExKS50b1N0cmluZygyKQoJCQkJCQkJCQkJLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMTExMTEgMTExMTExMTEgMTExMTExMTEKCQkJCQkJCQkJCS8vIDB4MjAwMDAgaXMgMl4yMS4KCQkJCQkJCQkJCXYgPSBhW2ldICogMHgyMDAwMCArIChhW2kgKyAxXSA+Pj4gMTEpOwoKCQkJCQkJCQkJCS8vIFJlamVjdGlvbiBzYW1wbGluZzoKCQkJCQkJCQkJCS8vIDAgPD0gdiA8IDkwMDcxOTkyNTQ3NDA5OTIKCQkJCQkJCQkJCS8vIFByb2JhYmlsaXR5IHRoYXQgdiA+PSA5ZTE1LCBpcwoJCQkJCQkJCQkJLy8gNzE5OTI1NDc0MDk5MiAvIDkwMDcxOTkyNTQ3NDA5OTIgfj0gMC4wMDA4LCBpLmUuIDEgaW4gMTI1MQoJCQkJCQkJCQkJaWYgKHYgPj0gOWUxNSkgewoJCQkJCQkJCQkJCWIgPSBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKG5ldyBVaW50MzJBcnJheSgyKSk7CgkJCQkJCQkJCQkJYVtpXSA9IGJbMF07CgkJCQkJCQkJCQkJYVtpICsgMV0gPSBiWzFdOwoJCQkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJCQkvLyAwIDw9IHYgPD0gODk5OTk5OTk5OTk5OTk5OQoJCQkJCQkJCQkJCS8vIDAgPD0gKHYgJSAxZTE0KSA8PSA5OTk5OTk5OTk5OTk5OQoJCQkJCQkJCQkJCWMucHVzaCh2ICUgMWUxNCk7CgkJCQkJCQkJCQkJaSArPSAyOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQl9CgkJCQkJCQkJCWkgPSBrIC8gMjsKCgkJCQkJCQkJCS8vIE5vZGUuanMgc3VwcG9ydGluZyBjcnlwdG8ucmFuZG9tQnl0ZXMuCgkJCQkJCQkJfSBlbHNlIGlmIChjcnlwdG8ucmFuZG9tQnl0ZXMpIHsKCQkJCQkJCQkJLy8gYnVmZmVyCgkJCQkJCQkJCWEgPSBjcnlwdG8ucmFuZG9tQnl0ZXMoayAqPSA3KTsKCQkJCQkJCQkJZm9yICg7IGkgPCBrOykgewoJCQkJCQkJCQkJLy8gMHgxMDAwMDAwMDAwMDAwIGlzIDJeNDgsIDB4MTAwMDAwMDAwMDAgaXMgMl40MAoJCQkJCQkJCQkJLy8gMHgxMDAwMDAwMDAgaXMgMl4zMiwgMHgxMDAwMDAwIGlzIDJeMjQKCQkJCQkJCQkJCS8vIDExMTExIDExMTExMTExIDExMTExMTExIDExMTExMTExIDExMTExMTExIDExMTExMTExIDExMTExMTExCgkJCQkJCQkJCQkvLyAwIDw9IHYgPCA5MDA3MTk5MjU0NzQwOTkyCgkJCQkJCQkJCQl2ID0gKGFbaV0gJiAzMSkgKiAweDEwMDAwMDAwMDAwMDAgKyBhW2kgKyAxXSAqIDB4MTAwMDAwMDAwMDAgKyBhW2kgKyAyXSAqIDB4MTAwMDAwMDAwICsgYVtpICsgM10gKiAweDEwMDAwMDAgKyAoYVtpICsgNF0gPDwgMTYpICsgKGFbaSArIDVdIDw8IDgpICsgYVtpICsgNl07CgkJCQkJCQkJCQlpZiAodiA+PSA5ZTE1KSB7CgkJCQkJCQkJCQkJY3J5cHRvLnJhbmRvbUJ5dGVzKDcpLmNvcHkoYSwgaSk7CgkJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJCS8vIDAgPD0gKHYgJSAxZTE0KSA8PSA5OTk5OTk5OTk5OTk5OQoJCQkJCQkJCQkJCWMucHVzaCh2ICUgMWUxNCk7CgkJCQkJCQkJCQkJaSArPSA3OwoJCQkJCQkJCQkJfQoJCQkJCQkJCQl9CgkJCQkJCQkJCWkgPSBrIC8gNzsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQlDUllQVE8gPSBmYWxzZTsKCQkJCQkJCQkJdGhyb3cgRXJyb3IoYmlnbnVtYmVyRXJyb3IgKyAnY3J5cHRvIHVuYXZhaWxhYmxlJyk7CgkJCQkJCQkJfQoJCQkJCQkJfQoKCQkJCQkJCS8vIFVzZSBNYXRoLnJhbmRvbS4KCQkJCQkJCWlmICghQ1JZUFRPKSB7CgkJCQkJCQkJZm9yICg7IGkgPCBrOykgewoJCQkJCQkJCQl2ID0gcmFuZG9tNTNiaXRJbnQoKTsKCQkJCQkJCQkJaWYgKHYgPCA5ZTE1KSBjW2krK10gPSB2ICUgMWUxNDsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQlrID0gY1stLWldOwoJCQkJCQkJZHAgJT0gTE9HX0JBU0U7CgoJCQkJCQkJLy8gQ29udmVydCB0cmFpbGluZyBkaWdpdHMgdG8gemVyb3MgYWNjb3JkaW5nIHRvIGRwLgoJCQkJCQkJaWYgKGsgJiYgZHApIHsKCQkJCQkJCQl2ID0gUE9XU19URU5bTE9HX0JBU0UgLSBkcF07CgkJCQkJCQkJY1tpXSA9IG1hdGhmbG9vcihrIC8gdikgKiB2OwoJCQkJCQkJfQoKCQkJCQkJCS8vIFJlbW92ZSB0cmFpbGluZyBlbGVtZW50cyB3aGljaCBhcmUgemVyby4KCQkJCQkJCWZvciAoOyBjW2ldID09PSAwOyBjLnBvcCgpLCBpLS0pIDsKCgkJCQkJCQkvLyBaZXJvPwoJCQkJCQkJaWYgKGkgPCAwKSB7CgkJCQkJCQkJYyA9IFtlID0gMF07CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCS8vIFJlbW92ZSBsZWFkaW5nIGVsZW1lbnRzIHdoaWNoIGFyZSB6ZXJvIGFuZCBhZGp1c3QgZXhwb25lbnQgYWNjb3JkaW5nbHkuCgkJCQkJCQkJZm9yIChlID0gLTE7IGNbMF0gPT09IDA7IGMuc3BsaWNlKDAsIDEpLCBlIC09IExPR19CQVNFKSA7CgoJCQkJCQkJCS8vIENvdW50IHRoZSBkaWdpdHMgb2YgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYyB0byBkZXRlcm1pbmUgbGVhZGluZyB6ZXJvcywgYW5kLi4uCgkJCQkJCQkJZm9yIChpID0gMSwgdiA9IGNbMF07IHYgPj0gMTA7IHYgLz0gMTAsIGkrKykgOwoKCQkJCQkJCQkvLyBhZGp1c3QgdGhlIGV4cG9uZW50IGFjY29yZGluZ2x5LgoJCQkJCQkJCWlmIChpIDwgTE9HX0JBU0UpIGUgLT0gTE9HX0JBU0UgLSBpOwoJCQkJCQkJfQoJCQkJCQkJcmFuZC5lID0gZTsKCQkJCQkJCXJhbmQuYyA9IGM7CgkJCQkJCQlyZXR1cm4gcmFuZDsKCQkJCQkJfTsKCQkJCQl9KCk7CgoJCQkJCS8qCiAgICAgKiBSZXR1cm4gYSBCaWdOdW1iZXIgd2hvc2UgdmFsdWUgaXMgdGhlIHN1bSBvZiB0aGUgYXJndW1lbnRzLgogICAgICoKICAgICAqIGFyZ3VtZW50cyB7bnVtYmVyfHN0cmluZ3xCaWdOdW1iZXJ9CiAgICAgKi8KCQkJCQlCaWdOdW1iZXIuc3VtID0gZnVuY3Rpb24oKSB7CgkJCQkJCXZhciBpID0gMSwKCQkJCQkJCWFyZ3MgPSBhcmd1bWVudHMsCgkJCQkJCQlzdW0gPSBuZXcgQmlnTnVtYmVyKGFyZ3NbMF0pOwoJCQkJCQlmb3IgKDsgaSA8IGFyZ3MubGVuZ3RoOykgc3VtID0gc3VtLnBsdXMoYXJnc1tpKytdKTsKCQkJCQkJcmV0dXJuIHN1bTsKCQkJCQl9OwoKCQkJCQkvLyBQUklWQVRFIEZVTkNUSU9OUwoKCQkJCQkvLyBDYWxsZWQgYnkgQmlnTnVtYmVyIGFuZCBCaWdOdW1iZXIucHJvdG90eXBlLnRvU3RyaW5nLgoJCQkJCWNvbnZlcnRCYXNlID0gZnVuY3Rpb24oKSB7CgkJCQkJCXZhciBkZWNpbWFsID0gJzAxMjM0NTY3ODknOwoKCQkJCQkJLyoKICAgICAgICogQ29udmVydCBzdHJpbmcgb2YgYmFzZUluIHRvIGFuIGFycmF5IG9mIG51bWJlcnMgb2YgYmFzZU91dC4KICAgICAgICogRWcuIHRvQmFzZU91dCgnMjU1JywgMTAsIDE2KSByZXR1cm5zIFsxNSwgMTVdLgogICAgICAgKiBFZy4gdG9CYXNlT3V0KCdmZicsIDE2LCAxMCkgcmV0dXJucyBbMiwgNSwgNV0uCiAgICAgICAqLwoJCQkJCQlmdW5jdGlvbiB0b0Jhc2VPdXQoc3RyLCBiYXNlSW4sIGJhc2VPdXQsIGFscGhhYmV0KSB7CgkJCQkJCQl2YXIgaiwKCQkJCQkJCQlhcnIgPSBbMF0sCgkJCQkJCQkJYXJyTCwKCQkJCQkJCQlpID0gMCwKCQkJCQkJCQlsZW4gPSBzdHIubGVuZ3RoOwoJCQkJCQkJZm9yICg7IGkgPCBsZW47KSB7CgkJCQkJCQkJZm9yIChhcnJMID0gYXJyLmxlbmd0aDsgYXJyTC0tOyBhcnJbYXJyTF0gKj0gYmFzZUluKSA7CgkJCQkJCQkJYXJyWzBdICs9IGFscGhhYmV0LmluZGV4T2Yoc3RyLmNoYXJBdChpKyspKTsKCQkJCQkJCQlmb3IgKGogPSAwOyBqIDwgYXJyLmxlbmd0aDsgaisrKSB7CgkJCQkJCQkJCWlmIChhcnJbal0gPiBiYXNlT3V0IC0gMSkgewoJCQkJCQkJCQkJaWYgKGFycltqICsgMV0gPT0gbnVsbCkgYXJyW2ogKyAxXSA9IDA7CgkJCQkJCQkJCQlhcnJbaiArIDFdICs9IGFycltqXSAvIGJhc2VPdXQgfCAwOwoJCQkJCQkJCQkJYXJyW2pdICU9IGJhc2VPdXQ7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQlyZXR1cm4gYXJyLnJldmVyc2UoKTsKCQkJCQkJfQoKCQkJCQkJLy8gQ29udmVydCBhIG51bWVyaWMgc3RyaW5nIG9mIGJhc2VJbiB0byBhIG51bWVyaWMgc3RyaW5nIG9mIGJhc2VPdXQuCgkJCQkJCS8vIElmIHRoZSBjYWxsZXIgaXMgdG9TdHJpbmcsIHdlIGFyZSBjb252ZXJ0aW5nIGZyb20gYmFzZSAxMCB0byBiYXNlT3V0LgoJCQkJCQkvLyBJZiB0aGUgY2FsbGVyIGlzIEJpZ051bWJlciwgd2UgYXJlIGNvbnZlcnRpbmcgZnJvbSBiYXNlSW4gdG8gYmFzZSAxMC4KCQkJCQkJcmV0dXJuIGZ1bmN0aW9uKHN0ciwgYmFzZUluLCBiYXNlT3V0LCBzaWduLCBjYWxsZXJJc1RvU3RyaW5nKSB7CgkJCQkJCQl2YXIgYWxwaGFiZXQsCgkJCQkJCQkJZCwKCQkJCQkJCQllLAoJCQkJCQkJCWssCgkJCQkJCQkJciwKCQkJCQkJCQl4LAoJCQkJCQkJCXhjLAoJCQkJCQkJCXksCgkJCQkJCQkJaSA9IHN0ci5pbmRleE9mKCcuJyksCgkJCQkJCQkJZHAgPSBERUNJTUFMX1BMQUNFUywKCQkJCQkJCQlybSA9IFJPVU5ESU5HX01PREU7CgoJCQkJCQkJLy8gTm9uLWludGVnZXIuCgkJCQkJCQlpZiAoaSA+PSAwKSB7CgkJCQkJCQkJayA9IFBPV19QUkVDSVNJT047CgoJCQkJCQkJCS8vIFVubGltaXRlZCBwcmVjaXNpb24uCgkJCQkJCQkJUE9XX1BSRUNJU0lPTiA9IDA7CgkJCQkJCQkJc3RyID0gc3RyLnJlcGxhY2UoJy4nLCAnJyk7CgkJCQkJCQkJeSA9IG5ldyBCaWdOdW1iZXIoYmFzZUluKTsKCQkJCQkJCQl4ID0geS5wb3coc3RyLmxlbmd0aCAtIGkpOwoJCQkJCQkJCVBPV19QUkVDSVNJT04gPSBrOwoKCQkJCQkJCQkvLyBDb252ZXJ0IHN0ciBhcyBpZiBhbiBpbnRlZ2VyLCB0aGVuIHJlc3RvcmUgdGhlIGZyYWN0aW9uIHBhcnQgYnkgZGl2aWRpbmcgdGhlCgkJCQkJCQkJLy8gcmVzdWx0IGJ5IGl0cyBiYXNlIHJhaXNlZCB0byBhIHBvd2VyLgoKCQkJCQkJCQl5LmMgPSB0b0Jhc2VPdXQodG9GaXhlZFBvaW50KGNvZWZmVG9TdHJpbmcoeC5jKSwgeC5lLCAnMCcpLCAxMCwgYmFzZU91dCwgZGVjaW1hbCk7CgkJCQkJCQkJeS5lID0geS5jLmxlbmd0aDsKCQkJCQkJCX0KCgkJCQkJCQkvLyBDb252ZXJ0IHRoZSBudW1iZXIgYXMgaW50ZWdlci4KCgkJCQkJCQl4YyA9IHRvQmFzZU91dChzdHIsIGJhc2VJbiwgYmFzZU91dCwgY2FsbGVySXNUb1N0cmluZyA/IChhbHBoYWJldCA9IEFMUEhBQkVULCBkZWNpbWFsKSA6IChhbHBoYWJldCA9IGRlY2ltYWwsIEFMUEhBQkVUKSk7CgoJCQkJCQkJLy8geGMgbm93IHJlcHJlc2VudHMgc3RyIGFzIGFuIGludGVnZXIgYW5kIGNvbnZlcnRlZCB0byBiYXNlT3V0LiBlIGlzIHRoZSBleHBvbmVudC4KCQkJCQkJCWUgPSBrID0geGMubGVuZ3RoOwoKCQkJCQkJCS8vIFJlbW92ZSB0cmFpbGluZyB6ZXJvcy4KCQkJCQkJCWZvciAoOyB4Y1stLWtdID09IDA7IHhjLnBvcCgpKSA7CgoJCQkJCQkJLy8gWmVybz8KCQkJCQkJCWlmICgheGNbMF0pIHJldHVybiBhbHBoYWJldC5jaGFyQXQoMCk7CgoJCQkJCQkJLy8gRG9lcyBzdHIgcmVwcmVzZW50IGFuIGludGVnZXI/IElmIHNvLCBubyBuZWVkIGZvciB0aGUgZGl2aXNpb24uCgkJCQkJCQlpZiAoaSA8IDApIHsKCQkJCQkJCQktLWU7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXguYyA9IHhjOwoJCQkJCQkJCXguZSA9IGU7CgoJCQkJCQkJCS8vIFRoZSBzaWduIGlzIG5lZWRlZCBmb3IgY29ycmVjdCByb3VuZGluZy4KCQkJCQkJCQl4LnMgPSBzaWduOwoJCQkJCQkJCXggPSBkaXYoeCwgeSwgZHAsIHJtLCBiYXNlT3V0KTsKCQkJCQkJCQl4YyA9IHguYzsKCQkJCQkJCQlyID0geC5yOwoJCQkJCQkJCWUgPSB4LmU7CgkJCQkJCQl9CgoJCQkJCQkJLy8geGMgbm93IHJlcHJlc2VudHMgc3RyIGNvbnZlcnRlZCB0byBiYXNlT3V0LgoKCQkJCQkJCS8vIFRIZSBpbmRleCBvZiB0aGUgcm91bmRpbmcgZGlnaXQuCgkJCQkJCQlkID0gZSArIGRwICsgMTsKCgkJCQkJCQkvLyBUaGUgcm91bmRpbmcgZGlnaXQ6IHRoZSBkaWdpdCB0byB0aGUgcmlnaHQgb2YgdGhlIGRpZ2l0IHRoYXQgbWF5IGJlIHJvdW5kZWQgdXAuCgkJCQkJCQlpID0geGNbZF07CgoJCQkJCQkJLy8gTG9vayBhdCB0aGUgcm91bmRpbmcgZGlnaXRzIGFuZCBtb2RlIHRvIGRldGVybWluZSB3aGV0aGVyIHRvIHJvdW5kIHVwLgoKCQkJCQkJCWsgPSBiYXNlT3V0IC8gMjsKCQkJCQkJCXIgPSByIHx8IGQgPCAwIHx8IHhjW2QgKyAxXSAhPSBudWxsOwoJCQkJCQkJciA9IHJtIDwgNCA/IChpICE9IG51bGwgfHwgcikgJiYgKHJtID09IDAgfHwgcm0gPT0gKHgucyA8IDAgPyAzIDogMikpIDogaSA+IGsgfHwgaSA9PSBrICYmIChybSA9PSA0IHx8IHIgfHwgcm0gPT0gNiAmJiB4Y1tkIC0gMV0gJiAxIHx8IHJtID09ICh4LnMgPCAwID8gOCA6IDcpKTsKCgkJCQkJCQkvLyBJZiB0aGUgaW5kZXggb2YgdGhlIHJvdW5kaW5nIGRpZ2l0IGlzIG5vdCBncmVhdGVyIHRoYW4gemVybywgb3IgeGMgcmVwcmVzZW50cwoJCQkJCQkJLy8gemVybywgdGhlbiB0aGUgcmVzdWx0IG9mIHRoZSBiYXNlIGNvbnZlcnNpb24gaXMgemVybyBvciwgaWYgcm91bmRpbmcgdXAsIGEgdmFsdWUKCQkJCQkJCS8vIHN1Y2ggYXMgMC4wMDAwMS4KCQkJCQkJCWlmIChkIDwgMSB8fCAheGNbMF0pIHsKCQkJCQkJCQkvLyAxXi1kcCBvciAwCgkJCQkJCQkJc3RyID0gciA/IHRvRml4ZWRQb2ludChhbHBoYWJldC5jaGFyQXQoMSksIC1kcCwgYWxwaGFiZXQuY2hhckF0KDApKSA6IGFscGhhYmV0LmNoYXJBdCgwKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJLy8gVHJ1bmNhdGUgeGMgdG8gdGhlIHJlcXVpcmVkIG51bWJlciBvZiBkZWNpbWFsIHBsYWNlcy4KCQkJCQkJCQl4Yy5sZW5ndGggPSBkOwoKCQkJCQkJCQkvLyBSb3VuZCB1cD8KCQkJCQkJCQlpZiAocikgewoJCQkJCQkJCQkvLyBSb3VuZGluZyB1cCBtYXkgbWVhbiB0aGUgcHJldmlvdXMgZGlnaXQgaGFzIHRvIGJlIHJvdW5kZWQgdXAgYW5kIHNvIG9uLgoJCQkJCQkJCQlmb3IgKC0tYmFzZU91dDsgKyt4Y1stLWRdID4gYmFzZU91dDspIHsKCQkJCQkJCQkJCXhjW2RdID0gMDsKCQkJCQkJCQkJCWlmICghZCkgewoJCQkJCQkJCQkJCSsrZTsKCQkJCQkJCQkJCQl4YyA9IFsxXS5jb25jYXQoeGMpOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQl9CgkJCQkJCQkJfQoKCQkJCQkJCQkvLyBEZXRlcm1pbmUgdHJhaWxpbmcgemVyb3MuCgkJCQkJCQkJZm9yIChrID0geGMubGVuZ3RoOyAheGNbLS1rXTspIDsKCgkJCQkJCQkJLy8gRS5nLiBbNCwgMTEsIDE1XSBiZWNvbWVzIDRiZi4KCQkJCQkJCQlmb3IgKGkgPSAwLCBzdHIgPSAnJzsgaSA8PSBrOyBzdHIgKz0gYWxwaGFiZXQuY2hhckF0KHhjW2krK10pKSA7CgoJCQkJCQkJCS8vIEFkZCBsZWFkaW5nIHplcm9zLCBkZWNpbWFsIHBvaW50IGFuZCB0cmFpbGluZyB6ZXJvcyBhcyByZXF1aXJlZC4KCQkJCQkJCQlzdHIgPSB0b0ZpeGVkUG9pbnQoc3RyLCBlLCBhbHBoYWJldC5jaGFyQXQoMCkpOwoJCQkJCQkJfQoKCQkJCQkJCS8vIFRoZSBjYWxsZXIgd2lsbCBhZGQgdGhlIHNpZ24uCgkJCQkJCQlyZXR1cm4gc3RyOwoJCQkJCQl9OwoJCQkJCX0oKTsKCgkJCQkJLy8gUGVyZm9ybSBkaXZpc2lvbiBpbiB0aGUgc3BlY2lmaWVkIGJhc2UuIENhbGxlZCBieSBkaXYgYW5kIGNvbnZlcnRCYXNlLgoJCQkJCWRpdiA9IGZ1bmN0aW9uKCkgewoJCQkJCQkvLyBBc3N1bWUgbm9uLXplcm8geCBhbmQgay4KCQkJCQkJZnVuY3Rpb24gbXVsdGlwbHkoeCwgaywgYmFzZSkgewoJCQkJCQkJdmFyIG0sCgkJCQkJCQkJdGVtcCwKCQkJCQkJCQl4bG8sCgkJCQkJCQkJeGhpLAoJCQkJCQkJCWNhcnJ5ID0gMCwKCQkJCQkJCQlpID0geC5sZW5ndGgsCgkJCQkJCQkJa2xvID0gayAlIFNRUlRfQkFTRSwKCQkJCQkJCQlraGkgPSBrIC8gU1FSVF9CQVNFIHwgMDsKCQkJCQkJCWZvciAoeCA9IHguc2xpY2UoKTsgaS0tOykgewoJCQkJCQkJCXhsbyA9IHhbaV0gJSBTUVJUX0JBU0U7CgkJCQkJCQkJeGhpID0geFtpXSAvIFNRUlRfQkFTRSB8IDA7CgkJCQkJCQkJbSA9IGtoaSAqIHhsbyArIHhoaSAqIGtsbzsKCQkJCQkJCQl0ZW1wID0ga2xvICogeGxvICsgbSAlIFNRUlRfQkFTRSAqIFNRUlRfQkFTRSArIGNhcnJ5OwoJCQkJCQkJCWNhcnJ5ID0gKHRlbXAgLyBiYXNlIHwgMCkgKyAobSAvIFNRUlRfQkFTRSB8IDApICsga2hpICogeGhpOwoJCQkJCQkJCXhbaV0gPSB0ZW1wICUgYmFzZTsKCQkJCQkJCX0KCQkJCQkJCWlmIChjYXJyeSkgeCA9IFtjYXJyeV0uY29uY2F0KHgpOwoJCQkJCQkJcmV0dXJuIHg7CgkJCQkJCX0KCgkJCQkJCWZ1bmN0aW9uIGNvbXBhcmUoYSwgYiwgYUwsIGJMKSB7CgkJCQkJCQl2YXIgaSwgY21wOwoJCQkJCQkJaWYgKGFMICE9IGJMKSB7CgkJCQkJCQkJY21wID0gYUwgPiBiTCA/IDEgOiAtMTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJZm9yIChpID0gY21wID0gMDsgaSA8IGFMOyBpKyspIHsKCQkJCQkJCQkJaWYgKGFbaV0gIT0gYltpXSkgewoJCQkJCQkJCQkJY21wID0gYVtpXSA+IGJbaV0gPyAxIDogLTE7CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJCXJldHVybiBjbXA7CgkJCQkJCX0KCgkJCQkJCWZ1bmN0aW9uIHN1YnRyYWN0KGEsIGIsIGFMLCBiYXNlKSB7CgkJCQkJCQl2YXIgaSA9IDA7CgoJCQkJCQkJLy8gU3VidHJhY3QgYiBmcm9tIGEuCgkJCQkJCQlmb3IgKDsgYUwtLTspIHsKCQkJCQkJCQlhW2FMXSAtPSBpOwoJCQkJCQkJCWkgPSBhW2FMXSA8IGJbYUxdID8gMSA6IDA7CgkJCQkJCQkJYVthTF0gPSBpICogYmFzZSArIGFbYUxdIC0gYlthTF07CgkJCQkJCQl9CgoJCQkJCQkJLy8gUmVtb3ZlIGxlYWRpbmcgemVyb3MuCgkJCQkJCQlmb3IgKDsgIWFbMF0gJiYgYS5sZW5ndGggPiAxOyBhLnNwbGljZSgwLCAxKSkgOwoJCQkJCQl9CgoJCQkJCQkvLyB4OiBkaXZpZGVuZCwgeTogZGl2aXNvci4KCQkJCQkJcmV0dXJuIGZ1bmN0aW9uKHgsIHksIGRwLCBybSwgYmFzZSkgewoJCQkJCQkJdmFyIGNtcCwKCQkJCQkJCQllLAoJCQkJCQkJCWksCgkJCQkJCQkJbW9yZSwKCQkJCQkJCQluLAoJCQkJCQkJCXByb2QsCgkJCQkJCQkJcHJvZEwsCgkJCQkJCQkJcSwKCQkJCQkJCQlxYywKCQkJCQkJCQlyZW0sCgkJCQkJCQkJcmVtTCwKCQkJCQkJCQlyZW0wLAoJCQkJCQkJCXhpLAoJCQkJCQkJCXhMLAoJCQkJCQkJCXljMCwKCQkJCQkJCQl5TCwKCQkJCQkJCQl5eiwKCQkJCQkJCQlzID0geC5zID09IHkucyA/IDEgOiAtMSwKCQkJCQkJCQl4YyA9IHguYywKCQkJCQkJCQl5YyA9IHkuYzsKCgkJCQkJCQkvLyBFaXRoZXIgTmFOLCBJbmZpbml0eSBvciAwPwoJCQkJCQkJaWYgKCF4YyB8fCAheGNbMF0gfHwgIXljIHx8ICF5Y1swXSkgewoJCQkJCQkJCXJldHVybiBuZXcgQmlnTnVtYmVyKAoJCQkJCQkJCQkvLyBSZXR1cm4gTmFOIGlmIGVpdGhlciBOYU4sIG9yIGJvdGggSW5maW5pdHkgb3IgMC4KCQkJCQkJCQkJIXgucyB8fCAheS5zIHx8ICh4YyA/IHljICYmIHhjWzBdID09IHljWzBdIDogIXljKSA/IE5hTiA6CgkJCQkJCQkJCQkvLyBSZXR1cm4gwrEwIGlmIHggaXMgwrEwIG9yIHkgaXMgwrFJbmZpbml0eSwgb3IgcmV0dXJuIMKxSW5maW5pdHkgYXMgeSBpcyDCsTAuCgkJCQkJCQkJCQl4YyAmJiB4Y1swXSA9PSAwIHx8ICF5YyA/IHMgKiAwIDogcyAvIDApOwoJCQkJCQkJfQoJCQkJCQkJcSA9IG5ldyBCaWdOdW1iZXIocyk7CgkJCQkJCQlxYyA9IHEuYyA9IFtdOwoJCQkJCQkJZSA9IHguZSAtIHkuZTsKCQkJCQkJCXMgPSBkcCArIGUgKyAxOwoJCQkJCQkJaWYgKCFiYXNlKSB7CgkJCQkJCQkJYmFzZSA9IEJBU0U7CgkJCQkJCQkJZSA9IGJpdEZsb29yKHguZSAvIExPR19CQVNFKSAtIGJpdEZsb29yKHkuZSAvIExPR19CQVNFKTsKCQkJCQkJCQlzID0gcyAvIExPR19CQVNFIHwgMDsKCQkJCQkJCX0KCgkJCQkJCQkvLyBSZXN1bHQgZXhwb25lbnQgbWF5IGJlIG9uZSBsZXNzIHRoZW4gdGhlIGN1cnJlbnQgdmFsdWUgb2YgZS4KCQkJCQkJCS8vIFRoZSBjb2VmZmljaWVudHMgb2YgdGhlIEJpZ051bWJlcnMgZnJvbSBjb252ZXJ0QmFzZSBtYXkgaGF2ZSB0cmFpbGluZyB6ZXJvcy4KCQkJCQkJCWZvciAoaSA9IDA7IHljW2ldID09ICh4Y1tpXSB8fCAwKTsgaSsrKSA7CgkJCQkJCQlpZiAoeWNbaV0gPiAoeGNbaV0gfHwgMCkpIGUtLTsKCQkJCQkJCWlmIChzIDwgMCkgewoJCQkJCQkJCXFjLnB1c2goMSk7CgkJCQkJCQkJbW9yZSA9IHRydWU7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXhMID0geGMubGVuZ3RoOwoJCQkJCQkJCXlMID0geWMubGVuZ3RoOwoJCQkJCQkJCWkgPSAwOwoJCQkJCQkJCXMgKz0gMjsKCgkJCQkJCQkJLy8gTm9ybWFsaXNlIHhjIGFuZCB5YyBzbyBoaWdoZXN0IG9yZGVyIGRpZ2l0IG9mIHljIGlzID49IGJhc2UgLyAyLgoKCQkJCQkJCQluID0gbWF0aGZsb29yKGJhc2UgLyAoeWNbMF0gKyAxKSk7CgoJCQkJCQkJCS8vIE5vdCBuZWNlc3NhcnksIGJ1dCB0byBoYW5kbGUgb2RkIGJhc2VzIHdoZXJlIHljWzBdID09IChiYXNlIC8gMikgLSAxLgoJCQkJCQkJCS8vIGlmIChuID4gMSB8fCBuKysgPT0gMSAmJiB5Y1swXSA8IGJhc2UgLyAyKSB7CgkJCQkJCQkJaWYgKG4gPiAxKSB7CgkJCQkJCQkJCXljID0gbXVsdGlwbHkoeWMsIG4sIGJhc2UpOwoJCQkJCQkJCQl4YyA9IG11bHRpcGx5KHhjLCBuLCBiYXNlKTsKCQkJCQkJCQkJeUwgPSB5Yy5sZW5ndGg7CgkJCQkJCQkJCXhMID0geGMubGVuZ3RoOwoJCQkJCQkJCX0KCQkJCQkJCQl4aSA9IHlMOwoJCQkJCQkJCXJlbSA9IHhjLnNsaWNlKDAsIHlMKTsKCQkJCQkJCQlyZW1MID0gcmVtLmxlbmd0aDsKCgkJCQkJCQkJLy8gQWRkIHplcm9zIHRvIG1ha2UgcmVtYWluZGVyIGFzIGxvbmcgYXMgZGl2aXNvci4KCQkJCQkJCQlmb3IgKDsgcmVtTCA8IHlMOyByZW1bcmVtTCsrXSA9IDApIDsKCQkJCQkJCQl5eiA9IHljLnNsaWNlKCk7CgkJCQkJCQkJeXogPSBbMF0uY29uY2F0KHl6KTsKCQkJCQkJCQl5YzAgPSB5Y1swXTsKCQkJCQkJCQlpZiAoeWNbMV0gPj0gYmFzZSAvIDIpIHljMCsrOwoJCQkJCQkJCS8vIE5vdCBuZWNlc3NhcnksIGJ1dCB0byBwcmV2ZW50IHRyaWFsIGRpZ2l0IG4gPiBiYXNlLCB3aGVuIHVzaW5nIGJhc2UgMy4KCQkJCQkJCQkvLyBlbHNlIGlmIChiYXNlID09IDMgJiYgeWMwID09IDEpIHljMCA9IDEgKyAxZS0xNTsKCgkJCQkJCQkJZG8gewoJCQkJCQkJCQluID0gMDsKCgkJCQkJCQkJCS8vIENvbXBhcmUgZGl2aXNvciBhbmQgcmVtYWluZGVyLgoJCQkJCQkJCQljbXAgPSBjb21wYXJlKHljLCByZW0sIHlMLCByZW1MKTsKCgkJCQkJCQkJCS8vIElmIGRpdmlzb3IgPCByZW1haW5kZXIuCgkJCQkJCQkJCWlmIChjbXAgPCAwKSB7CgkJCQkJCQkJCQkvLyBDYWxjdWxhdGUgdHJpYWwgZGlnaXQsIG4uCgoJCQkJCQkJCQkJcmVtMCA9IHJlbVswXTsKCQkJCQkJCQkJCWlmICh5TCAhPSByZW1MKSByZW0wID0gcmVtMCAqIGJhc2UgKyAocmVtWzFdIHx8IDApOwoKCQkJCQkJCQkJCS8vIG4gaXMgaG93IG1hbnkgdGltZXMgdGhlIGRpdmlzb3IgZ29lcyBpbnRvIHRoZSBjdXJyZW50IHJlbWFpbmRlci4KCQkJCQkJCQkJCW4gPSBtYXRoZmxvb3IocmVtMCAvIHljMCk7CgoJCQkJCQkJCQkJLy8gIEFsZ29yaXRobToKCQkJCQkJCQkJCS8vICBwcm9kdWN0ID0gZGl2aXNvciBtdWx0aXBsaWVkIGJ5IHRyaWFsIGRpZ2l0IChuKS4KCQkJCQkJCQkJCS8vICBDb21wYXJlIHByb2R1Y3QgYW5kIHJlbWFpbmRlci4KCQkJCQkJCQkJCS8vICBJZiBwcm9kdWN0IGlzIGdyZWF0ZXIgdGhhbiByZW1haW5kZXI6CgkJCQkJCQkJCQkvLyAgICBTdWJ0cmFjdCBkaXZpc29yIGZyb20gcHJvZHVjdCwgZGVjcmVtZW50IHRyaWFsIGRpZ2l0LgoJCQkJCQkJCQkJLy8gIFN1YnRyYWN0IHByb2R1Y3QgZnJvbSByZW1haW5kZXIuCgkJCQkJCQkJCQkvLyAgSWYgcHJvZHVjdCB3YXMgbGVzcyB0aGFuIHJlbWFpbmRlciBhdCB0aGUgbGFzdCBjb21wYXJlOgoJCQkJCQkJCQkJLy8gICAgQ29tcGFyZSBuZXcgcmVtYWluZGVyIGFuZCBkaXZpc29yLgoJCQkJCQkJCQkJLy8gICAgSWYgcmVtYWluZGVyIGlzIGdyZWF0ZXIgdGhhbiBkaXZpc29yOgoJCQkJCQkJCQkJLy8gICAgICBTdWJ0cmFjdCBkaXZpc29yIGZyb20gcmVtYWluZGVyLCBpbmNyZW1lbnQgdHJpYWwgZGlnaXQuCgoJCQkJCQkJCQkJaWYgKG4gPiAxKSB7CgkJCQkJCQkJCQkJLy8gbiBtYXkgYmUgPiBiYXNlIG9ubHkgd2hlbiBiYXNlIGlzIDMuCgkJCQkJCQkJCQkJaWYgKG4gPj0gYmFzZSkgbiA9IGJhc2UgLSAxOwoKCQkJCQkJCQkJCQkvLyBwcm9kdWN0ID0gZGl2aXNvciAqIHRyaWFsIGRpZ2l0LgoJCQkJCQkJCQkJCXByb2QgPSBtdWx0aXBseSh5YywgbiwgYmFzZSk7CgkJCQkJCQkJCQkJcHJvZEwgPSBwcm9kLmxlbmd0aDsKCQkJCQkJCQkJCQlyZW1MID0gcmVtLmxlbmd0aDsKCgkJCQkJCQkJCQkJLy8gQ29tcGFyZSBwcm9kdWN0IGFuZCByZW1haW5kZXIuCgkJCQkJCQkJCQkJLy8gSWYgcHJvZHVjdCA+IHJlbWFpbmRlciB0aGVuIHRyaWFsIGRpZ2l0IG4gdG9vIGhpZ2guCgkJCQkJCQkJCQkJLy8gbiBpcyAxIHRvbyBoaWdoIGFib3V0IDUlIG9mIHRoZSB0aW1lLCBhbmQgaXMgbm90IGtub3duIHRvIGhhdmUKCQkJCQkJCQkJCQkvLyBldmVyIGJlZW4gbW9yZSB0aGFuIDEgdG9vIGhpZ2guCgkJCQkJCQkJCQkJd2hpbGUgKGNvbXBhcmUocHJvZCwgcmVtLCBwcm9kTCwgcmVtTCkgPT0gMSkgewoJCQkJCQkJCQkJCQluLS07CgoJCQkJCQkJCQkJCQkvLyBTdWJ0cmFjdCBkaXZpc29yIGZyb20gcHJvZHVjdC4KCQkJCQkJCQkJCQkJc3VidHJhY3QocHJvZCwgeUwgPCBwcm9kTCA/IHl6IDogeWMsIHByb2RMLCBiYXNlKTsKCQkJCQkJCQkJCQkJcHJvZEwgPSBwcm9kLmxlbmd0aDsKCQkJCQkJCQkJCQkJY21wID0gMTsKCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJCS8vIG4gaXMgMCBvciAxLCBjbXAgaXMgLTEuCgkJCQkJCQkJCQkJLy8gSWYgbiBpcyAwLCB0aGVyZSBpcyBubyBuZWVkIHRvIGNvbXBhcmUgeWMgYW5kIHJlbSBhZ2FpbiBiZWxvdywKCQkJCQkJCQkJCQkvLyBzbyBjaGFuZ2UgY21wIHRvIDEgdG8gYXZvaWQgaXQuCgkJCQkJCQkJCQkJLy8gSWYgbiBpcyAxLCBsZWF2ZSBjbXAgYXMgLTEsIHNvIHljIGFuZCByZW0gYXJlIGNvbXBhcmVkIGFnYWluLgoJCQkJCQkJCQkJCWlmIChuID09IDApIHsKCQkJCQkJCQkJCQkJLy8gZGl2aXNvciA8IHJlbWFpbmRlciwgc28gbiBtdXN0IGJlIGF0IGxlYXN0IDEuCgkJCQkJCQkJCQkJCWNtcCA9IG4gPSAxOwoJCQkJCQkJCQkJCX0KCgkJCQkJCQkJCQkJLy8gcHJvZHVjdCA9IGRpdmlzb3IKCQkJCQkJCQkJCQlwcm9kID0geWMuc2xpY2UoKTsKCQkJCQkJCQkJCQlwcm9kTCA9IHByb2QubGVuZ3RoOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQkJaWYgKHByb2RMIDwgcmVtTCkgcHJvZCA9IFswXS5jb25jYXQocHJvZCk7CgoJCQkJCQkJCQkJLy8gU3VidHJhY3QgcHJvZHVjdCBmcm9tIHJlbWFpbmRlci4KCQkJCQkJCQkJCXN1YnRyYWN0KHJlbSwgcHJvZCwgcmVtTCwgYmFzZSk7CgkJCQkJCQkJCQlyZW1MID0gcmVtLmxlbmd0aDsKCgkJCQkJCQkJCQkvLyBJZiBwcm9kdWN0IHdhcyA8IHJlbWFpbmRlci4KCQkJCQkJCQkJCWlmIChjbXAgPT0gLTEpIHsKCQkJCQkJCQkJCQkvLyBDb21wYXJlIGRpdmlzb3IgYW5kIG5ldyByZW1haW5kZXIuCgkJCQkJCQkJCQkJLy8gSWYgZGl2aXNvciA8IG5ldyByZW1haW5kZXIsIHN1YnRyYWN0IGRpdmlzb3IgZnJvbSByZW1haW5kZXIuCgkJCQkJCQkJCQkJLy8gVHJpYWwgZGlnaXQgbiB0b28gbG93LgoJCQkJCQkJCQkJCS8vIG4gaXMgMSB0b28gbG93IGFib3V0IDUlIG9mIHRoZSB0aW1lLCBhbmQgdmVyeSByYXJlbHkgMiB0b28gbG93LgoJCQkJCQkJCQkJCXdoaWxlIChjb21wYXJlKHljLCByZW0sIHlMLCByZW1MKSA8IDEpIHsKCQkJCQkJCQkJCQkJbisrOwoKCQkJCQkJCQkJCQkJLy8gU3VidHJhY3QgZGl2aXNvciBmcm9tIHJlbWFpbmRlci4KCQkJCQkJCQkJCQkJc3VidHJhY3QocmVtLCB5TCA8IHJlbUwgPyB5eiA6IHljLCByZW1MLCBiYXNlKTsKCQkJCQkJCQkJCQkJcmVtTCA9IHJlbS5sZW5ndGg7CgkJCQkJCQkJCQkJfQoJCQkJCQkJCQkJfQoJCQkJCQkJCQl9IGVsc2UgaWYgKGNtcCA9PT0gMCkgewoJCQkJCQkJCQkJbisrOwoJCQkJCQkJCQkJcmVtID0gWzBdOwoJCQkJCQkJCQl9IC8vIGVsc2UgY21wID09PSAxIGFuZCBuIHdpbGwgYmUgMAoKCQkJCQkJCQkJLy8gQWRkIHRoZSBuZXh0IGRpZ2l0LCBuLCB0byB0aGUgcmVzdWx0IGFycmF5LgoJCQkJCQkJCQlxY1tpKytdID0gbjsKCgkJCQkJCQkJCS8vIFVwZGF0ZSB0aGUgcmVtYWluZGVyLgoJCQkJCQkJCQlpZiAocmVtWzBdKSB7CgkJCQkJCQkJCQlyZW1bcmVtTCsrXSA9IHhjW3hpXSB8fCAwOwoJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJcmVtID0gW3hjW3hpXV07CgkJCQkJCQkJCQlyZW1MID0gMTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0gd2hpbGUgKCh4aSsrIDwgeEwgfHwgcmVtWzBdICE9IG51bGwpICYmIHMtLSk7CgkJCQkJCQkJbW9yZSA9IHJlbVswXSAhPSBudWxsOwoKCQkJCQkJCQkvLyBMZWFkaW5nIHplcm8/CgkJCQkJCQkJaWYgKCFxY1swXSkgcWMuc3BsaWNlKDAsIDEpOwoJCQkJCQkJfQoJCQkJCQkJaWYgKGJhc2UgPT0gQkFTRSkgewoJCQkJCQkJCS8vIFRvIGNhbGN1bGF0ZSBxLmUsIGZpcnN0IGdldCB0aGUgbnVtYmVyIG9mIGRpZ2l0cyBvZiBxY1swXS4KCQkJCQkJCQlmb3IgKGkgPSAxLCBzID0gcWNbMF07IHMgPj0gMTA7IHMgLz0gMTAsIGkrKykgOwoJCQkJCQkJCXJvdW5kKHEsIGRwICsgKHEuZSA9IGkgKyBlICogTE9HX0JBU0UgLSAxKSArIDEsIHJtLCBtb3JlKTsKCgkJCQkJCQkJLy8gQ2FsbGVyIGlzIGNvbnZlcnRCYXNlLgoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlxLmUgPSBlOwoJCQkJCQkJCXEuciA9ICttb3JlOwoJCQkJCQkJfQoJCQkJCQkJcmV0dXJuIHE7CgkJCQkJCX07CgkJCQkJfSgpOwoKCQkJCQkvKgogICAgICogUmV0dXJuIGEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgdmFsdWUgb2YgQmlnTnVtYmVyIG4gaW4gZml4ZWQtcG9pbnQgb3IgZXhwb25lbnRpYWwKICAgICAqIG5vdGF0aW9uIHJvdW5kZWQgdG8gdGhlIHNwZWNpZmllZCBkZWNpbWFsIHBsYWNlcyBvciBzaWduaWZpY2FudCBkaWdpdHMuCiAgICAgKgogICAgICogbjogYSBCaWdOdW1iZXIuCiAgICAgKiBpOiB0aGUgaW5kZXggb2YgdGhlIGxhc3QgZGlnaXQgcmVxdWlyZWQgKGkuZS4gdGhlIGRpZ2l0IHRoYXQgbWF5IGJlIHJvdW5kZWQgdXApLgogICAgICogcm06IHRoZSByb3VuZGluZyBtb2RlLgogICAgICogaWQ6IDEgKHRvRXhwb25lbnRpYWwpIG9yIDIgKHRvUHJlY2lzaW9uKS4KICAgICAqLwoJCQkJCWZ1bmN0aW9uIGZvcm1hdChuLCBpLCBybSwgaWQpIHsKCQkJCQkJdmFyIGMwLCBlLCBuZSwgbGVuLCBzdHI7CgkJCQkJCWlmIChybSA9PSBudWxsKSBybSA9IFJPVU5ESU5HX01PREU7IGVsc2UgaW50Q2hlY2socm0sIDAsIDgpOwoJCQkJCQlpZiAoIW4uYykgcmV0dXJuIG4udG9TdHJpbmcoKTsKCQkJCQkJYzAgPSBuLmNbMF07CgkJCQkJCW5lID0gbi5lOwoJCQkJCQlpZiAoaSA9PSBudWxsKSB7CgkJCQkJCQlzdHIgPSBjb2VmZlRvU3RyaW5nKG4uYyk7CgkJCQkJCQlzdHIgPSBpZCA9PSAxIHx8IGlkID09IDIgJiYgKG5lIDw9IFRPX0VYUF9ORUcgfHwgbmUgPj0gVE9fRVhQX1BPUykgPyB0b0V4cG9uZW50aWFsKHN0ciwgbmUpIDogdG9GaXhlZFBvaW50KHN0ciwgbmUsICcwJyk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQluID0gcm91bmQobmV3IEJpZ051bWJlcihuKSwgaSwgcm0pOwoKCQkJCQkJCS8vIG4uZSBtYXkgaGF2ZSBjaGFuZ2VkIGlmIHRoZSB2YWx1ZSB3YXMgcm91bmRlZCB1cC4KCQkJCQkJCWUgPSBuLmU7CgkJCQkJCQlzdHIgPSBjb2VmZlRvU3RyaW5nKG4uYyk7CgkJCQkJCQlsZW4gPSBzdHIubGVuZ3RoOwoKCQkJCQkJCS8vIHRvUHJlY2lzaW9uIHJldHVybnMgZXhwb25lbnRpYWwgbm90YXRpb24gaWYgdGhlIG51bWJlciBvZiBzaWduaWZpY2FudCBkaWdpdHMKCQkJCQkJCS8vIHNwZWNpZmllZCBpcyBsZXNzIHRoYW4gdGhlIG51bWJlciBvZiBkaWdpdHMgbmVjZXNzYXJ5IHRvIHJlcHJlc2VudCB0aGUgaW50ZWdlcgoJCQkJCQkJLy8gcGFydCBvZiB0aGUgdmFsdWUgaW4gZml4ZWQtcG9pbnQgbm90YXRpb24uCgoJCQkJCQkJLy8gRXhwb25lbnRpYWwgbm90YXRpb24uCgkJCQkJCQlpZiAoaWQgPT0gMSB8fCBpZCA9PSAyICYmIChpIDw9IGUgfHwgZSA8PSBUT19FWFBfTkVHKSkgewoJCQkJCQkJCS8vIEFwcGVuZCB6ZXJvcz8KCQkJCQkJCQlmb3IgKDsgbGVuIDwgaTsgc3RyICs9ICcwJywgbGVuKyspIDsKCQkJCQkJCQlzdHIgPSB0b0V4cG9uZW50aWFsKHN0ciwgZSk7CgoJCQkJCQkJCS8vIEZpeGVkLXBvaW50IG5vdGF0aW9uLgoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlpIC09IG5lOwoJCQkJCQkJCXN0ciA9IHRvRml4ZWRQb2ludChzdHIsIGUsICcwJyk7CgoJCQkJCQkJCS8vIEFwcGVuZCB6ZXJvcz8KCQkJCQkJCQlpZiAoZSArIDEgPiBsZW4pIHsKCQkJCQkJCQkJaWYgKC0taSA+IDApIGZvciAoc3RyICs9ICcuJzsgaS0tOyBzdHIgKz0gJzAnKSA7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJaSArPSBlIC0gbGVuOwoJCQkJCQkJCQlpZiAoaSA+IDApIHsKCQkJCQkJCQkJCWlmIChlICsgMSA9PSBsZW4pIHN0ciArPSAnLic7CgkJCQkJCQkJCQlmb3IgKDsgaS0tOyBzdHIgKz0gJzAnKSA7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJcmV0dXJuIG4ucyA8IDAgJiYgYzAgPyAnLScgKyBzdHIgOiBzdHI7CgkJCQkJfQoKCQkJCQkvLyBIYW5kbGUgQmlnTnVtYmVyLm1heCBhbmQgQmlnTnVtYmVyLm1pbi4KCQkJCQkvLyBJZiBhbnkgbnVtYmVyIGlzIE5hTiwgcmV0dXJuIE5hTi4KCQkJCQlmdW5jdGlvbiBtYXhPck1pbihhcmdzLCBuKSB7CgkJCQkJCXZhciBrLAoJCQkJCQkJeSwKCQkJCQkJCWkgPSAxLAoJCQkJCQkJeCA9IG5ldyBCaWdOdW1iZXIoYXJnc1swXSk7CgkJCQkJCWZvciAoOyBpIDwgYXJncy5sZW5ndGg7IGkrKykgewoJCQkJCQkJeSA9IG5ldyBCaWdOdW1iZXIoYXJnc1tpXSk7CgkJCQkJCQlpZiAoIXkucyB8fCAoayA9IGNvbXBhcmUoeCwgeSkpID09PSBuIHx8IGsgPT09IDAgJiYgeC5zID09PSBuKSB7CgkJCQkJCQkJeCA9IHk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJcmV0dXJuIHg7CgkJCQkJfQoKCQkJCQkvKgogICAgICogU3RyaXAgdHJhaWxpbmcgemVyb3MsIGNhbGN1bGF0ZSBiYXNlIDEwIGV4cG9uZW50IGFuZCBjaGVjayBhZ2FpbnN0IE1JTl9FWFAgYW5kIE1BWF9FWFAuCiAgICAgKiBDYWxsZWQgYnkgbWludXMsIHBsdXMgYW5kIHRpbWVzLgogICAgICovCgkJCQkJZnVuY3Rpb24gbm9ybWFsaXNlKG4sIGMsIGUpIHsKCQkJCQkJdmFyIGkgPSAxLAoJCQkJCQkJaiA9IGMubGVuZ3RoOwoKCQkJCQkJLy8gUmVtb3ZlIHRyYWlsaW5nIHplcm9zLgoJCQkJCQlmb3IgKDsgIWNbLS1qXTsgYy5wb3AoKSkgOwoKCQkJCQkJLy8gQ2FsY3VsYXRlIHRoZSBiYXNlIDEwIGV4cG9uZW50LiBGaXJzdCBnZXQgdGhlIG51bWJlciBvZiBkaWdpdHMgb2YgY1swXS4KCQkJCQkJZm9yIChqID0gY1swXTsgaiA+PSAxMDsgaiAvPSAxMCwgaSsrKSA7CgoJCQkJCQkvLyBPdmVyZmxvdz8KCQkJCQkJaWYgKChlID0gaSArIGUgKiBMT0dfQkFTRSAtIDEpID4gTUFYX0VYUCkgewoJCQkJCQkJLy8gSW5maW5pdHkuCgkJCQkJCQluLmMgPSBuLmUgPSBudWxsOwoKCQkJCQkJCS8vIFVuZGVyZmxvdz8KCQkJCQkJfSBlbHNlIGlmIChlIDwgTUlOX0VYUCkgewoJCQkJCQkJLy8gWmVyby4KCQkJCQkJCW4uYyA9IFtuLmUgPSAwXTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCW4uZSA9IGU7CgkJCQkJCQluLmMgPSBjOwoJCQkJCQl9CgkJCQkJCXJldHVybiBuOwoJCQkJCX0KCgkJCQkJLy8gSGFuZGxlIHZhbHVlcyB0aGF0IGZhaWwgdGhlIHZhbGlkaXR5IHRlc3QgaW4gQmlnTnVtYmVyLgoJCQkJCXBhcnNlTnVtZXJpYyA9IGZ1bmN0aW9uKCkgewoJCQkJCQl2YXIgYmFzZVByZWZpeCA9IC9eKC0/KTAoW3hib10pKD89XHdbXHcuXSokKS9pLAoJCQkJCQkJZG90QWZ0ZXIgPSAvXihbXi5dKylcLiQvLAoJCQkJCQkJZG90QmVmb3JlID0gL15cLihbXi5dKykkLywKCQkJCQkJCWlzSW5maW5pdHlPck5hTiA9IC9eLT8oSW5maW5pdHl8TmFOKSQvLAoJCQkJCQkJd2hpdGVzcGFjZU9yUGx1cyA9IC9eXHMqXCsoPz1bXHcuXSl8XlxzK3xccyskL2c7CgkJCQkJCXJldHVybiBmdW5jdGlvbih4LCBzdHIsIGlzTnVtLCBiKSB7CgkJCQkJCQl2YXIgYmFzZSwKCQkJCQkJCQlzID0gaXNOdW0gPyBzdHIgOiBzdHIucmVwbGFjZSh3aGl0ZXNwYWNlT3JQbHVzLCAnJyk7CgoJCQkJCQkJLy8gTm8gZXhjZXB0aW9uIG9uIMKxSW5maW5pdHkgb3IgTmFOLgoJCQkJCQkJaWYgKGlzSW5maW5pdHlPck5hTi50ZXN0KHMpKSB7CgkJCQkJCQkJeC5zID0gaXNOYU4ocykgPyBudWxsIDogcyA8IDAgPyAtMSA6IDE7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCWlmICghaXNOdW0pIHsKCQkJCQkJCQkJLy8gYmFzZVByZWZpeCA9IC9eKC0/KTAoW3hib10pKD89XHdbXHcuXSokKS9pCgkJCQkJCQkJCXMgPSBzLnJlcGxhY2UoYmFzZVByZWZpeCwgZnVuY3Rpb24obSwgcDEsIHAyKSB7CgkJCQkJCQkJCQliYXNlID0gKHAyID0gcDIudG9Mb3dlckNhc2UoKSkgPT0gJ3gnID8gMTYgOiBwMiA9PSAnYicgPyAyIDogODsKCQkJCQkJCQkJCXJldHVybiAhYiB8fCBiID09IGJhc2UgPyBwMSA6IG07CgkJCQkJCQkJCX0pOwoJCQkJCQkJCQlpZiAoYikgewoJCQkJCQkJCQkJYmFzZSA9IGI7CgoJCQkJCQkJCQkJLy8gRS5nLiAnMS4nIHRvICcxJywgJy4xJyB0byAnMC4xJwoJCQkJCQkJCQkJcyA9IHMucmVwbGFjZShkb3RBZnRlciwgJyQxJykucmVwbGFjZShkb3RCZWZvcmUsICcwLiQxJyk7CgkJCQkJCQkJCX0KCQkJCQkJCQkJaWYgKHN0ciAhPSBzKSByZXR1cm4gbmV3IEJpZ051bWJlcihzLCBiYXNlKTsKCQkJCQkJCQl9CgoJCQkJCQkJCS8vICdbQmlnTnVtYmVyIEVycm9yXSBOb3QgYSBudW1iZXI6IHtufScKCQkJCQkJCQkvLyAnW0JpZ051bWJlciBFcnJvcl0gTm90IGEgYmFzZSB7Yn0gbnVtYmVyOiB7bn0nCgkJCQkJCQkJaWYgKEJpZ051bWJlci5ERUJVRykgewoJCQkJCQkJCQl0aHJvdyBFcnJvcihiaWdudW1iZXJFcnJvciArICdOb3QgYScgKyAoYiA/ICcgYmFzZSAnICsgYiA6ICcnKSArICcgbnVtYmVyOiAnICsgc3RyKTsKCQkJCQkJCQl9CgoJCQkJCQkJCS8vIE5hTgoJCQkJCQkJCXgucyA9IG51bGw7CgkJCQkJCQl9CgkJCQkJCQl4LmMgPSB4LmUgPSBudWxsOwoJCQkJCQl9OwoJCQkJCX0oKTsKCgkJCQkJLyoKICAgICAqIFJvdW5kIHggdG8gc2Qgc2lnbmlmaWNhbnQgZGlnaXRzIHVzaW5nIHJvdW5kaW5nIG1vZGUgcm0uIENoZWNrIGZvciBvdmVyL3VuZGVyLWZsb3cuCiAgICAgKiBJZiByIGlzIHRydXRoeSwgaXQgaXMga25vd24gdGhhdCB0aGVyZSBhcmUgbW9yZSBkaWdpdHMgYWZ0ZXIgdGhlIHJvdW5kaW5nIGRpZ2l0LgogICAgICovCgkJCQkJZnVuY3Rpb24gcm91bmQoeCwgc2QsIHJtLCByKSB7CgkJCQkJCXZhciBkLAoJCQkJCQkJaSwKCQkJCQkJCWosCgkJCQkJCQlrLAoJCQkJCQkJbiwKCQkJCQkJCW5pLAoJCQkJCQkJcmQsCgkJCQkJCQl4YyA9IHguYywKCQkJCQkJCXBvd3MxMCA9IFBPV1NfVEVOOwoKCQkJCQkJLy8gaWYgeCBpcyBub3QgSW5maW5pdHkgb3IgTmFOLi4uCgkJCQkJCWlmICh4YykgewoJCQkJCQkJLy8gcmQgaXMgdGhlIHJvdW5kaW5nIGRpZ2l0LCBpLmUuIHRoZSBkaWdpdCBhZnRlciB0aGUgZGlnaXQgdGhhdCBtYXkgYmUgcm91bmRlZCB1cC4KCQkJCQkJCS8vIG4gaXMgYSBiYXNlIDFlMTQgbnVtYmVyLCB0aGUgdmFsdWUgb2YgdGhlIGVsZW1lbnQgb2YgYXJyYXkgeC5jIGNvbnRhaW5pbmcgcmQuCgkJCQkJCQkvLyBuaSBpcyB0aGUgaW5kZXggb2YgbiB3aXRoaW4geC5jLgoJCQkJCQkJLy8gZCBpcyB0aGUgbnVtYmVyIG9mIGRpZ2l0cyBvZiBuLgoJCQkJCQkJLy8gaSBpcyB0aGUgaW5kZXggb2YgcmQgd2l0aGluIG4gaW5jbHVkaW5nIGxlYWRpbmcgemVyb3MuCgkJCQkJCQkvLyBqIGlzIHRoZSBhY3R1YWwgaW5kZXggb2YgcmQgd2l0aGluIG4gKGlmIDwgMCwgcmQgaXMgYSBsZWFkaW5nIHplcm8pLgoJCQkJCQkJb3V0OiB7CgkJCQkJCQkJLy8gR2V0IHRoZSBudW1iZXIgb2YgZGlnaXRzIG9mIHRoZSBmaXJzdCBlbGVtZW50IG9mIHhjLgoJCQkJCQkJCWZvciAoZCA9IDEsIGsgPSB4Y1swXTsgayA+PSAxMDsgayAvPSAxMCwgZCsrKSA7CgkJCQkJCQkJaSA9IHNkIC0gZDsKCgkJCQkJCQkJLy8gSWYgdGhlIHJvdW5kaW5nIGRpZ2l0IGlzIGluIHRoZSBmaXJzdCBlbGVtZW50IG9mIHhjLi4uCgkJCQkJCQkJaWYgKGkgPCAwKSB7CgkJCQkJCQkJCWkgKz0gTE9HX0JBU0U7CgkJCQkJCQkJCWogPSBzZDsKCQkJCQkJCQkJbiA9IHhjW25pID0gMF07CgoJCQkJCQkJCQkvLyBHZXQgdGhlIHJvdW5kaW5nIGRpZ2l0IGF0IGluZGV4IGogb2Ygbi4KCQkJCQkJCQkJcmQgPSBtYXRoZmxvb3IobiAvIHBvd3MxMFtkIC0gaiAtIDFdICUgMTApOwoJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCW5pID0gbWF0aGNlaWwoKGkgKyAxKSAvIExPR19CQVNFKTsKCQkJCQkJCQkJaWYgKG5pID49IHhjLmxlbmd0aCkgewoJCQkJCQkJCQkJaWYgKHIpIHsKCQkJCQkJCQkJCQkvLyBOZWVkZWQgYnkgc3FydC4KCQkJCQkJCQkJCQlmb3IgKDsgeGMubGVuZ3RoIDw9IG5pOyB4Yy5wdXNoKDApKSA7CgkJCQkJCQkJCQkJbiA9IHJkID0gMDsKCQkJCQkJCQkJCQlkID0gMTsKCQkJCQkJCQkJCQlpICU9IExPR19CQVNFOwoJCQkJCQkJCQkJCWogPSBpIC0gTE9HX0JBU0UgKyAxOwoJCQkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJCQlicmVhayBvdXQ7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCQluID0gayA9IHhjW25pXTsKCgkJCQkJCQkJCQkvLyBHZXQgdGhlIG51bWJlciBvZiBkaWdpdHMgb2Ygbi4KCQkJCQkJCQkJCWZvciAoZCA9IDE7IGsgPj0gMTA7IGsgLz0gMTAsIGQrKykgOwoKCQkJCQkJCQkJCS8vIEdldCB0aGUgaW5kZXggb2YgcmQgd2l0aGluIG4uCgkJCQkJCQkJCQlpICU9IExPR19CQVNFOwoKCQkJCQkJCQkJCS8vIEdldCB0aGUgaW5kZXggb2YgcmQgd2l0aGluIG4sIGFkanVzdGVkIGZvciBsZWFkaW5nIHplcm9zLgoJCQkJCQkJCQkJLy8gVGhlIG51bWJlciBvZiBsZWFkaW5nIHplcm9zIG9mIG4gaXMgZ2l2ZW4gYnkgTE9HX0JBU0UgLSBkLgoJCQkJCQkJCQkJaiA9IGkgLSBMT0dfQkFTRSArIGQ7CgoJCQkJCQkJCQkJLy8gR2V0IHRoZSByb3VuZGluZyBkaWdpdCBhdCBpbmRleCBqIG9mIG4uCgkJCQkJCQkJCQlyZCA9IGogPCAwID8gMCA6IG1hdGhmbG9vcihuIC8gcG93czEwW2QgLSBqIC0gMV0gJSAxMCk7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQkJciA9IHIgfHwgc2QgPCAwIHx8CgkJCQkJCQkJCS8vIEFyZSB0aGVyZSBhbnkgbm9uLXplcm8gZGlnaXRzIGFmdGVyIHRoZSByb3VuZGluZyBkaWdpdD8KCQkJCQkJCQkJLy8gVGhlIGV4cHJlc3Npb24gIG4gJSBwb3dzMTBbZCAtIGogLSAxXSAgcmV0dXJucyBhbGwgZGlnaXRzIG9mIG4gdG8gdGhlIHJpZ2h0CgkJCQkJCQkJCS8vIG9mIHRoZSBkaWdpdCBhdCBqLCBlLmcuIGlmIG4gaXMgOTA4NzE0IGFuZCBqIGlzIDIsIHRoZSBleHByZXNzaW9uIGdpdmVzIDcxNC4KCQkJCQkJCQkJeGNbbmkgKyAxXSAhPSBudWxsIHx8IChqIDwgMCA/IG4gOiBuICUgcG93czEwW2QgLSBqIC0gMV0pOwoJCQkJCQkJCXIgPSBybSA8IDQgPyAocmQgfHwgcikgJiYgKHJtID09IDAgfHwgcm0gPT0gKHgucyA8IDAgPyAzIDogMikpIDogcmQgPiA1IHx8IHJkID09IDUgJiYgKHJtID09IDQgfHwgciB8fCBybSA9PSA2ICYmCgkJCQkJCQkJCS8vIENoZWNrIHdoZXRoZXIgdGhlIGRpZ2l0IHRvIHRoZSBsZWZ0IG9mIHRoZSByb3VuZGluZyBkaWdpdCBpcyBvZGQuCgkJCQkJCQkJCShpID4gMCA/IGogPiAwID8gbiAvIHBvd3MxMFtkIC0gal0gOiAwIDogeGNbbmkgLSAxXSkgJSAxMCAmIDEgfHwgcm0gPT0gKHgucyA8IDAgPyA4IDogNykpOwoJCQkJCQkJCWlmIChzZCA8IDEgfHwgIXhjWzBdKSB7CgkJCQkJCQkJCXhjLmxlbmd0aCA9IDA7CgkJCQkJCQkJCWlmIChyKSB7CgkJCQkJCQkJCQkvLyBDb252ZXJ0IHNkIHRvIGRlY2ltYWwgcGxhY2VzLgoJCQkJCQkJCQkJc2QgLT0geC5lICsgMTsKCgkJCQkJCQkJCQkvLyAxLCAwLjEsIDAuMDEsIDAuMDAxLCAwLjAwMDEgZXRjLgoJCQkJCQkJCQkJeGNbMF0gPSBwb3dzMTBbKExPR19CQVNFIC0gc2QgJSBMT0dfQkFTRSkgJSBMT0dfQkFTRV07CgkJCQkJCQkJCQl4LmUgPSAtc2QgfHwgMDsKCQkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJCS8vIFplcm8uCgkJCQkJCQkJCQl4Y1swXSA9IHguZSA9IDA7CgkJCQkJCQkJCX0KCQkJCQkJCQkJcmV0dXJuIHg7CgkJCQkJCQkJfQoKCQkJCQkJCQkvLyBSZW1vdmUgZXhjZXNzIGRpZ2l0cy4KCQkJCQkJCQlpZiAoaSA9PSAwKSB7CgkJCQkJCQkJCXhjLmxlbmd0aCA9IG5pOwoJCQkJCQkJCQlrID0gMTsKCQkJCQkJCQkJbmktLTsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQl4Yy5sZW5ndGggPSBuaSArIDE7CgkJCQkJCQkJCWsgPSBwb3dzMTBbTE9HX0JBU0UgLSBpXTsKCgkJCQkJCQkJCS8vIEUuZy4gNTY3MDAgYmVjb21lcyA1NjAwMCBpZiA3IGlzIHRoZSByb3VuZGluZyBkaWdpdC4KCQkJCQkJCQkJLy8gaiA+IDAgbWVhbnMgaSA+IG51bWJlciBvZiBsZWFkaW5nIHplcm9zIG9mIG4uCgkJCQkJCQkJCXhjW25pXSA9IGogPiAwID8gbWF0aGZsb29yKG4gLyBwb3dzMTBbZCAtIGpdICUgcG93czEwW2pdKSAqIGsgOiAwOwoJCQkJCQkJCX0KCgkJCQkJCQkJLy8gUm91bmQgdXA/CgkJCQkJCQkJaWYgKHIpIHsKCQkJCQkJCQkJZm9yICg7IDspIHsKCQkJCQkJCQkJCS8vIElmIHRoZSBkaWdpdCB0byBiZSByb3VuZGVkIHVwIGlzIGluIHRoZSBmaXJzdCBlbGVtZW50IG9mIHhjLi4uCgkJCQkJCQkJCQlpZiAobmkgPT0gMCkgewoJCQkJCQkJCQkJCS8vIGkgd2lsbCBiZSB0aGUgbGVuZ3RoIG9mIHhjWzBdIGJlZm9yZSBrIGlzIGFkZGVkLgoJCQkJCQkJCQkJCWZvciAoaSA9IDEsIGogPSB4Y1swXTsgaiA+PSAxMDsgaiAvPSAxMCwgaSsrKSA7CgkJCQkJCQkJCQkJaiA9IHhjWzBdICs9IGs7CgkJCQkJCQkJCQkJZm9yIChrID0gMTsgaiA+PSAxMDsgaiAvPSAxMCwgaysrKSA7CgoJCQkJCQkJCQkJCS8vIGlmIGkgIT0gayB0aGUgbGVuZ3RoIGhhcyBpbmNyZWFzZWQuCgkJCQkJCQkJCQkJaWYgKGkgIT0gaykgewoJCQkJCQkJCQkJCQl4LmUrKzsKCQkJCQkJCQkJCQkJaWYgKHhjWzBdID09IEJBU0UpIHhjWzBdID0gMTsKCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJCXhjW25pXSArPSBrOwoJCQkJCQkJCQkJCWlmICh4Y1tuaV0gIT0gQkFTRSkgYnJlYWs7CgkJCQkJCQkJCQkJeGNbbmktLV0gPSAwOwoJCQkJCQkJCQkJCWsgPSAxOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQl9CgkJCQkJCQkJfQoKCQkJCQkJCQkvLyBSZW1vdmUgdHJhaWxpbmcgemVyb3MuCgkJCQkJCQkJZm9yIChpID0geGMubGVuZ3RoOyB4Y1stLWldID09PSAwOyB4Yy5wb3AoKSkgOwoJCQkJCQkJfQoKCQkJCQkJCS8vIE92ZXJmbG93PyBJbmZpbml0eS4KCQkJCQkJCWlmICh4LmUgPiBNQVhfRVhQKSB7CgkJCQkJCQkJeC5jID0geC5lID0gbnVsbDsKCgkJCQkJCQkJLy8gVW5kZXJmbG93PyBaZXJvLgoJCQkJCQkJfSBlbHNlIGlmICh4LmUgPCBNSU5fRVhQKSB7CgkJCQkJCQkJeC5jID0gW3guZSA9IDBdOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCXJldHVybiB4OwoJCQkJCX0KCgkJCQkJZnVuY3Rpb24gdmFsdWVPZihuKSB7CgkJCQkJCXZhciBzdHIsCgkJCQkJCQllID0gbi5lOwoJCQkJCQlpZiAoZSA9PT0gbnVsbCkgcmV0dXJuIG4udG9TdHJpbmcoKTsKCQkJCQkJc3RyID0gY29lZmZUb1N0cmluZyhuLmMpOwoJCQkJCQlzdHIgPSBlIDw9IFRPX0VYUF9ORUcgfHwgZSA+PSBUT19FWFBfUE9TID8gdG9FeHBvbmVudGlhbChzdHIsIGUpIDogdG9GaXhlZFBvaW50KHN0ciwgZSwgJzAnKTsKCQkJCQkJcmV0dXJuIG4ucyA8IDAgPyAnLScgKyBzdHIgOiBzdHI7CgkJCQkJfQoKCQkJCQkvLyBQUk9UT1RZUEUvSU5TVEFOQ0UgTUVUSE9EUwoKCQkJCQkvKgogICAgICogUmV0dXJuIGEgbmV3IEJpZ051bWJlciB3aG9zZSB2YWx1ZSBpcyB0aGUgYWJzb2x1dGUgdmFsdWUgb2YgdGhpcyBCaWdOdW1iZXIuCiAgICAgKi8KCQkJCQlQLmFic29sdXRlVmFsdWUgPSBQLmFicyA9IGZ1bmN0aW9uKCkgewoJCQkJCQl2YXIgeCA9IG5ldyBCaWdOdW1iZXIodGhpcyk7CgkJCQkJCWlmICh4LnMgPCAwKSB4LnMgPSAxOwoJCQkJCQlyZXR1cm4geDsKCQkJCQl9OwoKCQkJCQkvKgogICAgICogUmV0dXJuCiAgICAgKiAgIDEgaWYgdGhlIHZhbHVlIG9mIHRoaXMgQmlnTnVtYmVyIGlzIGdyZWF0ZXIgdGhhbiB0aGUgdmFsdWUgb2YgQmlnTnVtYmVyKHksIGIpLAogICAgICogICAtMSBpZiB0aGUgdmFsdWUgb2YgdGhpcyBCaWdOdW1iZXIgaXMgbGVzcyB0aGFuIHRoZSB2YWx1ZSBvZiBCaWdOdW1iZXIoeSwgYiksCiAgICAgKiAgIDAgaWYgdGhleSBoYXZlIHRoZSBzYW1lIHZhbHVlLAogICAgICogICBvciBudWxsIGlmIHRoZSB2YWx1ZSBvZiBlaXRoZXIgaXMgTmFOLgogICAgICovCgkJCQkJUC5jb21wYXJlZFRvID0gZnVuY3Rpb24oeSwgYikgewoJCQkJCQlyZXR1cm4gY29tcGFyZSh0aGlzLCBuZXcgQmlnTnVtYmVyKHksIGIpKTsKCQkJCQl9OwoKCQkJCQkvKgogICAgICogSWYgZHAgaXMgdW5kZWZpbmVkIG9yIG51bGwgb3IgdHJ1ZSBvciBmYWxzZSwgcmV0dXJuIHRoZSBudW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMgb2YgdGhlCiAgICAgKiB2YWx1ZSBvZiB0aGlzIEJpZ051bWJlciwgb3IgbnVsbCBpZiB0aGUgdmFsdWUgb2YgdGhpcyBCaWdOdW1iZXIgaXMgwrFJbmZpbml0eSBvciBOYU4uCiAgICAgKgogICAgICogT3RoZXJ3aXNlLCBpZiBkcCBpcyBhIG51bWJlciwgcmV0dXJuIGEgbmV3IEJpZ051bWJlciB3aG9zZSB2YWx1ZSBpcyB0aGUgdmFsdWUgb2YgdGhpcwogICAgICogQmlnTnVtYmVyIHJvdW5kZWQgdG8gYSBtYXhpbXVtIG9mIGRwIGRlY2ltYWwgcGxhY2VzIHVzaW5nIHJvdW5kaW5nIG1vZGUgcm0sIG9yCiAgICAgKiBST1VORElOR19NT0RFIGlmIHJtIGlzIG9taXR0ZWQuCiAgICAgKgogICAgICogW2RwXSB7bnVtYmVyfSBEZWNpbWFsIHBsYWNlczogaW50ZWdlciwgMCB0byBNQVggaW5jbHVzaXZlLgogICAgICogW3JtXSB7bnVtYmVyfSBSb3VuZGluZyBtb2RlLiBJbnRlZ2VyLCAwIHRvIDggaW5jbHVzaXZlLgogICAgICoKICAgICAqICdbQmlnTnVtYmVyIEVycm9yXSBBcmd1bWVudCB7bm90IGEgcHJpbWl0aXZlIG51bWJlcnxub3QgYW4gaW50ZWdlcnxvdXQgb2YgcmFuZ2V9OiB7ZHB8cm19JwogICAgICovCgkJCQkJUC5kZWNpbWFsUGxhY2VzID0gUC5kcCA9IGZ1bmN0aW9uKGRwLCBybSkgewoJCQkJCQl2YXIgYywKCQkJCQkJCW4sCgkJCQkJCQl2LAoJCQkJCQkJeCA9IHRoaXM7CgkJCQkJCWlmIChkcCAhPSBudWxsKSB7CgkJCQkJCQlpbnRDaGVjayhkcCwgMCwgTUFYKTsKCQkJCQkJCWlmIChybSA9PSBudWxsKSBybSA9IFJPVU5ESU5HX01PREU7IGVsc2UgaW50Q2hlY2socm0sIDAsIDgpOwoJCQkJCQkJcmV0dXJuIHJvdW5kKG5ldyBCaWdOdW1iZXIoeCksIGRwICsgeC5lICsgMSwgcm0pOwoJCQkJCQl9CgkJCQkJCWlmICghKGMgPSB4LmMpKSByZXR1cm4gbnVsbDsKCQkJCQkJbiA9ICgodiA9IGMubGVuZ3RoIC0gMSkgLSBiaXRGbG9vcih0aGlzLmUgLyBMT0dfQkFTRSkpICogTE9HX0JBU0U7CgoJCQkJCQkvLyBTdWJ0cmFjdCB0aGUgbnVtYmVyIG9mIHRyYWlsaW5nIHplcm9zIG9mIHRoZSBsYXN0IG51bWJlci4KCQkJCQkJaWYgKHYgPSBjW3ZdKSBmb3IgKDsgdiAlIDEwID09IDA7IHYgLz0gMTAsIG4tLSkgOwoJCQkJCQlpZiAobiA8IDApIG4gPSAwOwoJCQkJCQlyZXR1cm4gbjsKCQkJCQl9OwoKCQkJCQkvKgogICAgICogIG4gLyAwID0gSQogICAgICogIG4gLyBOID0gTgogICAgICogIG4gLyBJID0gMAogICAgICogIDAgLyBuID0gMAogICAgICogIDAgLyAwID0gTgogICAgICogIDAgLyBOID0gTgogICAgICogIDAgLyBJID0gMAogICAgICogIE4gLyBuID0gTgogICAgICogIE4gLyAwID0gTgogICAgICogIE4gLyBOID0gTgogICAgICogIE4gLyBJID0gTgogICAgICogIEkgLyBuID0gSQogICAgICogIEkgLyAwID0gSQogICAgICogIEkgLyBOID0gTgogICAgICogIEkgLyBJID0gTgogICAgICoKICAgICAqIFJldHVybiBhIG5ldyBCaWdOdW1iZXIgd2hvc2UgdmFsdWUgaXMgdGhlIHZhbHVlIG9mIHRoaXMgQmlnTnVtYmVyIGRpdmlkZWQgYnkgdGhlIHZhbHVlIG9mCiAgICAgKiBCaWdOdW1iZXIoeSwgYiksIHJvdW5kZWQgYWNjb3JkaW5nIHRvIERFQ0lNQUxfUExBQ0VTIGFuZCBST1VORElOR19NT0RFLgogICAgICovCgkJCQkJUC5kaXZpZGVkQnkgPSBQLmRpdiA9IGZ1bmN0aW9uKHksIGIpIHsKCQkJCQkJcmV0dXJuIGRpdih0aGlzLCBuZXcgQmlnTnVtYmVyKHksIGIpLCBERUNJTUFMX1BMQUNFUywgUk9VTkRJTkdfTU9ERSk7CgkJCQkJfTsKCgkJCQkJLyoKICAgICAqIFJldHVybiBhIG5ldyBCaWdOdW1iZXIgd2hvc2UgdmFsdWUgaXMgdGhlIGludGVnZXIgcGFydCBvZiBkaXZpZGluZyB0aGUgdmFsdWUgb2YgdGhpcwogICAgICogQmlnTnVtYmVyIGJ5IHRoZSB2YWx1ZSBvZiBCaWdOdW1iZXIoeSwgYikuCiAgICAgKi8KCQkJCQlQLmRpdmlkZWRUb0ludGVnZXJCeSA9IFAuaWRpdiA9IGZ1bmN0aW9uKHksIGIpIHsKCQkJCQkJcmV0dXJuIGRpdih0aGlzLCBuZXcgQmlnTnVtYmVyKHksIGIpLCAwLCAxKTsKCQkJCQl9OwoKCQkJCQkvKgogICAgICogUmV0dXJuIGEgQmlnTnVtYmVyIHdob3NlIHZhbHVlIGlzIHRoZSB2YWx1ZSBvZiB0aGlzIEJpZ051bWJlciBleHBvbmVudGlhdGVkIGJ5IG4uCiAgICAgKgogICAgICogSWYgbSBpcyBwcmVzZW50LCByZXR1cm4gdGhlIHJlc3VsdCBtb2R1bG8gbS4KICAgICAqIElmIG4gaXMgbmVnYXRpdmUgcm91bmQgYWNjb3JkaW5nIHRvIERFQ0lNQUxfUExBQ0VTIGFuZCBST1VORElOR19NT0RFLgogICAgICogSWYgUE9XX1BSRUNJU0lPTiBpcyBub24temVybyBhbmQgbSBpcyBub3QgcHJlc2VudCwgcm91bmQgdG8gUE9XX1BSRUNJU0lPTiB1c2luZyBST1VORElOR19NT0RFLgogICAgICoKICAgICAqIFRoZSBtb2R1bGFyIHBvd2VyIG9wZXJhdGlvbiB3b3JrcyBlZmZpY2llbnRseSB3aGVuIHgsIG4sIGFuZCBtIGFyZSBpbnRlZ2Vycywgb3RoZXJ3aXNlIGl0CiAgICAgKiBpcyBlcXVpdmFsZW50IHRvIGNhbGN1bGF0aW5nIHguZXhwb25lbnRpYXRlZEJ5KG4pLm1vZHVsbyhtKSB3aXRoIGEgUE9XX1BSRUNJU0lPTiBvZiAwLgogICAgICoKICAgICAqIG4ge251bWJlcnxzdHJpbmd8QmlnTnVtYmVyfSBUaGUgZXhwb25lbnQuIEFuIGludGVnZXIuCiAgICAgKiBbbV0ge251bWJlcnxzdHJpbmd8QmlnTnVtYmVyfSBUaGUgbW9kdWx1cy4KICAgICAqCiAgICAgKiAnW0JpZ051bWJlciBFcnJvcl0gRXhwb25lbnQgbm90IGFuIGludGVnZXI6IHtufScKICAgICAqLwoJCQkJCVAuZXhwb25lbnRpYXRlZEJ5ID0gUC5wb3cgPSBmdW5jdGlvbihuLCBtKSB7CgkJCQkJCXZhciBoYWxmLAoJCQkJCQkJaXNNb2RFeHAsCgkJCQkJCQlpLAoJCQkJCQkJaywKCQkJCQkJCW1vcmUsCgkJCQkJCQluSXNCaWcsCgkJCQkJCQluSXNOZWcsCgkJCQkJCQluSXNPZGQsCgkJCQkJCQl5LAoJCQkJCQkJeCA9IHRoaXM7CgkJCQkJCW4gPSBuZXcgQmlnTnVtYmVyKG4pOwoKCQkJCQkJLy8gQWxsb3cgTmFOIGFuZCDCsUluZmluaXR5LCBidXQgbm90IG90aGVyIG5vbi1pbnRlZ2Vycy4KCQkJCQkJaWYgKG4uYyAmJiAhbi5pc0ludGVnZXIoKSkgewoJCQkJCQkJdGhyb3cgRXJyb3IoYmlnbnVtYmVyRXJyb3IgKyAnRXhwb25lbnQgbm90IGFuIGludGVnZXI6ICcgKyB2YWx1ZU9mKG4pKTsKCQkJCQkJfQoJCQkJCQlpZiAobSAhPSBudWxsKSBtID0gbmV3IEJpZ051bWJlcihtKTsKCgkJCQkJCS8vIEV4cG9uZW50IG9mIE1BWF9TQUZFX0lOVEVHRVIgaXMgMTUuCgkJCQkJCW5Jc0JpZyA9IG4uZSA+IDE0OwoKCQkJCQkJLy8gSWYgeCBpcyBOYU4sIMKxSW5maW5pdHksIMKxMCBvciDCsTEsIG9yIG4gaXMgwrFJbmZpbml0eSwgTmFOIG9yIMKxMC4KCQkJCQkJaWYgKCF4LmMgfHwgIXguY1swXSB8fCB4LmNbMF0gPT0gMSAmJiAheC5lICYmIHguYy5sZW5ndGggPT0gMSB8fCAhbi5jIHx8ICFuLmNbMF0pIHsKCQkJCQkJCS8vIFRoZSBzaWduIG9mIHRoZSByZXN1bHQgb2YgcG93IHdoZW4geCBpcyBuZWdhdGl2ZSBkZXBlbmRzIG9uIHRoZSBldmVubmVzcyBvZiBuLgoJCQkJCQkJLy8gSWYgK24gb3ZlcmZsb3dzIHRvIMKxSW5maW5pdHksIHRoZSBldmVubmVzcyBvZiBuIHdvdWxkIGJlIG5vdCBiZSBrbm93bi4KCQkJCQkJCXkgPSBuZXcgQmlnTnVtYmVyKE1hdGgucG93KCt2YWx1ZU9mKHgpLCBuSXNCaWcgPyBuLnMgKiAoMiAtIGlzT2RkKG4pKSA6ICt2YWx1ZU9mKG4pKSk7CgkJCQkJCQlyZXR1cm4gbSA/IHkubW9kKG0pIDogeTsKCQkJCQkJfQoJCQkJCQluSXNOZWcgPSBuLnMgPCAwOwoJCQkJCQlpZiAobSkgewoJCQkJCQkJLy8geCAlIG0gcmV0dXJucyBOYU4gaWYgYWJzKG0pIGlzIHplcm8sIG9yIG0gaXMgTmFOLgoJCQkJCQkJaWYgKG0uYyA/ICFtLmNbMF0gOiAhbS5zKSByZXR1cm4gbmV3IEJpZ051bWJlcihOYU4pOwoJCQkJCQkJaXNNb2RFeHAgPSAhbklzTmVnICYmIHguaXNJbnRlZ2VyKCkgJiYgbS5pc0ludGVnZXIoKTsKCQkJCQkJCWlmIChpc01vZEV4cCkgeCA9IHgubW9kKG0pOwoKCQkJCQkJCS8vIE92ZXJmbG93IHRvIMKxSW5maW5pdHk6ID49MioqMWUxMCBvciA+PTEuMDAwMDAyNCoqMWUxNS4KCQkJCQkJCS8vIFVuZGVyZmxvdyB0byDCsTA6IDw9MC43OSoqMWUxMCBvciA8PTAuOTk5OTk3NSoqMWUxNS4KCQkJCQkJfSBlbHNlIGlmIChuLmUgPiA5ICYmICh4LmUgPiAwIHx8IHguZSA8IC0xIHx8ICh4LmUgPT0gMAoJCQkJCQkJLy8gWzEsIDI0MDAwMDAwMF0KCQkJCQkJCT8geC5jWzBdID4gMSB8fCBuSXNCaWcgJiYgeC5jWzFdID49IDI0ZTcKCQkJCQkJCS8vIFs4MDAwMDAwMDAwMDAwMF0gIFs5OTk5OTc1MDAwMDAwMF0KCQkJCQkJCTogeC5jWzBdIDwgOGUxMyB8fCBuSXNCaWcgJiYgeC5jWzBdIDw9IDk5OTk5NzVlNykpKSB7CgkJCQkJCQkvLyBJZiB4IGlzIG5lZ2F0aXZlIGFuZCBuIGlzIG9kZCwgayA9IC0wLCBlbHNlIGsgPSAwLgoJCQkJCQkJayA9IHgucyA8IDAgJiYgaXNPZGQobikgPyAtMCA6IDA7CgoJCQkJCQkJLy8gSWYgeCA+PSAxLCBrID0gwrFJbmZpbml0eS4KCQkJCQkJCWlmICh4LmUgPiAtMSkgayA9IDEgLyBrOwoKCQkJCQkJCS8vIElmIG4gaXMgbmVnYXRpdmUgcmV0dXJuIMKxMCwgZWxzZSByZXR1cm4gwrFJbmZpbml0eS4KCQkJCQkJCXJldHVybiBuZXcgQmlnTnVtYmVyKG5Jc05lZyA/IDEgLyBrIDogayk7CgkJCQkJCX0gZWxzZSBpZiAoUE9XX1BSRUNJU0lPTikgewoJCQkJCQkJLy8gVHJ1bmNhdGluZyBlYWNoIGNvZWZmaWNpZW50IGFycmF5IHRvIGEgbGVuZ3RoIG9mIGsgYWZ0ZXIgZWFjaCBtdWx0aXBsaWNhdGlvbgoJCQkJCQkJLy8gZXF1YXRlcyB0byB0cnVuY2F0aW5nIHNpZ25pZmljYW50IGRpZ2l0cyB0byBQT1dfUFJFQ0lTSU9OICsgWzI4LCA0MV0sCgkJCQkJCQkvLyBpLmUuIHRoZXJlIHdpbGwgYmUgYSBtaW5pbXVtIG9mIDI4IGd1YXJkIGRpZ2l0cyByZXRhaW5lZC4KCQkJCQkJCWsgPSBtYXRoY2VpbChQT1dfUFJFQ0lTSU9OIC8gTE9HX0JBU0UgKyAyKTsKCQkJCQkJfQoJCQkJCQlpZiAobklzQmlnKSB7CgkJCQkJCQloYWxmID0gbmV3IEJpZ051bWJlcigwLjUpOwoJCQkJCQkJaWYgKG5Jc05lZykgbi5zID0gMTsKCQkJCQkJCW5Jc09kZCA9IGlzT2RkKG4pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJaSA9IE1hdGguYWJzKCt2YWx1ZU9mKG4pKTsKCQkJCQkJCW5Jc09kZCA9IGkgJSAyOwoJCQkJCQl9CgkJCQkJCXkgPSBuZXcgQmlnTnVtYmVyKE9ORSk7CgoJCQkJCQkvLyBQZXJmb3JtcyA1NCBsb29wIGl0ZXJhdGlvbnMgZm9yIG4gb2YgOTAwNzE5OTI1NDc0MDk5MS4KCQkJCQkJZm9yICg7IDspIHsKCQkJCQkJCWlmIChuSXNPZGQpIHsKCQkJCQkJCQl5ID0geS50aW1lcyh4KTsKCQkJCQkJCQlpZiAoIXkuYykgYnJlYWs7CgkJCQkJCQkJaWYgKGspIHsKCQkJCQkJCQkJaWYgKHkuYy5sZW5ndGggPiBrKSB5LmMubGVuZ3RoID0gazsKCQkJCQkJCQl9IGVsc2UgaWYgKGlzTW9kRXhwKSB7CgkJCQkJCQkJCXkgPSB5Lm1vZChtKTsgLy95ID0geS5taW51cyhkaXYoeSwgbSwgMCwgTU9EVUxPX01PREUpLnRpbWVzKG0pKTsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQlpZiAoaSkgewoJCQkJCQkJCWkgPSBtYXRoZmxvb3IoaSAvIDIpOwoJCQkJCQkJCWlmIChpID09PSAwKSBicmVhazsKCQkJCQkJCQluSXNPZGQgPSBpICUgMjsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJbiA9IG4udGltZXMoaGFsZik7CgkJCQkJCQkJcm91bmQobiwgbi5lICsgMSwgMSk7CgkJCQkJCQkJaWYgKG4uZSA+IDE0KSB7CgkJCQkJCQkJCW5Jc09kZCA9IGlzT2RkKG4pOwoJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCWkgPSArdmFsdWVPZihuKTsKCQkJCQkJCQkJaWYgKGkgPT09IDApIGJyZWFrOwoJCQkJCQkJCQluSXNPZGQgPSBpICUgMjsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCQl4ID0geC50aW1lcyh4KTsKCQkJCQkJCWlmIChrKSB7CgkJCQkJCQkJaWYgKHguYyAmJiB4LmMubGVuZ3RoID4gaykgeC5jLmxlbmd0aCA9IGs7CgkJCQkJCQl9IGVsc2UgaWYgKGlzTW9kRXhwKSB7CgkJCQkJCQkJeCA9IHgubW9kKG0pOyAvL3ggPSB4Lm1pbnVzKGRpdih4LCBtLCAwLCBNT0RVTE9fTU9ERSkudGltZXMobSkpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWlmIChpc01vZEV4cCkgcmV0dXJuIHk7CgkJCQkJCWlmIChuSXNOZWcpIHkgPSBPTkUuZGl2KHkpOwoJCQkJCQlyZXR1cm4gbSA/IHkubW9kKG0pIDogayA/IHJvdW5kKHksIFBPV19QUkVDSVNJT04sIFJPVU5ESU5HX01PREUsIG1vcmUpIDogeTsKCQkJCQl9OwoKCQkJCQkvKgogICAgICogUmV0dXJuIGEgbmV3IEJpZ051bWJlciB3aG9zZSB2YWx1ZSBpcyB0aGUgdmFsdWUgb2YgdGhpcyBCaWdOdW1iZXIgcm91bmRlZCB0byBhbiBpbnRlZ2VyCiAgICAgKiB1c2luZyByb3VuZGluZyBtb2RlIHJtLCBvciBST1VORElOR19NT0RFIGlmIHJtIGlzIG9taXR0ZWQuCiAgICAgKgogICAgICogW3JtXSB7bnVtYmVyfSBSb3VuZGluZyBtb2RlLiBJbnRlZ2VyLCAwIHRvIDggaW5jbHVzaXZlLgogICAgICoKICAgICAqICdbQmlnTnVtYmVyIEVycm9yXSBBcmd1bWVudCB7bm90IGEgcHJpbWl0aXZlIG51bWJlcnxub3QgYW4gaW50ZWdlcnxvdXQgb2YgcmFuZ2V9OiB7cm19JwogICAgICovCgkJCQkJUC5pbnRlZ2VyVmFsdWUgPSBmdW5jdGlvbihybSkgewoJCQkJCQl2YXIgbiA9IG5ldyBCaWdOdW1iZXIodGhpcyk7CgkJCQkJCWlmIChybSA9PSBudWxsKSBybSA9IFJPVU5ESU5HX01PREU7IGVsc2UgaW50Q2hlY2socm0sIDAsIDgpOwoJCQkJCQlyZXR1cm4gcm91bmQobiwgbi5lICsgMSwgcm0pOwoJCQkJCX07CgoJCQkJCS8qCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgdmFsdWUgb2YgdGhpcyBCaWdOdW1iZXIgaXMgZXF1YWwgdG8gdGhlIHZhbHVlIG9mIEJpZ051bWJlcih5LCBiKSwKICAgICAqIG90aGVyd2lzZSByZXR1cm4gZmFsc2UuCiAgICAgKi8KCQkJCQlQLmlzRXF1YWxUbyA9IFAuZXEgPSBmdW5jdGlvbih5LCBiKSB7CgkJCQkJCXJldHVybiBjb21wYXJlKHRoaXMsIG5ldyBCaWdOdW1iZXIoeSwgYikpID09PSAwOwoJCQkJCX07CgoJCQkJCS8qCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgdmFsdWUgb2YgdGhpcyBCaWdOdW1iZXIgaXMgYSBmaW5pdGUgbnVtYmVyLCBvdGhlcndpc2UgcmV0dXJuIGZhbHNlLgogICAgICovCgkJCQkJUC5pc0Zpbml0ZSA9IGZ1bmN0aW9uKCkgewoJCQkJCQlyZXR1cm4gISF0aGlzLmM7CgkJCQkJfTsKCgkJCQkJLyoKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSB2YWx1ZSBvZiB0aGlzIEJpZ051bWJlciBpcyBncmVhdGVyIHRoYW4gdGhlIHZhbHVlIG9mIEJpZ051bWJlcih5LCBiKSwKICAgICAqIG90aGVyd2lzZSByZXR1cm4gZmFsc2UuCiAgICAgKi8KCQkJCQlQLmlzR3JlYXRlclRoYW4gPSBQLmd0ID0gZnVuY3Rpb24oeSwgYikgewoJCQkJCQlyZXR1cm4gY29tcGFyZSh0aGlzLCBuZXcgQmlnTnVtYmVyKHksIGIpKSA+IDA7CgkJCQkJfTsKCgkJCQkJLyoKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSB2YWx1ZSBvZiB0aGlzIEJpZ051bWJlciBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdG8gdGhlIHZhbHVlIG9mCiAgICAgKiBCaWdOdW1iZXIoeSwgYiksIG90aGVyd2lzZSByZXR1cm4gZmFsc2UuCiAgICAgKi8KCQkJCQlQLmlzR3JlYXRlclRoYW5PckVxdWFsVG8gPSBQLmd0ZSA9IGZ1bmN0aW9uKHksIGIpIHsKCQkJCQkJcmV0dXJuIChiID0gY29tcGFyZSh0aGlzLCBuZXcgQmlnTnVtYmVyKHksIGIpKSkgPT09IDEgfHwgYiA9PT0gMDsKCQkJCQl9OwoKCQkJCQkvKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhlIHZhbHVlIG9mIHRoaXMgQmlnTnVtYmVyIGlzIGFuIGludGVnZXIsIG90aGVyd2lzZSByZXR1cm4gZmFsc2UuCiAgICAgKi8KCQkJCQlQLmlzSW50ZWdlciA9IGZ1bmN0aW9uKCkgewoJCQkJCQlyZXR1cm4gISF0aGlzLmMgJiYgYml0Rmxvb3IodGhpcy5lIC8gTE9HX0JBU0UpID4gdGhpcy5jLmxlbmd0aCAtIDI7CgkJCQkJfTsKCgkJCQkJLyoKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSB2YWx1ZSBvZiB0aGlzIEJpZ051bWJlciBpcyBsZXNzIHRoYW4gdGhlIHZhbHVlIG9mIEJpZ051bWJlcih5LCBiKSwKICAgICAqIG90aGVyd2lzZSByZXR1cm4gZmFsc2UuCiAgICAgKi8KCQkJCQlQLmlzTGVzc1RoYW4gPSBQLmx0ID0gZnVuY3Rpb24oeSwgYikgewoJCQkJCQlyZXR1cm4gY29tcGFyZSh0aGlzLCBuZXcgQmlnTnVtYmVyKHksIGIpKSA8IDA7CgkJCQkJfTsKCgkJCQkJLyoKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSB2YWx1ZSBvZiB0aGlzIEJpZ051bWJlciBpcyBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gdGhlIHZhbHVlIG9mCiAgICAgKiBCaWdOdW1iZXIoeSwgYiksIG90aGVyd2lzZSByZXR1cm4gZmFsc2UuCiAgICAgKi8KCQkJCQlQLmlzTGVzc1RoYW5PckVxdWFsVG8gPSBQLmx0ZSA9IGZ1bmN0aW9uKHksIGIpIHsKCQkJCQkJcmV0dXJuIChiID0gY29tcGFyZSh0aGlzLCBuZXcgQmlnTnVtYmVyKHksIGIpKSkgPT09IC0xIHx8IGIgPT09IDA7CgkJCQkJfTsKCgkJCQkJLyoKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSB2YWx1ZSBvZiB0aGlzIEJpZ051bWJlciBpcyBOYU4sIG90aGVyd2lzZSByZXR1cm4gZmFsc2UuCiAgICAgKi8KCQkJCQlQLmlzTmFOID0gZnVuY3Rpb24oKSB7CgkJCQkJCXJldHVybiAhdGhpcy5zOwoJCQkJCX07CgoJCQkJCS8qCiAgICAgKiBSZXR1cm4gdHJ1ZSBpZiB0aGUgdmFsdWUgb2YgdGhpcyBCaWdOdW1iZXIgaXMgbmVnYXRpdmUsIG90aGVyd2lzZSByZXR1cm4gZmFsc2UuCiAgICAgKi8KCQkJCQlQLmlzTmVnYXRpdmUgPSBmdW5jdGlvbigpIHsKCQkJCQkJcmV0dXJuIHRoaXMucyA8IDA7CgkJCQkJfTsKCgkJCQkJLyoKICAgICAqIFJldHVybiB0cnVlIGlmIHRoZSB2YWx1ZSBvZiB0aGlzIEJpZ051bWJlciBpcyBwb3NpdGl2ZSwgb3RoZXJ3aXNlIHJldHVybiBmYWxzZS4KICAgICAqLwoJCQkJCVAuaXNQb3NpdGl2ZSA9IGZ1bmN0aW9uKCkgewoJCQkJCQlyZXR1cm4gdGhpcy5zID4gMDsKCQkJCQl9OwoKCQkJCQkvKgogICAgICogUmV0dXJuIHRydWUgaWYgdGhlIHZhbHVlIG9mIHRoaXMgQmlnTnVtYmVyIGlzIDAgb3IgLTAsIG90aGVyd2lzZSByZXR1cm4gZmFsc2UuCiAgICAgKi8KCQkJCQlQLmlzWmVybyA9IGZ1bmN0aW9uKCkgewoJCQkJCQlyZXR1cm4gISF0aGlzLmMgJiYgdGhpcy5jWzBdID09IDA7CgkJCQkJfTsKCgkJCQkJLyoKICAgICAqICBuIC0gMCA9IG4KICAgICAqICBuIC0gTiA9IE4KICAgICAqICBuIC0gSSA9IC1JCiAgICAgKiAgMCAtIG4gPSAtbgogICAgICogIDAgLSAwID0gMAogICAgICogIDAgLSBOID0gTgogICAgICogIDAgLSBJID0gLUkKICAgICAqICBOIC0gbiA9IE4KICAgICAqICBOIC0gMCA9IE4KICAgICAqICBOIC0gTiA9IE4KICAgICAqICBOIC0gSSA9IE4KICAgICAqICBJIC0gbiA9IEkKICAgICAqICBJIC0gMCA9IEkKICAgICAqICBJIC0gTiA9IE4KICAgICAqICBJIC0gSSA9IE4KICAgICAqCiAgICAgKiBSZXR1cm4gYSBuZXcgQmlnTnVtYmVyIHdob3NlIHZhbHVlIGlzIHRoZSB2YWx1ZSBvZiB0aGlzIEJpZ051bWJlciBtaW51cyB0aGUgdmFsdWUgb2YKICAgICAqIEJpZ051bWJlcih5LCBiKS4KICAgICAqLwoJCQkJCVAubWludXMgPSBmdW5jdGlvbih5LCBiKSB7CgkJCQkJCXZhciBpLAoJCQkJCQkJaiwKCQkJCQkJCXQsCgkJCQkJCQl4TFR5LAoJCQkJCQkJeCA9IHRoaXMsCgkJCQkJCQlhID0geC5zOwoJCQkJCQl5ID0gbmV3IEJpZ051bWJlcih5LCBiKTsKCQkJCQkJYiA9IHkuczsKCgkJCQkJCS8vIEVpdGhlciBOYU4/CgkJCQkJCWlmICghYSB8fCAhYikgcmV0dXJuIG5ldyBCaWdOdW1iZXIoTmFOKTsKCgkJCQkJCS8vIFNpZ25zIGRpZmZlcj8KCQkJCQkJaWYgKGEgIT0gYikgewoJCQkJCQkJeS5zID0gLWI7CgkJCQkJCQlyZXR1cm4geC5wbHVzKHkpOwoJCQkJCQl9CgkJCQkJCXZhciB4ZSA9IHguZSAvIExPR19CQVNFLAoJCQkJCQkJeWUgPSB5LmUgLyBMT0dfQkFTRSwKCQkJCQkJCXhjID0geC5jLAoJCQkJCQkJeWMgPSB5LmM7CgkJCQkJCWlmICgheGUgfHwgIXllKSB7CgkJCQkJCQkvLyBFaXRoZXIgSW5maW5pdHk/CgkJCQkJCQlpZiAoIXhjIHx8ICF5YykgcmV0dXJuIHhjID8gKHkucyA9IC1iLCB5KSA6IG5ldyBCaWdOdW1iZXIoeWMgPyB4IDogTmFOKTsKCgkJCQkJCQkvLyBFaXRoZXIgemVybz8KCQkJCQkJCWlmICgheGNbMF0gfHwgIXljWzBdKSB7CgkJCQkJCQkJLy8gUmV0dXJuIHkgaWYgeSBpcyBub24temVybywgeCBpZiB4IGlzIG5vbi16ZXJvLCBvciB6ZXJvIGlmIGJvdGggYXJlIHplcm8uCgkJCQkJCQkJcmV0dXJuIHljWzBdID8gKHkucyA9IC1iLCB5KSA6IG5ldyBCaWdOdW1iZXIoeGNbMF0gPyB4IDoKCQkJCQkJCQkJLy8gSUVFRSA3NTQgKDIwMDgpIDYuMzogbiAtIG4gPSAtMCB3aGVuIHJvdW5kaW5nIHRvIC1JbmZpbml0eQoJCQkJCQkJCQlST1VORElOR19NT0RFID09IDMgPyAtMCA6IDApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCXhlID0gYml0Rmxvb3IoeGUpOwoJCQkJCQl5ZSA9IGJpdEZsb29yKHllKTsKCQkJCQkJeGMgPSB4Yy5zbGljZSgpOwoKCQkJCQkJLy8gRGV0ZXJtaW5lIHdoaWNoIGlzIHRoZSBiaWdnZXIgbnVtYmVyLgoJCQkJCQlpZiAoYSA9IHhlIC0geWUpIHsKCQkJCQkJCWlmICh4TFR5ID0gYSA8IDApIHsKCQkJCQkJCQlhID0gLWE7CgkJCQkJCQkJdCA9IHhjOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQl5ZSA9IHhlOwoJCQkJCQkJCXQgPSB5YzsKCQkJCQkJCX0KCQkJCQkJCXQucmV2ZXJzZSgpOwoKCQkJCQkJCS8vIFByZXBlbmQgemVyb3MgdG8gZXF1YWxpc2UgZXhwb25lbnRzLgoJCQkJCQkJZm9yIChiID0gYTsgYi0tOyB0LnB1c2goMCkpIDsKCQkJCQkJCXQucmV2ZXJzZSgpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy8gRXhwb25lbnRzIGVxdWFsLiBDaGVjayBkaWdpdCBieSBkaWdpdC4KCQkJCQkJCWogPSAoeExUeSA9IChhID0geGMubGVuZ3RoKSA8IChiID0geWMubGVuZ3RoKSkgPyBhIDogYjsKCQkJCQkJCWZvciAoYSA9IGIgPSAwOyBiIDwgajsgYisrKSB7CgkJCQkJCQkJaWYgKHhjW2JdICE9IHljW2JdKSB7CgkJCQkJCQkJCXhMVHkgPSB4Y1tiXSA8IHljW2JdOwoJCQkJCQkJCQlicmVhazsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCgkJCQkJCS8vIHggPCB5PyBQb2ludCB4YyB0byB0aGUgYXJyYXkgb2YgdGhlIGJpZ2dlciBudW1iZXIuCgkJCQkJCWlmICh4TFR5KSB7CgkJCQkJCQl0ID0geGM7CgkJCQkJCQl4YyA9IHljOwoJCQkJCQkJeWMgPSB0OwoJCQkJCQkJeS5zID0gLXkuczsKCQkJCQkJfQoJCQkJCQliID0gKGogPSB5Yy5sZW5ndGgpIC0gKGkgPSB4Yy5sZW5ndGgpOwoKCQkJCQkJLy8gQXBwZW5kIHplcm9zIHRvIHhjIGlmIHNob3J0ZXIuCgkJCQkJCS8vIE5vIG5lZWQgdG8gYWRkIHplcm9zIHRvIHljIGlmIHNob3J0ZXIgYXMgc3VidHJhY3Qgb25seSBuZWVkcyB0byBzdGFydCBhdCB5Yy5sZW5ndGguCgkJCQkJCWlmIChiID4gMCkgZm9yICg7IGItLTsgeGNbaSsrXSA9IDApIDsKCQkJCQkJYiA9IEJBU0UgLSAxOwoKCQkJCQkJLy8gU3VidHJhY3QgeWMgZnJvbSB4Yy4KCQkJCQkJZm9yICg7IGogPiBhOykgewoJCQkJCQkJaWYgKHhjWy0tal0gPCB5Y1tqXSkgewoJCQkJCQkJCWZvciAoaSA9IGo7IGkgJiYgIXhjWy0taV07IHhjW2ldID0gYikgOwoJCQkJCQkJCS0teGNbaV07CgkJCQkJCQkJeGNbal0gKz0gQkFTRTsKCQkJCQkJCX0KCQkJCQkJCXhjW2pdIC09IHljW2pdOwoJCQkJCQl9CgoJCQkJCQkvLyBSZW1vdmUgbGVhZGluZyB6ZXJvcyBhbmQgYWRqdXN0IGV4cG9uZW50IGFjY29yZGluZ2x5LgoJCQkJCQlmb3IgKDsgeGNbMF0gPT0gMDsgeGMuc3BsaWNlKDAsIDEpLCAtLXllKSA7CgoJCQkJCQkvLyBaZXJvPwoJCQkJCQlpZiAoIXhjWzBdKSB7CgkJCQkJCQkvLyBGb2xsb3dpbmcgSUVFRSA3NTQgKDIwMDgpIDYuMywKCQkJCQkJCS8vIG4gLSBuID0gKzAgIGJ1dCAgbiAtIG4gPSAtMCAgd2hlbiByb3VuZGluZyB0b3dhcmRzIC1JbmZpbml0eS4KCQkJCQkJCXkucyA9IFJPVU5ESU5HX01PREUgPT0gMyA/IC0xIDogMTsKCQkJCQkJCXkuYyA9IFt5LmUgPSAwXTsKCQkJCQkJCXJldHVybiB5OwoJCQkJCQl9CgoJCQkJCQkvLyBObyBuZWVkIHRvIGNoZWNrIGZvciBJbmZpbml0eSBhcyAreCAtICt5ICE9IEluZmluaXR5ICYmIC14IC0gLXkgIT0gSW5maW5pdHkKCQkJCQkJLy8gZm9yIGZpbml0ZSB4IGFuZCB5LgoJCQkJCQlyZXR1cm4gbm9ybWFsaXNlKHksIHhjLCB5ZSk7CgkJCQkJfTsKCgkJCQkJLyoKICAgICAqICAgbiAlIDAgPSAgTgogICAgICogICBuICUgTiA9ICBOCiAgICAgKiAgIG4gJSBJID0gIG4KICAgICAqICAgMCAlIG4gPSAgMAogICAgICogIC0wICUgbiA9IC0wCiAgICAgKiAgIDAgJSAwID0gIE4KICAgICAqICAgMCAlIE4gPSAgTgogICAgICogICAwICUgSSA9ICAwCiAgICAgKiAgIE4gJSBuID0gIE4KICAgICAqICAgTiAlIDAgPSAgTgogICAgICogICBOICUgTiA9ICBOCiAgICAgKiAgIE4gJSBJID0gIE4KICAgICAqICAgSSAlIG4gPSAgTgogICAgICogICBJICUgMCA9ICBOCiAgICAgKiAgIEkgJSBOID0gIE4KICAgICAqICAgSSAlIEkgPSAgTgogICAgICoKICAgICAqIFJldHVybiBhIG5ldyBCaWdOdW1iZXIgd2hvc2UgdmFsdWUgaXMgdGhlIHZhbHVlIG9mIHRoaXMgQmlnTnVtYmVyIG1vZHVsbyB0aGUgdmFsdWUgb2YKICAgICAqIEJpZ051bWJlcih5LCBiKS4gVGhlIHJlc3VsdCBkZXBlbmRzIG9uIHRoZSB2YWx1ZSBvZiBNT0RVTE9fTU9ERS4KICAgICAqLwoJCQkJCVAubW9kdWxvID0gUC5tb2QgPSBmdW5jdGlvbih5LCBiKSB7CgkJCQkJCXZhciBxLAoJCQkJCQkJcywKCQkJCQkJCXggPSB0aGlzOwoJCQkJCQl5ID0gbmV3IEJpZ051bWJlcih5LCBiKTsKCgkJCQkJCS8vIFJldHVybiBOYU4gaWYgeCBpcyBJbmZpbml0eSBvciBOYU4sIG9yIHkgaXMgTmFOIG9yIHplcm8uCgkJCQkJCWlmICgheC5jIHx8ICF5LnMgfHwgeS5jICYmICF5LmNbMF0pIHsKCQkJCQkJCXJldHVybiBuZXcgQmlnTnVtYmVyKE5hTik7CgoJCQkJCQkJLy8gUmV0dXJuIHggaWYgeSBpcyBJbmZpbml0eSBvciB4IGlzIHplcm8uCgkJCQkJCX0gZWxzZSBpZiAoIXkuYyB8fCB4LmMgJiYgIXguY1swXSkgewoJCQkJCQkJcmV0dXJuIG5ldyBCaWdOdW1iZXIoeCk7CgkJCQkJCX0KCQkJCQkJaWYgKE1PRFVMT19NT0RFID09IDkpIHsKCQkJCQkJCS8vIEV1Y2xpZGlhbiBkaXZpc2lvbjogcSA9IHNpZ24oeSkgKiBmbG9vcih4IC8gYWJzKHkpKQoJCQkJCQkJLy8gciA9IHggLSBxeSAgICB3aGVyZSAgMCA8PSByIDwgYWJzKHkpCgkJCQkJCQlzID0geS5zOwoJCQkJCQkJeS5zID0gMTsKCQkJCQkJCXEgPSBkaXYoeCwgeSwgMCwgMyk7CgkJCQkJCQl5LnMgPSBzOwoJCQkJCQkJcS5zICo9IHM7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlxID0gZGl2KHgsIHksIDAsIE1PRFVMT19NT0RFKTsKCQkJCQkJfQoJCQkJCQl5ID0geC5taW51cyhxLnRpbWVzKHkpKTsKCgkJCQkJCS8vIFRvIG1hdGNoIEphdmFTY3JpcHQgJSwgZW5zdXJlIHNpZ24gb2YgemVybyBpcyBzaWduIG9mIGRpdmlkZW5kLgoJCQkJCQlpZiAoIXkuY1swXSAmJiBNT0RVTE9fTU9ERSA9PSAxKSB5LnMgPSB4LnM7CgkJCQkJCXJldHVybiB5OwoJCQkJCX07CgoJCQkJCS8qCiAgICAgKiAgbiAqIDAgPSAwCiAgICAgKiAgbiAqIE4gPSBOCiAgICAgKiAgbiAqIEkgPSBJCiAgICAgKiAgMCAqIG4gPSAwCiAgICAgKiAgMCAqIDAgPSAwCiAgICAgKiAgMCAqIE4gPSBOCiAgICAgKiAgMCAqIEkgPSBOCiAgICAgKiAgTiAqIG4gPSBOCiAgICAgKiAgTiAqIDAgPSBOCiAgICAgKiAgTiAqIE4gPSBOCiAgICAgKiAgTiAqIEkgPSBOCiAgICAgKiAgSSAqIG4gPSBJCiAgICAgKiAgSSAqIDAgPSBOCiAgICAgKiAgSSAqIE4gPSBOCiAgICAgKiAgSSAqIEkgPSBJCiAgICAgKgogICAgICogUmV0dXJuIGEgbmV3IEJpZ051bWJlciB3aG9zZSB2YWx1ZSBpcyB0aGUgdmFsdWUgb2YgdGhpcyBCaWdOdW1iZXIgbXVsdGlwbGllZCBieSB0aGUgdmFsdWUKICAgICAqIG9mIEJpZ051bWJlcih5LCBiKS4KICAgICAqLwoJCQkJCVAubXVsdGlwbGllZEJ5ID0gUC50aW1lcyA9IGZ1bmN0aW9uKHksIGIpIHsKCQkJCQkJdmFyIGMsCgkJCQkJCQllLAoJCQkJCQkJaSwKCQkJCQkJCWosCgkJCQkJCQlrLAoJCQkJCQkJbSwKCQkJCQkJCXhjTCwKCQkJCQkJCXhsbywKCQkJCQkJCXhoaSwKCQkJCQkJCXljTCwKCQkJCQkJCXlsbywKCQkJCQkJCXloaSwKCQkJCQkJCXpjLAoJCQkJCQkJYmFzZSwKCQkJCQkJCXNxcnRCYXNlLAoJCQkJCQkJeCA9IHRoaXMsCgkJCQkJCQl4YyA9IHguYywKCQkJCQkJCXljID0gKHkgPSBuZXcgQmlnTnVtYmVyKHksIGIpKS5jOwoKCQkJCQkJLy8gRWl0aGVyIE5hTiwgwrFJbmZpbml0eSBvciDCsTA/CgkJCQkJCWlmICgheGMgfHwgIXljIHx8ICF4Y1swXSB8fCAheWNbMF0pIHsKCQkJCQkJCS8vIFJldHVybiBOYU4gaWYgZWl0aGVyIGlzIE5hTiwgb3Igb25lIGlzIDAgYW5kIHRoZSBvdGhlciBpcyBJbmZpbml0eS4KCQkJCQkJCWlmICgheC5zIHx8ICF5LnMgfHwgeGMgJiYgIXhjWzBdICYmICF5YyB8fCB5YyAmJiAheWNbMF0gJiYgIXhjKSB7CgkJCQkJCQkJeS5jID0geS5lID0geS5zID0gbnVsbDsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJeS5zICo9IHguczsKCgkJCQkJCQkJLy8gUmV0dXJuIMKxSW5maW5pdHkgaWYgZWl0aGVyIGlzIMKxSW5maW5pdHkuCgkJCQkJCQkJaWYgKCF4YyB8fCAheWMpIHsKCQkJCQkJCQkJeS5jID0geS5lID0gbnVsbDsKCgkJCQkJCQkJCS8vIFJldHVybiDCsTAgaWYgZWl0aGVyIGlzIMKxMC4KCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQl5LmMgPSBbMF07CgkJCQkJCQkJCXkuZSA9IDA7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJcmV0dXJuIHk7CgkJCQkJCX0KCQkJCQkJZSA9IGJpdEZsb29yKHguZSAvIExPR19CQVNFKSArIGJpdEZsb29yKHkuZSAvIExPR19CQVNFKTsKCQkJCQkJeS5zICo9IHguczsKCQkJCQkJeGNMID0geGMubGVuZ3RoOwoJCQkJCQl5Y0wgPSB5Yy5sZW5ndGg7CgoJCQkJCQkvLyBFbnN1cmUgeGMgcG9pbnRzIHRvIGxvbmdlciBhcnJheSBhbmQgeGNMIHRvIGl0cyBsZW5ndGguCgkJCQkJCWlmICh4Y0wgPCB5Y0wpIHsKCQkJCQkJCXpjID0geGM7CgkJCQkJCQl4YyA9IHljOwoJCQkJCQkJeWMgPSB6YzsKCQkJCQkJCWkgPSB4Y0w7CgkJCQkJCQl4Y0wgPSB5Y0w7CgkJCQkJCQl5Y0wgPSBpOwoJCQkJCQl9CgoJCQkJCQkvLyBJbml0aWFsaXNlIHRoZSByZXN1bHQgYXJyYXkgd2l0aCB6ZXJvcy4KCQkJCQkJZm9yIChpID0geGNMICsgeWNMLCB6YyA9IFtdOyBpLS07IHpjLnB1c2goMCkpIDsKCQkJCQkJYmFzZSA9IEJBU0U7CgkJCQkJCXNxcnRCYXNlID0gU1FSVF9CQVNFOwoJCQkJCQlmb3IgKGkgPSB5Y0w7IC0taSA+PSAwOykgewoJCQkJCQkJYyA9IDA7CgkJCQkJCQl5bG8gPSB5Y1tpXSAlIHNxcnRCYXNlOwoJCQkJCQkJeWhpID0geWNbaV0gLyBzcXJ0QmFzZSB8IDA7CgkJCQkJCQlmb3IgKGsgPSB4Y0wsIGogPSBpICsgazsgaiA+IGk7KSB7CgkJCQkJCQkJeGxvID0geGNbLS1rXSAlIHNxcnRCYXNlOwoJCQkJCQkJCXhoaSA9IHhjW2tdIC8gc3FydEJhc2UgfCAwOwoJCQkJCQkJCW0gPSB5aGkgKiB4bG8gKyB4aGkgKiB5bG87CgkJCQkJCQkJeGxvID0geWxvICogeGxvICsgbSAlIHNxcnRCYXNlICogc3FydEJhc2UgKyB6Y1tqXSArIGM7CgkJCQkJCQkJYyA9ICh4bG8gLyBiYXNlIHwgMCkgKyAobSAvIHNxcnRCYXNlIHwgMCkgKyB5aGkgKiB4aGk7CgkJCQkJCQkJemNbai0tXSA9IHhsbyAlIGJhc2U7CgkJCQkJCQl9CgkJCQkJCQl6Y1tqXSA9IGM7CgkJCQkJCX0KCQkJCQkJaWYgKGMpIHsKCQkJCQkJCSsrZTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXpjLnNwbGljZSgwLCAxKTsKCQkJCQkJfQoJCQkJCQlyZXR1cm4gbm9ybWFsaXNlKHksIHpjLCBlKTsKCQkJCQl9OwoKCQkJCQkvKgogICAgICogUmV0dXJuIGEgbmV3IEJpZ051bWJlciB3aG9zZSB2YWx1ZSBpcyB0aGUgdmFsdWUgb2YgdGhpcyBCaWdOdW1iZXIgbmVnYXRlZCwKICAgICAqIGkuZS4gbXVsdGlwbGllZCBieSAtMS4KICAgICAqLwoJCQkJCVAubmVnYXRlZCA9IGZ1bmN0aW9uKCkgewoJCQkJCQl2YXIgeCA9IG5ldyBCaWdOdW1iZXIodGhpcyk7CgkJCQkJCXgucyA9IC14LnMgfHwgbnVsbDsKCQkJCQkJcmV0dXJuIHg7CgkJCQkJfTsKCgkJCQkJLyoKICAgICAqICBuICsgMCA9IG4KICAgICAqICBuICsgTiA9IE4KICAgICAqICBuICsgSSA9IEkKICAgICAqICAwICsgbiA9IG4KICAgICAqICAwICsgMCA9IDAKICAgICAqICAwICsgTiA9IE4KICAgICAqICAwICsgSSA9IEkKICAgICAqICBOICsgbiA9IE4KICAgICAqICBOICsgMCA9IE4KICAgICAqICBOICsgTiA9IE4KICAgICAqICBOICsgSSA9IE4KICAgICAqICBJICsgbiA9IEkKICAgICAqICBJICsgMCA9IEkKICAgICAqICBJICsgTiA9IE4KICAgICAqICBJICsgSSA9IEkKICAgICAqCiAgICAgKiBSZXR1cm4gYSBuZXcgQmlnTnVtYmVyIHdob3NlIHZhbHVlIGlzIHRoZSB2YWx1ZSBvZiB0aGlzIEJpZ051bWJlciBwbHVzIHRoZSB2YWx1ZSBvZgogICAgICogQmlnTnVtYmVyKHksIGIpLgogICAgICovCgkJCQkJUC5wbHVzID0gZnVuY3Rpb24oeSwgYikgewoJCQkJCQl2YXIgdCwKCQkJCQkJCXggPSB0aGlzLAoJCQkJCQkJYSA9IHguczsKCQkJCQkJeSA9IG5ldyBCaWdOdW1iZXIoeSwgYik7CgkJCQkJCWIgPSB5LnM7CgoJCQkJCQkvLyBFaXRoZXIgTmFOPwoJCQkJCQlpZiAoIWEgfHwgIWIpIHJldHVybiBuZXcgQmlnTnVtYmVyKE5hTik7CgoJCQkJCQkvLyBTaWducyBkaWZmZXI/CgkJCQkJCWlmIChhICE9IGIpIHsKCQkJCQkJCXkucyA9IC1iOwoJCQkJCQkJcmV0dXJuIHgubWludXMoeSk7CgkJCQkJCX0KCQkJCQkJdmFyIHhlID0geC5lIC8gTE9HX0JBU0UsCgkJCQkJCQl5ZSA9IHkuZSAvIExPR19CQVNFLAoJCQkJCQkJeGMgPSB4LmMsCgkJCQkJCQl5YyA9IHkuYzsKCQkJCQkJaWYgKCF4ZSB8fCAheWUpIHsKCQkJCQkJCS8vIFJldHVybiDCsUluZmluaXR5IGlmIGVpdGhlciDCsUluZmluaXR5LgoJCQkJCQkJaWYgKCF4YyB8fCAheWMpIHJldHVybiBuZXcgQmlnTnVtYmVyKGEgLyAwKTsKCgkJCQkJCQkvLyBFaXRoZXIgemVybz8KCQkJCQkJCS8vIFJldHVybiB5IGlmIHkgaXMgbm9uLXplcm8sIHggaWYgeCBpcyBub24temVybywgb3IgemVybyBpZiBib3RoIGFyZSB6ZXJvLgoJCQkJCQkJaWYgKCF4Y1swXSB8fCAheWNbMF0pIHJldHVybiB5Y1swXSA/IHkgOiBuZXcgQmlnTnVtYmVyKHhjWzBdID8geCA6IGEgKiAwKTsKCQkJCQkJfQoJCQkJCQl4ZSA9IGJpdEZsb29yKHhlKTsKCQkJCQkJeWUgPSBiaXRGbG9vcih5ZSk7CgkJCQkJCXhjID0geGMuc2xpY2UoKTsKCgkJCQkJCS8vIFByZXBlbmQgemVyb3MgdG8gZXF1YWxpc2UgZXhwb25lbnRzLiBGYXN0ZXIgdG8gdXNlIHJldmVyc2UgdGhlbiBkbyB1bnNoaWZ0cy4KCQkJCQkJaWYgKGEgPSB4ZSAtIHllKSB7CgkJCQkJCQlpZiAoYSA+IDApIHsKCQkJCQkJCQl5ZSA9IHhlOwoJCQkJCQkJCXQgPSB5YzsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJYSA9IC1hOwoJCQkJCQkJCXQgPSB4YzsKCQkJCQkJCX0KCQkJCQkJCXQucmV2ZXJzZSgpOwoJCQkJCQkJZm9yICg7IGEtLTsgdC5wdXNoKDApKSA7CgkJCQkJCQl0LnJldmVyc2UoKTsKCQkJCQkJfQoJCQkJCQlhID0geGMubGVuZ3RoOwoJCQkJCQliID0geWMubGVuZ3RoOwoKCQkJCQkJLy8gUG9pbnQgeGMgdG8gdGhlIGxvbmdlciBhcnJheSwgYW5kIGIgdG8gdGhlIHNob3J0ZXIgbGVuZ3RoLgoJCQkJCQlpZiAoYSAtIGIgPCAwKSB7CgkJCQkJCQl0ID0geWM7CgkJCQkJCQl5YyA9IHhjOwoJCQkJCQkJeGMgPSB0OwoJCQkJCQkJYiA9IGE7CgkJCQkJCX0KCgkJCQkJCS8vIE9ubHkgc3RhcnQgYWRkaW5nIGF0IHljLmxlbmd0aCAtIDEgYXMgdGhlIGZ1cnRoZXIgZGlnaXRzIG9mIHhjIGNhbiBiZSBpZ25vcmVkLgoJCQkJCQlmb3IgKGEgPSAwOyBiOykgewoJCQkJCQkJYSA9ICh4Y1stLWJdID0geGNbYl0gKyB5Y1tiXSArIGEpIC8gQkFTRSB8IDA7CgkJCQkJCQl4Y1tiXSA9IEJBU0UgPT09IHhjW2JdID8gMCA6IHhjW2JdICUgQkFTRTsKCQkJCQkJfQoJCQkJCQlpZiAoYSkgewoJCQkJCQkJeGMgPSBbYV0uY29uY2F0KHhjKTsKCQkJCQkJCSsreWU7CgkJCQkJCX0KCgkJCQkJCS8vIE5vIG5lZWQgdG8gY2hlY2sgZm9yIHplcm8sIGFzICt4ICsgK3kgIT0gMCAmJiAteCArIC15ICE9IDAKCQkJCQkJLy8geWUgPSBNQVhfRVhQICsgMSBwb3NzaWJsZQoJCQkJCQlyZXR1cm4gbm9ybWFsaXNlKHksIHhjLCB5ZSk7CgkJCQkJfTsKCgkJCQkJLyoKICAgICAqIElmIHNkIGlzIHVuZGVmaW5lZCBvciBudWxsIG9yIHRydWUgb3IgZmFsc2UsIHJldHVybiB0aGUgbnVtYmVyIG9mIHNpZ25pZmljYW50IGRpZ2l0cyBvZgogICAgICogdGhlIHZhbHVlIG9mIHRoaXMgQmlnTnVtYmVyLCBvciBudWxsIGlmIHRoZSB2YWx1ZSBvZiB0aGlzIEJpZ051bWJlciBpcyDCsUluZmluaXR5IG9yIE5hTi4KICAgICAqIElmIHNkIGlzIHRydWUgaW5jbHVkZSBpbnRlZ2VyLXBhcnQgdHJhaWxpbmcgemVyb3MgaW4gdGhlIGNvdW50LgogICAgICoKICAgICAqIE90aGVyd2lzZSwgaWYgc2QgaXMgYSBudW1iZXIsIHJldHVybiBhIG5ldyBCaWdOdW1iZXIgd2hvc2UgdmFsdWUgaXMgdGhlIHZhbHVlIG9mIHRoaXMKICAgICAqIEJpZ051bWJlciByb3VuZGVkIHRvIGEgbWF4aW11bSBvZiBzZCBzaWduaWZpY2FudCBkaWdpdHMgdXNpbmcgcm91bmRpbmcgbW9kZSBybSwgb3IKICAgICAqIFJPVU5ESU5HX01PREUgaWYgcm0gaXMgb21pdHRlZC4KICAgICAqCiAgICAgKiBzZCB7bnVtYmVyfGJvb2xlYW59IG51bWJlcjogc2lnbmlmaWNhbnQgZGlnaXRzOiBpbnRlZ2VyLCAxIHRvIE1BWCBpbmNsdXNpdmUuCiAgICAgKiAgICAgICAgICAgICAgICAgICAgIGJvb2xlYW46IHdoZXRoZXIgdG8gY291bnQgaW50ZWdlci1wYXJ0IHRyYWlsaW5nIHplcm9zOiB0cnVlIG9yIGZhbHNlLgogICAgICogW3JtXSB7bnVtYmVyfSBSb3VuZGluZyBtb2RlLiBJbnRlZ2VyLCAwIHRvIDggaW5jbHVzaXZlLgogICAgICoKICAgICAqICdbQmlnTnVtYmVyIEVycm9yXSBBcmd1bWVudCB7bm90IGEgcHJpbWl0aXZlIG51bWJlcnxub3QgYW4gaW50ZWdlcnxvdXQgb2YgcmFuZ2V9OiB7c2R8cm19JwogICAgICovCgkJCQkJUC5wcmVjaXNpb24gPSBQLnNkID0gZnVuY3Rpb24oc2QsIHJtKSB7CgkJCQkJCXZhciBjLAoJCQkJCQkJbiwKCQkJCQkJCXYsCgkJCQkJCQl4ID0gdGhpczsKCQkJCQkJaWYgKHNkICE9IG51bGwgJiYgc2QgIT09ICEhc2QpIHsKCQkJCQkJCWludENoZWNrKHNkLCAxLCBNQVgpOwoJCQkJCQkJaWYgKHJtID09IG51bGwpIHJtID0gUk9VTkRJTkdfTU9ERTsgZWxzZSBpbnRDaGVjayhybSwgMCwgOCk7CgkJCQkJCQlyZXR1cm4gcm91bmQobmV3IEJpZ051bWJlcih4KSwgc2QsIHJtKTsKCQkJCQkJfQoJCQkJCQlpZiAoIShjID0geC5jKSkgcmV0dXJuIG51bGw7CgkJCQkJCXYgPSBjLmxlbmd0aCAtIDE7CgkJCQkJCW4gPSB2ICogTE9HX0JBU0UgKyAxOwoJCQkJCQlpZiAodiA9IGNbdl0pIHsKCQkJCQkJCS8vIFN1YnRyYWN0IHRoZSBudW1iZXIgb2YgdHJhaWxpbmcgemVyb3Mgb2YgdGhlIGxhc3QgZWxlbWVudC4KCQkJCQkJCWZvciAoOyB2ICUgMTAgPT0gMDsgdiAvPSAxMCwgbi0tKSA7CgoJCQkJCQkJLy8gQWRkIHRoZSBudW1iZXIgb2YgZGlnaXRzIG9mIHRoZSBmaXJzdCBlbGVtZW50LgoJCQkJCQkJZm9yICh2ID0gY1swXTsgdiA+PSAxMDsgdiAvPSAxMCwgbisrKSA7CgkJCQkJCX0KCQkJCQkJaWYgKHNkICYmIHguZSArIDEgPiBuKSBuID0geC5lICsgMTsKCQkJCQkJcmV0dXJuIG47CgkJCQkJfTsKCgkJCQkJLyoKICAgICAqIFJldHVybiBhIG5ldyBCaWdOdW1iZXIgd2hvc2UgdmFsdWUgaXMgdGhlIHZhbHVlIG9mIHRoaXMgQmlnTnVtYmVyIHNoaWZ0ZWQgYnkgayBwbGFjZXMKICAgICAqIChwb3dlcnMgb2YgMTApLiBTaGlmdCB0byB0aGUgcmlnaHQgaWYgbiA+IDAsIGFuZCB0byB0aGUgbGVmdCBpZiBuIDwgMC4KICAgICAqCiAgICAgKiBrIHtudW1iZXJ9IEludGVnZXIsIC1NQVhfU0FGRV9JTlRFR0VSIHRvIE1BWF9TQUZFX0lOVEVHRVIgaW5jbHVzaXZlLgogICAgICoKICAgICAqICdbQmlnTnVtYmVyIEVycm9yXSBBcmd1bWVudCB7bm90IGEgcHJpbWl0aXZlIG51bWJlcnxub3QgYW4gaW50ZWdlcnxvdXQgb2YgcmFuZ2V9OiB7a30nCiAgICAgKi8KCQkJCQlQLnNoaWZ0ZWRCeSA9IGZ1bmN0aW9uKGspIHsKCQkJCQkJaW50Q2hlY2soaywgLU1BWF9TQUZFX0lOVEVHRVIsIE1BWF9TQUZFX0lOVEVHRVIpOwoJCQkJCQlyZXR1cm4gdGhpcy50aW1lcygnMWUnICsgayk7CgkJCQkJfTsKCgkJCQkJLyoKICAgICAqICBzcXJ0KC1uKSA9ICBOCiAgICAgKiAgc3FydChOKSA9ICBOCiAgICAgKiAgc3FydCgtSSkgPSAgTgogICAgICogIHNxcnQoSSkgPSAgSQogICAgICogIHNxcnQoMCkgPSAgMAogICAgICogIHNxcnQoLTApID0gLTAKICAgICAqCiAgICAgKiBSZXR1cm4gYSBuZXcgQmlnTnVtYmVyIHdob3NlIHZhbHVlIGlzIHRoZSBzcXVhcmUgcm9vdCBvZiB0aGUgdmFsdWUgb2YgdGhpcyBCaWdOdW1iZXIsCiAgICAgKiByb3VuZGVkIGFjY29yZGluZyB0byBERUNJTUFMX1BMQUNFUyBhbmQgUk9VTkRJTkdfTU9ERS4KICAgICAqLwoJCQkJCVAuc3F1YXJlUm9vdCA9IFAuc3FydCA9IGZ1bmN0aW9uKCkgewoJCQkJCQl2YXIgbSwKCQkJCQkJCW4sCgkJCQkJCQlyLAoJCQkJCQkJcmVwLAoJCQkJCQkJdCwKCQkJCQkJCXggPSB0aGlzLAoJCQkJCQkJYyA9IHguYywKCQkJCQkJCXMgPSB4LnMsCgkJCQkJCQllID0geC5lLAoJCQkJCQkJZHAgPSBERUNJTUFMX1BMQUNFUyArIDQsCgkJCQkJCQloYWxmID0gbmV3IEJpZ051bWJlcignMC41Jyk7CgoJCQkJCQkvLyBOZWdhdGl2ZS9OYU4vSW5maW5pdHkvemVybz8KCQkJCQkJaWYgKHMgIT09IDEgfHwgIWMgfHwgIWNbMF0pIHsKCQkJCQkJCXJldHVybiBuZXcgQmlnTnVtYmVyKCFzIHx8IHMgPCAwICYmICghYyB8fCBjWzBdKSA/IE5hTiA6IGMgPyB4IDogMSAvIDApOwoJCQkJCQl9CgoJCQkJCQkvLyBJbml0aWFsIGVzdGltYXRlLgoJCQkJCQlzID0gTWF0aC5zcXJ0KCt2YWx1ZU9mKHgpKTsKCgkJCQkJCS8vIE1hdGguc3FydCB1bmRlcmZsb3cvb3ZlcmZsb3c/CgkJCQkJCS8vIFBhc3MgeCB0byBNYXRoLnNxcnQgYXMgaW50ZWdlciwgdGhlbiBhZGp1c3QgdGhlIGV4cG9uZW50IG9mIHRoZSByZXN1bHQuCgkJCQkJCWlmIChzID09IDAgfHwgcyA9PSAxIC8gMCkgewoJCQkJCQkJbiA9IGNvZWZmVG9TdHJpbmcoYyk7CgkJCQkJCQlpZiAoKG4ubGVuZ3RoICsgZSkgJSAyID09IDApIG4gKz0gJzAnOwoJCQkJCQkJcyA9IE1hdGguc3FydCgrbik7CgkJCQkJCQllID0gYml0Rmxvb3IoKGUgKyAxKSAvIDIpIC0gKGUgPCAwIHx8IGUgJSAyKTsKCQkJCQkJCWlmIChzID09IDEgLyAwKSB7CgkJCQkJCQkJbiA9ICc1ZScgKyBlOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQluID0gcy50b0V4cG9uZW50aWFsKCk7CgkJCQkJCQkJbiA9IG4uc2xpY2UoMCwgbi5pbmRleE9mKCdlJykgKyAxKSArIGU7CgkJCQkJCQl9CgkJCQkJCQlyID0gbmV3IEJpZ051bWJlcihuKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCXIgPSBuZXcgQmlnTnVtYmVyKHMgKyAnJyk7CgkJCQkJCX0KCgkJCQkJCS8vIENoZWNrIGZvciB6ZXJvLgoJCQkJCQkvLyByIGNvdWxkIGJlIHplcm8gaWYgTUlOX0VYUCBpcyBjaGFuZ2VkIGFmdGVyIHRoZSB0aGlzIHZhbHVlIHdhcyBjcmVhdGVkLgoJCQkJCQkvLyBUaGlzIHdvdWxkIGNhdXNlIGEgZGl2aXNpb24gYnkgemVybyAoeC90KSBhbmQgaGVuY2UgSW5maW5pdHkgYmVsb3csIHdoaWNoIHdvdWxkIGNhdXNlCgkJCQkJCS8vIGNvZWZmVG9TdHJpbmcgdG8gdGhyb3cuCgkJCQkJCWlmIChyLmNbMF0pIHsKCQkJCQkJCWUgPSByLmU7CgkJCQkJCQlzID0gZSArIGRwOwoJCQkJCQkJaWYgKHMgPCAzKSBzID0gMDsKCgkJCQkJCQkvLyBOZXd0b24tUmFwaHNvbiBpdGVyYXRpb24uCgkJCQkJCQlmb3IgKDsgOykgewoJCQkJCQkJCXQgPSByOwoJCQkJCQkJCXIgPSBoYWxmLnRpbWVzKHQucGx1cyhkaXYoeCwgdCwgZHAsIDEpKSk7CgkJCQkJCQkJaWYgKGNvZWZmVG9TdHJpbmcodC5jKS5zbGljZSgwLCBzKSA9PT0gKG4gPSBjb2VmZlRvU3RyaW5nKHIuYykpLnNsaWNlKDAsIHMpKSB7CgkJCQkJCQkJCS8vIFRoZSBleHBvbmVudCBvZiByIG1heSBoZXJlIGJlIG9uZSBsZXNzIHRoYW4gdGhlIGZpbmFsIHJlc3VsdCBleHBvbmVudCwKCQkJCQkJCQkJLy8gZS5nIDAuMDAwOTk5OSAoZS00KSAtLT4gMC4wMDEgKGUtMyksIHNvIGFkanVzdCBzIHNvIHRoZSByb3VuZGluZyBkaWdpdHMKCQkJCQkJCQkJLy8gYXJlIGluZGV4ZWQgY29ycmVjdGx5LgoJCQkJCQkJCQlpZiAoci5lIDwgZSkgLS1zOwoJCQkJCQkJCQluID0gbi5zbGljZShzIC0gMywgcyArIDEpOwoKCQkJCQkJCQkJLy8gVGhlIDR0aCByb3VuZGluZyBkaWdpdCBtYXkgYmUgaW4gZXJyb3IgYnkgLTEgc28gaWYgdGhlIDQgcm91bmRpbmcgZGlnaXRzCgkJCQkJCQkJCS8vIGFyZSA5OTk5IG9yIDQ5OTkgKGkuZS4gYXBwcm9hY2hpbmcgYSByb3VuZGluZyBib3VuZGFyeSkgY29udGludWUgdGhlCgkJCQkJCQkJCS8vIGl0ZXJhdGlvbi4KCQkJCQkJCQkJaWYgKG4gPT0gJzk5OTknIHx8ICFyZXAgJiYgbiA9PSAnNDk5OScpIHsKCQkJCQkJCQkJCS8vIE9uIHRoZSBmaXJzdCBpdGVyYXRpb24gb25seSwgY2hlY2sgdG8gc2VlIGlmIHJvdW5kaW5nIHVwIGdpdmVzIHRoZQoJCQkJCQkJCQkJLy8gZXhhY3QgcmVzdWx0IGFzIHRoZSBuaW5lcyBtYXkgaW5maW5pdGVseSByZXBlYXQuCgkJCQkJCQkJCQlpZiAoIXJlcCkgewoJCQkJCQkJCQkJCXJvdW5kKHQsIHQuZSArIERFQ0lNQUxfUExBQ0VTICsgMiwgMCk7CgkJCQkJCQkJCQkJaWYgKHQudGltZXModCkuZXEoeCkpIHsKCQkJCQkJCQkJCQkJciA9IHQ7CgkJCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQkJCX0KCQkJCQkJCQkJCX0KCQkJCQkJCQkJCWRwICs9IDQ7CgkJCQkJCQkJCQlzICs9IDQ7CgkJCQkJCQkJCQlyZXAgPSAxOwoJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJLy8gSWYgcm91bmRpbmcgZGlnaXRzIGFyZSBudWxsLCAwezAsNH0gb3IgNTB7MCwzfSwgY2hlY2sgZm9yIGV4YWN0CgkJCQkJCQkJCQkvLyByZXN1bHQuIElmIG5vdCwgdGhlbiB0aGVyZSBhcmUgZnVydGhlciBkaWdpdHMgYW5kIG0gd2lsbCBiZSB0cnV0aHkuCgkJCQkJCQkJCQlpZiAoIStuIHx8ICErbi5zbGljZSgxKSAmJiBuLmNoYXJBdCgwKSA9PSAnNScpIHsKCQkJCQkJCQkJCQkvLyBUcnVuY2F0ZSB0byB0aGUgZmlyc3Qgcm91bmRpbmcgZGlnaXQuCgkJCQkJCQkJCQkJcm91bmQociwgci5lICsgREVDSU1BTF9QTEFDRVMgKyAyLCAxKTsKCQkJCQkJCQkJCQltID0gIXIudGltZXMocikuZXEoeCk7CgkJCQkJCQkJCQl9CgkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQlyZXR1cm4gcm91bmQociwgci5lICsgREVDSU1BTF9QTEFDRVMgKyAxLCBST1VORElOR19NT0RFLCBtKTsKCQkJCQl9OwoKCQkJCQkvKgogICAgICogUmV0dXJuIGEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgdmFsdWUgb2YgdGhpcyBCaWdOdW1iZXIgaW4gZXhwb25lbnRpYWwgbm90YXRpb24gYW5kCiAgICAgKiByb3VuZGVkIHVzaW5nIFJPVU5ESU5HX01PREUgdG8gZHAgZml4ZWQgZGVjaW1hbCBwbGFjZXMuCiAgICAgKgogICAgICogW2RwXSB7bnVtYmVyfSBEZWNpbWFsIHBsYWNlcy4gSW50ZWdlciwgMCB0byBNQVggaW5jbHVzaXZlLgogICAgICogW3JtXSB7bnVtYmVyfSBSb3VuZGluZyBtb2RlLiBJbnRlZ2VyLCAwIHRvIDggaW5jbHVzaXZlLgogICAgICoKICAgICAqICdbQmlnTnVtYmVyIEVycm9yXSBBcmd1bWVudCB7bm90IGEgcHJpbWl0aXZlIG51bWJlcnxub3QgYW4gaW50ZWdlcnxvdXQgb2YgcmFuZ2V9OiB7ZHB8cm19JwogICAgICovCgkJCQkJUC50b0V4cG9uZW50aWFsID0gZnVuY3Rpb24oZHAsIHJtKSB7CgkJCQkJCWlmIChkcCAhPSBudWxsKSB7CgkJCQkJCQlpbnRDaGVjayhkcCwgMCwgTUFYKTsKCQkJCQkJCWRwKys7CgkJCQkJCX0KCQkJCQkJcmV0dXJuIGZvcm1hdCh0aGlzLCBkcCwgcm0sIDEpOwoJCQkJCX07CgoJCQkJCS8qCiAgICAgKiBSZXR1cm4gYSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSB2YWx1ZSBvZiB0aGlzIEJpZ051bWJlciBpbiBmaXhlZC1wb2ludCBub3RhdGlvbiByb3VuZGluZwogICAgICogdG8gZHAgZml4ZWQgZGVjaW1hbCBwbGFjZXMgdXNpbmcgcm91bmRpbmcgbW9kZSBybSwgb3IgUk9VTkRJTkdfTU9ERSBpZiBybSBpcyBvbWl0dGVkLgogICAgICoKICAgICAqIE5vdGU6IGFzIHdpdGggSmF2YVNjcmlwdCdzIG51bWJlciB0eXBlLCAoLTApLnRvRml4ZWQoMCkgaXMgJzAnLAogICAgICogYnV0IGUuZy4gKC0wLjAwMDAxKS50b0ZpeGVkKDApIGlzICctMCcuCiAgICAgKgogICAgICogW2RwXSB7bnVtYmVyfSBEZWNpbWFsIHBsYWNlcy4gSW50ZWdlciwgMCB0byBNQVggaW5jbHVzaXZlLgogICAgICogW3JtXSB7bnVtYmVyfSBSb3VuZGluZyBtb2RlLiBJbnRlZ2VyLCAwIHRvIDggaW5jbHVzaXZlLgogICAgICoKICAgICAqICdbQmlnTnVtYmVyIEVycm9yXSBBcmd1bWVudCB7bm90IGEgcHJpbWl0aXZlIG51bWJlcnxub3QgYW4gaW50ZWdlcnxvdXQgb2YgcmFuZ2V9OiB7ZHB8cm19JwogICAgICovCgkJCQkJUC50b0ZpeGVkID0gZnVuY3Rpb24oZHAsIHJtKSB7CgkJCQkJCWlmIChkcCAhPSBudWxsKSB7CgkJCQkJCQlpbnRDaGVjayhkcCwgMCwgTUFYKTsKCQkJCQkJCWRwID0gZHAgKyB0aGlzLmUgKyAxOwoJCQkJCQl9CgkJCQkJCXJldHVybiBmb3JtYXQodGhpcywgZHAsIHJtKTsKCQkJCQl9OwoKCQkJCQkvKgogICAgICogUmV0dXJuIGEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgdmFsdWUgb2YgdGhpcyBCaWdOdW1iZXIgaW4gZml4ZWQtcG9pbnQgbm90YXRpb24gcm91bmRlZAogICAgICogdXNpbmcgcm0gb3IgUk9VTkRJTkdfTU9ERSB0byBkcCBkZWNpbWFsIHBsYWNlcywgYW5kIGZvcm1hdHRlZCBhY2NvcmRpbmcgdG8gdGhlIHByb3BlcnRpZXMKICAgICAqIG9mIHRoZSBmb3JtYXQgb3IgRk9STUFUIG9iamVjdCAoc2VlIEJpZ051bWJlci5zZXQpLgogICAgICoKICAgICAqIFRoZSBmb3JtYXR0aW5nIG9iamVjdCBtYXkgY29udGFpbiBzb21lIG9yIGFsbCBvZiB0aGUgcHJvcGVydGllcyBzaG93biBiZWxvdy4KICAgICAqCiAgICAgKiBGT1JNQVQgPSB7CiAgICAgKiAgIHByZWZpeDogJycsCiAgICAgKiAgIGdyb3VwU2l6ZTogMywKICAgICAqICAgc2Vjb25kYXJ5R3JvdXBTaXplOiAwLAogICAgICogICBncm91cFNlcGFyYXRvcjogJywnLAogICAgICogICBkZWNpbWFsU2VwYXJhdG9yOiAnLicsCiAgICAgKiAgIGZyYWN0aW9uR3JvdXBTaXplOiAwLAogICAgICogICBmcmFjdGlvbkdyb3VwU2VwYXJhdG9yOiAnXHhBMCcsICAgICAgLy8gbm9uLWJyZWFraW5nIHNwYWNlCiAgICAgKiAgIHN1ZmZpeDogJycKICAgICAqIH07CiAgICAgKgogICAgICogW2RwXSB7bnVtYmVyfSBEZWNpbWFsIHBsYWNlcy4gSW50ZWdlciwgMCB0byBNQVggaW5jbHVzaXZlLgogICAgICogW3JtXSB7bnVtYmVyfSBSb3VuZGluZyBtb2RlLiBJbnRlZ2VyLCAwIHRvIDggaW5jbHVzaXZlLgogICAgICogW2Zvcm1hdF0ge29iamVjdH0gRm9ybWF0dGluZyBvcHRpb25zLiBTZWUgRk9STUFUIHBiamVjdCBhYm92ZS4KICAgICAqCiAgICAgKiAnW0JpZ051bWJlciBFcnJvcl0gQXJndW1lbnQge25vdCBhIHByaW1pdGl2ZSBudW1iZXJ8bm90IGFuIGludGVnZXJ8b3V0IG9mIHJhbmdlfToge2RwfHJtfScKICAgICAqICdbQmlnTnVtYmVyIEVycm9yXSBBcmd1bWVudCBub3QgYW4gb2JqZWN0OiB7Zm9ybWF0fScKICAgICAqLwoJCQkJCVAudG9Gb3JtYXQgPSBmdW5jdGlvbihkcCwgcm0sIGZvcm1hdCkgewoJCQkJCQl2YXIgc3RyLAoJCQkJCQkJeCA9IHRoaXM7CgkJCQkJCWlmIChmb3JtYXQgPT0gbnVsbCkgewoJCQkJCQkJaWYgKGRwICE9IG51bGwgJiYgcm0gJiYgX3R5cGVvZihybSkgPT0gJ29iamVjdCcpIHsKCQkJCQkJCQlmb3JtYXQgPSBybTsKCQkJCQkJCQlybSA9IG51bGw7CgkJCQkJCQl9IGVsc2UgaWYgKGRwICYmIF90eXBlb2YoZHApID09ICdvYmplY3QnKSB7CgkJCQkJCQkJZm9ybWF0ID0gZHA7CgkJCQkJCQkJZHAgPSBybSA9IG51bGw7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCWZvcm1hdCA9IEZPUk1BVDsKCQkJCQkJCX0KCQkJCQkJfSBlbHNlIGlmIChfdHlwZW9mKGZvcm1hdCkgIT0gJ29iamVjdCcpIHsKCQkJCQkJCXRocm93IEVycm9yKGJpZ251bWJlckVycm9yICsgJ0FyZ3VtZW50IG5vdCBhbiBvYmplY3Q6ICcgKyBmb3JtYXQpOwoJCQkJCQl9CgkJCQkJCXN0ciA9IHgudG9GaXhlZChkcCwgcm0pOwoJCQkJCQlpZiAoeC5jKSB7CgkJCQkJCQl2YXIgaSwKCQkJCQkJCQlhcnIgPSBzdHIuc3BsaXQoJy4nKSwKCQkJCQkJCQlnMSA9ICtmb3JtYXQuZ3JvdXBTaXplLAoJCQkJCQkJCWcyID0gK2Zvcm1hdC5zZWNvbmRhcnlHcm91cFNpemUsCgkJCQkJCQkJZ3JvdXBTZXBhcmF0b3IgPSBmb3JtYXQuZ3JvdXBTZXBhcmF0b3IgfHwgJycsCgkJCQkJCQkJaW50UGFydCA9IGFyclswXSwKCQkJCQkJCQlmcmFjdGlvblBhcnQgPSBhcnJbMV0sCgkJCQkJCQkJaXNOZWcgPSB4LnMgPCAwLAoJCQkJCQkJCWludERpZ2l0cyA9IGlzTmVnID8gaW50UGFydC5zbGljZSgxKSA6IGludFBhcnQsCgkJCQkJCQkJbGVuID0gaW50RGlnaXRzLmxlbmd0aDsKCQkJCQkJCWlmIChnMikgewoJCQkJCQkJCWkgPSBnMTsKCQkJCQkJCQlnMSA9IGcyOwoJCQkJCQkJCWcyID0gaTsKCQkJCQkJCQlsZW4gLT0gaTsKCQkJCQkJCX0KCQkJCQkJCWlmIChnMSA+IDAgJiYgbGVuID4gMCkgewoJCQkJCQkJCWkgPSBsZW4gJSBnMSB8fCBnMTsKCQkJCQkJCQlpbnRQYXJ0ID0gaW50RGlnaXRzLnN1YnN0cigwLCBpKTsKCQkJCQkJCQlmb3IgKDsgaSA8IGxlbjsgaSArPSBnMSkgaW50UGFydCArPSBncm91cFNlcGFyYXRvciArIGludERpZ2l0cy5zdWJzdHIoaSwgZzEpOwoJCQkJCQkJCWlmIChnMiA+IDApIGludFBhcnQgKz0gZ3JvdXBTZXBhcmF0b3IgKyBpbnREaWdpdHMuc2xpY2UoaSk7CgkJCQkJCQkJaWYgKGlzTmVnKSBpbnRQYXJ0ID0gJy0nICsgaW50UGFydDsKCQkJCQkJCX0KCQkJCQkJCXN0ciA9IGZyYWN0aW9uUGFydCA/IGludFBhcnQgKyAoZm9ybWF0LmRlY2ltYWxTZXBhcmF0b3IgfHwgJycpICsgKChnMiA9ICtmb3JtYXQuZnJhY3Rpb25Hcm91cFNpemUpID8gZnJhY3Rpb25QYXJ0LnJlcGxhY2UobmV3IFJlZ0V4cCgnXFxkeycgKyBnMiArICd9XFxCJywgJ2cnKSwgJyQmJyArIChmb3JtYXQuZnJhY3Rpb25Hcm91cFNlcGFyYXRvciB8fCAnJykpIDogZnJhY3Rpb25QYXJ0KSA6IGludFBhcnQ7CgkJCQkJCX0KCQkJCQkJcmV0dXJuIChmb3JtYXQucHJlZml4IHx8ICcnKSArIHN0ciArIChmb3JtYXQuc3VmZml4IHx8ICcnKTsKCQkJCQl9OwoKCQkJCQkvKgogICAgICogUmV0dXJuIGFuIGFycmF5IG9mIHR3byBCaWdOdW1iZXJzIHJlcHJlc2VudGluZyB0aGUgdmFsdWUgb2YgdGhpcyBCaWdOdW1iZXIgYXMgYSBzaW1wbGUKICAgICAqIGZyYWN0aW9uIHdpdGggYW4gaW50ZWdlciBudW1lcmF0b3IgYW5kIGFuIGludGVnZXIgZGVub21pbmF0b3IuCiAgICAgKiBUaGUgZGVub21pbmF0b3Igd2lsbCBiZSBhIHBvc2l0aXZlIG5vbi16ZXJvIHZhbHVlIGxlc3MgdGhhbiBvciBlcXVhbCB0byB0aGUgc3BlY2lmaWVkCiAgICAgKiBtYXhpbXVtIGRlbm9taW5hdG9yLiBJZiBhIG1heGltdW0gZGVub21pbmF0b3IgaXMgbm90IHNwZWNpZmllZCwgdGhlIGRlbm9taW5hdG9yIHdpbGwgYmUKICAgICAqIHRoZSBsb3dlc3QgdmFsdWUgbmVjZXNzYXJ5IHRvIHJlcHJlc2VudCB0aGUgbnVtYmVyIGV4YWN0bHkuCiAgICAgKgogICAgICogW21kXSB7bnVtYmVyfHN0cmluZ3xCaWdOdW1iZXJ9IEludGVnZXIgPj0gMSwgb3IgSW5maW5pdHkuIFRoZSBtYXhpbXVtIGRlbm9taW5hdG9yLgogICAgICoKICAgICAqICdbQmlnTnVtYmVyIEVycm9yXSBBcmd1bWVudCB7bm90IGFuIGludGVnZXJ8b3V0IG9mIHJhbmdlfSA6IHttZH0nCiAgICAgKi8KCQkJCQlQLnRvRnJhY3Rpb24gPSBmdW5jdGlvbihtZCkgewoJCQkJCQl2YXIgZCwKCQkJCQkJCWQwLAoJCQkJCQkJZDEsCgkJCQkJCQlkMiwKCQkJCQkJCWUsCgkJCQkJCQlleHAsCgkJCQkJCQluLAoJCQkJCQkJbjAsCgkJCQkJCQluMSwKCQkJCQkJCXEsCgkJCQkJCQlyLAoJCQkJCQkJcywKCQkJCQkJCXggPSB0aGlzLAoJCQkJCQkJeGMgPSB4LmM7CgkJCQkJCWlmIChtZCAhPSBudWxsKSB7CgkJCQkJCQluID0gbmV3IEJpZ051bWJlcihtZCk7CgoJCQkJCQkJLy8gVGhyb3cgaWYgbWQgaXMgbGVzcyB0aGFuIG9uZSBvciBpcyBub3QgYW4gaW50ZWdlciwgdW5sZXNzIGl0IGlzIEluZmluaXR5LgoJCQkJCQkJaWYgKCFuLmlzSW50ZWdlcigpICYmIChuLmMgfHwgbi5zICE9PSAxKSB8fCBuLmx0KE9ORSkpIHsKCQkJCQkJCQl0aHJvdyBFcnJvcihiaWdudW1iZXJFcnJvciArICdBcmd1bWVudCAnICsgKG4uaXNJbnRlZ2VyKCkgPyAnb3V0IG9mIHJhbmdlOiAnIDogJ25vdCBhbiBpbnRlZ2VyOiAnKSArIHZhbHVlT2YobikpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWlmICgheGMpIHJldHVybiBuZXcgQmlnTnVtYmVyKHgpOwoJCQkJCQlkID0gbmV3IEJpZ051bWJlcihPTkUpOwoJCQkJCQluMSA9IGQwID0gbmV3IEJpZ051bWJlcihPTkUpOwoJCQkJCQlkMSA9IG4wID0gbmV3IEJpZ051bWJlcihPTkUpOwoJCQkJCQlzID0gY29lZmZUb1N0cmluZyh4Yyk7CgoJCQkJCQkvLyBEZXRlcm1pbmUgaW5pdGlhbCBkZW5vbWluYXRvci4KCQkJCQkJLy8gZCBpcyBhIHBvd2VyIG9mIDEwIGFuZCB0aGUgbWluaW11bSBtYXggZGVub21pbmF0b3IgdGhhdCBzcGVjaWZpZXMgdGhlIHZhbHVlIGV4YWN0bHkuCgkJCQkJCWUgPSBkLmUgPSBzLmxlbmd0aCAtIHguZSAtIDE7CgkJCQkJCWQuY1swXSA9IFBPV1NfVEVOWyhleHAgPSBlICUgTE9HX0JBU0UpIDwgMCA/IExPR19CQVNFICsgZXhwIDogZXhwXTsKCQkJCQkJbWQgPSAhbWQgfHwgbi5jb21wYXJlZFRvKGQpID4gMCA/IGUgPiAwID8gZCA6IG4xIDogbjsKCQkJCQkJZXhwID0gTUFYX0VYUDsKCQkJCQkJTUFYX0VYUCA9IDEgLyAwOwoJCQkJCQluID0gbmV3IEJpZ051bWJlcihzKTsKCgkJCQkJCS8vIG4wID0gZDEgPSAwCgkJCQkJCW4wLmNbMF0gPSAwOwoJCQkJCQlmb3IgKDsgOykgewoJCQkJCQkJcSA9IGRpdihuLCBkLCAwLCAxKTsKCQkJCQkJCWQyID0gZDAucGx1cyhxLnRpbWVzKGQxKSk7CgkJCQkJCQlpZiAoZDIuY29tcGFyZWRUbyhtZCkgPT0gMSkgYnJlYWs7CgkJCQkJCQlkMCA9IGQxOwoJCQkJCQkJZDEgPSBkMjsKCQkJCQkJCW4xID0gbjAucGx1cyhxLnRpbWVzKGQyID0gbjEpKTsKCQkJCQkJCW4wID0gZDI7CgkJCQkJCQlkID0gbi5taW51cyhxLnRpbWVzKGQyID0gZCkpOwoJCQkJCQkJbiA9IGQyOwoJCQkJCQl9CgkJCQkJCWQyID0gZGl2KG1kLm1pbnVzKGQwKSwgZDEsIDAsIDEpOwoJCQkJCQluMCA9IG4wLnBsdXMoZDIudGltZXMobjEpKTsKCQkJCQkJZDAgPSBkMC5wbHVzKGQyLnRpbWVzKGQxKSk7CgkJCQkJCW4wLnMgPSBuMS5zID0geC5zOwoJCQkJCQllID0gZSAqIDI7CgoJCQkJCQkvLyBEZXRlcm1pbmUgd2hpY2ggZnJhY3Rpb24gaXMgY2xvc2VyIHRvIHgsIG4wL2QwIG9yIG4xL2QxCgkJCQkJCXIgPSBkaXYobjEsIGQxLCBlLCBST1VORElOR19NT0RFKS5taW51cyh4KS5hYnMoKS5jb21wYXJlZFRvKGRpdihuMCwgZDAsIGUsIFJPVU5ESU5HX01PREUpLm1pbnVzKHgpLmFicygpKSA8IDEgPyBbbjEsIGQxXSA6IFtuMCwgZDBdOwoJCQkJCQlNQVhfRVhQID0gZXhwOwoJCQkJCQlyZXR1cm4gcjsKCQkJCQl9OwoKCQkJCQkvKgogICAgICogUmV0dXJuIHRoZSB2YWx1ZSBvZiB0aGlzIEJpZ051bWJlciBjb252ZXJ0ZWQgdG8gYSBudW1iZXIgcHJpbWl0aXZlLgogICAgICovCgkJCQkJUC50b051bWJlciA9IGZ1bmN0aW9uKCkgewoJCQkJCQlyZXR1cm4gK3ZhbHVlT2YodGhpcyk7CgkJCQkJfTsKCgkJCQkJLyoKICAgICAqIFJldHVybiBhIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIHZhbHVlIG9mIHRoaXMgQmlnTnVtYmVyIHJvdW5kZWQgdG8gc2Qgc2lnbmlmaWNhbnQgZGlnaXRzCiAgICAgKiB1c2luZyByb3VuZGluZyBtb2RlIHJtIG9yIFJPVU5ESU5HX01PREUuIElmIHNkIGlzIGxlc3MgdGhhbiB0aGUgbnVtYmVyIG9mIGRpZ2l0cwogICAgICogbmVjZXNzYXJ5IHRvIHJlcHJlc2VudCB0aGUgaW50ZWdlciBwYXJ0IG9mIHRoZSB2YWx1ZSBpbiBmaXhlZC1wb2ludCBub3RhdGlvbiwgdGhlbiB1c2UKICAgICAqIGV4cG9uZW50aWFsIG5vdGF0aW9uLgogICAgICoKICAgICAqIFtzZF0ge251bWJlcn0gU2lnbmlmaWNhbnQgZGlnaXRzLiBJbnRlZ2VyLCAxIHRvIE1BWCBpbmNsdXNpdmUuCiAgICAgKiBbcm1dIHtudW1iZXJ9IFJvdW5kaW5nIG1vZGUuIEludGVnZXIsIDAgdG8gOCBpbmNsdXNpdmUuCiAgICAgKgogICAgICogJ1tCaWdOdW1iZXIgRXJyb3JdIEFyZ3VtZW50IHtub3QgYSBwcmltaXRpdmUgbnVtYmVyfG5vdCBhbiBpbnRlZ2VyfG91dCBvZiByYW5nZX06IHtzZHxybX0nCiAgICAgKi8KCQkJCQlQLnRvUHJlY2lzaW9uID0gZnVuY3Rpb24oc2QsIHJtKSB7CgkJCQkJCWlmIChzZCAhPSBudWxsKSBpbnRDaGVjayhzZCwgMSwgTUFYKTsKCQkJCQkJcmV0dXJuIGZvcm1hdCh0aGlzLCBzZCwgcm0sIDIpOwoJCQkJCX07CgoJCQkJCS8qCiAgICAgKiBSZXR1cm4gYSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSB2YWx1ZSBvZiB0aGlzIEJpZ051bWJlciBpbiBiYXNlIGIsIG9yIGJhc2UgMTAgaWYgYiBpcwogICAgICogb21pdHRlZC4gSWYgYSBiYXNlIGlzIHNwZWNpZmllZCwgaW5jbHVkaW5nIGJhc2UgMTAsIHJvdW5kIGFjY29yZGluZyB0byBERUNJTUFMX1BMQUNFUyBhbmQKICAgICAqIFJPVU5ESU5HX01PREUuIElmIGEgYmFzZSBpcyBub3Qgc3BlY2lmaWVkLCBhbmQgdGhpcyBCaWdOdW1iZXIgaGFzIGEgcG9zaXRpdmUgZXhwb25lbnQKICAgICAqIHRoYXQgaXMgZXF1YWwgdG8gb3IgZ3JlYXRlciB0aGFuIFRPX0VYUF9QT1MsIG9yIGEgbmVnYXRpdmUgZXhwb25lbnQgZXF1YWwgdG8gb3IgbGVzcyB0aGFuCiAgICAgKiBUT19FWFBfTkVHLCByZXR1cm4gZXhwb25lbnRpYWwgbm90YXRpb24uCiAgICAgKgogICAgICogW2JdIHtudW1iZXJ9IEludGVnZXIsIDIgdG8gQUxQSEFCRVQubGVuZ3RoIGluY2x1c2l2ZS4KICAgICAqCiAgICAgKiAnW0JpZ051bWJlciBFcnJvcl0gQmFzZSB7bm90IGEgcHJpbWl0aXZlIG51bWJlcnxub3QgYW4gaW50ZWdlcnxvdXQgb2YgcmFuZ2V9OiB7Yn0nCiAgICAgKi8KCQkJCQlQLnRvU3RyaW5nID0gZnVuY3Rpb24oYikgewoJCQkJCQl2YXIgc3RyLAoJCQkJCQkJbiA9IHRoaXMsCgkJCQkJCQlzID0gbi5zLAoJCQkJCQkJZSA9IG4uZTsKCgkJCQkJCS8vIEluZmluaXR5IG9yIE5hTj8KCQkJCQkJaWYgKGUgPT09IG51bGwpIHsKCQkJCQkJCWlmIChzKSB7CgkJCQkJCQkJc3RyID0gJ0luZmluaXR5JzsKCQkJCQkJCQlpZiAocyA8IDApIHN0ciA9ICctJyArIHN0cjsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJc3RyID0gJ05hTic7CgkJCQkJCQl9CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlpZiAoYiA9PSBudWxsKSB7CgkJCQkJCQkJc3RyID0gZSA8PSBUT19FWFBfTkVHIHx8IGUgPj0gVE9fRVhQX1BPUyA/IHRvRXhwb25lbnRpYWwoY29lZmZUb1N0cmluZyhuLmMpLCBlKSA6IHRvRml4ZWRQb2ludChjb2VmZlRvU3RyaW5nKG4uYyksIGUsICcwJyk7CgkJCQkJCQl9IGVsc2UgaWYgKGIgPT09IDEwICYmIGFscGhhYmV0SGFzTm9ybWFsRGVjaW1hbERpZ2l0cykgewoJCQkJCQkJCW4gPSByb3VuZChuZXcgQmlnTnVtYmVyKG4pLCBERUNJTUFMX1BMQUNFUyArIGUgKyAxLCBST1VORElOR19NT0RFKTsKCQkJCQkJCQlzdHIgPSB0b0ZpeGVkUG9pbnQoY29lZmZUb1N0cmluZyhuLmMpLCBuLmUsICcwJyk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCWludENoZWNrKGIsIDIsIEFMUEhBQkVULmxlbmd0aCwgJ0Jhc2UnKTsKCQkJCQkJCQlzdHIgPSBjb252ZXJ0QmFzZSh0b0ZpeGVkUG9pbnQoY29lZmZUb1N0cmluZyhuLmMpLCBlLCAnMCcpLCAxMCwgYiwgcywgdHJ1ZSk7CgkJCQkJCQl9CgkJCQkJCQlpZiAocyA8IDAgJiYgbi5jWzBdKSBzdHIgPSAnLScgKyBzdHI7CgkJCQkJCX0KCQkJCQkJcmV0dXJuIHN0cjsKCQkJCQl9OwoKCQkJCQkvKgogICAgICogUmV0dXJuIGFzIHRvU3RyaW5nLCBidXQgZG8gbm90IGFjY2VwdCBhIGJhc2UgYXJndW1lbnQsIGFuZCBpbmNsdWRlIHRoZSBtaW51cyBzaWduIGZvcgogICAgICogbmVnYXRpdmUgemVyby4KICAgICAqLwoJCQkJCVAudmFsdWVPZiA9IFAudG9KU09OID0gZnVuY3Rpb24oKSB7CgkJCQkJCXJldHVybiB2YWx1ZU9mKHRoaXMpOwoJCQkJCX07CgkJCQkJUC5faXNCaWdOdW1iZXIgPSB0cnVlOwoJCQkJCWlmIChjb25maWdPYmplY3QgIT0gbnVsbCkgQmlnTnVtYmVyLnNldChjb25maWdPYmplY3QpOwoJCQkJCXJldHVybiBCaWdOdW1iZXI7CgkJCQl9CgoJCQkJLy8gUFJJVkFURSBIRUxQRVIgRlVOQ1RJT05TCgoJCQkJLy8gVGhlc2UgZnVuY3Rpb25zIGRvbid0IG5lZWQgYWNjZXNzIHRvIHZhcmlhYmxlcywKCQkJCS8vIGUuZy4gREVDSU1BTF9QTEFDRVMsIGluIHRoZSBzY29wZSBvZiB0aGUgYGNsb25lYCBmdW5jdGlvbiBhYm92ZS4KCgkJCQlmdW5jdGlvbiBiaXRGbG9vcihuKSB7CgkJCQkJdmFyIGkgPSBuIHwgMDsKCQkJCQlyZXR1cm4gbiA+IDAgfHwgbiA9PT0gaSA/IGkgOiBpIC0gMTsKCQkJCX0KCgkJCQkvLyBSZXR1cm4gYSBjb2VmZmljaWVudCBhcnJheSBhcyBhIHN0cmluZyBvZiBiYXNlIDEwIGRpZ2l0cy4KCQkJCWZ1bmN0aW9uIGNvZWZmVG9TdHJpbmcoYSkgewoJCQkJCXZhciBzLAoJCQkJCQl6LAoJCQkJCQlpID0gMSwKCQkJCQkJaiA9IGEubGVuZ3RoLAoJCQkJCQlyID0gYVswXSArICcnOwoJCQkJCWZvciAoOyBpIDwgajspIHsKCQkJCQkJcyA9IGFbaSsrXSArICcnOwoJCQkJCQl6ID0gTE9HX0JBU0UgLSBzLmxlbmd0aDsKCQkJCQkJZm9yICg7IHotLTsgcyA9ICcwJyArIHMpIDsKCQkJCQkJciArPSBzOwoJCQkJCX0KCgkJCQkJLy8gRGV0ZXJtaW5lIHRyYWlsaW5nIHplcm9zLgoJCQkJCWZvciAoaiA9IHIubGVuZ3RoOyByLmNoYXJDb2RlQXQoLS1qKSA9PT0gNDg7KSA7CgkJCQkJcmV0dXJuIHIuc2xpY2UoMCwgaiArIDEgfHwgMSk7CgkJCQl9CgoJCQkJLy8gQ29tcGFyZSB0aGUgdmFsdWUgb2YgQmlnTnVtYmVycyB4IGFuZCB5LgoJCQkJZnVuY3Rpb24gY29tcGFyZSh4LCB5KSB7CgkJCQkJdmFyIGEsCgkJCQkJCWIsCgkJCQkJCXhjID0geC5jLAoJCQkJCQl5YyA9IHkuYywKCQkJCQkJaSA9IHgucywKCQkJCQkJaiA9IHkucywKCQkJCQkJayA9IHguZSwKCQkJCQkJbCA9IHkuZTsKCgkJCQkJLy8gRWl0aGVyIE5hTj8KCQkJCQlpZiAoIWkgfHwgIWopIHJldHVybiBudWxsOwoJCQkJCWEgPSB4YyAmJiAheGNbMF07CgkJCQkJYiA9IHljICYmICF5Y1swXTsKCgkJCQkJLy8gRWl0aGVyIHplcm8/CgkJCQkJaWYgKGEgfHwgYikgcmV0dXJuIGEgPyBiID8gMCA6IC1qIDogaTsKCgkJCQkJLy8gU2lnbnMgZGlmZmVyPwoJCQkJCWlmIChpICE9IGopIHJldHVybiBpOwoJCQkJCWEgPSBpIDwgMDsKCQkJCQliID0gayA9PSBsOwoKCQkJCQkvLyBFaXRoZXIgSW5maW5pdHk/CgkJCQkJaWYgKCF4YyB8fCAheWMpIHJldHVybiBiID8gMCA6ICF4YyBeIGEgPyAxIDogLTE7CgoJCQkJCS8vIENvbXBhcmUgZXhwb25lbnRzLgoJCQkJCWlmICghYikgcmV0dXJuIGsgPiBsIF4gYSA/IDEgOiAtMTsKCQkJCQlqID0gKGsgPSB4Yy5sZW5ndGgpIDwgKGwgPSB5Yy5sZW5ndGgpID8gayA6IGw7CgoJCQkJCS8vIENvbXBhcmUgZGlnaXQgYnkgZGlnaXQuCgkJCQkJZm9yIChpID0gMDsgaSA8IGo7IGkrKykgaWYgKHhjW2ldICE9IHljW2ldKSByZXR1cm4geGNbaV0gPiB5Y1tpXSBeIGEgPyAxIDogLTE7CgoJCQkJCS8vIENvbXBhcmUgbGVuZ3Rocy4KCQkJCQlyZXR1cm4gayA9PSBsID8gMCA6IGsgPiBsIF4gYSA/IDEgOiAtMTsKCQkJCX0KCgkJCQkvKgogICAqIENoZWNrIHRoYXQgbiBpcyBhIHByaW1pdGl2ZSBudW1iZXIsIGFuIGludGVnZXIsIGFuZCBpbiByYW5nZSwgb3RoZXJ3aXNlIHRocm93LgogICAqLwoJCQkJZnVuY3Rpb24gaW50Q2hlY2sobiwgbWluLCBtYXgsIG5hbWUpIHsKCQkJCQlpZiAobiA8IG1pbiB8fCBuID4gbWF4IHx8IG4gIT09IG1hdGhmbG9vcihuKSkgewoJCQkJCQl0aHJvdyBFcnJvcihiaWdudW1iZXJFcnJvciArIChuYW1lIHx8ICdBcmd1bWVudCcpICsgKHR5cGVvZiBuID09ICdudW1iZXInID8gbiA8IG1pbiB8fCBuID4gbWF4ID8gJyBvdXQgb2YgcmFuZ2U6ICcgOiAnIG5vdCBhbiBpbnRlZ2VyOiAnIDogJyBub3QgYSBwcmltaXRpdmUgbnVtYmVyOiAnKSArIFN0cmluZyhuKSk7CgkJCQkJfQoJCQkJfQoKCQkJCS8vIEFzc3VtZXMgZmluaXRlIG4uCgkJCQlmdW5jdGlvbiBpc09kZChuKSB7CgkJCQkJdmFyIGsgPSBuLmMubGVuZ3RoIC0gMTsKCQkJCQlyZXR1cm4gYml0Rmxvb3Iobi5lIC8gTE9HX0JBU0UpID09IGsgJiYgbi5jW2tdICUgMiAhPSAwOwoJCQkJfQoKCQkJCWZ1bmN0aW9uIHRvRXhwb25lbnRpYWwoc3RyLCBlKSB7CgkJCQkJcmV0dXJuIChzdHIubGVuZ3RoID4gMSA/IHN0ci5jaGFyQXQoMCkgKyAnLicgKyBzdHIuc2xpY2UoMSkgOiBzdHIpICsgKGUgPCAwID8gJ2UnIDogJ2UrJykgKyBlOwoJCQkJfQoKCQkJCWZ1bmN0aW9uIHRvRml4ZWRQb2ludChzdHIsIGUsIHopIHsKCQkJCQl2YXIgbGVuLCB6czsKCgkJCQkJLy8gTmVnYXRpdmUgZXhwb25lbnQ/CgkJCQkJaWYgKGUgPCAwKSB7CgkJCQkJCS8vIFByZXBlbmQgemVyb3MuCgkJCQkJCWZvciAoenMgPSB6ICsgJy4nOyArK2U7IHpzICs9IHopIDsKCQkJCQkJc3RyID0genMgKyBzdHI7CgoJCQkJCQkvLyBQb3NpdGl2ZSBleHBvbmVudAoJCQkJCX0gZWxzZSB7CgkJCQkJCWxlbiA9IHN0ci5sZW5ndGg7CgoJCQkJCQkvLyBBcHBlbmQgemVyb3MuCgkJCQkJCWlmICgrK2UgPiBsZW4pIHsKCQkJCQkJCWZvciAoenMgPSB6LCBlIC09IGxlbjsgLS1lOyB6cyArPSB6KSA7CgkJCQkJCQlzdHIgKz0genM7CgkJCQkJCX0gZWxzZSBpZiAoZSA8IGxlbikgewoJCQkJCQkJc3RyID0gc3RyLnNsaWNlKDAsIGUpICsgJy4nICsgc3RyLnNsaWNlKGUpOwoJCQkJCQl9CgkJCQkJfQoJCQkJCXJldHVybiBzdHI7CgkJCQl9CgoJCQkJLy8gRVhQT1JUCgoJCQkJQmlnTnVtYmVyID0gY2xvbmUoKTsKCQkJCUJpZ051bWJlclsnZGVmYXVsdCddID0gQmlnTnVtYmVyLkJpZ051bWJlciA9IEJpZ051bWJlcjsKCgkJCQkvLyBBTUQuCgkJCQlpZiAodHJ1ZSkgewoJCQkJCSEoX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18gPSAoZnVuY3Rpb24oKSB7CgkJCQkJCXJldHVybiBCaWdOdW1iZXI7CgkJCQkJfSkuY2FsbChleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fLCBleHBvcnRzLCBtb2R1bGUpLAoJCQkJCV9fV0VCUEFDS19BTURfREVGSU5FX1JFU1VMVF9fICE9PSB1bmRlZmluZWQgJiYgKG1vZHVsZS5leHBvcnRzID0gX19XRUJQQUNLX0FNRF9ERUZJTkVfUkVTVUxUX18pKTsKCgkJCQkJLy8gTm9kZS5qcyBhbmQgb3RoZXIgZW52aXJvbm1lbnRzIHRoYXQgc3VwcG9ydCBtb2R1bGUuZXhwb3J0cy4KCQkJCX0gZWxzZSB7CgkJCQl9CgkJCX0pKHRoaXMpOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMjc0MToKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQ1MTQpOwoJCQltb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oNTE2NSkuUmVnRXhwLmVzY2FwZTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDQ4MTA6CgkJLyoqKi8gKChtb2R1bGUpID0+IHsKCgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpIHsKCQkJCWlmICh0eXBlb2YgaXQgIT0gJ2Z1bmN0aW9uJykgdGhyb3cgVHlwZUVycm9yKGl0ICsgJyBpcyBub3QgYSBmdW5jdGlvbiEnKTsKCQkJCXJldHVybiBpdDsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDIxODc6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJdmFyIGNvZiA9IF9fd2VicGFja19yZXF1aXJlX18oMjQzNCk7CgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQsIG1zZykgewoJCQkJaWYgKHR5cGVvZiBpdCAhPSAnbnVtYmVyJyAmJiBjb2YoaXQpICE9ICdOdW1iZXInKSB0aHJvdyBUeXBlRXJyb3IobXNnKTsKCQkJCXJldHVybiAraXQ7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA0NTUzOgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIyLjEuMy4zMSBBcnJheS5wcm90b3R5cGVbQEB1bnNjb3BhYmxlc10KCQkJdmFyIFVOU0NPUEFCTEVTID0gX193ZWJwYWNrX3JlcXVpcmVfXygyODY3KSgndW5zY29wYWJsZXMnKTsKCQkJdmFyIEFycmF5UHJvdG8gPSBBcnJheS5wcm90b3R5cGU7CgkJCWlmIChBcnJheVByb3RvW1VOU0NPUEFCTEVTXSA9PSB1bmRlZmluZWQpIF9fd2VicGFja19yZXF1aXJlX18oOTAzNikoQXJyYXlQcm90bywgVU5TQ09QQUJMRVMsIHt9KTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihrZXkpIHsKCQkJCUFycmF5UHJvdG9bVU5TQ09QQUJMRVNdW2tleV0gPSB0cnVlOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNjY5MzoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyIGF0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NzMwKSh0cnVlKTsKCi8vIGBBZHZhbmNlU3RyaW5nSW5kZXhgIGFic3RyYWN0IG9wZXJhdGlvbgovLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1hZHZhbmNlc3RyaW5naW5kZXgKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihTLCBpbmRleCwgdW5pY29kZSkgewoJCQkJcmV0dXJuIGluZGV4ICsgKHVuaWNvZGUgPyBhdChTLCBpbmRleCkubGVuZ3RoIDogMSk7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA4NjczOgoJCS8qKiovICgobW9kdWxlKSA9PiB7CgoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0LCBDb25zdHJ1Y3RvciwgbmFtZSwgZm9yYmlkZGVuRmllbGQpIHsKCQkJCWlmICghKGl0IGluc3RhbmNlb2YgQ29uc3RydWN0b3IpIHx8IGZvcmJpZGRlbkZpZWxkICE9PSB1bmRlZmluZWQgJiYgZm9yYmlkZGVuRmllbGQgaW4gaXQpIHsKCQkJCQl0aHJvdyBUeXBlRXJyb3IobmFtZSArICc6IGluY29ycmVjdCBpbnZvY2F0aW9uIScpOwoJCQkJfQoJCQkJcmV0dXJuIGl0OwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNjE2NjoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2ODYpOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KSB7CgkJCQlpZiAoIWlzT2JqZWN0KGl0KSkgdGhyb3cgVHlwZUVycm9yKGl0ICsgJyBpcyBub3QgYW4gb2JqZWN0IScpOwoJCQkJcmV0dXJuIGl0OwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMTI3MDoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7Ci8vIDIyLjEuMy4zIEFycmF5LnByb3RvdHlwZS5jb3B5V2l0aGluKHRhcmdldCwgc3RhcnQsIGVuZCA9IHRoaXMubGVuZ3RoKQoKCgkJCXZhciB0b09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNDgyMCk7CgkJCXZhciB0b0Fic29sdXRlSW5kZXggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc0NDMpOwoJCQl2YXIgdG9MZW5ndGggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUyMDEpOwoJCQltb2R1bGUuZXhwb3J0cyA9IFtdLmNvcHlXaXRoaW4gfHwgZnVuY3Rpb24gY29weVdpdGhpbih0YXJnZXQgLyogPSAwICovLCBzdGFydCAvKiA9IDAsIGVuZCA9IEBsZW5ndGggKi8pIHsKCQkJCXZhciBPID0gdG9PYmplY3QodGhpcyk7CgkJCQl2YXIgbGVuID0gdG9MZW5ndGgoTy5sZW5ndGgpOwoJCQkJdmFyIHRvID0gdG9BYnNvbHV0ZUluZGV4KHRhcmdldCwgbGVuKTsKCQkJCXZhciBmcm9tID0gdG9BYnNvbHV0ZUluZGV4KHN0YXJ0LCBsZW4pOwoJCQkJdmFyIGVuZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkOwoJCQkJdmFyIGNvdW50ID0gTWF0aC5taW4oKGVuZCA9PT0gdW5kZWZpbmVkID8gbGVuIDogdG9BYnNvbHV0ZUluZGV4KGVuZCwgbGVuKSkgLSBmcm9tLCBsZW4gLSB0byk7CgkJCQl2YXIgaW5jID0gMTsKCQkJCWlmIChmcm9tIDwgdG8gJiYgdG8gPCBmcm9tICsgY291bnQpIHsKCQkJCQlpbmMgPSAtMTsKCQkJCQlmcm9tICs9IGNvdW50IC0gMTsKCQkJCQl0byArPSBjb3VudCAtIDE7CgkJCQl9CgkJCQl3aGlsZSAoY291bnQtLSA+IDApIHsKCQkJCQlpZiAoZnJvbSBpbiBPKSBPW3RvXSA9IE9bZnJvbV07IGVsc2UgZGVsZXRlIE9bdG9dOwoJCQkJCXRvICs9IGluYzsKCQkJCQlmcm9tICs9IGluYzsKCQkJCX0KCQkJCXJldHVybiBPOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMzoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7Ci8vIDIyLjEuMy42IEFycmF5LnByb3RvdHlwZS5maWxsKHZhbHVlLCBzdGFydCA9IDAsIGVuZCA9IHRoaXMubGVuZ3RoKQoKCgkJCXZhciB0b09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNDgyMCk7CgkJCXZhciB0b0Fic29sdXRlSW5kZXggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc0NDMpOwoJCQl2YXIgdG9MZW5ndGggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUyMDEpOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGZpbGwodmFsdWUgLyogLCBzdGFydCA9IDAsIGVuZCA9IEBsZW5ndGggKi8pIHsKCQkJCXZhciBPID0gdG9PYmplY3QodGhpcyk7CgkJCQl2YXIgbGVuZ3RoID0gdG9MZW5ndGgoTy5sZW5ndGgpOwoJCQkJdmFyIGFMZW4gPSBhcmd1bWVudHMubGVuZ3RoOwoJCQkJdmFyIGluZGV4ID0gdG9BYnNvbHV0ZUluZGV4KGFMZW4gPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkLCBsZW5ndGgpOwoJCQkJdmFyIGVuZCA9IGFMZW4gPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkOwoJCQkJdmFyIGVuZFBvcyA9IGVuZCA9PT0gdW5kZWZpbmVkID8gbGVuZ3RoIDogdG9BYnNvbHV0ZUluZGV4KGVuZCwgbGVuZ3RoKTsKCQkJCXdoaWxlIChlbmRQb3MgPiBpbmRleCkgT1tpbmRleCsrXSA9IHZhbHVlOwoJCQkJcmV0dXJuIE87CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA4MTgyOgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciBmb3JPZiA9IF9fd2VicGFja19yZXF1aXJlX18oMzM4OSk7CgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXRlciwgSVRFUkFUT1IpIHsKCQkJCXZhciByZXN1bHQgPSBbXTsKCQkJCWZvck9mKGl0ZXIsIGZhbHNlLCByZXN1bHQucHVzaCwgcmVzdWx0LCBJVEVSQVRPUik7CgkJCQlyZXR1cm4gcmVzdWx0OwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNjg4OToKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyBmYWxzZSAtPiBBcnJheSNpbmRleE9mCi8vIHRydWUgIC0+IEFycmF5I2luY2x1ZGVzCgkJCXZhciB0b0lPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzMDkpOwoJCQl2YXIgdG9MZW5ndGggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUyMDEpOwoJCQl2YXIgdG9BYnNvbHV0ZUluZGV4ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NDQzKTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihJU19JTkNMVURFUykgewoJCQkJcmV0dXJuIGZ1bmN0aW9uKCR0aGlzLCBlbCwgZnJvbUluZGV4KSB7CgkJCQkJdmFyIE8gPSB0b0lPYmplY3QoJHRoaXMpOwoJCQkJCXZhciBsZW5ndGggPSB0b0xlbmd0aChPLmxlbmd0aCk7CgkJCQkJdmFyIGluZGV4ID0gdG9BYnNvbHV0ZUluZGV4KGZyb21JbmRleCwgbGVuZ3RoKTsKCQkJCQl2YXIgdmFsdWU7CgkJCQkJLy8gQXJyYXkjaW5jbHVkZXMgdXNlcyBTYW1lVmFsdWVaZXJvIGVxdWFsaXR5IGFsZ29yaXRobQoJCQkJCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmUKCQkJCQlpZiAoSVNfSU5DTFVERVMgJiYgZWwgIT0gZWwpIHdoaWxlIChsZW5ndGggPiBpbmRleCkgewoJCQkJCQl2YWx1ZSA9IE9baW5kZXgrK107CgkJCQkJCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmUKCQkJCQkJaWYgKHZhbHVlICE9IHZhbHVlKSByZXR1cm4gdHJ1ZTsKCQkJCQkJLy8gQXJyYXkjaW5kZXhPZiBpZ25vcmVzIGhvbGVzLCBBcnJheSNpbmNsdWRlcyAtIG5vdAoJCQkJCX0gZWxzZSBmb3IgKDsgbGVuZ3RoID4gaW5kZXg7IGluZGV4KyspIGlmIChJU19JTkNMVURFUyB8fCBpbmRleCBpbiBPKSB7CgkJCQkJCWlmIChPW2luZGV4XSA9PT0gZWwpIHJldHVybiBJU19JTkNMVURFUyB8fCBpbmRleCB8fCAwOwoJCQkJCX0KCQkJCQlyZXR1cm4gIUlTX0lOQ0xVREVTICYmIC0xOwoJCQkJfTsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDk1Njk6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMCAtPiBBcnJheSNmb3JFYWNoCi8vIDEgLT4gQXJyYXkjbWFwCi8vIDIgLT4gQXJyYXkjZmlsdGVyCi8vIDMgLT4gQXJyYXkjc29tZQovLyA0IC0+IEFycmF5I2V2ZXJ5Ci8vIDUgLT4gQXJyYXkjZmluZAovLyA2IC0+IEFycmF5I2ZpbmRJbmRleAoJCQl2YXIgY3R4ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4NTYzKTsKCQkJdmFyIElPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU4NzQpOwoJCQl2YXIgdG9PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ4MjApOwoJCQl2YXIgdG9MZW5ndGggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUyMDEpOwoJCQl2YXIgYXNjID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0NTcwKTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihUWVBFLCAkY3JlYXRlKSB7CgkJCQl2YXIgSVNfTUFQID0gVFlQRSA9PSAxOwoJCQkJdmFyIElTX0ZJTFRFUiA9IFRZUEUgPT0gMjsKCQkJCXZhciBJU19TT01FID0gVFlQRSA9PSAzOwoJCQkJdmFyIElTX0VWRVJZID0gVFlQRSA9PSA0OwoJCQkJdmFyIElTX0ZJTkRfSU5ERVggPSBUWVBFID09IDY7CgkJCQl2YXIgTk9fSE9MRVMgPSBUWVBFID09IDUgfHwgSVNfRklORF9JTkRFWDsKCQkJCXZhciBjcmVhdGUgPSAkY3JlYXRlIHx8IGFzYzsKCQkJCXJldHVybiBmdW5jdGlvbigkdGhpcywgY2FsbGJhY2tmbiwgdGhhdCkgewoJCQkJCXZhciBPID0gdG9PYmplY3QoJHRoaXMpOwoJCQkJCXZhciBzZWxmID0gSU9iamVjdChPKTsKCQkJCQl2YXIgZiA9IGN0eChjYWxsYmFja2ZuLCB0aGF0LCAzKTsKCQkJCQl2YXIgbGVuZ3RoID0gdG9MZW5ndGgoc2VsZi5sZW5ndGgpOwoJCQkJCXZhciBpbmRleCA9IDA7CgkJCQkJdmFyIHJlc3VsdCA9IElTX01BUCA/IGNyZWF0ZSgkdGhpcywgbGVuZ3RoKSA6IElTX0ZJTFRFUiA/IGNyZWF0ZSgkdGhpcywgMCkgOiB1bmRlZmluZWQ7CgkJCQkJdmFyIHZhbCwgcmVzOwoJCQkJCWZvciAoOyBsZW5ndGggPiBpbmRleDsgaW5kZXgrKykgaWYgKE5PX0hPTEVTIHx8IGluZGV4IGluIHNlbGYpIHsKCQkJCQkJdmFsID0gc2VsZltpbmRleF07CgkJCQkJCXJlcyA9IGYodmFsLCBpbmRleCwgTyk7CgkJCQkJCWlmIChUWVBFKSB7CgkJCQkJCQlpZiAoSVNfTUFQKSByZXN1bHRbaW5kZXhdID0gcmVzOyAvLyBtYXAKCQkJCQkJCWVsc2UgaWYgKHJlcykgc3dpdGNoIChUWVBFKSB7CgkJCQkJCQkJY2FzZSAzOgoJCQkJCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCQkJCQkvLyBzb21lCgkJCQkJCQkJY2FzZSA1OgoJCQkJCQkJCQlyZXR1cm4gdmFsOwoJCQkJCQkJCS8vIGZpbmQKCQkJCQkJCQljYXNlIDY6CgkJCQkJCQkJCXJldHVybiBpbmRleDsKCQkJCQkJCQkvLyBmaW5kSW5kZXgKCQkJCQkJCQljYXNlIDI6CgkJCQkJCQkJCXJlc3VsdC5wdXNoKHZhbCk7CgkJCQkJCQkJLy8gZmlsdGVyCgkJCQkJCQl9IGVsc2UgaWYgKElTX0VWRVJZKSByZXR1cm4gZmFsc2U7IC8vIGV2ZXJ5CgkJCQkJCX0KCQkJCQl9CgkJCQkJcmV0dXJuIElTX0ZJTkRfSU5ERVggPyAtMSA6IElTX1NPTUUgfHwgSVNfRVZFUlkgPyBJU19FVkVSWSA6IHJlc3VsdDsKCQkJCX07CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA1NzA4OgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciBhRnVuY3Rpb24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ4MTApOwoJCQl2YXIgdG9PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ4MjApOwoJCQl2YXIgSU9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNTg3NCk7CgkJCXZhciB0b0xlbmd0aCA9IF9fd2VicGFja19yZXF1aXJlX18oNTIwMSk7CgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24odGhhdCwgY2FsbGJhY2tmbiwgYUxlbiwgbWVtbywgaXNSaWdodCkgewoJCQkJYUZ1bmN0aW9uKGNhbGxiYWNrZm4pOwoJCQkJdmFyIE8gPSB0b09iamVjdCh0aGF0KTsKCQkJCXZhciBzZWxmID0gSU9iamVjdChPKTsKCQkJCXZhciBsZW5ndGggPSB0b0xlbmd0aChPLmxlbmd0aCk7CgkJCQl2YXIgaW5kZXggPSBpc1JpZ2h0ID8gbGVuZ3RoIC0gMSA6IDA7CgkJCQl2YXIgaSA9IGlzUmlnaHQgPyAtMSA6IDE7CgkJCQlpZiAoYUxlbiA8IDIpIGZvciAoOyA7KSB7CgkJCQkJaWYgKGluZGV4IGluIHNlbGYpIHsKCQkJCQkJbWVtbyA9IHNlbGZbaW5kZXhdOwoJCQkJCQlpbmRleCArPSBpOwoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQkJaW5kZXggKz0gaTsKCQkJCQlpZiAoaXNSaWdodCA/IGluZGV4IDwgMCA6IGxlbmd0aCA8PSBpbmRleCkgewoJCQkJCQl0aHJvdyBUeXBlRXJyb3IoJ1JlZHVjZSBvZiBlbXB0eSBhcnJheSB3aXRoIG5vIGluaXRpYWwgdmFsdWUnKTsKCQkJCQl9CgkJCQl9CgkJCQlmb3IgKDsgaXNSaWdodCA/IGluZGV4ID49IDAgOiBsZW5ndGggPiBpbmRleDsgaW5kZXggKz0gaSkgaWYgKGluZGV4IGluIHNlbGYpIHsKCQkJCQltZW1vID0gY2FsbGJhY2tmbihtZW1vLCBzZWxmW2luZGV4XSwgaW5kZXgsIE8pOwoJCQkJfQoJCQkJcmV0dXJuIG1lbW87CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA5MDIwOgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNDY4Nik7CgkJCXZhciBpc0FycmF5ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNTAyKTsKCQkJdmFyIFNQRUNJRVMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI4NjcpKCdzcGVjaWVzJyk7CgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ob3JpZ2luYWwpIHsKCQkJCXZhciBDOwoJCQkJaWYgKGlzQXJyYXkob3JpZ2luYWwpKSB7CgkJCQkJQyA9IG9yaWdpbmFsLmNvbnN0cnVjdG9yOwoJCQkJCS8vIGNyb3NzLXJlYWxtIGZhbGxiYWNrCgkJCQkJaWYgKHR5cGVvZiBDID09ICdmdW5jdGlvbicgJiYgKEMgPT09IEFycmF5IHx8IGlzQXJyYXkoQy5wcm90b3R5cGUpKSkgQyA9IHVuZGVmaW5lZDsKCQkJCQlpZiAoaXNPYmplY3QoQykpIHsKCQkJCQkJQyA9IENbU1BFQ0lFU107CgkJCQkJCWlmIChDID09PSBudWxsKSBDID0gdW5kZWZpbmVkOwoJCQkJCX0KCQkJCX0KCQkJCXJldHVybiBDID09PSB1bmRlZmluZWQgPyBBcnJheSA6IEM7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA0NTcwOgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDkuNC4yLjMgQXJyYXlTcGVjaWVzQ3JlYXRlKG9yaWdpbmFsQXJyYXksIGxlbmd0aCkKCQkJdmFyIHNwZWNpZXNDb25zdHJ1Y3RvciA9IF9fd2VicGFja19yZXF1aXJlX18oOTAyMCk7CgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ob3JpZ2luYWwsIGxlbmd0aCkgewoJCQkJcmV0dXJuIG5ldyAoc3BlY2llc0NvbnN0cnVjdG9yKG9yaWdpbmFsKSkobGVuZ3RoKTsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDQ3NzoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyIGFGdW5jdGlvbiA9IF9fd2VicGFja19yZXF1aXJlX18oNDgxMCk7CgkJCXZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNDY4Nik7CgkJCXZhciBpbnZva2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY5NDQpOwoJCQl2YXIgYXJyYXlTbGljZSA9IFtdLnNsaWNlOwoJCQl2YXIgZmFjdG9yaWVzID0ge307CgkJCXZhciBjb25zdHJ1Y3QgPSBmdW5jdGlvbiBjb25zdHJ1Y3QoRiwgbGVuLCBhcmdzKSB7CgkJCQlpZiAoIShsZW4gaW4gZmFjdG9yaWVzKSkgewoJCQkJCWZvciAodmFyIG4gPSBbXSwgaSA9IDA7IGkgPCBsZW47IGkrKykgbltpXSA9ICdhWycgKyBpICsgJ10nOwoJCQkJCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1uZXctZnVuYwoJCQkJCWZhY3Rvcmllc1tsZW5dID0gRnVuY3Rpb24oJ0YsYScsICdyZXR1cm4gbmV3IEYoJyArIG4uam9pbignLCcpICsgJyknKTsKCQkJCX0KCQkJCXJldHVybiBmYWN0b3JpZXNbbGVuXShGLCBhcmdzKTsKCQkJfTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBGdW5jdGlvbi5iaW5kIHx8IGZ1bmN0aW9uIGJpbmQodGhhdCAvKiAsIC4uLmFyZ3MgKi8pIHsKCQkJCXZhciBmbiA9IGFGdW5jdGlvbih0aGlzKTsKCQkJCXZhciBwYXJ0QXJncyA9IGFycmF5U2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwoJCQkJdmFyIGJvdW5kID0gZnVuY3Rpb24gYm91bmQoIC8qIGFyZ3MuLi4gKi8KCQkJCSkgewoJCQkJCXZhciBhcmdzID0gcGFydEFyZ3MuY29uY2F0KGFycmF5U2xpY2UuY2FsbChhcmd1bWVudHMpKTsKCQkJCQlyZXR1cm4gdGhpcyBpbnN0YW5jZW9mIGJvdW5kID8gY29uc3RydWN0KGZuLCBhcmdzLmxlbmd0aCwgYXJncykgOiBpbnZva2UoZm4sIGFyZ3MsIHRoYXQpOwoJCQkJfTsKCQkJCWlmIChpc09iamVjdChmbi5wcm90b3R5cGUpKSBib3VuZC5wcm90b3R5cGUgPSBmbi5wcm90b3R5cGU7CgkJCQlyZXR1cm4gYm91bmQ7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA5MzQ6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gZ2V0dGluZyB0YWcgZnJvbSAxOS4xLjMuNiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nKCkKCQkJdmFyIGNvZiA9IF9fd2VicGFja19yZXF1aXJlX18oMjQzNCk7CgkJCXZhciBUQUcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI4NjcpKCd0b1N0cmluZ1RhZycpOwovLyBFUzMgd3JvbmcgaGVyZQoJCQl2YXIgQVJHID0gY29mKGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuIGFyZ3VtZW50czsKCQkJfSgpKSA9PSAnQXJndW1lbnRzJzsKCi8vIGZhbGxiYWNrIGZvciBJRTExIFNjcmlwdCBBY2Nlc3MgRGVuaWVkIGVycm9yCgkJCXZhciB0cnlHZXQgPSBmdW5jdGlvbiB0cnlHZXQoaXQsIGtleSkgewoJCQkJdHJ5IHsKCQkJCQlyZXR1cm4gaXRba2V5XTsKCQkJCX0gY2F0Y2ggKGUpIHsvKiBlbXB0eSAqLwoJCQkJfQoJCQl9OwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KSB7CgkJCQl2YXIgTywgVCwgQjsKCQkJCXJldHVybiBpdCA9PT0gdW5kZWZpbmVkID8gJ1VuZGVmaW5lZCcgOiBpdCA9PT0gbnVsbCA/ICdOdWxsJwoJCQkJCS8vIEBAdG9TdHJpbmdUYWcgY2FzZQoJCQkJCTogdHlwZW9mIChUID0gdHJ5R2V0KE8gPSBPYmplY3QoaXQpLCBUQUcpKSA9PSAnc3RyaW5nJyA/IFQKCQkJCQkJLy8gYnVpbHRpblRhZyBjYXNlCgkJCQkJCTogQVJHID8gY29mKE8pCgkJCQkJCQkvLyBFUzMgYXJndW1lbnRzIGZhbGxiYWNrCgkJCQkJCQk6IChCID0gY29mKE8pKSA9PSAnT2JqZWN0JyAmJiB0eXBlb2YgTy5jYWxsZWUgPT0gJ2Z1bmN0aW9uJyA/ICdBcmd1bWVudHMnIDogQjsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDI0MzQ6CgkJLyoqKi8gKChtb2R1bGUpID0+IHsKCgkJCXZhciB0b1N0cmluZyA9IHt9LnRvU3RyaW5nOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KSB7CgkJCQlyZXR1cm4gdG9TdHJpbmcuY2FsbChpdCkuc2xpY2UoOCwgLTEpOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gOTcwOToKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyIGRQID0gKF9fd2VicGFja19yZXF1aXJlX18oMTUxNSkuZik7CgkJCXZhciBjcmVhdGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUxNDIpOwoJCQl2YXIgcmVkZWZpbmVBbGwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcxODUpOwoJCQl2YXIgY3R4ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4NTYzKTsKCQkJdmFyIGFuSW5zdGFuY2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg2NzMpOwoJCQl2YXIgZm9yT2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMzODkpOwoJCQl2YXIgJGl0ZXJEZWZpbmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg5MTUpOwoJCQl2YXIgc3RlcCA9IF9fd2VicGFja19yZXF1aXJlX18oOTQ5OCk7CgkJCXZhciBzZXRTcGVjaWVzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMzM0KTsKCQkJdmFyIERFU0NSSVBUT1JTID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MTk0KTsKCQkJdmFyIGZhc3RLZXkgPSAoX193ZWJwYWNrX3JlcXVpcmVfXygyMzY5KS5mYXN0S2V5KTsKCQkJdmFyIHZhbGlkYXRlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2ODEzKTsKCQkJdmFyIFNJWkUgPSBERVNDUklQVE9SUyA/ICdfcycgOiAnc2l6ZSc7CgkJCXZhciBnZXRFbnRyeSA9IGZ1bmN0aW9uIGdldEVudHJ5KHRoYXQsIGtleSkgewoJCQkJLy8gZmFzdCBjYXNlCgkJCQl2YXIgaW5kZXggPSBmYXN0S2V5KGtleSk7CgkJCQl2YXIgZW50cnk7CgkJCQlpZiAoaW5kZXggIT09ICdGJykgcmV0dXJuIHRoYXQuX2lbaW5kZXhdOwoJCQkJLy8gZnJvemVuIG9iamVjdCBjYXNlCgkJCQlmb3IgKGVudHJ5ID0gdGhhdC5fZjsgZW50cnk7IGVudHJ5ID0gZW50cnkubikgewoJCQkJCWlmIChlbnRyeS5rID09IGtleSkgcmV0dXJuIGVudHJ5OwoJCQkJfQoJCQl9OwoJCQltb2R1bGUuZXhwb3J0cyA9IHsKCQkJCWdldENvbnN0cnVjdG9yOiBmdW5jdGlvbiBnZXRDb25zdHJ1Y3Rvcih3cmFwcGVyLCBOQU1FLCBJU19NQVAsIEFEREVSKSB7CgkJCQkJdmFyIEMgPSB3cmFwcGVyKGZ1bmN0aW9uKHRoYXQsIGl0ZXJhYmxlKSB7CgkJCQkJCWFuSW5zdGFuY2UodGhhdCwgQywgTkFNRSwgJ19pJyk7CgkJCQkJCXRoYXQuX3QgPSBOQU1FOyAvLyBjb2xsZWN0aW9uIHR5cGUKCQkJCQkJdGhhdC5faSA9IGNyZWF0ZShudWxsKTsgLy8gaW5kZXgKCQkJCQkJdGhhdC5fZiA9IHVuZGVmaW5lZDsgLy8gZmlyc3QgZW50cnkKCQkJCQkJdGhhdC5fbCA9IHVuZGVmaW5lZDsgLy8gbGFzdCBlbnRyeQoJCQkJCQl0aGF0W1NJWkVdID0gMDsgLy8gc2l6ZQoJCQkJCQlpZiAoaXRlcmFibGUgIT0gdW5kZWZpbmVkKSBmb3JPZihpdGVyYWJsZSwgSVNfTUFQLCB0aGF0W0FEREVSXSwgdGhhdCk7CgkJCQkJfSk7CgkJCQkJcmVkZWZpbmVBbGwoQy5wcm90b3R5cGUsIHsKCQkJCQkJLy8gMjMuMS4zLjEgTWFwLnByb3RvdHlwZS5jbGVhcigpCgkJCQkJCS8vIDIzLjIuMy4yIFNldC5wcm90b3R5cGUuY2xlYXIoKQoJCQkJCQljbGVhcjogZnVuY3Rpb24gY2xlYXIoKSB7CgkJCQkJCQlmb3IgKHZhciB0aGF0ID0gdmFsaWRhdGUodGhpcywgTkFNRSksIGRhdGEgPSB0aGF0Ll9pLCBlbnRyeSA9IHRoYXQuX2Y7IGVudHJ5OyBlbnRyeSA9IGVudHJ5Lm4pIHsKCQkJCQkJCQllbnRyeS5yID0gdHJ1ZTsKCQkJCQkJCQlpZiAoZW50cnkucCkgZW50cnkucCA9IGVudHJ5LnAubiA9IHVuZGVmaW5lZDsKCQkJCQkJCQlkZWxldGUgZGF0YVtlbnRyeS5pXTsKCQkJCQkJCX0KCQkJCQkJCXRoYXQuX2YgPSB0aGF0Ll9sID0gdW5kZWZpbmVkOwoJCQkJCQkJdGhhdFtTSVpFXSA9IDA7CgkJCQkJCX0sCgkJCQkJCS8vIDIzLjEuMy4zIE1hcC5wcm90b3R5cGUuZGVsZXRlKGtleSkKCQkJCQkJLy8gMjMuMi4zLjQgU2V0LnByb3RvdHlwZS5kZWxldGUodmFsdWUpCgkJCQkJCSdkZWxldGUnOiBmdW5jdGlvbiBfZGVsZXRlKGtleSkgewoJCQkJCQkJdmFyIHRoYXQgPSB2YWxpZGF0ZSh0aGlzLCBOQU1FKTsKCQkJCQkJCXZhciBlbnRyeSA9IGdldEVudHJ5KHRoYXQsIGtleSk7CgkJCQkJCQlpZiAoZW50cnkpIHsKCQkJCQkJCQl2YXIgbmV4dCA9IGVudHJ5Lm47CgkJCQkJCQkJdmFyIHByZXYgPSBlbnRyeS5wOwoJCQkJCQkJCWRlbGV0ZSB0aGF0Ll9pW2VudHJ5LmldOwoJCQkJCQkJCWVudHJ5LnIgPSB0cnVlOwoJCQkJCQkJCWlmIChwcmV2KSBwcmV2Lm4gPSBuZXh0OwoJCQkJCQkJCWlmIChuZXh0KSBuZXh0LnAgPSBwcmV2OwoJCQkJCQkJCWlmICh0aGF0Ll9mID09IGVudHJ5KSB0aGF0Ll9mID0gbmV4dDsKCQkJCQkJCQlpZiAodGhhdC5fbCA9PSBlbnRyeSkgdGhhdC5fbCA9IHByZXY7CgkJCQkJCQkJdGhhdFtTSVpFXS0tOwoJCQkJCQkJfQoJCQkJCQkJcmV0dXJuICEhZW50cnk7CgkJCQkJCX0sCgkJCQkJCS8vIDIzLjIuMy42IFNldC5wcm90b3R5cGUuZm9yRWFjaChjYWxsYmFja2ZuLCB0aGlzQXJnID0gdW5kZWZpbmVkKQoJCQkJCQkvLyAyMy4xLjMuNSBNYXAucHJvdG90eXBlLmZvckVhY2goY2FsbGJhY2tmbiwgdGhpc0FyZyA9IHVuZGVmaW5lZCkKCQkJCQkJZm9yRWFjaDogZnVuY3Rpb24gZm9yRWFjaChjYWxsYmFja2ZuIC8qICwgdGhhdCA9IHVuZGVmaW5lZCAqLykgewoJCQkJCQkJdmFsaWRhdGUodGhpcywgTkFNRSk7CgkJCQkJCQl2YXIgZiA9IGN0eChjYWxsYmFja2ZuLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCwgMyk7CgkJCQkJCQl2YXIgZW50cnk7CgkJCQkJCQl3aGlsZSAoZW50cnkgPSBlbnRyeSA/IGVudHJ5Lm4gOiB0aGlzLl9mKSB7CgkJCQkJCQkJZihlbnRyeS52LCBlbnRyeS5rLCB0aGlzKTsKCQkJCQkJCQkvLyByZXZlcnQgdG8gdGhlIGxhc3QgZXhpc3RpbmcgZW50cnkKCQkJCQkJCQl3aGlsZSAoZW50cnkgJiYgZW50cnkucikgZW50cnkgPSBlbnRyeS5wOwoJCQkJCQkJfQoJCQkJCQl9LAoJCQkJCQkvLyAyMy4xLjMuNyBNYXAucHJvdG90eXBlLmhhcyhrZXkpCgkJCQkJCS8vIDIzLjIuMy43IFNldC5wcm90b3R5cGUuaGFzKHZhbHVlKQoJCQkJCQloYXM6IGZ1bmN0aW9uIGhhcyhrZXkpIHsKCQkJCQkJCXJldHVybiAhIWdldEVudHJ5KHZhbGlkYXRlKHRoaXMsIE5BTUUpLCBrZXkpOwoJCQkJCQl9CgkJCQkJfSk7CgkJCQkJaWYgKERFU0NSSVBUT1JTKSBkUChDLnByb3RvdHlwZSwgJ3NpemUnLCB7CgkJCQkJCWdldDogZnVuY3Rpb24gZ2V0KCkgewoJCQkJCQkJcmV0dXJuIHZhbGlkYXRlKHRoaXMsIE5BTUUpW1NJWkVdOwoJCQkJCQl9CgkJCQkJfSk7CgkJCQkJcmV0dXJuIEM7CgkJCQl9LAoJCQkJZGVmOiBmdW5jdGlvbiBkZWYodGhhdCwga2V5LCB2YWx1ZSkgewoJCQkJCXZhciBlbnRyeSA9IGdldEVudHJ5KHRoYXQsIGtleSk7CgkJCQkJdmFyIHByZXYsIGluZGV4OwoJCQkJCS8vIGNoYW5nZSBleGlzdGluZyBlbnRyeQoJCQkJCWlmIChlbnRyeSkgewoJCQkJCQllbnRyeS52ID0gdmFsdWU7CgkJCQkJCS8vIGNyZWF0ZSBuZXcgZW50cnkKCQkJCQl9IGVsc2UgewoJCQkJCQl0aGF0Ll9sID0gZW50cnkgPSB7CgkJCQkJCQlpOiBpbmRleCA9IGZhc3RLZXkoa2V5LCB0cnVlKSwKCQkJCQkJCS8vIDwtIGluZGV4CgkJCQkJCQlrOiBrZXksCgkJCQkJCQkvLyA8LSBrZXkKCQkJCQkJCXY6IHZhbHVlLAoJCQkJCQkJLy8gPC0gdmFsdWUKCQkJCQkJCXA6IHByZXYgPSB0aGF0Ll9sLAoJCQkJCQkJLy8gPC0gcHJldmlvdXMgZW50cnkKCQkJCQkJCW46IHVuZGVmaW5lZCwKCQkJCQkJCS8vIDwtIG5leHQgZW50cnkKCQkJCQkJCXI6IGZhbHNlIC8vIDwtIHJlbW92ZWQKCQkJCQkJfTsKCQkJCQkJaWYgKCF0aGF0Ll9mKSB0aGF0Ll9mID0gZW50cnk7CgkJCQkJCWlmIChwcmV2KSBwcmV2Lm4gPSBlbnRyeTsKCQkJCQkJdGhhdFtTSVpFXSsrOwoJCQkJCQkvLyBhZGQgdG8gaW5kZXgKCQkJCQkJaWYgKGluZGV4ICE9PSAnRicpIHRoYXQuX2lbaW5kZXhdID0gZW50cnk7CgkJCQkJfQoJCQkJCXJldHVybiB0aGF0OwoJCQkJfSwKCQkJCWdldEVudHJ5OiBnZXRFbnRyeSwKCQkJCXNldFN0cm9uZzogZnVuY3Rpb24gc2V0U3Ryb25nKEMsIE5BTUUsIElTX01BUCkgewoJCQkJCS8vIGFkZCAua2V5cywgLnZhbHVlcywgLmVudHJpZXMsIFtAQGl0ZXJhdG9yXQoJCQkJCS8vIDIzLjEuMy40LCAyMy4xLjMuOCwgMjMuMS4zLjExLCAyMy4xLjMuMTIsIDIzLjIuMy41LCAyMy4yLjMuOCwgMjMuMi4zLjEwLCAyMy4yLjMuMTEKCQkJCQkkaXRlckRlZmluZShDLCBOQU1FLCBmdW5jdGlvbihpdGVyYXRlZCwga2luZCkgewoJCQkJCQl0aGlzLl90ID0gdmFsaWRhdGUoaXRlcmF0ZWQsIE5BTUUpOyAvLyB0YXJnZXQKCQkJCQkJdGhpcy5fayA9IGtpbmQ7IC8vIGtpbmQKCQkJCQkJdGhpcy5fbCA9IHVuZGVmaW5lZDsgLy8gcHJldmlvdXMKCQkJCQl9LCBmdW5jdGlvbigpIHsKCQkJCQkJdmFyIHRoYXQgPSB0aGlzOwoJCQkJCQl2YXIga2luZCA9IHRoYXQuX2s7CgkJCQkJCXZhciBlbnRyeSA9IHRoYXQuX2w7CgkJCQkJCS8vIHJldmVydCB0byB0aGUgbGFzdCBleGlzdGluZyBlbnRyeQoJCQkJCQl3aGlsZSAoZW50cnkgJiYgZW50cnkucikgZW50cnkgPSBlbnRyeS5wOwoJCQkJCQkvLyBnZXQgbmV4dCBlbnRyeQoJCQkJCQlpZiAoIXRoYXQuX3QgfHwgISh0aGF0Ll9sID0gZW50cnkgPSBlbnRyeSA/IGVudHJ5Lm4gOiB0aGF0Ll90Ll9mKSkgewoJCQkJCQkJLy8gb3IgZmluaXNoIHRoZSBpdGVyYXRpb24KCQkJCQkJCXRoYXQuX3QgPSB1bmRlZmluZWQ7CgkJCQkJCQlyZXR1cm4gc3RlcCgxKTsKCQkJCQkJfQoJCQkJCQkvLyByZXR1cm4gc3RlcCBieSBraW5kCgkJCQkJCWlmIChraW5kID09ICdrZXlzJykgcmV0dXJuIHN0ZXAoMCwgZW50cnkuayk7CgkJCQkJCWlmIChraW5kID09ICd2YWx1ZXMnKSByZXR1cm4gc3RlcCgwLCBlbnRyeS52KTsKCQkJCQkJcmV0dXJuIHN0ZXAoMCwgW2VudHJ5LmssIGVudHJ5LnZdKTsKCQkJCQl9LCBJU19NQVAgPyAnZW50cmllcycgOiAndmFsdWVzJywgIUlTX01BUCwgdHJ1ZSk7CgoJCQkJCS8vIGFkZCBbQEBzcGVjaWVzXSwgMjMuMS4yLjIsIDIzLjIuMi4yCgkJCQkJc2V0U3BlY2llcyhOQU1FKTsKCQkJCX0KCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDY2NzE6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gaHR0cHM6Ly9naXRodWIuY29tL0RhdmlkQnJ1YW50L01hcC1TZXQucHJvdG90eXBlLnRvSlNPTgoJCQl2YXIgY2xhc3NvZiA9IF9fd2VicGFja19yZXF1aXJlX18oOTM0KTsKCQkJdmFyIGZyb20gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgxODIpOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKE5BTUUpIHsKCQkJCXJldHVybiBmdW5jdGlvbiB0b0pTT04oKSB7CgkJCQkJaWYgKGNsYXNzb2YodGhpcykgIT0gTkFNRSkgdGhyb3cgVHlwZUVycm9yKE5BTUUgKyAnI3RvSlNPTiBpc25cJ3QgZ2VuZXJpYycpOwoJCQkJCXJldHVybiBmcm9tKHRoaXMpOwoJCQkJfTsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDc3MjoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyIHJlZGVmaW5lQWxsID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3MTg1KTsKCQkJdmFyIGdldFdlYWsgPSAoX193ZWJwYWNrX3JlcXVpcmVfXygyMzY5KS5nZXRXZWFrKTsKCQkJdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MTY2KTsKCQkJdmFyIGlzT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0Njg2KTsKCQkJdmFyIGFuSW5zdGFuY2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg2NzMpOwoJCQl2YXIgZm9yT2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMzODkpOwoJCQl2YXIgY3JlYXRlQXJyYXlNZXRob2QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk1NjkpOwoJCQl2YXIgJGhhcyA9IF9fd2VicGFja19yZXF1aXJlX18oNDk5Nyk7CgkJCXZhciB2YWxpZGF0ZSA9IF9fd2VicGFja19yZXF1aXJlX18oNjgxMyk7CgkJCXZhciBhcnJheUZpbmQgPSBjcmVhdGVBcnJheU1ldGhvZCg1KTsKCQkJdmFyIGFycmF5RmluZEluZGV4ID0gY3JlYXRlQXJyYXlNZXRob2QoNik7CgkJCXZhciBpZCA9IDA7CgovLyBmYWxsYmFjayBmb3IgdW5jYXVnaHQgZnJvemVuIGtleXMKCQkJdmFyIHVuY2F1Z2h0RnJvemVuU3RvcmUgPSBmdW5jdGlvbiB1bmNhdWdodEZyb3plblN0b3JlKHRoYXQpIHsKCQkJCXJldHVybiB0aGF0Ll9sIHx8ICh0aGF0Ll9sID0gbmV3IFVuY2F1Z2h0RnJvemVuU3RvcmUoKSk7CgkJCX07CgkJCXZhciBVbmNhdWdodEZyb3plblN0b3JlID0gZnVuY3Rpb24gVW5jYXVnaHRGcm96ZW5TdG9yZSgpIHsKCQkJCXRoaXMuYSA9IFtdOwoJCQl9OwoJCQl2YXIgZmluZFVuY2F1Z2h0RnJvemVuID0gZnVuY3Rpb24gZmluZFVuY2F1Z2h0RnJvemVuKHN0b3JlLCBrZXkpIHsKCQkJCXJldHVybiBhcnJheUZpbmQoc3RvcmUuYSwgZnVuY3Rpb24oaXQpIHsKCQkJCQlyZXR1cm4gaXRbMF0gPT09IGtleTsKCQkJCX0pOwoJCQl9OwoJCQlVbmNhdWdodEZyb3plblN0b3JlLnByb3RvdHlwZSA9IHsKCQkJCWdldDogZnVuY3Rpb24gZ2V0KGtleSkgewoJCQkJCXZhciBlbnRyeSA9IGZpbmRVbmNhdWdodEZyb3plbih0aGlzLCBrZXkpOwoJCQkJCWlmIChlbnRyeSkgcmV0dXJuIGVudHJ5WzFdOwoJCQkJfSwKCQkJCWhhczogZnVuY3Rpb24gaGFzKGtleSkgewoJCQkJCXJldHVybiAhIWZpbmRVbmNhdWdodEZyb3plbih0aGlzLCBrZXkpOwoJCQkJfSwKCQkJCXNldDogZnVuY3Rpb24gc2V0KGtleSwgdmFsdWUpIHsKCQkJCQl2YXIgZW50cnkgPSBmaW5kVW5jYXVnaHRGcm96ZW4odGhpcywga2V5KTsKCQkJCQlpZiAoZW50cnkpIGVudHJ5WzFdID0gdmFsdWU7IGVsc2UgdGhpcy5hLnB1c2goW2tleSwgdmFsdWVdKTsKCQkJCX0sCgkJCQknZGVsZXRlJzogZnVuY3Rpb24gX2RlbGV0ZShrZXkpIHsKCQkJCQl2YXIgaW5kZXggPSBhcnJheUZpbmRJbmRleCh0aGlzLmEsIGZ1bmN0aW9uKGl0KSB7CgkJCQkJCXJldHVybiBpdFswXSA9PT0ga2V5OwoJCQkJCX0pOwoJCQkJCWlmICh+aW5kZXgpIHRoaXMuYS5zcGxpY2UoaW5kZXgsIDEpOwoJCQkJCXJldHVybiAhIX5pbmRleDsKCQkJCX0KCQkJfTsKCQkJbW9kdWxlLmV4cG9ydHMgPSB7CgkJCQlnZXRDb25zdHJ1Y3RvcjogZnVuY3Rpb24gZ2V0Q29uc3RydWN0b3Iod3JhcHBlciwgTkFNRSwgSVNfTUFQLCBBRERFUikgewoJCQkJCXZhciBDID0gd3JhcHBlcihmdW5jdGlvbih0aGF0LCBpdGVyYWJsZSkgewoJCQkJCQlhbkluc3RhbmNlKHRoYXQsIEMsIE5BTUUsICdfaScpOwoJCQkJCQl0aGF0Ll90ID0gTkFNRTsgLy8gY29sbGVjdGlvbiB0eXBlCgkJCQkJCXRoYXQuX2kgPSBpZCsrOyAvLyBjb2xsZWN0aW9uIGlkCgkJCQkJCXRoYXQuX2wgPSB1bmRlZmluZWQ7IC8vIGxlYWsgc3RvcmUgZm9yIHVuY2F1Z2h0IGZyb3plbiBvYmplY3RzCgkJCQkJCWlmIChpdGVyYWJsZSAhPSB1bmRlZmluZWQpIGZvck9mKGl0ZXJhYmxlLCBJU19NQVAsIHRoYXRbQURERVJdLCB0aGF0KTsKCQkJCQl9KTsKCQkJCQlyZWRlZmluZUFsbChDLnByb3RvdHlwZSwgewoJCQkJCQkvLyAyMy4zLjMuMiBXZWFrTWFwLnByb3RvdHlwZS5kZWxldGUoa2V5KQoJCQkJCQkvLyAyMy40LjMuMyBXZWFrU2V0LnByb3RvdHlwZS5kZWxldGUodmFsdWUpCgkJCQkJCSdkZWxldGUnOiBmdW5jdGlvbiBfZGVsZXRlKGtleSkgewoJCQkJCQkJaWYgKCFpc09iamVjdChrZXkpKSByZXR1cm4gZmFsc2U7CgkJCQkJCQl2YXIgZGF0YSA9IGdldFdlYWsoa2V5KTsKCQkJCQkJCWlmIChkYXRhID09PSB0cnVlKSByZXR1cm4gdW5jYXVnaHRGcm96ZW5TdG9yZSh2YWxpZGF0ZSh0aGlzLCBOQU1FKSlbJ2RlbGV0ZSddKGtleSk7CgkJCQkJCQlyZXR1cm4gZGF0YSAmJiAkaGFzKGRhdGEsIHRoaXMuX2kpICYmIGRlbGV0ZSBkYXRhW3RoaXMuX2ldOwoJCQkJCQl9LAoJCQkJCQkvLyAyMy4zLjMuNCBXZWFrTWFwLnByb3RvdHlwZS5oYXMoa2V5KQoJCQkJCQkvLyAyMy40LjMuNCBXZWFrU2V0LnByb3RvdHlwZS5oYXModmFsdWUpCgkJCQkJCWhhczogZnVuY3Rpb24gaGFzKGtleSkgewoJCQkJCQkJaWYgKCFpc09iamVjdChrZXkpKSByZXR1cm4gZmFsc2U7CgkJCQkJCQl2YXIgZGF0YSA9IGdldFdlYWsoa2V5KTsKCQkJCQkJCWlmIChkYXRhID09PSB0cnVlKSByZXR1cm4gdW5jYXVnaHRGcm96ZW5TdG9yZSh2YWxpZGF0ZSh0aGlzLCBOQU1FKSkuaGFzKGtleSk7CgkJCQkJCQlyZXR1cm4gZGF0YSAmJiAkaGFzKGRhdGEsIHRoaXMuX2kpOwoJCQkJCQl9CgkJCQkJfSk7CgkJCQkJcmV0dXJuIEM7CgkJCQl9LAoJCQkJZGVmOiBmdW5jdGlvbiBkZWYodGhhdCwga2V5LCB2YWx1ZSkgewoJCQkJCXZhciBkYXRhID0gZ2V0V2Vhayhhbk9iamVjdChrZXkpLCB0cnVlKTsKCQkJCQlpZiAoZGF0YSA9PT0gdHJ1ZSkgdW5jYXVnaHRGcm96ZW5TdG9yZSh0aGF0KS5zZXQoa2V5LCB2YWx1ZSk7IGVsc2UgZGF0YVt0aGF0Ll9pXSA9IHZhbHVlOwoJCQkJCXJldHVybiB0aGF0OwoJCQkJfSwKCQkJCXVmc3RvcmU6IHVuY2F1Z2h0RnJvemVuU3RvcmUKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDk4OTM6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCgkJCXZhciBnbG9iYWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk3NjkpOwoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciByZWRlZmluZSA9IF9fd2VicGFja19yZXF1aXJlX18oODkxNCk7CgkJCXZhciByZWRlZmluZUFsbCA9IF9fd2VicGFja19yZXF1aXJlX18oNzE4NSk7CgkJCXZhciBtZXRhID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMzY5KTsKCQkJdmFyIGZvck9mID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMzg5KTsKCQkJdmFyIGFuSW5zdGFuY2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg2NzMpOwoJCQl2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2ODYpOwoJCQl2YXIgZmFpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyOCk7CgkJCXZhciAkaXRlckRldGVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oOTI5KTsKCQkJdmFyIHNldFRvU3RyaW5nVGFnID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MzIxKTsKCQkJdmFyIGluaGVyaXRJZlJlcXVpcmVkID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTExKTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihOQU1FLCB3cmFwcGVyLCBtZXRob2RzLCBjb21tb24sIElTX01BUCwgSVNfV0VBSykgewoJCQkJdmFyIEJhc2UgPSBnbG9iYWxbTkFNRV07CgkJCQl2YXIgQyA9IEJhc2U7CgkJCQl2YXIgQURERVIgPSBJU19NQVAgPyAnc2V0JyA6ICdhZGQnOwoJCQkJdmFyIHByb3RvID0gQyAmJiBDLnByb3RvdHlwZTsKCQkJCXZhciBPID0ge307CgkJCQl2YXIgZml4TWV0aG9kID0gZnVuY3Rpb24gZml4TWV0aG9kKEtFWSkgewoJCQkJCXZhciBmbiA9IHByb3RvW0tFWV07CgkJCQkJcmVkZWZpbmUocHJvdG8sIEtFWSwgS0VZID09ICdkZWxldGUnID8gZnVuY3Rpb24oYSkgewoJCQkJCQlyZXR1cm4gSVNfV0VBSyAmJiAhaXNPYmplY3QoYSkgPyBmYWxzZSA6IGZuLmNhbGwodGhpcywgYSA9PT0gMCA/IDAgOiBhKTsKCQkJCQl9IDogS0VZID09ICdoYXMnID8gZnVuY3Rpb24gaGFzKGEpIHsKCQkJCQkJcmV0dXJuIElTX1dFQUsgJiYgIWlzT2JqZWN0KGEpID8gZmFsc2UgOiBmbi5jYWxsKHRoaXMsIGEgPT09IDAgPyAwIDogYSk7CgkJCQkJfSA6IEtFWSA9PSAnZ2V0JyA/IGZ1bmN0aW9uIGdldChhKSB7CgkJCQkJCXJldHVybiBJU19XRUFLICYmICFpc09iamVjdChhKSA/IHVuZGVmaW5lZCA6IGZuLmNhbGwodGhpcywgYSA9PT0gMCA/IDAgOiBhKTsKCQkJCQl9IDogS0VZID09ICdhZGQnID8gZnVuY3Rpb24gYWRkKGEpIHsKCQkJCQkJZm4uY2FsbCh0aGlzLCBhID09PSAwID8gMCA6IGEpOwoJCQkJCQlyZXR1cm4gdGhpczsKCQkJCQl9IDogZnVuY3Rpb24gc2V0KGEsIGIpIHsKCQkJCQkJZm4uY2FsbCh0aGlzLCBhID09PSAwID8gMCA6IGEsIGIpOwoJCQkJCQlyZXR1cm4gdGhpczsKCQkJCQl9KTsKCQkJCX07CgkJCQlpZiAodHlwZW9mIEMgIT0gJ2Z1bmN0aW9uJyB8fCAhKElTX1dFQUsgfHwgcHJvdG8uZm9yRWFjaCAmJiAhZmFpbHMoZnVuY3Rpb24oKSB7CgkJCQkJbmV3IEMoKS5lbnRyaWVzKCkubmV4dCgpOwoJCQkJfSkpKSB7CgkJCQkJLy8gY3JlYXRlIGNvbGxlY3Rpb24gY29uc3RydWN0b3IKCQkJCQlDID0gY29tbW9uLmdldENvbnN0cnVjdG9yKHdyYXBwZXIsIE5BTUUsIElTX01BUCwgQURERVIpOwoJCQkJCXJlZGVmaW5lQWxsKEMucHJvdG90eXBlLCBtZXRob2RzKTsKCQkJCQltZXRhLk5FRUQgPSB0cnVlOwoJCQkJfSBlbHNlIHsKCQkJCQl2YXIgaW5zdGFuY2UgPSBuZXcgQygpOwoJCQkJCS8vIGVhcmx5IGltcGxlbWVudGF0aW9ucyBub3Qgc3VwcG9ydHMgY2hhaW5pbmcKCQkJCQl2YXIgSEFTTlRfQ0hBSU5JTkcgPSBpbnN0YW5jZVtBRERFUl0oSVNfV0VBSyA/IHt9IDogLTAsIDEpICE9IGluc3RhbmNlOwoJCQkJCS8vIFY4IH4gIENocm9taXVtIDQwLSB3ZWFrLWNvbGxlY3Rpb25zIHRocm93cyBvbiBwcmltaXRpdmVzLCBidXQgc2hvdWxkIHJldHVybiBmYWxzZQoJCQkJCXZhciBUSFJPV1NfT05fUFJJTUlUSVZFUyA9IGZhaWxzKGZ1bmN0aW9uKCkgewoJCQkJCQlpbnN0YW5jZS5oYXMoMSk7CgkJCQkJfSk7CgkJCQkJLy8gbW9zdCBlYXJseSBpbXBsZW1lbnRhdGlvbnMgZG9lc24ndCBzdXBwb3J0cyBpdGVyYWJsZXMsIG1vc3QgbW9kZXJuIC0gbm90IGNsb3NlIGl0IGNvcnJlY3RseQoJCQkJCXZhciBBQ0NFUFRfSVRFUkFCTEVTID0gJGl0ZXJEZXRlY3QoZnVuY3Rpb24oaXRlcikgewoJCQkJCQluZXcgQyhpdGVyKTsKCQkJCQl9KTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1uZXcKCQkJCQkvLyBmb3IgZWFybHkgaW1wbGVtZW50YXRpb25zIC0wIGFuZCArMCBub3QgdGhlIHNhbWUKCQkJCQl2YXIgQlVHR1lfWkVSTyA9ICFJU19XRUFLICYmIGZhaWxzKGZ1bmN0aW9uKCkgewoJCQkJCQkvLyBWOCB+IENocm9taXVtIDQyLSBmYWlscyBvbmx5IHdpdGggNSsgZWxlbWVudHMKCQkJCQkJdmFyICRpbnN0YW5jZSA9IG5ldyBDKCk7CgkJCQkJCXZhciBpbmRleCA9IDU7CgkJCQkJCXdoaWxlIChpbmRleC0tKSAkaW5zdGFuY2VbQURERVJdKGluZGV4LCBpbmRleCk7CgkJCQkJCXJldHVybiAhJGluc3RhbmNlLmhhcygtMCk7CgkJCQkJfSk7CgkJCQkJaWYgKCFBQ0NFUFRfSVRFUkFCTEVTKSB7CgkJCQkJCUMgPSB3cmFwcGVyKGZ1bmN0aW9uKHRhcmdldCwgaXRlcmFibGUpIHsKCQkJCQkJCWFuSW5zdGFuY2UodGFyZ2V0LCBDLCBOQU1FKTsKCQkJCQkJCXZhciB0aGF0ID0gaW5oZXJpdElmUmVxdWlyZWQobmV3IEJhc2UoKSwgdGFyZ2V0LCBDKTsKCQkJCQkJCWlmIChpdGVyYWJsZSAhPSB1bmRlZmluZWQpIGZvck9mKGl0ZXJhYmxlLCBJU19NQVAsIHRoYXRbQURERVJdLCB0aGF0KTsKCQkJCQkJCXJldHVybiB0aGF0OwoJCQkJCQl9KTsKCQkJCQkJQy5wcm90b3R5cGUgPSBwcm90bzsKCQkJCQkJcHJvdG8uY29uc3RydWN0b3IgPSBDOwoJCQkJCX0KCQkJCQlpZiAoVEhST1dTX09OX1BSSU1JVElWRVMgfHwgQlVHR1lfWkVSTykgewoJCQkJCQlmaXhNZXRob2QoJ2RlbGV0ZScpOwoJCQkJCQlmaXhNZXRob2QoJ2hhcycpOwoJCQkJCQlJU19NQVAgJiYgZml4TWV0aG9kKCdnZXQnKTsKCQkJCQl9CgkJCQkJaWYgKEJVR0dZX1pFUk8gfHwgSEFTTlRfQ0hBSU5JTkcpIGZpeE1ldGhvZChBRERFUik7CgkJCQkJLy8gd2VhayBjb2xsZWN0aW9ucyBzaG91bGQgbm90IGNvbnRhaW5zIC5jbGVhciBtZXRob2QKCQkJCQlpZiAoSVNfV0VBSyAmJiBwcm90by5jbGVhcikgZGVsZXRlIHByb3RvLmNsZWFyOwoJCQkJfQoJCQkJc2V0VG9TdHJpbmdUYWcoQywgTkFNRSk7CgkJCQlPW05BTUVdID0gQzsKCQkJCSRleHBvcnQoJGV4cG9ydC5HICsgJGV4cG9ydC5XICsgJGV4cG9ydC5GICogKEMgIT0gQmFzZSksIE8pOwoJCQkJaWYgKCFJU19XRUFLKSBjb21tb24uc2V0U3Ryb25nKEMsIE5BTUUsIElTX01BUCk7CgkJCQlyZXR1cm4gQzsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDUxNjU6CgkJLyoqKi8gKChtb2R1bGUpID0+IHsKCgkJCXZhciBjb3JlID0gbW9kdWxlLmV4cG9ydHMgPSB7CgkJCQl2ZXJzaW9uOiAnMi42LjEyJwoJCQl9OwoJCQlpZiAodHlwZW9mIF9fZSA9PSAnbnVtYmVyJykgX19lID0gY29yZTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bmRlZgoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMjAxMjoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyICRkZWZpbmVQcm9wZXJ0eSA9IF9fd2VicGFja19yZXF1aXJlX18oMTUxNSk7CgkJCXZhciBjcmVhdGVEZXNjID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3MjMpOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG9iamVjdCwgaW5kZXgsIHZhbHVlKSB7CgkJCQlpZiAoaW5kZXggaW4gb2JqZWN0KSAkZGVmaW5lUHJvcGVydHkuZihvYmplY3QsIGluZGV4LCBjcmVhdGVEZXNjKDAsIHZhbHVlKSk7IGVsc2Ugb2JqZWN0W2luZGV4XSA9IHZhbHVlOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gODU2MzoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyBvcHRpb25hbCAvIHNpbXBsZSBjb250ZXh0IGJpbmRpbmcKCQkJdmFyIGFGdW5jdGlvbiA9IF9fd2VicGFja19yZXF1aXJlX18oNDgxMCk7CgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZm4sIHRoYXQsIGxlbmd0aCkgewoJCQkJYUZ1bmN0aW9uKGZuKTsKCQkJCWlmICh0aGF0ID09PSB1bmRlZmluZWQpIHJldHVybiBmbjsKCQkJCXN3aXRjaCAobGVuZ3RoKSB7CgkJCQkJY2FzZSAxOgoJCQkJCQlyZXR1cm4gZnVuY3Rpb24oYSkgewoJCQkJCQkJcmV0dXJuIGZuLmNhbGwodGhhdCwgYSk7CgkJCQkJCX07CgkJCQkJY2FzZSAyOgoJCQkJCQlyZXR1cm4gZnVuY3Rpb24oYSwgYikgewoJCQkJCQkJcmV0dXJuIGZuLmNhbGwodGhhdCwgYSwgYik7CgkJCQkJCX07CgkJCQkJY2FzZSAzOgoJCQkJCQlyZXR1cm4gZnVuY3Rpb24oYSwgYiwgYykgewoJCQkJCQkJcmV0dXJuIGZuLmNhbGwodGhhdCwgYSwgYiwgYyk7CgkJCQkJCX07CgkJCQl9CgkJCQlyZXR1cm4gZnVuY3Rpb24gLyogLi4uYXJncyAqLwoJCQkJCSgpIHsKCQkJCQlyZXR1cm4gZm4uYXBwbHkodGhhdCwgYXJndW1lbnRzKTsKCQkJCX07CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA4MTUwOgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyAyMC4zLjQuMzYgLyAxNS45LjUuNDMgRGF0ZS5wcm90b3R5cGUudG9JU09TdHJpbmcoKQoJCQl2YXIgZmFpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyOCk7CgkJCXZhciBnZXRUaW1lID0gRGF0ZS5wcm90b3R5cGUuZ2V0VGltZTsKCQkJdmFyICR0b0lTT1N0cmluZyA9IERhdGUucHJvdG90eXBlLnRvSVNPU3RyaW5nOwoJCQl2YXIgbHogPSBmdW5jdGlvbiBseihudW0pIHsKCQkJCXJldHVybiBudW0gPiA5ID8gbnVtIDogJzAnICsgbnVtOwoJCQl9OwoKLy8gUGhhbnRvbUpTIC8gb2xkIFdlYktpdCBoYXMgYSBicm9rZW4gaW1wbGVtZW50YXRpb25zCgkJCW1vZHVsZS5leHBvcnRzID0gZmFpbHMoZnVuY3Rpb24oKSB7CgkJCQlyZXR1cm4gJHRvSVNPU3RyaW5nLmNhbGwobmV3IERhdGUoLTVlMTMgLSAxKSkgIT0gJzAzODUtMDctMjVUMDc6MDY6MzkuOTk5Wic7CgkJCX0pIHx8ICFmYWlscyhmdW5jdGlvbigpIHsKCQkJCSR0b0lTT1N0cmluZy5jYWxsKG5ldyBEYXRlKE5hTikpOwoJCQl9KSA/IGZ1bmN0aW9uIHRvSVNPU3RyaW5nKCkgewoJCQkJaWYgKCFpc0Zpbml0ZShnZXRUaW1lLmNhbGwodGhpcykpKSB0aHJvdyBSYW5nZUVycm9yKCdJbnZhbGlkIHRpbWUgdmFsdWUnKTsKCQkJCXZhciBkID0gdGhpczsKCQkJCXZhciB5ID0gZC5nZXRVVENGdWxsWWVhcigpOwoJCQkJdmFyIG0gPSBkLmdldFVUQ01pbGxpc2Vjb25kcygpOwoJCQkJdmFyIHMgPSB5IDwgMCA/ICctJyA6IHkgPiA5OTk5ID8gJysnIDogJyc7CgkJCQlyZXR1cm4gcyArICgnMDAwMDAnICsgTWF0aC5hYnMoeSkpLnNsaWNlKHMgPyAtNiA6IC00KSArICctJyArIGx6KGQuZ2V0VVRDTW9udGgoKSArIDEpICsgJy0nICsgbHooZC5nZXRVVENEYXRlKCkpICsgJ1QnICsgbHooZC5nZXRVVENIb3VycygpKSArICc6JyArIGx6KGQuZ2V0VVRDTWludXRlcygpKSArICc6JyArIGx6KGQuZ2V0VVRDU2Vjb25kcygpKSArICcuJyArIChtID4gOTkgPyBtIDogJzAnICsgbHoobSkpICsgJ1onOwoJCQl9IDogJHRvSVNPU3RyaW5nOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMzQyMToKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MTY2KTsKCQkJdmFyIHRvUHJpbWl0aXZlID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNDQwKTsKCQkJdmFyIE5VTUJFUiA9ICdudW1iZXInOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGhpbnQpIHsKCQkJCWlmIChoaW50ICE9PSAnc3RyaW5nJyAmJiBoaW50ICE9PSBOVU1CRVIgJiYgaGludCAhPT0gJ2RlZmF1bHQnKSB0aHJvdyBUeXBlRXJyb3IoJ0luY29ycmVjdCBoaW50Jyk7CgkJCQlyZXR1cm4gdG9QcmltaXRpdmUoYW5PYmplY3QodGhpcyksIGhpbnQgIT0gTlVNQkVSKTsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDcxODk6CgkJLyoqKi8gKChtb2R1bGUpID0+IHsKCi8vIDcuMi4xIFJlcXVpcmVPYmplY3RDb2VyY2libGUoYXJndW1lbnQpCgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpIHsKCQkJCWlmIChpdCA9PSB1bmRlZmluZWQpIHRocm93IFR5cGVFcnJvcignQ2FuXCd0IGNhbGwgbWV0aG9kIG9uICAnICsgaXQpOwoJCQkJcmV0dXJuIGl0OwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNTE5NDoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyBUaGFuaydzIElFOCBmb3IgaGlzIGZ1bm55IGRlZmluZVByb3BlcnR5CgkJCW1vZHVsZS5leHBvcnRzID0gIV9fd2VicGFja19yZXF1aXJlX18oMTI4KShmdW5jdGlvbigpIHsKCQkJCXJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICdhJywgewoJCQkJCWdldDogZnVuY3Rpb24gZ2V0KCkgewoJCQkJCQlyZXR1cm4gNzsKCQkJCQl9CgkJCQl9KS5hICE9IDc7CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMzM4MzoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2ODYpOwoJCQl2YXIgZG9jdW1lbnQgPSAoX193ZWJwYWNrX3JlcXVpcmVfXyg5NzY5KS5kb2N1bWVudCk7Ci8vIHR5cGVvZiBkb2N1bWVudC5jcmVhdGVFbGVtZW50IGlzICdvYmplY3QnIGluIG9sZCBJRQoJCQl2YXIgaXMgPSBpc09iamVjdChkb2N1bWVudCkgJiYgaXNPYmplY3QoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCk7CgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpIHsKCQkJCXJldHVybiBpcyA/IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoaXQpIDoge307CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA1MTg2OgoJCS8qKiovICgobW9kdWxlKSA9PiB7CgovLyBJRSA4LSBkb24ndCBlbnVtIGJ1ZyBrZXlzCgkJCW1vZHVsZS5leHBvcnRzID0gJ2NvbnN0cnVjdG9yLGhhc093blByb3BlcnR5LGlzUHJvdG90eXBlT2YscHJvcGVydHlJc0VudW1lcmFibGUsdG9Mb2NhbGVTdHJpbmcsdG9TdHJpbmcsdmFsdWVPZicuc3BsaXQoJywnKTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDM0MTA6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gYWxsIGVudW1lcmFibGUgb2JqZWN0IGtleXMsIGluY2x1ZGVzIHN5bWJvbHMKCQkJdmFyIGdldEtleXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY0MzYpOwoJCQl2YXIgZ09QUyA9IF9fd2VicGFja19yZXF1aXJlX18oNTk0NCk7CgkJCXZhciBwSUUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIyNzEpOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KSB7CgkJCQl2YXIgcmVzdWx0ID0gZ2V0S2V5cyhpdCk7CgkJCQl2YXIgZ2V0U3ltYm9scyA9IGdPUFMuZjsKCQkJCWlmIChnZXRTeW1ib2xzKSB7CgkJCQkJdmFyIHN5bWJvbHMgPSBnZXRTeW1ib2xzKGl0KTsKCQkJCQl2YXIgaXNFbnVtID0gcElFLmY7CgkJCQkJdmFyIGkgPSAwOwoJCQkJCXZhciBrZXk7CgkJCQkJd2hpbGUgKHN5bWJvbHMubGVuZ3RoID4gaSkgaWYgKGlzRW51bS5jYWxsKGl0LCBrZXkgPSBzeW1ib2xzW2krK10pKSByZXN1bHQucHVzaChrZXkpOwoJCQkJfQoJCQkJcmV0dXJuIHJlc3VsdDsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDQxOTQ6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oOTc2OSk7CgkJCXZhciBjb3JlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MTY1KTsKCQkJdmFyIGhpZGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkwMzYpOwoJCQl2YXIgcmVkZWZpbmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg5MTQpOwoJCQl2YXIgY3R4ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4NTYzKTsKCQkJdmFyIFBST1RPVFlQRSA9ICdwcm90b3R5cGUnOwoJCQl2YXIgJGV4cG9ydCA9IGZ1bmN0aW9uICRleHBvcnQodHlwZSwgbmFtZSwgc291cmNlKSB7CgkJCQl2YXIgSVNfRk9SQ0VEID0gdHlwZSAmICRleHBvcnQuRjsKCQkJCXZhciBJU19HTE9CQUwgPSB0eXBlICYgJGV4cG9ydC5HOwoJCQkJdmFyIElTX1NUQVRJQyA9IHR5cGUgJiAkZXhwb3J0LlM7CgkJCQl2YXIgSVNfUFJPVE8gPSB0eXBlICYgJGV4cG9ydC5QOwoJCQkJdmFyIElTX0JJTkQgPSB0eXBlICYgJGV4cG9ydC5COwoJCQkJdmFyIHRhcmdldCA9IElTX0dMT0JBTCA/IGdsb2JhbCA6IElTX1NUQVRJQyA/IGdsb2JhbFtuYW1lXSB8fCAoZ2xvYmFsW25hbWVdID0ge30pIDogKGdsb2JhbFtuYW1lXSB8fCB7fSlbUFJPVE9UWVBFXTsKCQkJCXZhciBleHBvcnRzID0gSVNfR0xPQkFMID8gY29yZSA6IGNvcmVbbmFtZV0gfHwgKGNvcmVbbmFtZV0gPSB7fSk7CgkJCQl2YXIgZXhwUHJvdG8gPSBleHBvcnRzW1BST1RPVFlQRV0gfHwgKGV4cG9ydHNbUFJPVE9UWVBFXSA9IHt9KTsKCQkJCXZhciBrZXksIG93biwgb3V0LCBleHA7CgkJCQlpZiAoSVNfR0xPQkFMKSBzb3VyY2UgPSBuYW1lOwoJCQkJZm9yIChrZXkgaW4gc291cmNlKSB7CgkJCQkJLy8gY29udGFpbnMgaW4gbmF0aXZlCgkJCQkJb3duID0gIUlTX0ZPUkNFRCAmJiB0YXJnZXQgJiYgdGFyZ2V0W2tleV0gIT09IHVuZGVmaW5lZDsKCQkJCQkvLyBleHBvcnQgbmF0aXZlIG9yIHBhc3NlZAoJCQkJCW91dCA9IChvd24gPyB0YXJnZXQgOiBzb3VyY2UpW2tleV07CgkJCQkJLy8gYmluZCB0aW1lcnMgdG8gZ2xvYmFsIGZvciBjYWxsIGZyb20gZXhwb3J0IGNvbnRleHQKCQkJCQlleHAgPSBJU19CSU5EICYmIG93biA/IGN0eChvdXQsIGdsb2JhbCkgOiBJU19QUk9UTyAmJiB0eXBlb2Ygb3V0ID09ICdmdW5jdGlvbicgPyBjdHgoRnVuY3Rpb24uY2FsbCwgb3V0KSA6IG91dDsKCQkJCQkvLyBleHRlbmQgZ2xvYmFsCgkJCQkJaWYgKHRhcmdldCkgcmVkZWZpbmUodGFyZ2V0LCBrZXksIG91dCwgdHlwZSAmICRleHBvcnQuVSk7CgkJCQkJLy8gZXhwb3J0CgkJCQkJaWYgKGV4cG9ydHNba2V5XSAhPSBvdXQpIGhpZGUoZXhwb3J0cywga2V5LCBleHApOwoJCQkJCWlmIChJU19QUk9UTyAmJiBleHBQcm90b1trZXldICE9IG91dCkgZXhwUHJvdG9ba2V5XSA9IG91dDsKCQkJCX0KCQkJfTsKCQkJZ2xvYmFsLmNvcmUgPSBjb3JlOwovLyB0eXBlIGJpdG1hcAoJCQkkZXhwb3J0LkYgPSAxOyAvLyBmb3JjZWQKCQkJJGV4cG9ydC5HID0gMjsgLy8gZ2xvYmFsCgkJCSRleHBvcnQuUyA9IDQ7IC8vIHN0YXRpYwoJCQkkZXhwb3J0LlAgPSA4OyAvLyBwcm90bwoJCQkkZXhwb3J0LkIgPSAxNjsgLy8gYmluZAoJCQkkZXhwb3J0LlcgPSAzMjsgLy8gd3JhcAoJCQkkZXhwb3J0LlUgPSA2NDsgLy8gc2FmZQoJCQkkZXhwb3J0LlIgPSAxMjg7IC8vIHJlYWwgcHJvdG8gbWV0aG9kIGZvciBgbGlicmFyeWAKCQkJbW9kdWxlLmV4cG9ydHMgPSAkZXhwb3J0OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gOTg1NzoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgTUFUQ0ggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI4NjcpKCdtYXRjaCcpOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKEtFWSkgewoJCQkJdmFyIHJlID0gLy4vOwoJCQkJdHJ5IHsKCQkJCQknLy4vJ1tLRVldKHJlKTsKCQkJCX0gY2F0Y2ggKGUpIHsKCQkJCQl0cnkgewoJCQkJCQlyZVtNQVRDSF0gPSBmYWxzZTsKCQkJCQkJcmV0dXJuICEnLy4vJ1tLRVldKHJlKTsKCQkJCQl9IGNhdGNoIChmKSB7LyogZW1wdHkgKi8KCQkJCQl9CgkJCQl9CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDEyODoKCQkvKioqLyAoKG1vZHVsZSkgPT4gewoKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihleGVjKSB7CgkJCQl0cnkgewoJCQkJCXJldHVybiAhIWV4ZWMoKTsKCQkJCX0gY2F0Y2ggKGUpIHsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0KCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDQ0ODU6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCgkJCV9fd2VicGFja19yZXF1aXJlX18oMzUwMik7CgkJCXZhciByZWRlZmluZSA9IF9fd2VicGFja19yZXF1aXJlX18oODkxNCk7CgkJCXZhciBoaWRlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5MDM2KTsKCQkJdmFyIGZhaWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMjgpOwoJCQl2YXIgZGVmaW5lZCA9IF9fd2VicGFja19yZXF1aXJlX18oNzE4OSk7CgkJCXZhciB3a3MgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI4NjcpOwoJCQl2YXIgcmVnZXhwRXhlYyA9IF9fd2VicGFja19yZXF1aXJlX18oNTYwNyk7CgkJCXZhciBTUEVDSUVTID0gd2tzKCdzcGVjaWVzJyk7CgkJCXZhciBSRVBMQUNFX1NVUFBPUlRTX05BTUVEX0dST1VQUyA9ICFmYWlscyhmdW5jdGlvbigpIHsKCQkJCS8vICNyZXBsYWNlIG5lZWRzIGJ1aWx0LWluIHN1cHBvcnQgZm9yIG5hbWVkIGdyb3Vwcy4KCQkJCS8vICNtYXRjaCB3b3JrcyBmaW5lIGJlY2F1c2UgaXQganVzdCByZXR1cm4gdGhlIGV4ZWMgcmVzdWx0cywgZXZlbiBpZiBpdCBoYXMKCQkJCS8vIGEgImdyb3BzIiBwcm9wZXJ0eS4KCQkJCXZhciByZSA9IC8uLzsKCQkJCXJlLmV4ZWMgPSBmdW5jdGlvbigpIHsKCQkJCQl2YXIgcmVzdWx0ID0gW107CgkJCQkJcmVzdWx0Lmdyb3VwcyA9IHsKCQkJCQkJYTogJzcnCgkJCQkJfTsKCQkJCQlyZXR1cm4gcmVzdWx0OwoJCQkJfTsKCQkJCXJldHVybiAnJy5yZXBsYWNlKHJlLCAnJDxhPicpICE9PSAnNyc7CgkJCX0pOwoJCQl2YXIgU1BMSVRfV09SS1NfV0lUSF9PVkVSV1JJVFRFTl9FWEVDID0gZnVuY3Rpb24oKSB7CgkJCQkvLyBDaHJvbWUgNTEgaGFzIGEgYnVnZ3kgInNwbGl0IiBpbXBsZW1lbnRhdGlvbiB3aGVuIFJlZ0V4cCNleGVjICE9PSBuYXRpdmVFeGVjCgkJCQl2YXIgcmUgPSAvKD86KS87CgkJCQl2YXIgb3JpZ2luYWxFeGVjID0gcmUuZXhlYzsKCQkJCXJlLmV4ZWMgPSBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gb3JpZ2luYWxFeGVjLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CgkJCQl9OwoJCQkJdmFyIHJlc3VsdCA9ICdhYicuc3BsaXQocmUpOwoJCQkJcmV0dXJuIHJlc3VsdC5sZW5ndGggPT09IDIgJiYgcmVzdWx0WzBdID09PSAnYScgJiYgcmVzdWx0WzFdID09PSAnYic7CgkJCX0oKTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihLRVksIGxlbmd0aCwgZXhlYykgewoJCQkJdmFyIFNZTUJPTCA9IHdrcyhLRVkpOwoJCQkJdmFyIERFTEVHQVRFU19UT19TWU1CT0wgPSAhZmFpbHMoZnVuY3Rpb24oKSB7CgkJCQkJLy8gU3RyaW5nIG1ldGhvZHMgY2FsbCBzeW1ib2wtbmFtZWQgUmVnRXAgbWV0aG9kcwoJCQkJCXZhciBPID0ge307CgkJCQkJT1tTWU1CT0xdID0gZnVuY3Rpb24oKSB7CgkJCQkJCXJldHVybiA3OwoJCQkJCX07CgkJCQkJcmV0dXJuICcnW0tFWV0oTykgIT0gNzsKCQkJCX0pOwoJCQkJdmFyIERFTEVHQVRFU19UT19FWEVDID0gREVMRUdBVEVTX1RPX1NZTUJPTCA/ICFmYWlscyhmdW5jdGlvbigpIHsKCQkJCQkvLyBTeW1ib2wtbmFtZWQgUmVnRXhwIG1ldGhvZHMgY2FsbCAuZXhlYwoJCQkJCXZhciBleGVjQ2FsbGVkID0gZmFsc2U7CgkJCQkJdmFyIHJlID0gL2EvOwoJCQkJCXJlLmV4ZWMgPSBmdW5jdGlvbigpIHsKCQkJCQkJZXhlY0NhbGxlZCA9IHRydWU7CgkJCQkJCXJldHVybiBudWxsOwoJCQkJCX07CgkJCQkJaWYgKEtFWSA9PT0gJ3NwbGl0JykgewoJCQkJCQkvLyBSZWdFeHBbQEBzcGxpdF0gZG9lc24ndCBjYWxsIHRoZSByZWdleCdzIGV4ZWMgbWV0aG9kLCBidXQgZmlyc3QgY3JlYXRlcwoJCQkJCQkvLyBhIG5ldyBvbmUuIFdlIG5lZWQgdG8gcmV0dXJuIHRoZSBwYXRjaGVkIHJlZ2V4IHdoZW4gY3JlYXRpbmcgdGhlIG5ldyBvbmUuCgkJCQkJCXJlLmNvbnN0cnVjdG9yID0ge307CgkJCQkJCXJlLmNvbnN0cnVjdG9yW1NQRUNJRVNdID0gZnVuY3Rpb24oKSB7CgkJCQkJCQlyZXR1cm4gcmU7CgkJCQkJCX07CgkJCQkJfQoJCQkJCXJlW1NZTUJPTF0oJycpOwoJCQkJCXJldHVybiAhZXhlY0NhbGxlZDsKCQkJCX0pIDogdW5kZWZpbmVkOwoJCQkJaWYgKCFERUxFR0FURVNfVE9fU1lNQk9MIHx8ICFERUxFR0FURVNfVE9fRVhFQyB8fCBLRVkgPT09ICdyZXBsYWNlJyAmJiAhUkVQTEFDRV9TVVBQT1JUU19OQU1FRF9HUk9VUFMgfHwgS0VZID09PSAnc3BsaXQnICYmICFTUExJVF9XT1JLU19XSVRIX09WRVJXUklUVEVOX0VYRUMpIHsKCQkJCQl2YXIgbmF0aXZlUmVnRXhwTWV0aG9kID0gLy4vW1NZTUJPTF07CgkJCQkJdmFyIGZucyA9IGV4ZWMoZGVmaW5lZCwgU1lNQk9MLCAnJ1tLRVldLCBmdW5jdGlvbiBtYXliZUNhbGxOYXRpdmUobmF0aXZlTWV0aG9kLCByZWdleHAsIHN0ciwgYXJnMiwgZm9yY2VTdHJpbmdNZXRob2QpIHsKCQkJCQkJaWYgKHJlZ2V4cC5leGVjID09PSByZWdleHBFeGVjKSB7CgkJCQkJCQlpZiAoREVMRUdBVEVTX1RPX1NZTUJPTCAmJiAhZm9yY2VTdHJpbmdNZXRob2QpIHsKCQkJCQkJCQkvLyBUaGUgbmF0aXZlIFN0cmluZyBtZXRob2QgYWxyZWFkeSBkZWxlZ2F0ZXMgdG8gQEBtZXRob2QgKHRoaXMKCQkJCQkJCQkvLyBwb2x5ZmlsbGVkIGZ1bmN0aW9uKSwgbGVhc2luZyB0byBpbmZpbml0ZSByZWN1cnNpb24uCgkJCQkJCQkJLy8gV2UgYXZvaWQgaXQgYnkgZGlyZWN0bHkgY2FsbGluZyB0aGUgbmF0aXZlIEBAbWV0aG9kIG1ldGhvZC4KCQkJCQkJCQlyZXR1cm4gewoJCQkJCQkJCQlkb25lOiB0cnVlLAoJCQkJCQkJCQl2YWx1ZTogbmF0aXZlUmVnRXhwTWV0aG9kLmNhbGwocmVnZXhwLCBzdHIsIGFyZzIpCgkJCQkJCQkJfTsKCQkJCQkJCX0KCQkJCQkJCXJldHVybiB7CgkJCQkJCQkJZG9uZTogdHJ1ZSwKCQkJCQkJCQl2YWx1ZTogbmF0aXZlTWV0aG9kLmNhbGwoc3RyLCByZWdleHAsIGFyZzIpCgkJCQkJCQl9OwoJCQkJCQl9CgkJCQkJCXJldHVybiB7CgkJCQkJCQlkb25lOiBmYWxzZQoJCQkJCQl9OwoJCQkJCX0pOwoJCQkJCXZhciBzdHJmbiA9IGZuc1swXTsKCQkJCQl2YXIgcnhmbiA9IGZuc1sxXTsKCQkJCQlyZWRlZmluZShTdHJpbmcucHJvdG90eXBlLCBLRVksIHN0cmZuKTsKCQkJCQloaWRlKFJlZ0V4cC5wcm90b3R5cGUsIFNZTUJPTCwgbGVuZ3RoID09IDIKCQkJCQkJLy8gMjEuMi41LjggUmVnRXhwLnByb3RvdHlwZVtAQHJlcGxhY2VdKHN0cmluZywgcmVwbGFjZVZhbHVlKQoJCQkJCQkvLyAyMS4yLjUuMTEgUmVnRXhwLnByb3RvdHlwZVtAQHNwbGl0XShzdHJpbmcsIGxpbWl0KQoJCQkJCQk/IGZ1bmN0aW9uKHN0cmluZywgYXJnKSB7CgkJCQkJCQlyZXR1cm4gcnhmbi5jYWxsKHN0cmluZywgdGhpcywgYXJnKTsKCQkJCQkJfQoJCQkJCQkvLyAyMS4yLjUuNiBSZWdFeHAucHJvdG90eXBlW0BAbWF0Y2hdKHN0cmluZykKCQkJCQkJLy8gMjEuMi41LjkgUmVnRXhwLnByb3RvdHlwZVtAQHNlYXJjaF0oc3RyaW5nKQoJCQkJCQk6IGZ1bmN0aW9uKHN0cmluZykgewoJCQkJCQkJcmV0dXJuIHJ4Zm4uY2FsbChzdHJpbmcsIHRoaXMpOwoJCQkJCQl9KTsKCQkJCX0KCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDE1NTg6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCi8vIDIxLjIuNS4zIGdldCBSZWdFeHAucHJvdG90eXBlLmZsYWdzCgkJCXZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNjE2Nik7CgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oKSB7CgkJCQl2YXIgdGhhdCA9IGFuT2JqZWN0KHRoaXMpOwoJCQkJdmFyIHJlc3VsdCA9ICcnOwoJCQkJaWYgKHRoYXQuZ2xvYmFsKSByZXN1bHQgKz0gJ2cnOwoJCQkJaWYgKHRoYXQuaWdub3JlQ2FzZSkgcmVzdWx0ICs9ICdpJzsKCQkJCWlmICh0aGF0Lm11bHRpbGluZSkgcmVzdWx0ICs9ICdtJzsKCQkJCWlmICh0aGF0LnVuaWNvZGUpIHJlc3VsdCArPSAndSc7CgkJCQlpZiAodGhhdC5zdGlja3kpIHJlc3VsdCArPSAneSc7CgkJCQlyZXR1cm4gcmVzdWx0OwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gODE4OToKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKLy8gaHR0cHM6Ly90YzM5LmdpdGh1Yi5pby9wcm9wb3NhbC1mbGF0TWFwLyNzZWMtRmxhdHRlbkludG9BcnJheQoJCQl2YXIgaXNBcnJheSA9IF9fd2VicGFja19yZXF1aXJlX18oMTUwMik7CgkJCXZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNDY4Nik7CgkJCXZhciB0b0xlbmd0aCA9IF9fd2VicGFja19yZXF1aXJlX18oNTIwMSk7CgkJCXZhciBjdHggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg1NjMpOwoJCQl2YXIgSVNfQ09OQ0FUX1NQUkVBREFCTEUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI4NjcpKCdpc0NvbmNhdFNwcmVhZGFibGUnKTsKCgkJCWZ1bmN0aW9uIGZsYXR0ZW5JbnRvQXJyYXkodGFyZ2V0LCBvcmlnaW5hbCwgc291cmNlLCBzb3VyY2VMZW4sIHN0YXJ0LCBkZXB0aCwgbWFwcGVyLCB0aGlzQXJnKSB7CgkJCQl2YXIgdGFyZ2V0SW5kZXggPSBzdGFydDsKCQkJCXZhciBzb3VyY2VJbmRleCA9IDA7CgkJCQl2YXIgbWFwRm4gPSBtYXBwZXIgPyBjdHgobWFwcGVyLCB0aGlzQXJnLCAzKSA6IGZhbHNlOwoJCQkJdmFyIGVsZW1lbnQsIHNwcmVhZGFibGU7CgkJCQl3aGlsZSAoc291cmNlSW5kZXggPCBzb3VyY2VMZW4pIHsKCQkJCQlpZiAoc291cmNlSW5kZXggaW4gc291cmNlKSB7CgkJCQkJCWVsZW1lbnQgPSBtYXBGbiA/IG1hcEZuKHNvdXJjZVtzb3VyY2VJbmRleF0sIHNvdXJjZUluZGV4LCBvcmlnaW5hbCkgOiBzb3VyY2Vbc291cmNlSW5kZXhdOwoJCQkJCQlzcHJlYWRhYmxlID0gZmFsc2U7CgkJCQkJCWlmIChpc09iamVjdChlbGVtZW50KSkgewoJCQkJCQkJc3ByZWFkYWJsZSA9IGVsZW1lbnRbSVNfQ09OQ0FUX1NQUkVBREFCTEVdOwoJCQkJCQkJc3ByZWFkYWJsZSA9IHNwcmVhZGFibGUgIT09IHVuZGVmaW5lZCA/ICEhc3ByZWFkYWJsZSA6IGlzQXJyYXkoZWxlbWVudCk7CgkJCQkJCX0KCQkJCQkJaWYgKHNwcmVhZGFibGUgJiYgZGVwdGggPiAwKSB7CgkJCQkJCQl0YXJnZXRJbmRleCA9IGZsYXR0ZW5JbnRvQXJyYXkodGFyZ2V0LCBvcmlnaW5hbCwgZWxlbWVudCwgdG9MZW5ndGgoZWxlbWVudC5sZW5ndGgpLCB0YXJnZXRJbmRleCwgZGVwdGggLSAxKSAtIDE7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlpZiAodGFyZ2V0SW5kZXggPj0gMHgxZmZmZmZmZmZmZmZmZikgdGhyb3cgVHlwZUVycm9yKCk7CgkJCQkJCQl0YXJnZXRbdGFyZ2V0SW5kZXhdID0gZWxlbWVudDsKCQkJCQkJfQoJCQkJCQl0YXJnZXRJbmRleCsrOwoJCQkJCX0KCQkJCQlzb3VyY2VJbmRleCsrOwoJCQkJfQoJCQkJcmV0dXJuIHRhcmdldEluZGV4OwoJCQl9CgoJCQltb2R1bGUuZXhwb3J0cyA9IGZsYXR0ZW5JbnRvQXJyYXk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAzMzg5OgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciBjdHggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg1NjMpOwoJCQl2YXIgY2FsbCA9IF9fd2VicGFja19yZXF1aXJlX18oMTcyMik7CgkJCXZhciBpc0FycmF5SXRlciA9IF9fd2VicGFja19yZXF1aXJlX18oNjU3Nyk7CgkJCXZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNjE2Nik7CgkJCXZhciB0b0xlbmd0aCA9IF9fd2VicGFja19yZXF1aXJlX18oNTIwMSk7CgkJCXZhciBnZXRJdGVyRm4gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ0Nyk7CgkJCXZhciBCUkVBSyA9IHt9OwoJCQl2YXIgUkVUVVJOID0ge307CgkJCXZhciBleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdGVyYWJsZSwgZW50cmllcywgZm4sIHRoYXQsIElURVJBVE9SKSB7CgkJCQl2YXIgaXRlckZuID0gSVRFUkFUT1IgPyBmdW5jdGlvbigpIHsKCQkJCQlyZXR1cm4gaXRlcmFibGU7CgkJCQl9IDogZ2V0SXRlckZuKGl0ZXJhYmxlKTsKCQkJCXZhciBmID0gY3R4KGZuLCB0aGF0LCBlbnRyaWVzID8gMiA6IDEpOwoJCQkJdmFyIGluZGV4ID0gMDsKCQkJCXZhciBsZW5ndGgsIHN0ZXAsIGl0ZXJhdG9yLCByZXN1bHQ7CgkJCQlpZiAodHlwZW9mIGl0ZXJGbiAhPSAnZnVuY3Rpb24nKSB0aHJvdyBUeXBlRXJyb3IoaXRlcmFibGUgKyAnIGlzIG5vdCBpdGVyYWJsZSEnKTsKCQkJCS8vIGZhc3QgY2FzZSBmb3IgYXJyYXlzIHdpdGggZGVmYXVsdCBpdGVyYXRvcgoJCQkJaWYgKGlzQXJyYXlJdGVyKGl0ZXJGbikpIGZvciAobGVuZ3RoID0gdG9MZW5ndGgoaXRlcmFibGUubGVuZ3RoKTsgbGVuZ3RoID4gaW5kZXg7IGluZGV4KyspIHsKCQkJCQlyZXN1bHQgPSBlbnRyaWVzID8gZihhbk9iamVjdChzdGVwID0gaXRlcmFibGVbaW5kZXhdKVswXSwgc3RlcFsxXSkgOiBmKGl0ZXJhYmxlW2luZGV4XSk7CgkJCQkJaWYgKHJlc3VsdCA9PT0gQlJFQUsgfHwgcmVzdWx0ID09PSBSRVRVUk4pIHJldHVybiByZXN1bHQ7CgkJCQl9IGVsc2UgZm9yIChpdGVyYXRvciA9IGl0ZXJGbi5jYWxsKGl0ZXJhYmxlKTsgIShzdGVwID0gaXRlcmF0b3IubmV4dCgpKS5kb25lOykgewoJCQkJCXJlc3VsdCA9IGNhbGwoaXRlcmF0b3IsIGYsIHN0ZXAudmFsdWUsIGVudHJpZXMpOwoJCQkJCWlmIChyZXN1bHQgPT09IEJSRUFLIHx8IHJlc3VsdCA9PT0gUkVUVVJOKSByZXR1cm4gcmVzdWx0OwoJCQkJfQoJCQl9OwoJCQlleHBvcnRzLkJSRUFLID0gQlJFQUs7CgkJCWV4cG9ydHMuUkVUVVJOID0gUkVUVVJOOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMjg1NzoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQltb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oNzQwKSgnbmF0aXZlLWZ1bmN0aW9uLXRvLXN0cmluZycsIEZ1bmN0aW9uLnRvU3RyaW5nKTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDk3Njk6CgkJLyoqKi8gKChtb2R1bGUpID0+IHsKCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS96bG9pcm9jay9jb3JlLWpzL2lzc3Vlcy84NiNpc3N1ZWNvbW1lbnQtMTE1NzU5MDI4CgkJCXZhciBnbG9iYWwgPSBtb2R1bGUuZXhwb3J0cyA9IHR5cGVvZiB3aW5kb3cgIT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93Lk1hdGggPT0gTWF0aCA/IHdpbmRvdyA6IHR5cGVvZiBzZWxmICE9ICd1bmRlZmluZWQnICYmIHNlbGYuTWF0aCA9PSBNYXRoID8gc2VsZgoJCQkJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLW5ldy1mdW5jCgkJCQk6IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7CgkJCWlmICh0eXBlb2YgX19nID09ICdudW1iZXInKSBfX2cgPSBnbG9iYWw7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW5kZWYKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDQ5OTc6CgkJLyoqKi8gKChtb2R1bGUpID0+IHsKCgkJCXZhciBoYXNPd25Qcm9wZXJ0eSA9IHt9Lmhhc093blByb3BlcnR5OwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0LCBrZXkpIHsKCQkJCXJldHVybiBoYXNPd25Qcm9wZXJ0eS5jYWxsKGl0LCBrZXkpOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gOTAzNjoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgZFAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1MTUpOwoJCQl2YXIgY3JlYXRlRGVzYyA9IF9fd2VicGFja19yZXF1aXJlX18oNzIzKTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUxOTQpID8gZnVuY3Rpb24ob2JqZWN0LCBrZXksIHZhbHVlKSB7CgkJCQlyZXR1cm4gZFAuZihvYmplY3QsIGtleSwgY3JlYXRlRGVzYygxLCB2YWx1ZSkpOwoJCQl9IDogZnVuY3Rpb24ob2JqZWN0LCBrZXksIHZhbHVlKSB7CgkJCQlvYmplY3Rba2V5XSA9IHZhbHVlOwoJCQkJcmV0dXJuIG9iamVjdDsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDQ3NToKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgZG9jdW1lbnQgPSAoX193ZWJwYWNrX3JlcXVpcmVfXyg5NzY5KS5kb2N1bWVudCk7CgkJCW1vZHVsZS5leHBvcnRzID0gZG9jdW1lbnQgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNDIxMToKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQltb2R1bGUuZXhwb3J0cyA9ICFfX3dlYnBhY2tfcmVxdWlyZV9fKDUxOTQpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fKDEyOCkoZnVuY3Rpb24oKSB7CgkJCQlyZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KF9fd2VicGFja19yZXF1aXJlX18oMzM4MykoJ2RpdicpLCAnYScsIHsKCQkJCQlnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCQkJCQkJcmV0dXJuIDc7CgkJCQkJfQoJCQkJfSkuYSAhPSA3OwoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDQxMTE6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJdmFyIGlzT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0Njg2KTsKCQkJdmFyIHNldFByb3RvdHlwZU9mID0gKF9fd2VicGFja19yZXF1aXJlX18oMzQ1NCkuc2V0KTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbih0aGF0LCB0YXJnZXQsIEMpIHsKCQkJCXZhciBTID0gdGFyZ2V0LmNvbnN0cnVjdG9yOwoJCQkJdmFyIFA7CgkJCQlpZiAoUyAhPT0gQyAmJiB0eXBlb2YgUyA9PSAnZnVuY3Rpb24nICYmIChQID0gUy5wcm90b3R5cGUpICE9PSBDLnByb3RvdHlwZSAmJiBpc09iamVjdChQKSAmJiBzZXRQcm90b3R5cGVPZikgewoJCQkJCXNldFByb3RvdHlwZU9mKHRoYXQsIFApOwoJCQkJfQoJCQkJcmV0dXJuIHRoYXQ7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA2OTQ0OgoJCS8qKiovICgobW9kdWxlKSA9PiB7CgovLyBmYXN0IGFwcGx5LCBodHRwOi8vanNwZXJmLmxua2l0LmNvbS9mYXN0LWFwcGx5LzUKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihmbiwgYXJncywgdGhhdCkgewoJCQkJdmFyIHVuID0gdGhhdCA9PT0gdW5kZWZpbmVkOwoJCQkJc3dpdGNoIChhcmdzLmxlbmd0aCkgewoJCQkJCWNhc2UgMDoKCQkJCQkJcmV0dXJuIHVuID8gZm4oKSA6IGZuLmNhbGwodGhhdCk7CgkJCQkJY2FzZSAxOgoJCQkJCQlyZXR1cm4gdW4gPyBmbihhcmdzWzBdKSA6IGZuLmNhbGwodGhhdCwgYXJnc1swXSk7CgkJCQkJY2FzZSAyOgoJCQkJCQlyZXR1cm4gdW4gPyBmbihhcmdzWzBdLCBhcmdzWzFdKSA6IGZuLmNhbGwodGhhdCwgYXJnc1swXSwgYXJnc1sxXSk7CgkJCQkJY2FzZSAzOgoJCQkJCQlyZXR1cm4gdW4gPyBmbihhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKSA6IGZuLmNhbGwodGhhdCwgYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSk7CgkJCQkJY2FzZSA0OgoJCQkJCQlyZXR1cm4gdW4gPyBmbihhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdKSA6IGZuLmNhbGwodGhhdCwgYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSwgYXJnc1szXSk7CgkJCQl9CgkJCQlyZXR1cm4gZm4uYXBwbHkodGhhdCwgYXJncyk7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA1ODc0OgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIGZhbGxiYWNrIGZvciBub24tYXJyYXktbGlrZSBFUzMgYW5kIG5vbi1lbnVtZXJhYmxlIG9sZCBWOCBzdHJpbmdzCgkJCXZhciBjb2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI0MzQpOwovLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcHJvdG90eXBlLWJ1aWx0aW5zCgkJCW1vZHVsZS5leHBvcnRzID0gT2JqZWN0KCd6JykucHJvcGVydHlJc0VudW1lcmFibGUoMCkgPyBPYmplY3QgOiBmdW5jdGlvbihpdCkgewoJCQkJcmV0dXJuIGNvZihpdCkgPT0gJ1N0cmluZycgPyBpdC5zcGxpdCgnJykgOiBPYmplY3QoaXQpOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNjU3NzoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyBjaGVjayBvbiBkZWZhdWx0IEFycmF5IGl0ZXJhdG9yCgkJCXZhciBJdGVyYXRvcnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM0NDQpOwoJCQl2YXIgSVRFUkFUT1IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI4NjcpKCdpdGVyYXRvcicpOwoJCQl2YXIgQXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCkgewoJCQkJcmV0dXJuIGl0ICE9PSB1bmRlZmluZWQgJiYgKEl0ZXJhdG9ycy5BcnJheSA9PT0gaXQgfHwgQXJyYXlQcm90b1tJVEVSQVRPUl0gPT09IGl0KTsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDE1MDI6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gNy4yLjIgSXNBcnJheShhcmd1bWVudCkKCQkJdmFyIGNvZiA9IF9fd2VicGFja19yZXF1aXJlX18oMjQzNCk7CgkJCW1vZHVsZS5leHBvcnRzID0gQXJyYXkuaXNBcnJheSB8fCBmdW5jdGlvbiBpc0FycmF5KGFyZykgewoJCQkJcmV0dXJuIGNvZihhcmcpID09ICdBcnJheSc7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA5NzQwOgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIwLjEuMi4zIE51bWJlci5pc0ludGVnZXIobnVtYmVyKQoJCQl2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2ODYpOwoJCQl2YXIgZmxvb3IgPSBNYXRoLmZsb29yOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGlzSW50ZWdlcihpdCkgewoJCQkJcmV0dXJuICFpc09iamVjdChpdCkgJiYgaXNGaW5pdGUoaXQpICYmIGZsb29yKGl0KSA9PT0gaXQ7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA0Njg2OgoJCS8qKiovICgobW9kdWxlKSA9PiB7CgoJCQlmdW5jdGlvbiBfdHlwZW9mKG8pIHsKCQkJCSdAYmFiZWwvaGVscGVycyAtIHR5cGVvZic7CgkJCQlyZXR1cm4gX3R5cGVvZiA9ICdmdW5jdGlvbicgPT0gdHlwZW9mIFN5bWJvbCAmJiAnc3ltYm9sJyA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24obykgewoJCQkJCXJldHVybiB0eXBlb2YgbzsKCQkJCX0gOiBmdW5jdGlvbihvKSB7CgkJCQkJcmV0dXJuIG8gJiYgJ2Z1bmN0aW9uJyA9PSB0eXBlb2YgU3ltYm9sICYmIG8uY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvICE9PSBTeW1ib2wucHJvdG90eXBlID8gJ3N5bWJvbCcgOiB0eXBlb2YgbzsKCQkJCX0sIF90eXBlb2Yobyk7CgkJCX0KCgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpIHsKCQkJCXJldHVybiBfdHlwZW9mKGl0KSA9PT0gJ29iamVjdCcgPyBpdCAhPT0gbnVsbCA6IHR5cGVvZiBpdCA9PT0gJ2Z1bmN0aW9uJzsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDg0MzA6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gNy4yLjggSXNSZWdFeHAoYXJndW1lbnQpCgkJCXZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNDY4Nik7CgkJCXZhciBjb2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI0MzQpOwoJCQl2YXIgTUFUQ0ggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI4NjcpKCdtYXRjaCcpOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KSB7CgkJCQl2YXIgaXNSZWdFeHA7CgkJCQlyZXR1cm4gaXNPYmplY3QoaXQpICYmICgoaXNSZWdFeHAgPSBpdFtNQVRDSF0pICE9PSB1bmRlZmluZWQgPyAhIWlzUmVnRXhwIDogY29mKGl0KSA9PSAnUmVnRXhwJyk7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAxNzIyOgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIGNhbGwgc29tZXRoaW5nIG9uIGl0ZXJhdG9yIHN0ZXAgd2l0aCBzYWZlIGNsb3Npbmcgb24gZXJyb3IKCQkJdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MTY2KTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdGVyYXRvciwgZm4sIHZhbHVlLCBlbnRyaWVzKSB7CgkJCQl0cnkgewoJCQkJCXJldHVybiBlbnRyaWVzID8gZm4oYW5PYmplY3QodmFsdWUpWzBdLCB2YWx1ZVsxXSkgOiBmbih2YWx1ZSk7CgkJCQkJLy8gNy40LjYgSXRlcmF0b3JDbG9zZShpdGVyYXRvciwgY29tcGxldGlvbikKCQkJCX0gY2F0Y2ggKGUpIHsKCQkJCQl2YXIgcmV0ID0gaXRlcmF0b3JbJ3JldHVybiddOwoJCQkJCWlmIChyZXQgIT09IHVuZGVmaW5lZCkgYW5PYmplY3QocmV0LmNhbGwoaXRlcmF0b3IpKTsKCQkJCQl0aHJvdyBlOwoJCQkJfQoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gODMxMToKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyIGNyZWF0ZSA9IF9fd2VicGFja19yZXF1aXJlX18oNTE0Mik7CgkJCXZhciBkZXNjcmlwdG9yID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3MjMpOwoJCQl2YXIgc2V0VG9TdHJpbmdUYWcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUzMjEpOwoJCQl2YXIgSXRlcmF0b3JQcm90b3R5cGUgPSB7fTsKCi8vIDI1LjEuMi4xLjEgJUl0ZXJhdG9yUHJvdG90eXBlJVtAQGl0ZXJhdG9yXSgpCgkJCV9fd2VicGFja19yZXF1aXJlX18oOTAzNikoSXRlcmF0b3JQcm90b3R5cGUsIF9fd2VicGFja19yZXF1aXJlX18oMjg2NykoJ2l0ZXJhdG9yJyksIGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuIHRoaXM7CgkJCX0pOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKENvbnN0cnVjdG9yLCBOQU1FLCBuZXh0KSB7CgkJCQlDb25zdHJ1Y3Rvci5wcm90b3R5cGUgPSBjcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUsIHsKCQkJCQluZXh0OiBkZXNjcmlwdG9yKDEsIG5leHQpCgkJCQl9KTsKCQkJCXNldFRvU3RyaW5nVGFnKENvbnN0cnVjdG9yLCBOQU1FICsgJyBJdGVyYXRvcicpOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gODkxNToKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyIExJQlJBUlkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY1NjcpOwoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciByZWRlZmluZSA9IF9fd2VicGFja19yZXF1aXJlX18oODkxNCk7CgkJCXZhciBoaWRlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5MDM2KTsKCQkJdmFyIEl0ZXJhdG9ycyA9IF9fd2VicGFja19yZXF1aXJlX18oMzQ0NCk7CgkJCXZhciAkaXRlckNyZWF0ZSA9IF9fd2VicGFja19yZXF1aXJlX18oODMxMSk7CgkJCXZhciBzZXRUb1N0cmluZ1RhZyA9IF9fd2VicGFja19yZXF1aXJlX18oNTMyMSk7CgkJCXZhciBnZXRQcm90b3R5cGVPZiA9IF9fd2VicGFja19yZXF1aXJlX18oODk5Nik7CgkJCXZhciBJVEVSQVRPUiA9IF9fd2VicGFja19yZXF1aXJlX18oMjg2NykoJ2l0ZXJhdG9yJyk7CgkJCXZhciBCVUdHWSA9ICEoW10ua2V5cyAmJiAnbmV4dCcgaW4gW10ua2V5cygpKTsgLy8gU2FmYXJpIGhhcyBidWdneSBpdGVyYXRvcnMgdy9vIGBuZXh0YAoJCQl2YXIgRkZfSVRFUkFUT1IgPSAnQEBpdGVyYXRvcic7CgkJCXZhciBLRVlTID0gJ2tleXMnOwoJCQl2YXIgVkFMVUVTID0gJ3ZhbHVlcyc7CgkJCXZhciByZXR1cm5UaGlzID0gZnVuY3Rpb24gcmV0dXJuVGhpcygpIHsKCQkJCXJldHVybiB0aGlzOwoJCQl9OwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKEJhc2UsIE5BTUUsIENvbnN0cnVjdG9yLCBuZXh0LCBERUZBVUxULCBJU19TRVQsIEZPUkNFRCkgewoJCQkJJGl0ZXJDcmVhdGUoQ29uc3RydWN0b3IsIE5BTUUsIG5leHQpOwoJCQkJdmFyIGdldE1ldGhvZCA9IGZ1bmN0aW9uIGdldE1ldGhvZChraW5kKSB7CgkJCQkJaWYgKCFCVUdHWSAmJiBraW5kIGluIHByb3RvKSByZXR1cm4gcHJvdG9ba2luZF07CgkJCQkJc3dpdGNoIChraW5kKSB7CgkJCQkJCWNhc2UgS0VZUzoKCQkJCQkJCXJldHVybiBmdW5jdGlvbiBrZXlzKCkgewoJCQkJCQkJCXJldHVybiBuZXcgQ29uc3RydWN0b3IodGhpcywga2luZCk7CgkJCQkJCQl9OwoJCQkJCQljYXNlIFZBTFVFUzoKCQkJCQkJCXJldHVybiBmdW5jdGlvbiB2YWx1ZXMoKSB7CgkJCQkJCQkJcmV0dXJuIG5ldyBDb25zdHJ1Y3Rvcih0aGlzLCBraW5kKTsKCQkJCQkJCX07CgkJCQkJfQoJCQkJCXJldHVybiBmdW5jdGlvbiBlbnRyaWVzKCkgewoJCQkJCQlyZXR1cm4gbmV3IENvbnN0cnVjdG9yKHRoaXMsIGtpbmQpOwoJCQkJCX07CgkJCQl9OwoJCQkJdmFyIFRBRyA9IE5BTUUgKyAnIEl0ZXJhdG9yJzsKCQkJCXZhciBERUZfVkFMVUVTID0gREVGQVVMVCA9PSBWQUxVRVM7CgkJCQl2YXIgVkFMVUVTX0JVRyA9IGZhbHNlOwoJCQkJdmFyIHByb3RvID0gQmFzZS5wcm90b3R5cGU7CgkJCQl2YXIgJG5hdGl2ZSA9IHByb3RvW0lURVJBVE9SXSB8fCBwcm90b1tGRl9JVEVSQVRPUl0gfHwgREVGQVVMVCAmJiBwcm90b1tERUZBVUxUXTsKCQkJCXZhciAkZGVmYXVsdCA9ICRuYXRpdmUgfHwgZ2V0TWV0aG9kKERFRkFVTFQpOwoJCQkJdmFyICRlbnRyaWVzID0gREVGQVVMVCA/ICFERUZfVkFMVUVTID8gJGRlZmF1bHQgOiBnZXRNZXRob2QoJ2VudHJpZXMnKSA6IHVuZGVmaW5lZDsKCQkJCXZhciAkYW55TmF0aXZlID0gTkFNRSA9PSAnQXJyYXknID8gcHJvdG8uZW50cmllcyB8fCAkbmF0aXZlIDogJG5hdGl2ZTsKCQkJCXZhciBtZXRob2RzLCBrZXksIEl0ZXJhdG9yUHJvdG90eXBlOwoJCQkJLy8gRml4IG5hdGl2ZQoJCQkJaWYgKCRhbnlOYXRpdmUpIHsKCQkJCQlJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvdHlwZU9mKCRhbnlOYXRpdmUuY2FsbChuZXcgQmFzZSgpKSk7CgkJCQkJaWYgKEl0ZXJhdG9yUHJvdG90eXBlICE9PSBPYmplY3QucHJvdG90eXBlICYmIEl0ZXJhdG9yUHJvdG90eXBlLm5leHQpIHsKCQkJCQkJLy8gU2V0IEBAdG9TdHJpbmdUYWcgdG8gbmF0aXZlIGl0ZXJhdG9ycwoJCQkJCQlzZXRUb1N0cmluZ1RhZyhJdGVyYXRvclByb3RvdHlwZSwgVEFHLCB0cnVlKTsKCQkJCQkJLy8gZml4IGZvciBzb21lIG9sZCBlbmdpbmVzCgkJCQkJCWlmICghTElCUkFSWSAmJiB0eXBlb2YgSXRlcmF0b3JQcm90b3R5cGVbSVRFUkFUT1JdICE9ICdmdW5jdGlvbicpIGhpZGUoSXRlcmF0b3JQcm90b3R5cGUsIElURVJBVE9SLCByZXR1cm5UaGlzKTsKCQkJCQl9CgkJCQl9CgkJCQkvLyBmaXggQXJyYXkje3ZhbHVlcywgQEBpdGVyYXRvcn0ubmFtZSBpbiBWOCAvIEZGCgkJCQlpZiAoREVGX1ZBTFVFUyAmJiAkbmF0aXZlICYmICRuYXRpdmUubmFtZSAhPT0gVkFMVUVTKSB7CgkJCQkJVkFMVUVTX0JVRyA9IHRydWU7CgkJCQkJJGRlZmF1bHQgPSBmdW5jdGlvbiB2YWx1ZXMoKSB7CgkJCQkJCXJldHVybiAkbmF0aXZlLmNhbGwodGhpcyk7CgkJCQkJfTsKCQkJCX0KCQkJCS8vIERlZmluZSBpdGVyYXRvcgoJCQkJaWYgKCghTElCUkFSWSB8fCBGT1JDRUQpICYmIChCVUdHWSB8fCBWQUxVRVNfQlVHIHx8ICFwcm90b1tJVEVSQVRPUl0pKSB7CgkJCQkJaGlkZShwcm90bywgSVRFUkFUT1IsICRkZWZhdWx0KTsKCQkJCX0KCQkJCS8vIFBsdWcgZm9yIGxpYnJhcnkKCQkJCUl0ZXJhdG9yc1tOQU1FXSA9ICRkZWZhdWx0OwoJCQkJSXRlcmF0b3JzW1RBR10gPSByZXR1cm5UaGlzOwoJCQkJaWYgKERFRkFVTFQpIHsKCQkJCQltZXRob2RzID0gewoJCQkJCQl2YWx1ZXM6IERFRl9WQUxVRVMgPyAkZGVmYXVsdCA6IGdldE1ldGhvZChWQUxVRVMpLAoJCQkJCQlrZXlzOiBJU19TRVQgPyAkZGVmYXVsdCA6IGdldE1ldGhvZChLRVlTKSwKCQkJCQkJZW50cmllczogJGVudHJpZXMKCQkJCQl9OwoJCQkJCWlmIChGT1JDRUQpIGZvciAoa2V5IGluIG1ldGhvZHMpIHsKCQkJCQkJaWYgKCEoa2V5IGluIHByb3RvKSkgcmVkZWZpbmUocHJvdG8sIGtleSwgbWV0aG9kc1trZXldKTsKCQkJCQl9IGVsc2UgJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiAoQlVHR1kgfHwgVkFMVUVTX0JVRyksIE5BTUUsIG1ldGhvZHMpOwoJCQkJfQoJCQkJcmV0dXJuIG1ldGhvZHM7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA5Mjk6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJdmFyIElURVJBVE9SID0gX193ZWJwYWNrX3JlcXVpcmVfXygyODY3KSgnaXRlcmF0b3InKTsKCQkJdmFyIFNBRkVfQ0xPU0lORyA9IGZhbHNlOwoJCQl0cnkgewoJCQkJdmFyIHJpdGVyID0gWzddW0lURVJBVE9SXSgpOwoJCQkJcml0ZXJbJ3JldHVybiddID0gZnVuY3Rpb24oKSB7CgkJCQkJU0FGRV9DTE9TSU5HID0gdHJ1ZTsKCQkJCX07CgkJCQkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdGhyb3ctbGl0ZXJhbAoJCQkJQXJyYXkuZnJvbShyaXRlciwgZnVuY3Rpb24oKSB7CgkJCQkJdGhyb3cgMjsKCQkJCX0pOwoJCQl9IGNhdGNoIChlKSB7LyogZW1wdHkgKi8KCQkJfQoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGV4ZWMsIHNraXBDbG9zaW5nKSB7CgkJCQlpZiAoIXNraXBDbG9zaW5nICYmICFTQUZFX0NMT1NJTkcpIHJldHVybiBmYWxzZTsKCQkJCXZhciBzYWZlID0gZmFsc2U7CgkJCQl0cnkgewoJCQkJCXZhciBhcnIgPSBbN107CgkJCQkJdmFyIGl0ZXIgPSBhcnJbSVRFUkFUT1JdKCk7CgkJCQkJaXRlci5uZXh0ID0gZnVuY3Rpb24oKSB7CgkJCQkJCXJldHVybiB7CgkJCQkJCQlkb25lOiBzYWZlID0gdHJ1ZQoJCQkJCQl9OwoJCQkJCX07CgkJCQkJYXJyW0lURVJBVE9SXSA9IGZ1bmN0aW9uKCkgewoJCQkJCQlyZXR1cm4gaXRlcjsKCQkJCQl9OwoJCQkJCWV4ZWMoYXJyKTsKCQkJCX0gY2F0Y2ggKGUpIHsvKiBlbXB0eSAqLwoJCQkJfQoJCQkJcmV0dXJuIHNhZmU7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA5NDk4OgoJCS8qKiovICgobW9kdWxlKSA9PiB7CgoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGRvbmUsIHZhbHVlKSB7CgkJCQlyZXR1cm4gewoJCQkJCXZhbHVlOiB2YWx1ZSwKCQkJCQlkb25lOiAhIWRvbmUKCQkJCX07CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAzNDQ0OgoJCS8qKiovICgobW9kdWxlKSA9PiB7CgoJCQltb2R1bGUuZXhwb3J0cyA9IHt9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNjU2NzoKCQkvKioqLyAoKG1vZHVsZSkgPT4gewoKCQkJbW9kdWxlLmV4cG9ydHMgPSBmYWxzZTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDg2MzY6CgkJLyoqKi8gKChtb2R1bGUpID0+IHsKCi8vIDIwLjIuMi4xNCBNYXRoLmV4cG0xKHgpCgkJCXZhciAkZXhwbTEgPSBNYXRoLmV4cG0xOwoJCQltb2R1bGUuZXhwb3J0cyA9ICEkZXhwbTEKCQkJLy8gT2xkIEZGIGJ1ZwoJCQl8fCAkZXhwbTEoMTApID4gMjIwMjUuNDY1Nzk0ODA2NzE5IHx8ICRleHBtMSgxMCkgPCAyMjAyNS40NjU3OTQ4MDY3MTY1MTY4CgkJCS8vIFRvciBCcm93c2VyIGJ1ZwoJCQl8fCAkZXhwbTEoLTJlLTE3KSAhPSAtMmUtMTcgPyBmdW5jdGlvbiBleHBtMSh4KSB7CgkJCQlyZXR1cm4gKHggPSAreCkgPT0gMCA/IHggOiB4ID4gLTFlLTYgJiYgeCA8IDFlLTYgPyB4ICsgeCAqIHggLyAyIDogTWF0aC5leHAoeCkgLSAxOwoJCQl9IDogJGV4cG0xOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMzM6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMjAuMi4yLjE2IE1hdGguZnJvdW5kKHgpCgkJCXZhciBzaWduID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2NDg2KTsKCQkJdmFyIHBvdyA9IE1hdGgucG93OwoJCQl2YXIgRVBTSUxPTiA9IHBvdygyLCAtNTIpOwoJCQl2YXIgRVBTSUxPTjMyID0gcG93KDIsIC0yMyk7CgkJCXZhciBNQVgzMiA9IHBvdygyLCAxMjcpICogKDIgLSBFUFNJTE9OMzIpOwoJCQl2YXIgTUlOMzIgPSBwb3coMiwgLTEyNik7CgkJCXZhciByb3VuZFRpZXNUb0V2ZW4gPSBmdW5jdGlvbiByb3VuZFRpZXNUb0V2ZW4obikgewoJCQkJcmV0dXJuIG4gKyAxIC8gRVBTSUxPTiAtIDEgLyBFUFNJTE9OOwoJCQl9OwoJCQltb2R1bGUuZXhwb3J0cyA9IE1hdGguZnJvdW5kIHx8IGZ1bmN0aW9uIGZyb3VuZCh4KSB7CgkJCQl2YXIgJGFicyA9IE1hdGguYWJzKHgpOwoJCQkJdmFyICRzaWduID0gc2lnbih4KTsKCQkJCXZhciBhLCByZXN1bHQ7CgkJCQlpZiAoJGFicyA8IE1JTjMyKSByZXR1cm4gJHNpZ24gKiByb3VuZFRpZXNUb0V2ZW4oJGFicyAvIE1JTjMyIC8gRVBTSUxPTjMyKSAqIE1JTjMyICogRVBTSUxPTjMyOwoJCQkJYSA9ICgxICsgRVBTSUxPTjMyIC8gRVBTSUxPTikgKiAkYWJzOwoJCQkJcmVzdWx0ID0gYSAtIChhIC0gJGFicyk7CgkJCQkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlCgkJCQlpZiAocmVzdWx0ID4gTUFYMzIgfHwgcmVzdWx0ICE9IHJlc3VsdCkgcmV0dXJuICRzaWduICogSW5maW5pdHk7CgkJCQlyZXR1cm4gJHNpZ24gKiByZXN1bHQ7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA0OTc2OgoJCS8qKiovICgobW9kdWxlKSA9PiB7CgovLyAyMC4yLjIuMjAgTWF0aC5sb2cxcCh4KQoJCQltb2R1bGUuZXhwb3J0cyA9IE1hdGgubG9nMXAgfHwgZnVuY3Rpb24gbG9nMXAoeCkgewoJCQkJcmV0dXJuICh4ID0gK3gpID4gLTFlLTggJiYgeCA8IDFlLTggPyB4IC0geCAqIHggLyAyIDogTWF0aC5sb2coMSArIHgpOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMjE1NToKCQkvKioqLyAoKG1vZHVsZSkgPT4gewoKLy8gaHR0cHM6Ly9yd2FsZHJvbi5naXRodWIuaW8vcHJvcG9zYWwtbWF0aC1leHRlbnNpb25zLwoJCQltb2R1bGUuZXhwb3J0cyA9IE1hdGguc2NhbGUgfHwgZnVuY3Rpb24gc2NhbGUoeCwgaW5Mb3csIGluSGlnaCwgb3V0TG93LCBvdXRIaWdoKSB7CgkJCQlpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMAoJCQkJCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmUKCQkJCQl8fCB4ICE9IHgKCQkJCQkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlCgkJCQkJfHwgaW5Mb3cgIT0gaW5Mb3cKCQkJCQkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlCgkJCQkJfHwgaW5IaWdoICE9IGluSGlnaAoJCQkJCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmUKCQkJCQl8fCBvdXRMb3cgIT0gb3V0TG93CgkJCQkJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXNlbGYtY29tcGFyZQoJCQkJCXx8IG91dEhpZ2ggIT0gb3V0SGlnaCkgcmV0dXJuIE5hTjsKCQkJCWlmICh4ID09PSBJbmZpbml0eSB8fCB4ID09PSAtSW5maW5pdHkpIHJldHVybiB4OwoJCQkJcmV0dXJuICh4IC0gaW5Mb3cpICogKG91dEhpZ2ggLSBvdXRMb3cpIC8gKGluSGlnaCAtIGluTG93KSArIG91dExvdzsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDY0ODY6CgkJLyoqKi8gKChtb2R1bGUpID0+IHsKCi8vIDIwLjIuMi4yOCBNYXRoLnNpZ24oeCkKCQkJbW9kdWxlLmV4cG9ydHMgPSBNYXRoLnNpZ24gfHwgZnVuY3Rpb24gc2lnbih4KSB7CgkJCQkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlCgkJCQlyZXR1cm4gKHggPSAreCkgPT0gMCB8fCB4ICE9IHggPyB4IDogeCA8IDAgPyAtMSA6IDE7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAyMzY5OgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCWZ1bmN0aW9uIF90eXBlb2YobykgewoJCQkJJ0BiYWJlbC9oZWxwZXJzIC0gdHlwZW9mJzsKCQkJCXJldHVybiBfdHlwZW9mID0gJ2Z1bmN0aW9uJyA9PSB0eXBlb2YgU3ltYm9sICYmICdzeW1ib2wnID09IHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPyBmdW5jdGlvbihvKSB7CgkJCQkJcmV0dXJuIHR5cGVvZiBvOwoJCQkJfSA6IGZ1bmN0aW9uKG8pIHsKCQkJCQlyZXR1cm4gbyAmJiAnZnVuY3Rpb24nID09IHR5cGVvZiBTeW1ib2wgJiYgby5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG8gIT09IFN5bWJvbC5wcm90b3R5cGUgPyAnc3ltYm9sJyA6IHR5cGVvZiBvOwoJCQkJfSwgX3R5cGVvZihvKTsKCQkJfQoKCQkJdmFyIE1FVEEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYxNykoJ21ldGEnKTsKCQkJdmFyIGlzT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0Njg2KTsKCQkJdmFyIGhhcyA9IF9fd2VicGFja19yZXF1aXJlX18oNDk5Nyk7CgkJCXZhciBzZXREZXNjID0gKF9fd2VicGFja19yZXF1aXJlX18oMTUxNSkuZik7CgkJCXZhciBpZCA9IDA7CgkJCXZhciBpc0V4dGVuc2libGUgPSBPYmplY3QuaXNFeHRlbnNpYmxlIHx8IGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuIHRydWU7CgkJCX07CgkJCXZhciBGUkVFWkUgPSAhX193ZWJwYWNrX3JlcXVpcmVfXygxMjgpKGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuIGlzRXh0ZW5zaWJsZShPYmplY3QucHJldmVudEV4dGVuc2lvbnMoe30pKTsKCQkJfSk7CgkJCXZhciBzZXRNZXRhID0gZnVuY3Rpb24gc2V0TWV0YShpdCkgewoJCQkJc2V0RGVzYyhpdCwgTUVUQSwgewoJCQkJCXZhbHVlOiB7CgkJCQkJCWk6ICdPJyArICsraWQsCgkJCQkJCS8vIG9iamVjdCBJRAoJCQkJCQl3OiB7fSAvLyB3ZWFrIGNvbGxlY3Rpb25zIElEcwoJCQkJCX0KCQkJCX0pOwoJCQl9OwoJCQl2YXIgZmFzdEtleSA9IGZ1bmN0aW9uIGZhc3RLZXkoaXQsIGNyZWF0ZSkgewoJCQkJLy8gcmV0dXJuIHByaW1pdGl2ZSB3aXRoIHByZWZpeAoJCQkJaWYgKCFpc09iamVjdChpdCkpIHJldHVybiBfdHlwZW9mKGl0KSA9PSAnc3ltYm9sJyA/IGl0IDogKHR5cGVvZiBpdCA9PSAnc3RyaW5nJyA/ICdTJyA6ICdQJykgKyBpdDsKCQkJCWlmICghaGFzKGl0LCBNRVRBKSkgewoJCQkJCS8vIGNhbid0IHNldCBtZXRhZGF0YSB0byB1bmNhdWdodCBmcm96ZW4gb2JqZWN0CgkJCQkJaWYgKCFpc0V4dGVuc2libGUoaXQpKSByZXR1cm4gJ0YnOwoJCQkJCS8vIG5vdCBuZWNlc3NhcnkgdG8gYWRkIG1ldGFkYXRhCgkJCQkJaWYgKCFjcmVhdGUpIHJldHVybiAnRSc7CgkJCQkJLy8gYWRkIG1pc3NpbmcgbWV0YWRhdGEKCQkJCQlzZXRNZXRhKGl0KTsKCQkJCQkvLyByZXR1cm4gb2JqZWN0IElECgkJCQl9CgkJCQlyZXR1cm4gaXRbTUVUQV0uaTsKCQkJfTsKCQkJdmFyIGdldFdlYWsgPSBmdW5jdGlvbiBnZXRXZWFrKGl0LCBjcmVhdGUpIHsKCQkJCWlmICghaGFzKGl0LCBNRVRBKSkgewoJCQkJCS8vIGNhbid0IHNldCBtZXRhZGF0YSB0byB1bmNhdWdodCBmcm96ZW4gb2JqZWN0CgkJCQkJaWYgKCFpc0V4dGVuc2libGUoaXQpKSByZXR1cm4gdHJ1ZTsKCQkJCQkvLyBub3QgbmVjZXNzYXJ5IHRvIGFkZCBtZXRhZGF0YQoJCQkJCWlmICghY3JlYXRlKSByZXR1cm4gZmFsc2U7CgkJCQkJLy8gYWRkIG1pc3NpbmcgbWV0YWRhdGEKCQkJCQlzZXRNZXRhKGl0KTsKCQkJCQkvLyByZXR1cm4gaGFzaCB3ZWFrIGNvbGxlY3Rpb25zIElEcwoJCQkJfQoJCQkJcmV0dXJuIGl0W01FVEFdLnc7CgkJCX07Ci8vIGFkZCBtZXRhZGF0YSBvbiBmcmVlemUtZmFtaWx5IG1ldGhvZHMgY2FsbGluZwoJCQl2YXIgb25GcmVlemUgPSBmdW5jdGlvbiBvbkZyZWV6ZShpdCkgewoJCQkJaWYgKEZSRUVaRSAmJiBtZXRhLk5FRUQgJiYgaXNFeHRlbnNpYmxlKGl0KSAmJiAhaGFzKGl0LCBNRVRBKSkgc2V0TWV0YShpdCk7CgkJCQlyZXR1cm4gaXQ7CgkJCX07CgkJCXZhciBtZXRhID0gbW9kdWxlLmV4cG9ydHMgPSB7CgkJCQlLRVk6IE1FVEEsCgkJCQlORUVEOiBmYWxzZSwKCQkJCWZhc3RLZXk6IGZhc3RLZXksCgkJCQlnZXRXZWFrOiBnZXRXZWFrLAoJCQkJb25GcmVlemU6IG9uRnJlZXplCgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA4NTU4OgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCWZ1bmN0aW9uIF90eXBlb2YobykgewoJCQkJJ0BiYWJlbC9oZWxwZXJzIC0gdHlwZW9mJzsKCQkJCXJldHVybiBfdHlwZW9mID0gJ2Z1bmN0aW9uJyA9PSB0eXBlb2YgU3ltYm9sICYmICdzeW1ib2wnID09IHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPyBmdW5jdGlvbihvKSB7CgkJCQkJcmV0dXJuIHR5cGVvZiBvOwoJCQkJfSA6IGZ1bmN0aW9uKG8pIHsKCQkJCQlyZXR1cm4gbyAmJiAnZnVuY3Rpb24nID09IHR5cGVvZiBTeW1ib2wgJiYgby5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG8gIT09IFN5bWJvbC5wcm90b3R5cGUgPyAnc3ltYm9sJyA6IHR5cGVvZiBvOwoJCQkJfSwgX3R5cGVvZihvKTsKCQkJfQoKCQkJdmFyIE1hcCA9IF9fd2VicGFja19yZXF1aXJlX18oNTMxKTsKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQl2YXIgc2hhcmVkID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NDApKCdtZXRhZGF0YScpOwoJCQl2YXIgc3RvcmUgPSBzaGFyZWQuc3RvcmUgfHwgKHNoYXJlZC5zdG9yZSA9IG5ldyAoX193ZWJwYWNrX3JlcXVpcmVfXyg1NjQyKSkoKSk7CgkJCXZhciBnZXRPckNyZWF0ZU1ldGFkYXRhTWFwID0gZnVuY3Rpb24gZ2V0T3JDcmVhdGVNZXRhZGF0YU1hcCh0YXJnZXQsIHRhcmdldEtleSwgY3JlYXRlKSB7CgkJCQl2YXIgdGFyZ2V0TWV0YWRhdGEgPSBzdG9yZS5nZXQodGFyZ2V0KTsKCQkJCWlmICghdGFyZ2V0TWV0YWRhdGEpIHsKCQkJCQlpZiAoIWNyZWF0ZSkgcmV0dXJuIHVuZGVmaW5lZDsKCQkJCQlzdG9yZS5zZXQodGFyZ2V0LCB0YXJnZXRNZXRhZGF0YSA9IG5ldyBNYXAoKSk7CgkJCQl9CgkJCQl2YXIga2V5TWV0YWRhdGEgPSB0YXJnZXRNZXRhZGF0YS5nZXQodGFyZ2V0S2V5KTsKCQkJCWlmICgha2V5TWV0YWRhdGEpIHsKCQkJCQlpZiAoIWNyZWF0ZSkgcmV0dXJuIHVuZGVmaW5lZDsKCQkJCQl0YXJnZXRNZXRhZGF0YS5zZXQodGFyZ2V0S2V5LCBrZXlNZXRhZGF0YSA9IG5ldyBNYXAoKSk7CgkJCQl9CgkJCQlyZXR1cm4ga2V5TWV0YWRhdGE7CgkJCX07CgkJCXZhciBvcmRpbmFyeUhhc093bk1ldGFkYXRhID0gZnVuY3Rpb24gb3JkaW5hcnlIYXNPd25NZXRhZGF0YShNZXRhZGF0YUtleSwgTywgUCkgewoJCQkJdmFyIG1ldGFkYXRhTWFwID0gZ2V0T3JDcmVhdGVNZXRhZGF0YU1hcChPLCBQLCBmYWxzZSk7CgkJCQlyZXR1cm4gbWV0YWRhdGFNYXAgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogbWV0YWRhdGFNYXAuaGFzKE1ldGFkYXRhS2V5KTsKCQkJfTsKCQkJdmFyIG9yZGluYXJ5R2V0T3duTWV0YWRhdGEgPSBmdW5jdGlvbiBvcmRpbmFyeUdldE93bk1ldGFkYXRhKE1ldGFkYXRhS2V5LCBPLCBQKSB7CgkJCQl2YXIgbWV0YWRhdGFNYXAgPSBnZXRPckNyZWF0ZU1ldGFkYXRhTWFwKE8sIFAsIGZhbHNlKTsKCQkJCXJldHVybiBtZXRhZGF0YU1hcCA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogbWV0YWRhdGFNYXAuZ2V0KE1ldGFkYXRhS2V5KTsKCQkJfTsKCQkJdmFyIG9yZGluYXJ5RGVmaW5lT3duTWV0YWRhdGEgPSBmdW5jdGlvbiBvcmRpbmFyeURlZmluZU93bk1ldGFkYXRhKE1ldGFkYXRhS2V5LCBNZXRhZGF0YVZhbHVlLCBPLCBQKSB7CgkJCQlnZXRPckNyZWF0ZU1ldGFkYXRhTWFwKE8sIFAsIHRydWUpLnNldChNZXRhZGF0YUtleSwgTWV0YWRhdGFWYWx1ZSk7CgkJCX07CgkJCXZhciBvcmRpbmFyeU93bk1ldGFkYXRhS2V5cyA9IGZ1bmN0aW9uIG9yZGluYXJ5T3duTWV0YWRhdGFLZXlzKHRhcmdldCwgdGFyZ2V0S2V5KSB7CgkJCQl2YXIgbWV0YWRhdGFNYXAgPSBnZXRPckNyZWF0ZU1ldGFkYXRhTWFwKHRhcmdldCwgdGFyZ2V0S2V5LCBmYWxzZSk7CgkJCQl2YXIga2V5cyA9IFtdOwoJCQkJaWYgKG1ldGFkYXRhTWFwKSBtZXRhZGF0YU1hcC5mb3JFYWNoKGZ1bmN0aW9uKF8sIGtleSkgewoJCQkJCWtleXMucHVzaChrZXkpOwoJCQkJfSk7CgkJCQlyZXR1cm4ga2V5czsKCQkJfTsKCQkJdmFyIHRvTWV0YUtleSA9IGZ1bmN0aW9uIHRvTWV0YUtleShpdCkgewoJCQkJcmV0dXJuIGl0ID09PSB1bmRlZmluZWQgfHwgX3R5cGVvZihpdCkgPT0gJ3N5bWJvbCcgPyBpdCA6IFN0cmluZyhpdCk7CgkJCX07CgkJCXZhciBleHAgPSBmdW5jdGlvbiBleHAoTykgewoJCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdSZWZsZWN0JywgTyk7CgkJCX07CgkJCW1vZHVsZS5leHBvcnRzID0gewoJCQkJc3RvcmU6IHN0b3JlLAoJCQkJbWFwOiBnZXRPckNyZWF0ZU1ldGFkYXRhTWFwLAoJCQkJaGFzOiBvcmRpbmFyeUhhc093bk1ldGFkYXRhLAoJCQkJZ2V0OiBvcmRpbmFyeUdldE93bk1ldGFkYXRhLAoJCQkJc2V0OiBvcmRpbmFyeURlZmluZU93bk1ldGFkYXRhLAoJCQkJa2V5czogb3JkaW5hcnlPd25NZXRhZGF0YUtleXMsCgkJCQlrZXk6IHRvTWV0YUtleSwKCQkJCWV4cDogZXhwCgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAyNjg0OgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciBnbG9iYWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk3NjkpOwoJCQl2YXIgbWFjcm90YXNrID0gKF9fd2VicGFja19yZXF1aXJlX18oNTAyOSkuc2V0KTsKCQkJdmFyIE9ic2VydmVyID0gZ2xvYmFsLk11dGF0aW9uT2JzZXJ2ZXIgfHwgZ2xvYmFsLldlYktpdE11dGF0aW9uT2JzZXJ2ZXI7CgkJCXZhciBwcm9jZXNzID0gZ2xvYmFsLnByb2Nlc3M7CgkJCXZhciBQcm9taXNlID0gZ2xvYmFsLlByb21pc2U7CgkJCXZhciBpc05vZGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI0MzQpKHByb2Nlc3MpID09ICdwcm9jZXNzJzsKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpIHsKCQkJCXZhciBoZWFkLCBsYXN0LCBub3RpZnk7CgkJCQl2YXIgZmx1c2ggPSBmdW5jdGlvbiBmbHVzaCgpIHsKCQkJCQl2YXIgcGFyZW50LCBmbjsKCQkJCQlpZiAoaXNOb2RlICYmIChwYXJlbnQgPSBwcm9jZXNzLmRvbWFpbikpIHBhcmVudC5leGl0KCk7CgkJCQkJd2hpbGUgKGhlYWQpIHsKCQkJCQkJZm4gPSBoZWFkLmZuOwoJCQkJCQloZWFkID0gaGVhZC5uZXh0OwoJCQkJCQl0cnkgewoJCQkJCQkJZm4oKTsKCQkJCQkJfSBjYXRjaCAoZSkgewoJCQkJCQkJaWYgKGhlYWQpIG5vdGlmeSgpOyBlbHNlIGxhc3QgPSB1bmRlZmluZWQ7CgkJCQkJCQl0aHJvdyBlOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWxhc3QgPSB1bmRlZmluZWQ7CgkJCQkJaWYgKHBhcmVudCkgcGFyZW50LmVudGVyKCk7CgkJCQl9OwoKCQkJCS8vIE5vZGUuanMKCQkJCWlmIChpc05vZGUpIHsKCQkJCQlub3RpZnkgPSBmdW5jdGlvbiBub3RpZnkoKSB7CgkJCQkJCXByb2Nlc3MubmV4dFRpY2soZmx1c2gpOwoJCQkJCX07CgkJCQkJLy8gYnJvd3NlcnMgd2l0aCBNdXRhdGlvbk9ic2VydmVyLCBleGNlcHQgaU9TIFNhZmFyaSAtIGh0dHBzOi8vZ2l0aHViLmNvbS96bG9pcm9jay9jb3JlLWpzL2lzc3Vlcy8zMzkKCQkJCX0gZWxzZSBpZiAoT2JzZXJ2ZXIgJiYgIShnbG9iYWwubmF2aWdhdG9yICYmIGdsb2JhbC5uYXZpZ2F0b3Iuc3RhbmRhbG9uZSkpIHsKCQkJCQl2YXIgdG9nZ2xlID0gdHJ1ZTsKCQkJCQl2YXIgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnKTsKCQkJCQluZXcgT2JzZXJ2ZXIoZmx1c2gpLm9ic2VydmUobm9kZSwgewoJCQkJCQljaGFyYWN0ZXJEYXRhOiB0cnVlCgkJCQkJfSk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tbmV3CgkJCQkJbm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5KCkgewoJCQkJCQlub2RlLmRhdGEgPSB0b2dnbGUgPSAhdG9nZ2xlOwoJCQkJCX07CgkJCQkJLy8gZW52aXJvbm1lbnRzIHdpdGggbWF5YmUgbm9uLWNvbXBsZXRlbHkgY29ycmVjdCwgYnV0IGV4aXN0ZW50IFByb21pc2UKCQkJCX0gZWxzZSBpZiAoUHJvbWlzZSAmJiBQcm9taXNlLnJlc29sdmUpIHsKCQkJCQkvLyBQcm9taXNlLnJlc29sdmUgd2l0aG91dCBhbiBhcmd1bWVudCB0aHJvd3MgYW4gZXJyb3IgaW4gTEcgV2ViT1MgMgoJCQkJCXZhciBwcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKHVuZGVmaW5lZCk7CgkJCQkJbm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5KCkgewoJCQkJCQlwcm9taXNlLnRoZW4oZmx1c2gpOwoJCQkJCX07CgkJCQkJLy8gZm9yIG90aGVyIGVudmlyb25tZW50cyAtIG1hY3JvdGFzayBiYXNlZCBvbjoKCQkJCQkvLyAtIHNldEltbWVkaWF0ZQoJCQkJCS8vIC0gTWVzc2FnZUNoYW5uZWwKCQkJCQkvLyAtIHdpbmRvdy5wb3N0TWVzc2FnCgkJCQkJLy8gLSBvbnJlYWR5c3RhdGVjaGFuZ2UKCQkJCQkvLyAtIHNldFRpbWVvdXQKCQkJCX0gZWxzZSB7CgkJCQkJbm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5KCkgewoJCQkJCQkvLyBzdHJhbmdlIElFICsgd2VicGFjayBkZXYgc2VydmVyIGJ1ZyAtIHVzZSAuY2FsbChnbG9iYWwpCgkJCQkJCW1hY3JvdGFzay5jYWxsKGdsb2JhbCwgZmx1c2gpOwoJCQkJCX07CgkJCQl9CgkJCQlyZXR1cm4gZnVuY3Rpb24oZm4pIHsKCQkJCQl2YXIgdGFzayA9IHsKCQkJCQkJZm46IGZuLAoJCQkJCQluZXh0OiB1bmRlZmluZWQKCQkJCQl9OwoJCQkJCWlmIChsYXN0KSBsYXN0Lm5leHQgPSB0YXNrOwoJCQkJCWlmICghaGVhZCkgewoJCQkJCQloZWFkID0gdGFzazsKCQkJCQkJbm90aWZ5KCk7CgkJCQkJfQoJCQkJCWxhc3QgPSB0YXNrOwoJCQkJfTsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDI2Mzg6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCi8vIDI1LjQuMS41IE5ld1Byb21pc2VDYXBhYmlsaXR5KEMpCgkJCXZhciBhRnVuY3Rpb24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ4MTApOwoKCQkJZnVuY3Rpb24gUHJvbWlzZUNhcGFiaWxpdHkoQykgewoJCQkJdmFyIHJlc29sdmUsIHJlamVjdDsKCQkJCXRoaXMucHJvbWlzZSA9IG5ldyBDKGZ1bmN0aW9uKCQkcmVzb2x2ZSwgJCRyZWplY3QpIHsKCQkJCQlpZiAocmVzb2x2ZSAhPT0gdW5kZWZpbmVkIHx8IHJlamVjdCAhPT0gdW5kZWZpbmVkKSB0aHJvdyBUeXBlRXJyb3IoJ0JhZCBQcm9taXNlIGNvbnN0cnVjdG9yJyk7CgkJCQkJcmVzb2x2ZSA9ICQkcmVzb2x2ZTsKCQkJCQlyZWplY3QgPSAkJHJlamVjdDsKCQkJCX0pOwoJCQkJdGhpcy5yZXNvbHZlID0gYUZ1bmN0aW9uKHJlc29sdmUpOwoJCQkJdGhpcy5yZWplY3QgPSBhRnVuY3Rpb24ocmVqZWN0KTsKCQkJfQoKCQkJbW9kdWxlLmV4cG9ydHMuZiA9IGZ1bmN0aW9uKEMpIHsKCQkJCXJldHVybiBuZXcgUHJvbWlzZUNhcGFiaWxpdHkoQyk7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA3NjY2OgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyAxOS4xLjIuMSBPYmplY3QuYXNzaWduKHRhcmdldCwgc291cmNlLCAuLi4pCgkJCXZhciBERVNDUklQVE9SUyA9IF9fd2VicGFja19yZXF1aXJlX18oNTE5NCk7CgkJCXZhciBnZXRLZXlzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2NDM2KTsKCQkJdmFyIGdPUFMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU5NDQpOwoJCQl2YXIgcElFID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMjcxKTsKCQkJdmFyIHRvT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0ODIwKTsKCQkJdmFyIElPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU4NzQpOwoJCQl2YXIgJGFzc2lnbiA9IE9iamVjdC5hc3NpZ247CgovLyBzaG91bGQgd29yayB3aXRoIHN5bWJvbHMgYW5kIHNob3VsZCBoYXZlIGRldGVybWluaXN0aWMgcHJvcGVydHkgb3JkZXIgKFY4IGJ1ZykKCQkJbW9kdWxlLmV4cG9ydHMgPSAhJGFzc2lnbiB8fCBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyOCkoZnVuY3Rpb24oKSB7CgkJCQl2YXIgQSA9IHt9OwoJCQkJdmFyIEIgPSB7fTsKCQkJCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bmRlZgoJCQkJdmFyIFMgPSBTeW1ib2woKTsKCQkJCXZhciBLID0gJ2FiY2RlZmdoaWprbG1ub3BxcnN0JzsKCQkJCUFbU10gPSA3OwoJCQkJSy5zcGxpdCgnJykuZm9yRWFjaChmdW5jdGlvbihrKSB7CgkJCQkJQltrXSA9IGs7CgkJCQl9KTsKCQkJCXJldHVybiAkYXNzaWduKHt9LCBBKVtTXSAhPSA3IHx8IE9iamVjdC5rZXlzKCRhc3NpZ24oe30sIEIpKS5qb2luKCcnKSAhPSBLOwoJCQl9KSA/IGZ1bmN0aW9uIGFzc2lnbih0YXJnZXQsIHNvdXJjZSkgewoJCQkJLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bnVzZWQtdmFycwoJCQkJdmFyIFQgPSB0b09iamVjdCh0YXJnZXQpOwoJCQkJdmFyIGFMZW4gPSBhcmd1bWVudHMubGVuZ3RoOwoJCQkJdmFyIGluZGV4ID0gMTsKCQkJCXZhciBnZXRTeW1ib2xzID0gZ09QUy5mOwoJCQkJdmFyIGlzRW51bSA9IHBJRS5mOwoJCQkJd2hpbGUgKGFMZW4gPiBpbmRleCkgewoJCQkJCXZhciBTID0gSU9iamVjdChhcmd1bWVudHNbaW5kZXgrK10pOwoJCQkJCXZhciBrZXlzID0gZ2V0U3ltYm9scyA/IGdldEtleXMoUykuY29uY2F0KGdldFN5bWJvbHMoUykpIDogZ2V0S2V5cyhTKTsKCQkJCQl2YXIgbGVuZ3RoID0ga2V5cy5sZW5ndGg7CgkJCQkJdmFyIGogPSAwOwoJCQkJCXZhciBrZXk7CgkJCQkJd2hpbGUgKGxlbmd0aCA+IGopIHsKCQkJCQkJa2V5ID0ga2V5c1tqKytdOwoJCQkJCQlpZiAoIURFU0NSSVBUT1JTIHx8IGlzRW51bS5jYWxsKFMsIGtleSkpIFRba2V5XSA9IFNba2V5XTsKCQkJCQl9CgkJCQl9CgkJCQlyZXR1cm4gVDsKCQkJfSA6ICRhc3NpZ247CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA1MTQyOgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDE5LjEuMi4yIC8gMTUuMi4zLjUgT2JqZWN0LmNyZWF0ZShPIFssIFByb3BlcnRpZXNdKQoJCQl2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYxNjYpOwoJCQl2YXIgZFBzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MzA5KTsKCQkJdmFyIGVudW1CdWdLZXlzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MTg2KTsKCQkJdmFyIElFX1BST1RPID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NjgyKSgnSUVfUFJPVE8nKTsKCQkJdmFyIEVtcHR5ID0gZnVuY3Rpb24gRW1wdHkoKSB7LyogZW1wdHkgKi8KCQkJfTsKCQkJdmFyIFBST1RPVFlQRSA9ICdwcm90b3R5cGUnOwoKLy8gQ3JlYXRlIG9iamVjdCB3aXRoIGZha2UgYG51bGxgIHByb3RvdHlwZTogdXNlIGlmcmFtZSBPYmplY3Qgd2l0aCBjbGVhcmVkIHByb3RvdHlwZQoJCQl2YXIgX2NyZWF0ZURpY3QgPSBmdW5jdGlvbiBjcmVhdGVEaWN0KCkgewoJCQkJLy8gVGhyYXNoLCB3YXN0ZSBhbmQgc29kb215OiBJRSBHQyBidWcKCQkJCXZhciBpZnJhbWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMzODMpKCdpZnJhbWUnKTsKCQkJCXZhciBpID0gZW51bUJ1Z0tleXMubGVuZ3RoOwoJCQkJdmFyIGx0ID0gJzwnOwoJCQkJdmFyIGd0ID0gJz4nOwoJCQkJdmFyIGlmcmFtZURvY3VtZW50OwoJCQkJaWZyYW1lLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CgkJCQkoX193ZWJwYWNrX3JlcXVpcmVfXyg0NzUpLmFwcGVuZENoaWxkKShpZnJhbWUpOwoJCQkJaWZyYW1lLnNyYyA9ICdqYXZhc2NyaXB0Oic7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tc2NyaXB0LXVybAoJCQkJLy8gY3JlYXRlRGljdCA9IGlmcmFtZS5jb250ZW50V2luZG93Lk9iamVjdDsKCQkJCS8vIGh0bWwucmVtb3ZlQ2hpbGQoaWZyYW1lKTsKCQkJCWlmcmFtZURvY3VtZW50ID0gaWZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQ7CgkJCQlpZnJhbWVEb2N1bWVudC5vcGVuKCk7CgkJCQlpZnJhbWVEb2N1bWVudC53cml0ZShsdCArICdzY3JpcHQnICsgZ3QgKyAnZG9jdW1lbnQuRj1PYmplY3QnICsgbHQgKyAnL3NjcmlwdCcgKyBndCk7CgkJCQlpZnJhbWVEb2N1bWVudC5jbG9zZSgpOwoJCQkJX2NyZWF0ZURpY3QgPSBpZnJhbWVEb2N1bWVudC5GOwoJCQkJd2hpbGUgKGktLSkgZGVsZXRlIF9jcmVhdGVEaWN0W1BST1RPVFlQRV1bZW51bUJ1Z0tleXNbaV1dOwoJCQkJcmV0dXJuIF9jcmVhdGVEaWN0KCk7CgkJCX07CgkJCW1vZHVsZS5leHBvcnRzID0gT2JqZWN0LmNyZWF0ZSB8fCBmdW5jdGlvbiBjcmVhdGUoTywgUHJvcGVydGllcykgewoJCQkJdmFyIHJlc3VsdDsKCQkJCWlmIChPICE9PSBudWxsKSB7CgkJCQkJRW1wdHlbUFJPVE9UWVBFXSA9IGFuT2JqZWN0KE8pOwoJCQkJCXJlc3VsdCA9IG5ldyBFbXB0eSgpOwoJCQkJCUVtcHR5W1BST1RPVFlQRV0gPSBudWxsOwoJCQkJCS8vIGFkZCAiX19wcm90b19fIiBmb3IgT2JqZWN0LmdldFByb3RvdHlwZU9mIHBvbHlmaWxsCgkJCQkJcmVzdWx0W0lFX1BST1RPXSA9IE87CgkJCQl9IGVsc2UgcmVzdWx0ID0gX2NyZWF0ZURpY3QoKTsKCQkJCXJldHVybiBQcm9wZXJ0aWVzID09PSB1bmRlZmluZWQgPyByZXN1bHQgOiBkUHMocmVzdWx0LCBQcm9wZXJ0aWVzKTsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDE1MTU6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MTY2KTsKCQkJdmFyIElFOF9ET01fREVGSU5FID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MjExKTsKCQkJdmFyIHRvUHJpbWl0aXZlID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNDQwKTsKCQkJdmFyIGRQID0gT2JqZWN0LmRlZmluZVByb3BlcnR5OwoJCQlleHBvcnRzLmYgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUxOTQpID8gT2JqZWN0LmRlZmluZVByb3BlcnR5IDogZnVuY3Rpb24gZGVmaW5lUHJvcGVydHkoTywgUCwgQXR0cmlidXRlcykgewoJCQkJYW5PYmplY3QoTyk7CgkJCQlQID0gdG9QcmltaXRpdmUoUCwgdHJ1ZSk7CgkJCQlhbk9iamVjdChBdHRyaWJ1dGVzKTsKCQkJCWlmIChJRThfRE9NX0RFRklORSkgdHJ5IHsKCQkJCQlyZXR1cm4gZFAoTywgUCwgQXR0cmlidXRlcyk7CgkJCQl9IGNhdGNoIChlKSB7LyogZW1wdHkgKi8KCQkJCX0KCQkJCWlmICgnZ2V0JyBpbiBBdHRyaWJ1dGVzIHx8ICdzZXQnIGluIEF0dHJpYnV0ZXMpIHRocm93IFR5cGVFcnJvcignQWNjZXNzb3JzIG5vdCBzdXBwb3J0ZWQhJyk7CgkJCQlpZiAoJ3ZhbHVlJyBpbiBBdHRyaWJ1dGVzKSBPW1BdID0gQXR0cmlidXRlcy52YWx1ZTsKCQkJCXJldHVybiBPOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNjMwOToKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgZFAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1MTUpOwoJCQl2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYxNjYpOwoJCQl2YXIgZ2V0S2V5cyA9IF9fd2VicGFja19yZXF1aXJlX18oNjQzNik7CgkJCW1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MTk0KSA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzIDogZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyhPLCBQcm9wZXJ0aWVzKSB7CgkJCQlhbk9iamVjdChPKTsKCQkJCXZhciBrZXlzID0gZ2V0S2V5cyhQcm9wZXJ0aWVzKTsKCQkJCXZhciBsZW5ndGggPSBrZXlzLmxlbmd0aDsKCQkJCXZhciBpID0gMDsKCQkJCXZhciBQOwoJCQkJd2hpbGUgKGxlbmd0aCA+IGkpIGRQLmYoTywgUCA9IGtleXNbaSsrXSwgUHJvcGVydGllc1tQXSk7CgkJCQlyZXR1cm4gTzsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDQwNTc6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCi8vIEZvcmNlZCByZXBsYWNlbWVudCBwcm90b3R5cGUgYWNjZXNzb3JzIG1ldGhvZHMKCQkJbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY1NjcpIHx8ICFfX3dlYnBhY2tfcmVxdWlyZV9fKDEyOCkoZnVuY3Rpb24oKSB7CgkJCQl2YXIgSyA9IE1hdGgucmFuZG9tKCk7CgkJCQkvLyBJbiBGRiB0aHJvd3Mgb25seSBkZWZpbmUgbWV0aG9kcwoJCQkJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVuZGVmLCBuby11c2VsZXNzLWNhbGwKCQkJCV9fZGVmaW5lU2V0dGVyX18uY2FsbChudWxsLCBLLCBmdW5jdGlvbigpIHsvKiBlbXB0eSAqLwoJCQkJfSk7CgkJCQlkZWxldGUgX193ZWJwYWNrX3JlcXVpcmVfXyg5NzY5KVtLXTsKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA4MDk2OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciBwSUUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIyNzEpOwoJCQl2YXIgY3JlYXRlRGVzYyA9IF9fd2VicGFja19yZXF1aXJlX18oNzIzKTsKCQkJdmFyIHRvSU9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMTMwOSk7CgkJCXZhciB0b1ByaW1pdGl2ZSA9IF9fd2VicGFja19yZXF1aXJlX18oMzQ0MCk7CgkJCXZhciBoYXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ5OTcpOwoJCQl2YXIgSUU4X0RPTV9ERUZJTkUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQyMTEpOwoJCQl2YXIgZ09QRCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CgkJCWV4cG9ydHMuZiA9IF9fd2VicGFja19yZXF1aXJlX18oNTE5NCkgPyBnT1BEIDogZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE8sIFApIHsKCQkJCU8gPSB0b0lPYmplY3QoTyk7CgkJCQlQID0gdG9QcmltaXRpdmUoUCwgdHJ1ZSk7CgkJCQlpZiAoSUU4X0RPTV9ERUZJTkUpIHRyeSB7CgkJCQkJcmV0dXJuIGdPUEQoTywgUCk7CgkJCQl9IGNhdGNoIChlKSB7LyogZW1wdHkgKi8KCQkJCX0KCQkJCWlmIChoYXMoTywgUCkpIHJldHVybiBjcmVhdGVEZXNjKCFwSUUuZi5jYWxsKE8sIFApLCBPW1BdKTsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDc2NDM6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJZnVuY3Rpb24gX3R5cGVvZihvKSB7CgkJCQknQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YnOwoJCQkJcmV0dXJuIF90eXBlb2YgPSAnZnVuY3Rpb24nID09IHR5cGVvZiBTeW1ib2wgJiYgJ3N5bWJvbCcgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uKG8pIHsKCQkJCQlyZXR1cm4gdHlwZW9mIG87CgkJCQl9IDogZnVuY3Rpb24obykgewoJCQkJCXJldHVybiBvICYmICdmdW5jdGlvbicgPT0gdHlwZW9mIFN5bWJvbCAmJiBvLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgbyAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICdzeW1ib2wnIDogdHlwZW9mIG87CgkJCQl9LCBfdHlwZW9mKG8pOwoJCQl9CgovLyBmYWxsYmFjayBmb3IgSUUxMSBidWdneSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyB3aXRoIGlmcmFtZSBhbmQgd2luZG93CgkJCXZhciB0b0lPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzMDkpOwoJCQl2YXIgZ09QTiA9IChfX3dlYnBhY2tfcmVxdWlyZV9fKDg0ODIpLmYpOwoJCQl2YXIgdG9TdHJpbmcgPSB7fS50b1N0cmluZzsKCQkJdmFyIHdpbmRvd05hbWVzID0gKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKHdpbmRvdykpID09ICdvYmplY3QnICYmIHdpbmRvdyAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHdpbmRvdykgOiBbXTsKCQkJdmFyIGdldFdpbmRvd05hbWVzID0gZnVuY3Rpb24gZ2V0V2luZG93TmFtZXMoaXQpIHsKCQkJCXRyeSB7CgkJCQkJcmV0dXJuIGdPUE4oaXQpOwoJCQkJfSBjYXRjaCAoZSkgewoJCQkJCXJldHVybiB3aW5kb3dOYW1lcy5zbGljZSgpOwoJCQkJfQoJCQl9OwoJCQltb2R1bGUuZXhwb3J0cy5mID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlOYW1lcyhpdCkgewoJCQkJcmV0dXJuIHdpbmRvd05hbWVzICYmIHRvU3RyaW5nLmNhbGwoaXQpID09ICdbb2JqZWN0IFdpbmRvd10nID8gZ2V0V2luZG93TmFtZXMoaXQpIDogZ09QTih0b0lPYmplY3QoaXQpKTsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDg0ODI6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMTkuMS4yLjcgLyAxNS4yLjMuNCBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhPKQoJCQl2YXIgJGtleXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM4MzApOwoJCQl2YXIgaGlkZGVuS2V5cyA9IChfX3dlYnBhY2tfcmVxdWlyZV9fKDUxODYpLmNvbmNhdCkoJ2xlbmd0aCcsICdwcm90b3R5cGUnKTsKCQkJZXhwb3J0cy5mID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMgfHwgZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlOYW1lcyhPKSB7CgkJCQlyZXR1cm4gJGtleXMoTywgaGlkZGVuS2V5cyk7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA1OTQ0OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMpID0+IHsKCgkJCWV4cG9ydHMuZiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA4OTk2OgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDE5LjEuMi45IC8gMTUuMi4zLjIgT2JqZWN0LmdldFByb3RvdHlwZU9mKE8pCgkJCXZhciBoYXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ5OTcpOwoJCQl2YXIgdG9PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ4MjApOwoJCQl2YXIgSUVfUFJPVE8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc2ODIpKCdJRV9QUk9UTycpOwoJCQl2YXIgT2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlOwoJCQltb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbihPKSB7CgkJCQlPID0gdG9PYmplY3QoTyk7CgkJCQlpZiAoaGFzKE8sIElFX1BST1RPKSkgcmV0dXJuIE9bSUVfUFJPVE9dOwoJCQkJaWYgKHR5cGVvZiBPLmNvbnN0cnVjdG9yID09ICdmdW5jdGlvbicgJiYgTyBpbnN0YW5jZW9mIE8uY29uc3RydWN0b3IpIHsKCQkJCQlyZXR1cm4gTy5jb25zdHJ1Y3Rvci5wcm90b3R5cGU7CgkJCQl9CgkJCQlyZXR1cm4gTyBpbnN0YW5jZW9mIE9iamVjdCA/IE9iamVjdFByb3RvIDogbnVsbDsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDM4MzA6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJdmFyIGhhcyA9IF9fd2VicGFja19yZXF1aXJlX18oNDk5Nyk7CgkJCXZhciB0b0lPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzMDkpOwoJCQl2YXIgYXJyYXlJbmRleE9mID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2ODg5KShmYWxzZSk7CgkJCXZhciBJRV9QUk9UTyA9IF9fd2VicGFja19yZXF1aXJlX18oNzY4MikoJ0lFX1BST1RPJyk7CgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ob2JqZWN0LCBuYW1lcykgewoJCQkJdmFyIE8gPSB0b0lPYmplY3Qob2JqZWN0KTsKCQkJCXZhciBpID0gMDsKCQkJCXZhciByZXN1bHQgPSBbXTsKCQkJCXZhciBrZXk7CgkJCQlmb3IgKGtleSBpbiBPKSBpZiAoa2V5ICE9IElFX1BST1RPKSBoYXMoTywga2V5KSAmJiByZXN1bHQucHVzaChrZXkpOwoJCQkJLy8gRG9uJ3QgZW51bSBidWcgJiBoaWRkZW4ga2V5cwoJCQkJd2hpbGUgKG5hbWVzLmxlbmd0aCA+IGkpIGlmIChoYXMoTywga2V5ID0gbmFtZXNbaSsrXSkpIHsKCQkJCQl+YXJyYXlJbmRleE9mKHJlc3VsdCwga2V5KSB8fCByZXN1bHQucHVzaChrZXkpOwoJCQkJfQoJCQkJcmV0dXJuIHJlc3VsdDsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDY0MzY6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMTkuMS4yLjE0IC8gMTUuMi4zLjE0IE9iamVjdC5rZXlzKE8pCgkJCXZhciAka2V5cyA9IF9fd2VicGFja19yZXF1aXJlX18oMzgzMCk7CgkJCXZhciBlbnVtQnVnS2V5cyA9IF9fd2VicGFja19yZXF1aXJlX18oNTE4Nik7CgkJCW1vZHVsZS5leHBvcnRzID0gT2JqZWN0LmtleXMgfHwgZnVuY3Rpb24ga2V5cyhPKSB7CgkJCQlyZXR1cm4gJGtleXMoTywgZW51bUJ1Z0tleXMpOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMjI3MToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzKSA9PiB7CgoJCQlleHBvcnRzLmYgPSB7fS5wcm9wZXJ0eUlzRW51bWVyYWJsZTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDY3NjM6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gbW9zdCBPYmplY3QgbWV0aG9kcyBieSBFUzYgc2hvdWxkIGFjY2VwdCBwcmltaXRpdmVzCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIGNvcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUxNjUpOwoJCQl2YXIgZmFpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyOCk7CgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oS0VZLCBleGVjKSB7CgkJCQl2YXIgZm4gPSAoY29yZS5PYmplY3QgfHwge30pW0tFWV0gfHwgT2JqZWN0W0tFWV07CgkJCQl2YXIgZXhwID0ge307CgkJCQlleHBbS0VZXSA9IGV4ZWMoZm4pOwoJCQkJJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiBmYWlscyhmdW5jdGlvbigpIHsKCQkJCQlmbigxKTsKCQkJCX0pLCAnT2JqZWN0JywgZXhwKTsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDQxNjY6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJdmFyIERFU0NSSVBUT1JTID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MTk0KTsKCQkJdmFyIGdldEtleXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY0MzYpOwoJCQl2YXIgdG9JT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMzA5KTsKCQkJdmFyIGlzRW51bSA9IChfX3dlYnBhY2tfcmVxdWlyZV9fKDIyNzEpLmYpOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGlzRW50cmllcykgewoJCQkJcmV0dXJuIGZ1bmN0aW9uKGl0KSB7CgkJCQkJdmFyIE8gPSB0b0lPYmplY3QoaXQpOwoJCQkJCXZhciBrZXlzID0gZ2V0S2V5cyhPKTsKCQkJCQl2YXIgbGVuZ3RoID0ga2V5cy5sZW5ndGg7CgkJCQkJdmFyIGkgPSAwOwoJCQkJCXZhciByZXN1bHQgPSBbXTsKCQkJCQl2YXIga2V5OwoJCQkJCXdoaWxlIChsZW5ndGggPiBpKSB7CgkJCQkJCWtleSA9IGtleXNbaSsrXTsKCQkJCQkJaWYgKCFERVNDUklQVE9SUyB8fCBpc0VudW0uY2FsbChPLCBrZXkpKSB7CgkJCQkJCQlyZXN1bHQucHVzaChpc0VudHJpZXMgPyBba2V5LCBPW2tleV1dIDogT1trZXldKTsKCQkJCQkJfQoJCQkJCX0KCQkJCQlyZXR1cm4gcmVzdWx0OwoJCQkJfTsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDMzNzU6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gYWxsIG9iamVjdCBrZXlzLCBpbmNsdWRlcyBub24tZW51bWVyYWJsZSBhbmQgc3ltYm9scwoJCQl2YXIgZ09QTiA9IF9fd2VicGFja19yZXF1aXJlX18oODQ4Mik7CgkJCXZhciBnT1BTID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1OTQ0KTsKCQkJdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MTY2KTsKCQkJdmFyIFJlZmxlY3QgPSAoX193ZWJwYWNrX3JlcXVpcmVfXyg5NzY5KS5SZWZsZWN0KTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBSZWZsZWN0ICYmIFJlZmxlY3Qub3duS2V5cyB8fCBmdW5jdGlvbiBvd25LZXlzKGl0KSB7CgkJCQl2YXIga2V5cyA9IGdPUE4uZihhbk9iamVjdChpdCkpOwoJCQkJdmFyIGdldFN5bWJvbHMgPSBnT1BTLmY7CgkJCQlyZXR1cm4gZ2V0U3ltYm9scyA/IGtleXMuY29uY2F0KGdldFN5bWJvbHMoaXQpKSA6IGtleXM7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA4NzUwOgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciAkcGFyc2VGbG9hdCA9IChfX3dlYnBhY2tfcmVxdWlyZV9fKDk3NjkpLnBhcnNlRmxvYXQpOwoJCQl2YXIgJHRyaW0gPSAoX193ZWJwYWNrX3JlcXVpcmVfXyg1MzU2KS50cmltKTsKCQkJbW9kdWxlLmV4cG9ydHMgPSAxIC8gJHBhcnNlRmxvYXQoX193ZWJwYWNrX3JlcXVpcmVfXygyNTY5KSArICctMCcpICE9PSAtSW5maW5pdHkgPyBmdW5jdGlvbiBwYXJzZUZsb2F0KHN0cikgewoJCQkJdmFyIHN0cmluZyA9ICR0cmltKFN0cmluZyhzdHIpLCAzKTsKCQkJCXZhciByZXN1bHQgPSAkcGFyc2VGbG9hdChzdHJpbmcpOwoJCQkJcmV0dXJuIHJlc3VsdCA9PT0gMCAmJiBzdHJpbmcuY2hhckF0KDApID09ICctJyA/IC0wIDogcmVzdWx0OwoJCQl9IDogJHBhcnNlRmxvYXQ7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA5OTU4OgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciAkcGFyc2VJbnQgPSAoX193ZWJwYWNrX3JlcXVpcmVfXyg5NzY5KS5wYXJzZUludCk7CgkJCXZhciAkdHJpbSA9IChfX3dlYnBhY2tfcmVxdWlyZV9fKDUzNTYpLnRyaW0pOwoJCQl2YXIgd3MgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI1NjkpOwoJCQl2YXIgaGV4ID0gL15bLStdPzBbeFhdLzsKCQkJbW9kdWxlLmV4cG9ydHMgPSAkcGFyc2VJbnQod3MgKyAnMDgnKSAhPT0gOCB8fCAkcGFyc2VJbnQod3MgKyAnMHgxNicpICE9PSAyMiA/IGZ1bmN0aW9uIHBhcnNlSW50KHN0ciwgcmFkaXgpIHsKCQkJCXZhciBzdHJpbmcgPSAkdHJpbShTdHJpbmcoc3RyKSwgMyk7CgkJCQlyZXR1cm4gJHBhcnNlSW50KHN0cmluZywgcmFkaXggPj4+IDAgfHwgKGhleC50ZXN0KHN0cmluZykgPyAxNiA6IDEwKSk7CgkJCX0gOiAkcGFyc2VJbnQ7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAyNjQyOgoJCS8qKiovICgobW9kdWxlKSA9PiB7CgoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGV4ZWMpIHsKCQkJCXRyeSB7CgkJCQkJcmV0dXJuIHsKCQkJCQkJZTogZmFsc2UsCgkJCQkJCXY6IGV4ZWMoKQoJCQkJCX07CgkJCQl9IGNhdGNoIChlKSB7CgkJCQkJcmV0dXJuIHsKCQkJCQkJZTogdHJ1ZSwKCQkJCQkJdjogZQoJCQkJCX07CgkJCQl9CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA2Mzc5OgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNjE2Nik7CgkJCXZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNDY4Nik7CgkJCXZhciBuZXdQcm9taXNlQ2FwYWJpbGl0eSA9IF9fd2VicGFja19yZXF1aXJlX18oMjYzOCk7CgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oQywgeCkgewoJCQkJYW5PYmplY3QoQyk7CgkJCQlpZiAoaXNPYmplY3QoeCkgJiYgeC5jb25zdHJ1Y3RvciA9PT0gQykgcmV0dXJuIHg7CgkJCQl2YXIgcHJvbWlzZUNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eS5mKEMpOwoJCQkJdmFyIHJlc29sdmUgPSBwcm9taXNlQ2FwYWJpbGl0eS5yZXNvbHZlOwoJCQkJcmVzb2x2ZSh4KTsKCQkJCXJldHVybiBwcm9taXNlQ2FwYWJpbGl0eS5wcm9taXNlOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNzIzOgoJCS8qKiovICgobW9kdWxlKSA9PiB7CgoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGJpdG1hcCwgdmFsdWUpIHsKCQkJCXJldHVybiB7CgkJCQkJZW51bWVyYWJsZTogIShiaXRtYXAgJiAxKSwKCQkJCQljb25maWd1cmFibGU6ICEoYml0bWFwICYgMiksCgkJCQkJd3JpdGFibGU6ICEoYml0bWFwICYgNCksCgkJCQkJdmFsdWU6IHZhbHVlCgkJCQl9OwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNzE4NToKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgcmVkZWZpbmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg5MTQpOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKHRhcmdldCwgc3JjLCBzYWZlKSB7CgkJCQlmb3IgKHZhciBrZXkgaW4gc3JjKSByZWRlZmluZSh0YXJnZXQsIGtleSwgc3JjW2tleV0sIHNhZmUpOwoJCQkJcmV0dXJuIHRhcmdldDsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDg5MTQ6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oOTc2OSk7CgkJCXZhciBoaWRlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5MDM2KTsKCQkJdmFyIGhhcyA9IF9fd2VicGFja19yZXF1aXJlX18oNDk5Nyk7CgkJCXZhciBTUkMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYxNykoJ3NyYycpOwoJCQl2YXIgJHRvU3RyaW5nID0gX193ZWJwYWNrX3JlcXVpcmVfXygyODU3KTsKCQkJdmFyIFRPX1NUUklORyA9ICd0b1N0cmluZyc7CgkJCXZhciBUUEwgPSAoJycgKyAkdG9TdHJpbmcpLnNwbGl0KFRPX1NUUklORyk7CgkJCShfX3dlYnBhY2tfcmVxdWlyZV9fKDUxNjUpLmluc3BlY3RTb3VyY2UpID0gZnVuY3Rpb24oaXQpIHsKCQkJCXJldHVybiAkdG9TdHJpbmcuY2FsbChpdCk7CgkJCX07CgkJCShtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKE8sIGtleSwgdmFsLCBzYWZlKSB7CgkJCQl2YXIgaXNGdW5jdGlvbiA9IHR5cGVvZiB2YWwgPT0gJ2Z1bmN0aW9uJzsKCQkJCWlmIChpc0Z1bmN0aW9uKSBoYXModmFsLCAnbmFtZScpIHx8IGhpZGUodmFsLCAnbmFtZScsIGtleSk7CgkJCQlpZiAoT1trZXldID09PSB2YWwpIHJldHVybjsKCQkJCWlmIChpc0Z1bmN0aW9uKSBoYXModmFsLCBTUkMpIHx8IGhpZGUodmFsLCBTUkMsIE9ba2V5XSA/ICcnICsgT1trZXldIDogVFBMLmpvaW4oU3RyaW5nKGtleSkpKTsKCQkJCWlmIChPID09PSBnbG9iYWwpIHsKCQkJCQlPW2tleV0gPSB2YWw7CgkJCQl9IGVsc2UgaWYgKCFzYWZlKSB7CgkJCQkJZGVsZXRlIE9ba2V5XTsKCQkJCQloaWRlKE8sIGtleSwgdmFsKTsKCQkJCX0gZWxzZSBpZiAoT1trZXldKSB7CgkJCQkJT1trZXldID0gdmFsOwoJCQkJfSBlbHNlIHsKCQkJCQloaWRlKE8sIGtleSwgdmFsKTsKCQkJCX0KCQkJCS8vIGFkZCBmYWtlIEZ1bmN0aW9uI3RvU3RyaW5nIGZvciBjb3JyZWN0IHdvcmsgd3JhcHBlZCBtZXRob2RzIC8gY29uc3RydWN0b3JzIHdpdGggbWV0aG9kcyBsaWtlIExvRGFzaCBpc05hdGl2ZQoJCQl9KShGdW5jdGlvbi5wcm90b3R5cGUsIFRPX1NUUklORywgZnVuY3Rpb24gdG9TdHJpbmcoKSB7CgkJCQlyZXR1cm4gdHlwZW9mIHRoaXMgPT0gJ2Z1bmN0aW9uJyAmJiB0aGlzW1NSQ10gfHwgJHRvU3RyaW5nLmNhbGwodGhpcyk7CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMzc5NToKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJZnVuY3Rpb24gX3R5cGVvZihvKSB7CgkJCQknQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YnOwoJCQkJcmV0dXJuIF90eXBlb2YgPSAnZnVuY3Rpb24nID09IHR5cGVvZiBTeW1ib2wgJiYgJ3N5bWJvbCcgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uKG8pIHsKCQkJCQlyZXR1cm4gdHlwZW9mIG87CgkJCQl9IDogZnVuY3Rpb24obykgewoJCQkJCXJldHVybiBvICYmICdmdW5jdGlvbicgPT0gdHlwZW9mIFN5bWJvbCAmJiBvLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgbyAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICdzeW1ib2wnIDogdHlwZW9mIG87CgkJCQl9LCBfdHlwZW9mKG8pOwoJCQl9CgoJCQl2YXIgY2xhc3NvZiA9IF9fd2VicGFja19yZXF1aXJlX18oOTM0KTsKCQkJdmFyIGJ1aWx0aW5FeGVjID0gUmVnRXhwLnByb3RvdHlwZS5leGVjOwoKLy8gYFJlZ0V4cEV4ZWNgIGFic3RyYWN0IG9wZXJhdGlvbgovLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1yZWdleHBleGVjCgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oUiwgUykgewoJCQkJdmFyIGV4ZWMgPSBSLmV4ZWM7CgkJCQlpZiAodHlwZW9mIGV4ZWMgPT09ICdmdW5jdGlvbicpIHsKCQkJCQl2YXIgcmVzdWx0ID0gZXhlYy5jYWxsKFIsIFMpOwoJCQkJCWlmIChfdHlwZW9mKHJlc3VsdCkgIT09ICdvYmplY3QnKSB7CgkJCQkJCXRocm93IG5ldyBUeXBlRXJyb3IoJ1JlZ0V4cCBleGVjIG1ldGhvZCByZXR1cm5lZCBzb21ldGhpbmcgb3RoZXIgdGhhbiBhbiBPYmplY3Qgb3IgbnVsbCcpOwoJCQkJCX0KCQkJCQlyZXR1cm4gcmVzdWx0OwoJCQkJfQoJCQkJaWYgKGNsYXNzb2YoUikgIT09ICdSZWdFeHAnKSB7CgkJCQkJdGhyb3cgbmV3IFR5cGVFcnJvcignUmVnRXhwI2V4ZWMgY2FsbGVkIG9uIGluY29tcGF0aWJsZSByZWNlaXZlcicpOwoJCQkJfQoJCQkJcmV0dXJuIGJ1aWx0aW5FeGVjLmNhbGwoUiwgUyk7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA1NjA3OgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgoJCQl2YXIgcmVnZXhwRmxhZ3MgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1NTgpOwoJCQl2YXIgbmF0aXZlRXhlYyA9IFJlZ0V4cC5wcm90b3R5cGUuZXhlYzsKLy8gVGhpcyBhbHdheXMgcmVmZXJzIHRvIHRoZSBuYXRpdmUgaW1wbGVtZW50YXRpb24sIGJlY2F1c2UgdGhlCi8vIFN0cmluZyNyZXBsYWNlIHBvbHlmaWxsIHVzZXMgLi9maXgtcmVnZXhwLXdlbGwta25vd24tc3ltYm9sLWxvZ2ljLmpzLAovLyB3aGljaCBsb2FkcyB0aGlzIGZpbGUgYmVmb3JlIHBhdGNoaW5nIHRoZSBtZXRob2QuCgkJCXZhciBuYXRpdmVSZXBsYWNlID0gU3RyaW5nLnByb3RvdHlwZS5yZXBsYWNlOwoJCQl2YXIgcGF0Y2hlZEV4ZWMgPSBuYXRpdmVFeGVjOwoJCQl2YXIgTEFTVF9JTkRFWCA9ICdsYXN0SW5kZXgnOwoJCQl2YXIgVVBEQVRFU19MQVNUX0lOREVYX1dST05HID0gZnVuY3Rpb24oKSB7CgkJCQl2YXIgcmUxID0gL2EvLAoJCQkJCXJlMiA9IC9iKi9nOwoJCQkJbmF0aXZlRXhlYy5jYWxsKHJlMSwgJ2EnKTsKCQkJCW5hdGl2ZUV4ZWMuY2FsbChyZTIsICdhJyk7CgkJCQlyZXR1cm4gcmUxW0xBU1RfSU5ERVhdICE9PSAwIHx8IHJlMltMQVNUX0lOREVYXSAhPT0gMDsKCQkJfSgpOwoKLy8gbm9ucGFydGljaXBhdGluZyBjYXB0dXJpbmcgZ3JvdXAsIGNvcGllZCBmcm9tIGVzNS1zaGltJ3MgU3RyaW5nI3NwbGl0IHBhdGNoLgoJCQl2YXIgTlBDR19JTkNMVURFRCA9IC8oKT8/Ly5leGVjKCcnKVsxXSAhPT0gdW5kZWZpbmVkOwoJCQl2YXIgUEFUQ0ggPSBVUERBVEVTX0xBU1RfSU5ERVhfV1JPTkcgfHwgTlBDR19JTkNMVURFRDsKCQkJaWYgKFBBVENIKSB7CgkJCQlwYXRjaGVkRXhlYyA9IGZ1bmN0aW9uIGV4ZWMoc3RyKSB7CgkJCQkJdmFyIHJlID0gdGhpczsKCQkJCQl2YXIgbGFzdEluZGV4LCByZUNvcHksIG1hdGNoLCBpOwoJCQkJCWlmIChOUENHX0lOQ0xVREVEKSB7CgkJCQkJCXJlQ29weSA9IG5ldyBSZWdFeHAoJ14nICsgcmUuc291cmNlICsgJyQoPyFcXHMpJywgcmVnZXhwRmxhZ3MuY2FsbChyZSkpOwoJCQkJCX0KCQkJCQlpZiAoVVBEQVRFU19MQVNUX0lOREVYX1dST05HKSBsYXN0SW5kZXggPSByZVtMQVNUX0lOREVYXTsKCQkJCQltYXRjaCA9IG5hdGl2ZUV4ZWMuY2FsbChyZSwgc3RyKTsKCQkJCQlpZiAoVVBEQVRFU19MQVNUX0lOREVYX1dST05HICYmIG1hdGNoKSB7CgkJCQkJCXJlW0xBU1RfSU5ERVhdID0gcmUuZ2xvYmFsID8gbWF0Y2guaW5kZXggKyBtYXRjaFswXS5sZW5ndGggOiBsYXN0SW5kZXg7CgkJCQkJfQoJCQkJCWlmIChOUENHX0lOQ0xVREVEICYmIG1hdGNoICYmIG1hdGNoLmxlbmd0aCA+IDEpIHsKCQkJCQkJLy8gRml4IGJyb3dzZXJzIHdob3NlIGBleGVjYCBtZXRob2RzIGRvbid0IGNvbnNpc3RlbnRseSByZXR1cm4gYHVuZGVmaW5lZGAKCQkJCQkJLy8gZm9yIE5QQ0csIGxpa2UgSUU4LiBOT1RFOiBUaGlzIGRvZXNuJyB3b3JrIGZvciAvKC4/KT8vCgkJCQkJCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1sb29wLWZ1bmMKCQkJCQkJbmF0aXZlUmVwbGFjZS5jYWxsKG1hdGNoWzBdLCByZUNvcHksIGZ1bmN0aW9uKCkgewoJCQkJCQkJZm9yIChpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGggLSAyOyBpKyspIHsKCQkJCQkJCQlpZiAoYXJndW1lbnRzW2ldID09PSB1bmRlZmluZWQpIG1hdGNoW2ldID0gdW5kZWZpbmVkOwoJCQkJCQkJfQoJCQkJCQl9KTsKCQkJCQl9CgkJCQkJcmV0dXJuIG1hdGNoOwoJCQkJfTsKCQkJfQoJCQltb2R1bGUuZXhwb3J0cyA9IHBhdGNoZWRFeGVjOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNjk1MToKCQkvKioqLyAoKG1vZHVsZSkgPT4gewoKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihyZWdFeHAsIHJlcGxhY2UpIHsKCQkJCXZhciByZXBsYWNlciA9IHJlcGxhY2UgPT09IE9iamVjdChyZXBsYWNlKSA/IGZ1bmN0aW9uKHBhcnQpIHsKCQkJCQlyZXR1cm4gcmVwbGFjZVtwYXJ0XTsKCQkJCX0gOiByZXBsYWNlOwoJCQkJcmV0dXJuIGZ1bmN0aW9uKGl0KSB7CgkJCQkJcmV0dXJuIFN0cmluZyhpdCkucmVwbGFjZShyZWdFeHAsIHJlcGxhY2VyKTsKCQkJCX07CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA0MzkyOgoJCS8qKiovICgobW9kdWxlKSA9PiB7CgovLyA3LjIuOSBTYW1lVmFsdWUoeCwgeSkKCQkJbW9kdWxlLmV4cG9ydHMgPSBPYmplY3QuaXMgfHwgZnVuY3Rpb24gaXMoeCwgeSkgewoJCQkJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXNlbGYtY29tcGFyZQoJCQkJcmV0dXJuIHggPT09IHkgPyB4ICE9PSAwIHx8IDEgLyB4ID09PSAxIC8geSA6IHggIT0geCAmJiB5ICE9IHk7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA2NzQyOgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL3Byb3Bvc2FsLXNldG1hcC1vZmZyb20vCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIGFGdW5jdGlvbiA9IF9fd2VicGFja19yZXF1aXJlX18oNDgxMCk7CgkJCXZhciBjdHggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg1NjMpOwoJCQl2YXIgZm9yT2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMzODkpOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKENPTExFQ1RJT04pIHsKCQkJCSRleHBvcnQoJGV4cG9ydC5TLCBDT0xMRUNUSU9OLCB7CgkJCQkJZnJvbTogZnVuY3Rpb24gZnJvbShzb3VyY2UgLyogLCBtYXBGbiwgdGhpc0FyZyAqLykgewoJCQkJCQl2YXIgbWFwRm4gPSBhcmd1bWVudHNbMV07CgkJCQkJCXZhciBtYXBwaW5nLCBBLCBuLCBjYjsKCQkJCQkJYUZ1bmN0aW9uKHRoaXMpOwoJCQkJCQltYXBwaW5nID0gbWFwRm4gIT09IHVuZGVmaW5lZDsKCQkJCQkJaWYgKG1hcHBpbmcpIGFGdW5jdGlvbihtYXBGbik7CgkJCQkJCWlmIChzb3VyY2UgPT0gdW5kZWZpbmVkKSByZXR1cm4gbmV3IHRoaXMoKTsKCQkJCQkJQSA9IFtdOwoJCQkJCQlpZiAobWFwcGluZykgewoJCQkJCQkJbiA9IDA7CgkJCQkJCQljYiA9IGN0eChtYXBGbiwgYXJndW1lbnRzWzJdLCAyKTsKCQkJCQkJCWZvck9mKHNvdXJjZSwgZmFsc2UsIGZ1bmN0aW9uKG5leHRJdGVtKSB7CgkJCQkJCQkJQS5wdXNoKGNiKG5leHRJdGVtLCBuKyspKTsKCQkJCQkJCX0pOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJZm9yT2Yoc291cmNlLCBmYWxzZSwgQS5wdXNoLCBBKTsKCQkJCQkJfQoJCQkJCQlyZXR1cm4gbmV3IHRoaXMoQSk7CgkJCQkJfQoJCQkJfSk7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA2NTg2OgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL3Byb3Bvc2FsLXNldG1hcC1vZmZyb20vCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihDT0xMRUNUSU9OKSB7CgkJCQkkZXhwb3J0KCRleHBvcnQuUywgQ09MTEVDVElPTiwgewoJCQkJCW9mOiBmdW5jdGlvbiBvZigpIHsKCQkJCQkJdmFyIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7CgkJCQkJCXZhciBBID0gbmV3IEFycmF5KGxlbmd0aCk7CgkJCQkJCXdoaWxlIChsZW5ndGgtLSkgQVtsZW5ndGhdID0gYXJndW1lbnRzW2xlbmd0aF07CgkJCQkJCXJldHVybiBuZXcgdGhpcyhBKTsKCQkJCQl9CgkJCQl9KTsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDM0NTQ6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gV29ya3Mgd2l0aCBfX3Byb3RvX18gb25seS4gT2xkIHY4IGNhbid0IHdvcmsgd2l0aCBudWxsIHByb3RvIG9iamVjdHMuCgkJCS8qIGVzbGludC1kaXNhYmxlIG5vLXByb3RvICovCgkJCXZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNDY4Nik7CgkJCXZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNjE2Nik7CgkJCXZhciBjaGVjayA9IGZ1bmN0aW9uIGNoZWNrKE8sIHByb3RvKSB7CgkJCQlhbk9iamVjdChPKTsKCQkJCWlmICghaXNPYmplY3QocHJvdG8pICYmIHByb3RvICE9PSBudWxsKSB0aHJvdyBUeXBlRXJyb3IocHJvdG8gKyAnOiBjYW5cJ3Qgc2V0IGFzIHByb3RvdHlwZSEnKTsKCQkJfTsKCQkJbW9kdWxlLmV4cG9ydHMgPSB7CgkJCQlzZXQ6IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fCAoJ19fcHJvdG9fXycgaW4ge30gPwoJCQkJCS8vIGVzbGludC1kaXNhYmxlLWxpbmUKCQkJCQlmdW5jdGlvbih0ZXN0LCBidWdneSwgc2V0KSB7CgkJCQkJCXRyeSB7CgkJCQkJCQlzZXQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg1NjMpKEZ1bmN0aW9uLmNhbGwsIChfX3dlYnBhY2tfcmVxdWlyZV9fKDgwOTYpLmYpKE9iamVjdC5wcm90b3R5cGUsICdfX3Byb3RvX18nKS5zZXQsIDIpOwoJCQkJCQkJc2V0KHRlc3QsIFtdKTsKCQkJCQkJCWJ1Z2d5ID0gISh0ZXN0IGluc3RhbmNlb2YgQXJyYXkpOwoJCQkJCQl9IGNhdGNoIChlKSB7CgkJCQkJCQlidWdneSA9IHRydWU7CgkJCQkJCX0KCQkJCQkJcmV0dXJuIGZ1bmN0aW9uIHNldFByb3RvdHlwZU9mKE8sIHByb3RvKSB7CgkJCQkJCQljaGVjayhPLCBwcm90byk7CgkJCQkJCQlpZiAoYnVnZ3kpIE8uX19wcm90b19fID0gcHJvdG87IGVsc2Ugc2V0KE8sIHByb3RvKTsKCQkJCQkJCXJldHVybiBPOwoJCQkJCQl9OwoJCQkJCX0oe30sIGZhbHNlKSA6IHVuZGVmaW5lZCksCgkJCQljaGVjazogY2hlY2sKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDIzMzQ6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCgkJCXZhciBnbG9iYWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk3NjkpOwoJCQl2YXIgZFAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1MTUpOwoJCQl2YXIgREVTQ1JJUFRPUlMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUxOTQpOwoJCQl2YXIgU1BFQ0lFUyA9IF9fd2VicGFja19yZXF1aXJlX18oMjg2NykoJ3NwZWNpZXMnKTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihLRVkpIHsKCQkJCXZhciBDID0gZ2xvYmFsW0tFWV07CgkJCQlpZiAoREVTQ1JJUFRPUlMgJiYgQyAmJiAhQ1tTUEVDSUVTXSkgZFAuZihDLCBTUEVDSUVTLCB7CgkJCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCQkJCWdldDogZnVuY3Rpb24gZ2V0KCkgewoJCQkJCQlyZXR1cm4gdGhpczsKCQkJCQl9CgkJCQl9KTsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDUzMjE6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJdmFyIGRlZiA9IChfX3dlYnBhY2tfcmVxdWlyZV9fKDE1MTUpLmYpOwoJCQl2YXIgaGFzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0OTk3KTsKCQkJdmFyIFRBRyA9IF9fd2VicGFja19yZXF1aXJlX18oMjg2NykoJ3RvU3RyaW5nVGFnJyk7CgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQsIHRhZywgc3RhdCkgewoJCQkJaWYgKGl0ICYmICFoYXMoaXQgPSBzdGF0ID8gaXQgOiBpdC5wcm90b3R5cGUsIFRBRykpIGRlZihpdCwgVEFHLCB7CgkJCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCQkJCXZhbHVlOiB0YWcKCQkJCX0pOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNzY4MjoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgc2hhcmVkID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NDApKCdrZXlzJyk7CgkJCXZhciB1aWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYxNyk7CgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oa2V5KSB7CgkJCQlyZXR1cm4gc2hhcmVkW2tleV0gfHwgKHNoYXJlZFtrZXldID0gdWlkKGtleSkpOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNzQwOgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciBjb3JlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MTY1KTsKCQkJdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oOTc2OSk7CgkJCXZhciBTSEFSRUQgPSAnX19jb3JlLWpzX3NoYXJlZF9fJzsKCQkJdmFyIHN0b3JlID0gZ2xvYmFsW1NIQVJFRF0gfHwgKGdsb2JhbFtTSEFSRURdID0ge30pOwoJCQkobW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihrZXksIHZhbHVlKSB7CgkJCQlyZXR1cm4gc3RvcmVba2V5XSB8fCAoc3RvcmVba2V5XSA9IHZhbHVlICE9PSB1bmRlZmluZWQgPyB2YWx1ZSA6IHt9KTsKCQkJfSkoJ3ZlcnNpb25zJywgW10pLnB1c2goewoJCQkJdmVyc2lvbjogY29yZS52ZXJzaW9uLAoJCQkJbW9kZTogX193ZWJwYWNrX3JlcXVpcmVfXyg2NTY3KSA/ICdwdXJlJyA6ICdnbG9iYWwnLAoJCQkJY29weXJpZ2h0OiAnwqkgMjAyMCBEZW5pcyBQdXNoa2FyZXYgKHpsb2lyb2NrLnJ1KScKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA3NTU0OgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDcuMy4yMCBTcGVjaWVzQ29uc3RydWN0b3IoTywgZGVmYXVsdENvbnN0cnVjdG9yKQoJCQl2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYxNjYpOwoJCQl2YXIgYUZ1bmN0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0ODEwKTsKCQkJdmFyIFNQRUNJRVMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI4NjcpKCdzcGVjaWVzJyk7CgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oTywgRCkgewoJCQkJdmFyIEMgPSBhbk9iamVjdChPKS5jb25zdHJ1Y3RvcjsKCQkJCXZhciBTOwoJCQkJcmV0dXJuIEMgPT09IHVuZGVmaW5lZCB8fCAoUyA9IGFuT2JqZWN0KEMpW1NQRUNJRVNdKSA9PSB1bmRlZmluZWQgPyBEIDogYUZ1bmN0aW9uKFMpOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMTgwODoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyIGZhaWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMjgpOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG1ldGhvZCwgYXJnKSB7CgkJCQlyZXR1cm4gISFtZXRob2QgJiYgZmFpbHMoZnVuY3Rpb24oKSB7CgkJCQkJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVzZWxlc3MtY2FsbAoJCQkJCWFyZyA/IG1ldGhvZC5jYWxsKG51bGwsIGZ1bmN0aW9uKCkgey8qIGVtcHR5ICovCgkJCQkJfSwgMSkgOiBtZXRob2QuY2FsbChudWxsKTsKCQkJCX0pOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNzczMDoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgdG9JbnRlZ2VyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2Njk5KTsKCQkJdmFyIGRlZmluZWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcxODkpOwovLyB0cnVlICAtPiBTdHJpbmcjYXQKLy8gZmFsc2UgLT4gU3RyaW5nI2NvZGVQb2ludEF0CgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oVE9fU1RSSU5HKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24odGhhdCwgcG9zKSB7CgkJCQkJdmFyIHMgPSBTdHJpbmcoZGVmaW5lZCh0aGF0KSk7CgkJCQkJdmFyIGkgPSB0b0ludGVnZXIocG9zKTsKCQkJCQl2YXIgbCA9IHMubGVuZ3RoOwoJCQkJCXZhciBhLCBiOwoJCQkJCWlmIChpIDwgMCB8fCBpID49IGwpIHJldHVybiBUT19TVFJJTkcgPyAnJyA6IHVuZGVmaW5lZDsKCQkJCQlhID0gcy5jaGFyQ29kZUF0KGkpOwoJCQkJCXJldHVybiBhIDwgMHhkODAwIHx8IGEgPiAweGRiZmYgfHwgaSArIDEgPT09IGwgfHwgKGIgPSBzLmNoYXJDb2RlQXQoaSArIDEpKSA8IDB4ZGMwMCB8fCBiID4gMHhkZmZmID8gVE9fU1RSSU5HID8gcy5jaGFyQXQoaSkgOiBhIDogVE9fU1RSSU5HID8gcy5zbGljZShpLCBpICsgMikgOiAoYSAtIDB4ZDgwMCA8PCAxMCkgKyAoYiAtIDB4ZGMwMCkgKyAweDEwMDAwOwoJCQkJfTsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDMxOTQ6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gaGVscGVyIGZvciBTdHJpbmcje3N0YXJ0c1dpdGgsIGVuZHNXaXRoLCBpbmNsdWRlc30KCQkJdmFyIGlzUmVnRXhwID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4NDMwKTsKCQkJdmFyIGRlZmluZWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcxODkpOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKHRoYXQsIHNlYXJjaFN0cmluZywgTkFNRSkgewoJCQkJaWYgKGlzUmVnRXhwKHNlYXJjaFN0cmluZykpIHRocm93IFR5cGVFcnJvcignU3RyaW5nIycgKyBOQU1FICsgJyBkb2VzblwndCBhY2NlcHQgcmVnZXghJyk7CgkJCQlyZXR1cm4gU3RyaW5nKGRlZmluZWQodGhhdCkpOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNDczNjoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciBmYWlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMTI4KTsKCQkJdmFyIGRlZmluZWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcxODkpOwoJCQl2YXIgcXVvdCA9IC8iL2c7Ci8vIEIuMi4zLjIuMSBDcmVhdGVIVE1MKHN0cmluZywgdGFnLCBhdHRyaWJ1dGUsIHZhbHVlKQoJCQl2YXIgY3JlYXRlSFRNTCA9IGZ1bmN0aW9uIGNyZWF0ZUhUTUwoc3RyaW5nLCB0YWcsIGF0dHJpYnV0ZSwgdmFsdWUpIHsKCQkJCXZhciBTID0gU3RyaW5nKGRlZmluZWQoc3RyaW5nKSk7CgkJCQl2YXIgcDEgPSAnPCcgKyB0YWc7CgkJCQlpZiAoYXR0cmlidXRlICE9PSAnJykgcDEgKz0gJyAnICsgYXR0cmlidXRlICsgJz0iJyArIFN0cmluZyh2YWx1ZSkucmVwbGFjZShxdW90LCAnJnF1b3Q7JykgKyAnIic7CgkJCQlyZXR1cm4gcDEgKyAnPicgKyBTICsgJzwvJyArIHRhZyArICc+JzsKCQkJfTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihOQU1FLCBleGVjKSB7CgkJCQl2YXIgTyA9IHt9OwoJCQkJT1tOQU1FXSA9IGV4ZWMoY3JlYXRlSFRNTCk7CgkJCQkkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIGZhaWxzKGZ1bmN0aW9uKCkgewoJCQkJCXZhciB0ZXN0ID0gJydbTkFNRV0oJyInKTsKCQkJCQlyZXR1cm4gdGVzdCAhPT0gdGVzdC50b0xvd2VyQ2FzZSgpIHx8IHRlc3Quc3BsaXQoJyInKS5sZW5ndGggPiAzOwoJCQkJfSksICdTdHJpbmcnLCBPKTsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDc4NDE6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gaHR0cHM6Ly9naXRodWIuY29tL3RjMzkvcHJvcG9zYWwtc3RyaW5nLXBhZC1zdGFydC1lbmQKCQkJdmFyIHRvTGVuZ3RoID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MjAxKTsKCQkJdmFyIHJlcGVhdCA9IF9fd2VicGFja19yZXF1aXJlX18oNjI3NCk7CgkJCXZhciBkZWZpbmVkID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3MTg5KTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbih0aGF0LCBtYXhMZW5ndGgsIGZpbGxTdHJpbmcsIGxlZnQpIHsKCQkJCXZhciBTID0gU3RyaW5nKGRlZmluZWQodGhhdCkpOwoJCQkJdmFyIHN0cmluZ0xlbmd0aCA9IFMubGVuZ3RoOwoJCQkJdmFyIGZpbGxTdHIgPSBmaWxsU3RyaW5nID09PSB1bmRlZmluZWQgPyAnICcgOiBTdHJpbmcoZmlsbFN0cmluZyk7CgkJCQl2YXIgaW50TWF4TGVuZ3RoID0gdG9MZW5ndGgobWF4TGVuZ3RoKTsKCQkJCWlmIChpbnRNYXhMZW5ndGggPD0gc3RyaW5nTGVuZ3RoIHx8IGZpbGxTdHIgPT0gJycpIHJldHVybiBTOwoJCQkJdmFyIGZpbGxMZW4gPSBpbnRNYXhMZW5ndGggLSBzdHJpbmdMZW5ndGg7CgkJCQl2YXIgc3RyaW5nRmlsbGVyID0gcmVwZWF0LmNhbGwoZmlsbFN0ciwgTWF0aC5jZWlsKGZpbGxMZW4gLyBmaWxsU3RyLmxlbmd0aCkpOwoJCQkJaWYgKHN0cmluZ0ZpbGxlci5sZW5ndGggPiBmaWxsTGVuKSBzdHJpbmdGaWxsZXIgPSBzdHJpbmdGaWxsZXIuc2xpY2UoMCwgZmlsbExlbik7CgkJCQlyZXR1cm4gbGVmdCA/IHN0cmluZ0ZpbGxlciArIFMgOiBTICsgc3RyaW5nRmlsbGVyOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNjI3NDoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyIHRvSW50ZWdlciA9IF9fd2VicGFja19yZXF1aXJlX18oNjY5OSk7CgkJCXZhciBkZWZpbmVkID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3MTg5KTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiByZXBlYXQoY291bnQpIHsKCQkJCXZhciBzdHIgPSBTdHJpbmcoZGVmaW5lZCh0aGlzKSk7CgkJCQl2YXIgcmVzID0gJyc7CgkJCQl2YXIgbiA9IHRvSW50ZWdlcihjb3VudCk7CgkJCQlpZiAobiA8IDAgfHwgbiA9PSBJbmZpbml0eSkgdGhyb3cgUmFuZ2VFcnJvcignQ291bnQgY2FuXCd0IGJlIG5lZ2F0aXZlJyk7CgkJCQlmb3IgKDsgbiA+IDA7IChuID4+Pj0gMSkgJiYgKHN0ciArPSBzdHIpKSBpZiAobiAmIDEpIHJlcyArPSBzdHI7CgkJCQlyZXR1cm4gcmVzOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNTM1NjoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciBkZWZpbmVkID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3MTg5KTsKCQkJdmFyIGZhaWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMjgpOwoJCQl2YXIgc3BhY2VzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNTY5KTsKCQkJdmFyIHNwYWNlID0gJ1snICsgc3BhY2VzICsgJ10nOwoJCQl2YXIgbm9uID0gJ1x1MjAwQlx4ODUnOwoJCQl2YXIgbHRyaW0gPSBSZWdFeHAoJ14nICsgc3BhY2UgKyBzcGFjZSArICcqJyk7CgkJCXZhciBydHJpbSA9IFJlZ0V4cChzcGFjZSArIHNwYWNlICsgJyokJyk7CgkJCXZhciBleHBvcnRlciA9IGZ1bmN0aW9uIGV4cG9ydGVyKEtFWSwgZXhlYywgQUxJQVMpIHsKCQkJCXZhciBleHAgPSB7fTsKCQkJCXZhciBGT1JDRSA9IGZhaWxzKGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiAhIXNwYWNlc1tLRVldKCkgfHwgbm9uW0tFWV0oKSAhPSBub247CgkJCQl9KTsKCQkJCXZhciBmbiA9IGV4cFtLRVldID0gRk9SQ0UgPyBleGVjKHRyaW0pIDogc3BhY2VzW0tFWV07CgkJCQlpZiAoQUxJQVMpIGV4cFtBTElBU10gPSBmbjsKCQkJCSRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogRk9SQ0UsICdTdHJpbmcnLCBleHApOwoJCQl9OwoKLy8gMSAtPiBTdHJpbmcjdHJpbUxlZnQKLy8gMiAtPiBTdHJpbmcjdHJpbVJpZ2h0Ci8vIDMgLT4gU3RyaW5nI3RyaW0KCQkJdmFyIHRyaW0gPSBleHBvcnRlci50cmltID0gZnVuY3Rpb24oc3RyaW5nLCBUWVBFKSB7CgkJCQlzdHJpbmcgPSBTdHJpbmcoZGVmaW5lZChzdHJpbmcpKTsKCQkJCWlmIChUWVBFICYgMSkgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UobHRyaW0sICcnKTsKCQkJCWlmIChUWVBFICYgMikgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UocnRyaW0sICcnKTsKCQkJCXJldHVybiBzdHJpbmc7CgkJCX07CgkJCW1vZHVsZS5leHBvcnRzID0gZXhwb3J0ZXI7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAyNTY5OgoJCS8qKiovICgobW9kdWxlKSA9PiB7CgoJCQltb2R1bGUuZXhwb3J0cyA9ICdcdFxuXHgwQlxmXHIgXHhBMFx1MTY4MFx1MTgwRVx1MjAwMFx1MjAwMVx1MjAwMlx1MjAwMycgKyAnXHUyMDA0XHUyMDA1XHUyMDA2XHUyMDA3XHUyMDA4XHUyMDA5XHUyMDBBXHUyMDJGXHUyMDVGXHUzMDAwXHUyMDI4XHUyMDI5XHVGRUZGJzsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDUwMjk6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJdmFyIGN0eCA9IF9fd2VicGFja19yZXF1aXJlX18oODU2Myk7CgkJCXZhciBpbnZva2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY5NDQpOwoJCQl2YXIgaHRtbCA9IF9fd2VicGFja19yZXF1aXJlX18oNDc1KTsKCQkJdmFyIGNlbCA9IF9fd2VicGFja19yZXF1aXJlX18oMzM4Myk7CgkJCXZhciBnbG9iYWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk3NjkpOwoJCQl2YXIgcHJvY2VzcyA9IGdsb2JhbC5wcm9jZXNzOwoJCQl2YXIgc2V0VGFzayA9IGdsb2JhbC5zZXRJbW1lZGlhdGU7CgkJCXZhciBjbGVhclRhc2sgPSBnbG9iYWwuY2xlYXJJbW1lZGlhdGU7CgkJCXZhciBNZXNzYWdlQ2hhbm5lbCA9IGdsb2JhbC5NZXNzYWdlQ2hhbm5lbDsKCQkJdmFyIERpc3BhdGNoID0gZ2xvYmFsLkRpc3BhdGNoOwoJCQl2YXIgY291bnRlciA9IDA7CgkJCXZhciBxdWV1ZSA9IHt9OwoJCQl2YXIgT05SRUFEWVNUQVRFQ0hBTkdFID0gJ29ucmVhZHlzdGF0ZWNoYW5nZSc7CgkJCXZhciBkZWZlciwgY2hhbm5lbCwgcG9ydDsKCQkJdmFyIHJ1biA9IGZ1bmN0aW9uIHJ1bigpIHsKCQkJCXZhciBpZCA9ICt0aGlzOwoJCQkJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXByb3RvdHlwZS1idWlsdGlucwoJCQkJaWYgKHF1ZXVlLmhhc093blByb3BlcnR5KGlkKSkgewoJCQkJCXZhciBmbiA9IHF1ZXVlW2lkXTsKCQkJCQlkZWxldGUgcXVldWVbaWRdOwoJCQkJCWZuKCk7CgkJCQl9CgkJCX07CgkJCXZhciBsaXN0ZW5lciA9IGZ1bmN0aW9uIGxpc3RlbmVyKGV2ZW50KSB7CgkJCQlydW4uY2FsbChldmVudC5kYXRhKTsKCQkJfTsKLy8gTm9kZS5qcyAwLjkrICYgSUUxMCsgaGFzIHNldEltbWVkaWF0ZSwgb3RoZXJ3aXNlOgoJCQlpZiAoIXNldFRhc2sgfHwgIWNsZWFyVGFzaykgewoJCQkJc2V0VGFzayA9IGZ1bmN0aW9uIHNldEltbWVkaWF0ZShmbikgewoJCQkJCXZhciBhcmdzID0gW107CgkJCQkJdmFyIGkgPSAxOwoJCQkJCXdoaWxlIChhcmd1bWVudHMubGVuZ3RoID4gaSkgYXJncy5wdXNoKGFyZ3VtZW50c1tpKytdKTsKCQkJCQlxdWV1ZVsrK2NvdW50ZXJdID0gZnVuY3Rpb24oKSB7CgkJCQkJCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1uZXctZnVuYwoJCQkJCQlpbnZva2UodHlwZW9mIGZuID09ICdmdW5jdGlvbicgPyBmbiA6IEZ1bmN0aW9uKGZuKSwgYXJncyk7CgkJCQkJfTsKCQkJCQlkZWZlcihjb3VudGVyKTsKCQkJCQlyZXR1cm4gY291bnRlcjsKCQkJCX07CgkJCQljbGVhclRhc2sgPSBmdW5jdGlvbiBjbGVhckltbWVkaWF0ZShpZCkgewoJCQkJCWRlbGV0ZSBxdWV1ZVtpZF07CgkJCQl9OwoJCQkJLy8gTm9kZS5qcyAwLjgtCgkJCQlpZiAoX193ZWJwYWNrX3JlcXVpcmVfXygyNDM0KShwcm9jZXNzKSA9PSAncHJvY2VzcycpIHsKCQkJCQlkZWZlciA9IGZ1bmN0aW9uIGRlZmVyKGlkKSB7CgkJCQkJCXByb2Nlc3MubmV4dFRpY2soY3R4KHJ1biwgaWQsIDEpKTsKCQkJCQl9OwoJCQkJCS8vIFNwaGVyZSAoSlMgZ2FtZSBlbmdpbmUpIERpc3BhdGNoIEFQSQoJCQkJfSBlbHNlIGlmIChEaXNwYXRjaCAmJiBEaXNwYXRjaC5ub3cpIHsKCQkJCQlkZWZlciA9IGZ1bmN0aW9uIGRlZmVyKGlkKSB7CgkJCQkJCURpc3BhdGNoLm5vdyhjdHgocnVuLCBpZCwgMSkpOwoJCQkJCX07CgkJCQkJLy8gQnJvd3NlcnMgd2l0aCBNZXNzYWdlQ2hhbm5lbCwgaW5jbHVkZXMgV2ViV29ya2VycwoJCQkJfSBlbHNlIGlmIChNZXNzYWdlQ2hhbm5lbCkgewoJCQkJCWNoYW5uZWwgPSBuZXcgTWVzc2FnZUNoYW5uZWwoKTsKCQkJCQlwb3J0ID0gY2hhbm5lbC5wb3J0MjsKCQkJCQljaGFubmVsLnBvcnQxLm9ubWVzc2FnZSA9IGxpc3RlbmVyOwoJCQkJCWRlZmVyID0gY3R4KHBvcnQucG9zdE1lc3NhZ2UsIHBvcnQsIDEpOwoJCQkJCS8vIEJyb3dzZXJzIHdpdGggcG9zdE1lc3NhZ2UsIHNraXAgV2ViV29ya2VycwoJCQkJCS8vIElFOCBoYXMgcG9zdE1lc3NhZ2UsIGJ1dCBpdCdzIHN5bmMgJiB0eXBlb2YgaXRzIHBvc3RNZXNzYWdlIGlzICdvYmplY3QnCgkJCQl9IGVsc2UgaWYgKGdsb2JhbC5hZGRFdmVudExpc3RlbmVyICYmIHR5cGVvZiBwb3N0TWVzc2FnZSA9PSAnZnVuY3Rpb24nICYmICFnbG9iYWwuaW1wb3J0U2NyaXB0cykgewoJCQkJCWRlZmVyID0gZnVuY3Rpb24gZGVmZXIoaWQpIHsKCQkJCQkJZ2xvYmFsLnBvc3RNZXNzYWdlKGlkICsgJycsICcqJyk7CgkJCQkJfTsKCQkJCQlnbG9iYWwuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGxpc3RlbmVyLCBmYWxzZSk7CgkJCQkJLy8gSUU4LQoJCQkJfSBlbHNlIGlmIChPTlJFQURZU1RBVEVDSEFOR0UgaW4gY2VsKCdzY3JpcHQnKSkgewoJCQkJCWRlZmVyID0gZnVuY3Rpb24gZGVmZXIoaWQpIHsKCQkJCQkJaHRtbC5hcHBlbmRDaGlsZChjZWwoJ3NjcmlwdCcpKVtPTlJFQURZU1RBVEVDSEFOR0VdID0gZnVuY3Rpb24oKSB7CgkJCQkJCQlodG1sLnJlbW92ZUNoaWxkKHRoaXMpOwoJCQkJCQkJcnVuLmNhbGwoaWQpOwoJCQkJCQl9OwoJCQkJCX07CgkJCQkJLy8gUmVzdCBvbGQgYnJvd3NlcnMKCQkJCX0gZWxzZSB7CgkJCQkJZGVmZXIgPSBmdW5jdGlvbiBkZWZlcihpZCkgewoJCQkJCQlzZXRUaW1lb3V0KGN0eChydW4sIGlkLCAxKSwgMCk7CgkJCQkJfTsKCQkJCX0KCQkJfQoJCQltb2R1bGUuZXhwb3J0cyA9IHsKCQkJCXNldDogc2V0VGFzaywKCQkJCWNsZWFyOiBjbGVhclRhc2sKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDc0NDM6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJdmFyIHRvSW50ZWdlciA9IF9fd2VicGFja19yZXF1aXJlX18oNjY5OSk7CgkJCXZhciBtYXggPSBNYXRoLm1heDsKCQkJdmFyIG1pbiA9IE1hdGgubWluOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGluZGV4LCBsZW5ndGgpIHsKCQkJCWluZGV4ID0gdG9JbnRlZ2VyKGluZGV4KTsKCQkJCXJldHVybiBpbmRleCA8IDAgPyBtYXgoaW5kZXggKyBsZW5ndGgsIDApIDogbWluKGluZGV4LCBsZW5ndGgpOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gOTcxNToKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy10b2luZGV4CgkJCXZhciB0b0ludGVnZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY2OTkpOwoJCQl2YXIgdG9MZW5ndGggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUyMDEpOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KSB7CgkJCQlpZiAoaXQgPT09IHVuZGVmaW5lZCkgcmV0dXJuIDA7CgkJCQl2YXIgbnVtYmVyID0gdG9JbnRlZ2VyKGl0KTsKCQkJCXZhciBsZW5ndGggPSB0b0xlbmd0aChudW1iZXIpOwoJCQkJaWYgKG51bWJlciAhPT0gbGVuZ3RoKSB0aHJvdyBSYW5nZUVycm9yKCdXcm9uZyBsZW5ndGghJyk7CgkJCQlyZXR1cm4gbGVuZ3RoOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNjY5OToKCQkvKioqLyAoKG1vZHVsZSkgPT4gewoKLy8gNy4xLjQgVG9JbnRlZ2VyCgkJCXZhciBjZWlsID0gTWF0aC5jZWlsOwoJCQl2YXIgZmxvb3IgPSBNYXRoLmZsb29yOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KSB7CgkJCQlyZXR1cm4gaXNOYU4oaXQgPSAraXQpID8gMCA6IChpdCA+IDAgPyBmbG9vciA6IGNlaWwpKGl0KTsKCQkJfTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDEzMDk6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gdG8gaW5kZXhlZCBvYmplY3QsIHRvT2JqZWN0IHdpdGggZmFsbGJhY2sgZm9yIG5vbi1hcnJheS1saWtlIEVTMyBzdHJpbmdzCgkJCXZhciBJT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1ODc0KTsKCQkJdmFyIGRlZmluZWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcxODkpOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KSB7CgkJCQlyZXR1cm4gSU9iamVjdChkZWZpbmVkKGl0KSk7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA1MjAxOgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDcuMS4xNSBUb0xlbmd0aAoJCQl2YXIgdG9JbnRlZ2VyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2Njk5KTsKCQkJdmFyIG1pbiA9IE1hdGgubWluOwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KSB7CgkJCQlyZXR1cm4gaXQgPiAwID8gbWluKHRvSW50ZWdlcihpdCksIDB4MWZmZmZmZmZmZmZmZmYpIDogMDsgLy8gcG93KDIsIDUzKSAtIDEgPT0gOTAwNzE5OTI1NDc0MDk5MQoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNDgyMDoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyA3LjEuMTMgVG9PYmplY3QoYXJndW1lbnQpCgkJCXZhciBkZWZpbmVkID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3MTg5KTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCkgewoJCQkJcmV0dXJuIE9iamVjdChkZWZpbmVkKGl0KSk7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAzNDQwOgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDcuMS4xIFRvUHJpbWl0aXZlKGlucHV0IFssIFByZWZlcnJlZFR5cGVdKQoJCQl2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2ODYpOwovLyBpbnN0ZWFkIG9mIHRoZSBFUzYgc3BlYyB2ZXJzaW9uLCB3ZSBkaWRuJ3QgaW1wbGVtZW50IEBAdG9QcmltaXRpdmUgY2FzZQovLyBhbmQgdGhlIHNlY29uZCBhcmd1bWVudCAtIGZsYWcgLSBwcmVmZXJyZWQgdHlwZSBpcyBhIHN0cmluZwoJCQltb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0LCBTKSB7CgkJCQlpZiAoIWlzT2JqZWN0KGl0KSkgcmV0dXJuIGl0OwoJCQkJdmFyIGZuLCB2YWw7CgkJCQlpZiAoUyAmJiB0eXBlb2YgKGZuID0gaXQudG9TdHJpbmcpID09ICdmdW5jdGlvbicgJiYgIWlzT2JqZWN0KHZhbCA9IGZuLmNhbGwoaXQpKSkgcmV0dXJuIHZhbDsKCQkJCWlmICh0eXBlb2YgKGZuID0gaXQudmFsdWVPZikgPT0gJ2Z1bmN0aW9uJyAmJiAhaXNPYmplY3QodmFsID0gZm4uY2FsbChpdCkpKSByZXR1cm4gdmFsOwoJCQkJaWYgKCFTICYmIHR5cGVvZiAoZm4gPSBpdC50b1N0cmluZykgPT0gJ2Z1bmN0aW9uJyAmJiAhaXNPYmplY3QodmFsID0gZm4uY2FsbChpdCkpKSByZXR1cm4gdmFsOwoJCQkJdGhyb3cgVHlwZUVycm9yKCdDYW5cJ3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlJyk7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA0MjYwOgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgoJCQlmdW5jdGlvbiBfdHlwZW9mKG8pIHsKCQkJCSdAYmFiZWwvaGVscGVycyAtIHR5cGVvZic7CgkJCQlyZXR1cm4gX3R5cGVvZiA9ICdmdW5jdGlvbicgPT0gdHlwZW9mIFN5bWJvbCAmJiAnc3ltYm9sJyA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24obykgewoJCQkJCXJldHVybiB0eXBlb2YgbzsKCQkJCX0gOiBmdW5jdGlvbihvKSB7CgkJCQkJcmV0dXJuIG8gJiYgJ2Z1bmN0aW9uJyA9PSB0eXBlb2YgU3ltYm9sICYmIG8uY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvICE9PSBTeW1ib2wucHJvdG90eXBlID8gJ3N5bWJvbCcgOiB0eXBlb2YgbzsKCQkJCX0sIF90eXBlb2Yobyk7CgkJCX0KCgkJCWlmIChfX3dlYnBhY2tfcmVxdWlyZV9fKDUxOTQpKSB7CgkJCQl2YXIgTElCUkFSWSA9IF9fd2VicGFja19yZXF1aXJlX18oNjU2Nyk7CgkJCQl2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5NzY5KTsKCQkJCXZhciBmYWlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMTI4KTsKCQkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJCXZhciAkdHlwZWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY5ODUpOwoJCQkJdmFyICRidWZmZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQwNDMpOwoJCQkJdmFyIGN0eCA9IF9fd2VicGFja19yZXF1aXJlX18oODU2Myk7CgkJCQl2YXIgYW5JbnN0YW5jZSA9IF9fd2VicGFja19yZXF1aXJlX18oODY3Myk7CgkJCQl2YXIgcHJvcGVydHlEZXNjID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3MjMpOwoJCQkJdmFyIGhpZGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkwMzYpOwoJCQkJdmFyIHJlZGVmaW5lQWxsID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3MTg1KTsKCQkJCXZhciB0b0ludGVnZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY2OTkpOwoJCQkJdmFyIHRvTGVuZ3RoID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MjAxKTsKCQkJCXZhciB0b0luZGV4ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5NzE1KTsKCQkJCXZhciB0b0Fic29sdXRlSW5kZXggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc0NDMpOwoJCQkJdmFyIHRvUHJpbWl0aXZlID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNDQwKTsKCQkJCXZhciBoYXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ5OTcpOwoJCQkJdmFyIGNsYXNzb2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkzNCk7CgkJCQl2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2ODYpOwoJCQkJdmFyIHRvT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0ODIwKTsKCQkJCXZhciBpc0FycmF5SXRlciA9IF9fd2VicGFja19yZXF1aXJlX18oNjU3Nyk7CgkJCQl2YXIgY3JlYXRlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MTQyKTsKCQkJCXZhciBnZXRQcm90b3R5cGVPZiA9IF9fd2VicGFja19yZXF1aXJlX18oODk5Nik7CgkJCQl2YXIgZ09QTiA9IChfX3dlYnBhY2tfcmVxdWlyZV9fKDg0ODIpLmYpOwoJCQkJdmFyIGdldEl0ZXJGbiA9IF9fd2VicGFja19yZXF1aXJlX18oNDQ3KTsKCQkJCXZhciB1aWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYxNyk7CgkJCQl2YXIgd2tzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyODY3KTsKCQkJCXZhciBjcmVhdGVBcnJheU1ldGhvZCA9IF9fd2VicGFja19yZXF1aXJlX18oOTU2OSk7CgkJCQl2YXIgY3JlYXRlQXJyYXlJbmNsdWRlcyA9IF9fd2VicGFja19yZXF1aXJlX18oNjg4OSk7CgkJCQl2YXIgc3BlY2llc0NvbnN0cnVjdG9yID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NTU0KTsKCQkJCXZhciBBcnJheUl0ZXJhdG9ycyA9IF9fd2VicGFja19yZXF1aXJlX18oODcyNik7CgkJCQl2YXIgSXRlcmF0b3JzID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNDQ0KTsKCQkJCXZhciAkaXRlckRldGVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oOTI5KTsKCQkJCXZhciBzZXRTcGVjaWVzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMzM0KTsKCQkJCXZhciBhcnJheUZpbGwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpOwoJCQkJdmFyIGFycmF5Q29weVdpdGhpbiA9IF9fd2VicGFja19yZXF1aXJlX18oMTI3MCk7CgkJCQl2YXIgJERQID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNTE1KTsKCQkJCXZhciAkR09QRCA9IF9fd2VicGFja19yZXF1aXJlX18oODA5Nik7CgkJCQl2YXIgZFAgPSAkRFAuZjsKCQkJCXZhciBnT1BEID0gJEdPUEQuZjsKCQkJCXZhciBSYW5nZUVycm9yID0gZ2xvYmFsLlJhbmdlRXJyb3I7CgkJCQl2YXIgVHlwZUVycm9yID0gZ2xvYmFsLlR5cGVFcnJvcjsKCQkJCXZhciBVaW50OEFycmF5ID0gZ2xvYmFsLlVpbnQ4QXJyYXk7CgkJCQl2YXIgQVJSQVlfQlVGRkVSID0gJ0FycmF5QnVmZmVyJzsKCQkJCXZhciBTSEFSRURfQlVGRkVSID0gJ1NoYXJlZCcgKyBBUlJBWV9CVUZGRVI7CgkJCQl2YXIgQllURVNfUEVSX0VMRU1FTlQgPSAnQllURVNfUEVSX0VMRU1FTlQnOwoJCQkJdmFyIFBST1RPVFlQRSA9ICdwcm90b3R5cGUnOwoJCQkJdmFyIEFycmF5UHJvdG8gPSBBcnJheVtQUk9UT1RZUEVdOwoJCQkJdmFyICRBcnJheUJ1ZmZlciA9ICRidWZmZXIuQXJyYXlCdWZmZXI7CgkJCQl2YXIgJERhdGFWaWV3ID0gJGJ1ZmZlci5EYXRhVmlldzsKCQkJCXZhciBhcnJheUZvckVhY2ggPSBjcmVhdGVBcnJheU1ldGhvZCgwKTsKCQkJCXZhciBhcnJheUZpbHRlciA9IGNyZWF0ZUFycmF5TWV0aG9kKDIpOwoJCQkJdmFyIGFycmF5U29tZSA9IGNyZWF0ZUFycmF5TWV0aG9kKDMpOwoJCQkJdmFyIGFycmF5RXZlcnkgPSBjcmVhdGVBcnJheU1ldGhvZCg0KTsKCQkJCXZhciBhcnJheUZpbmQgPSBjcmVhdGVBcnJheU1ldGhvZCg1KTsKCQkJCXZhciBhcnJheUZpbmRJbmRleCA9IGNyZWF0ZUFycmF5TWV0aG9kKDYpOwoJCQkJdmFyIGFycmF5SW5jbHVkZXMgPSBjcmVhdGVBcnJheUluY2x1ZGVzKHRydWUpOwoJCQkJdmFyIGFycmF5SW5kZXhPZiA9IGNyZWF0ZUFycmF5SW5jbHVkZXMoZmFsc2UpOwoJCQkJdmFyIGFycmF5VmFsdWVzID0gQXJyYXlJdGVyYXRvcnMudmFsdWVzOwoJCQkJdmFyIGFycmF5S2V5cyA9IEFycmF5SXRlcmF0b3JzLmtleXM7CgkJCQl2YXIgYXJyYXlFbnRyaWVzID0gQXJyYXlJdGVyYXRvcnMuZW50cmllczsKCQkJCXZhciBhcnJheUxhc3RJbmRleE9mID0gQXJyYXlQcm90by5sYXN0SW5kZXhPZjsKCQkJCXZhciBhcnJheVJlZHVjZSA9IEFycmF5UHJvdG8ucmVkdWNlOwoJCQkJdmFyIGFycmF5UmVkdWNlUmlnaHQgPSBBcnJheVByb3RvLnJlZHVjZVJpZ2h0OwoJCQkJdmFyIGFycmF5Sm9pbiA9IEFycmF5UHJvdG8uam9pbjsKCQkJCXZhciBhcnJheVNvcnQgPSBBcnJheVByb3RvLnNvcnQ7CgkJCQl2YXIgYXJyYXlTbGljZSA9IEFycmF5UHJvdG8uc2xpY2U7CgkJCQl2YXIgYXJyYXlUb1N0cmluZyA9IEFycmF5UHJvdG8udG9TdHJpbmc7CgkJCQl2YXIgYXJyYXlUb0xvY2FsZVN0cmluZyA9IEFycmF5UHJvdG8udG9Mb2NhbGVTdHJpbmc7CgkJCQl2YXIgSVRFUkFUT1IgPSB3a3MoJ2l0ZXJhdG9yJyk7CgkJCQl2YXIgVEFHID0gd2tzKCd0b1N0cmluZ1RhZycpOwoJCQkJdmFyIFRZUEVEX0NPTlNUUlVDVE9SID0gdWlkKCd0eXBlZF9jb25zdHJ1Y3RvcicpOwoJCQkJdmFyIERFRl9DT05TVFJVQ1RPUiA9IHVpZCgnZGVmX2NvbnN0cnVjdG9yJyk7CgkJCQl2YXIgQUxMX0NPTlNUUlVDVE9SUyA9ICR0eXBlZC5DT05TVFI7CgkJCQl2YXIgVFlQRURfQVJSQVkgPSAkdHlwZWQuVFlQRUQ7CgkJCQl2YXIgVklFVyA9ICR0eXBlZC5WSUVXOwoJCQkJdmFyIFdST05HX0xFTkdUSCA9ICdXcm9uZyBsZW5ndGghJzsKCQkJCXZhciAkbWFwID0gY3JlYXRlQXJyYXlNZXRob2QoMSwgZnVuY3Rpb24oTywgbGVuZ3RoKSB7CgkJCQkJcmV0dXJuIGFsbG9jYXRlKHNwZWNpZXNDb25zdHJ1Y3RvcihPLCBPW0RFRl9DT05TVFJVQ1RPUl0pLCBsZW5ndGgpOwoJCQkJfSk7CgkJCQl2YXIgTElUVExFX0VORElBTiA9IGZhaWxzKGZ1bmN0aW9uKCkgewoJCQkJCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bmRlZgoJCQkJCXJldHVybiBuZXcgVWludDhBcnJheShuZXcgVWludDE2QXJyYXkoWzFdKS5idWZmZXIpWzBdID09PSAxOwoJCQkJfSk7CgkJCQl2YXIgRk9SQ0VEX1NFVCA9ICEhVWludDhBcnJheSAmJiAhIVVpbnQ4QXJyYXlbUFJPVE9UWVBFXS5zZXQgJiYgZmFpbHMoZnVuY3Rpb24oKSB7CgkJCQkJbmV3IFVpbnQ4QXJyYXkoMSkuc2V0KHt9KTsKCQkJCX0pOwoJCQkJdmFyIHRvT2Zmc2V0ID0gZnVuY3Rpb24gdG9PZmZzZXQoaXQsIEJZVEVTKSB7CgkJCQkJdmFyIG9mZnNldCA9IHRvSW50ZWdlcihpdCk7CgkJCQkJaWYgKG9mZnNldCA8IDAgfHwgb2Zmc2V0ICUgQllURVMpIHRocm93IFJhbmdlRXJyb3IoJ1dyb25nIG9mZnNldCEnKTsKCQkJCQlyZXR1cm4gb2Zmc2V0OwoJCQkJfTsKCQkJCXZhciB2YWxpZGF0ZSA9IGZ1bmN0aW9uIHZhbGlkYXRlKGl0KSB7CgkJCQkJaWYgKGlzT2JqZWN0KGl0KSAmJiBUWVBFRF9BUlJBWSBpbiBpdCkgcmV0dXJuIGl0OwoJCQkJCXRocm93IFR5cGVFcnJvcihpdCArICcgaXMgbm90IGEgdHlwZWQgYXJyYXkhJyk7CgkJCQl9OwoJCQkJdmFyIGFsbG9jYXRlID0gZnVuY3Rpb24gYWxsb2NhdGUoQywgbGVuZ3RoKSB7CgkJCQkJaWYgKCEoaXNPYmplY3QoQykgJiYgVFlQRURfQ09OU1RSVUNUT1IgaW4gQykpIHsKCQkJCQkJdGhyb3cgVHlwZUVycm9yKCdJdCBpcyBub3QgYSB0eXBlZCBhcnJheSBjb25zdHJ1Y3RvciEnKTsKCQkJCQl9CgkJCQkJcmV0dXJuIG5ldyBDKGxlbmd0aCk7CgkJCQl9OwoJCQkJdmFyIHNwZWNpZXNGcm9tTGlzdCA9IGZ1bmN0aW9uIHNwZWNpZXNGcm9tTGlzdChPLCBsaXN0KSB7CgkJCQkJcmV0dXJuIGZyb21MaXN0KHNwZWNpZXNDb25zdHJ1Y3RvcihPLCBPW0RFRl9DT05TVFJVQ1RPUl0pLCBsaXN0KTsKCQkJCX07CgkJCQl2YXIgZnJvbUxpc3QgPSBmdW5jdGlvbiBmcm9tTGlzdChDLCBsaXN0KSB7CgkJCQkJdmFyIGluZGV4ID0gMDsKCQkJCQl2YXIgbGVuZ3RoID0gbGlzdC5sZW5ndGg7CgkJCQkJdmFyIHJlc3VsdCA9IGFsbG9jYXRlKEMsIGxlbmd0aCk7CgkJCQkJd2hpbGUgKGxlbmd0aCA+IGluZGV4KSByZXN1bHRbaW5kZXhdID0gbGlzdFtpbmRleCsrXTsKCQkJCQlyZXR1cm4gcmVzdWx0OwoJCQkJfTsKCQkJCXZhciBhZGRHZXR0ZXIgPSBmdW5jdGlvbiBhZGRHZXR0ZXIoaXQsIGtleSwgaW50ZXJuYWwpIHsKCQkJCQlkUChpdCwga2V5LCB7CgkJCQkJCWdldDogZnVuY3Rpb24gZ2V0KCkgewoJCQkJCQkJcmV0dXJuIHRoaXMuX2RbaW50ZXJuYWxdOwoJCQkJCQl9CgkJCQkJfSk7CgkJCQl9OwoJCQkJdmFyICRmcm9tID0gZnVuY3Rpb24gZnJvbShzb3VyY2UgLyogLCBtYXBmbiwgdGhpc0FyZyAqLykgewoJCQkJCXZhciBPID0gdG9PYmplY3Qoc291cmNlKTsKCQkJCQl2YXIgYUxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CgkJCQkJdmFyIG1hcGZuID0gYUxlbiA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CgkJCQkJdmFyIG1hcHBpbmcgPSBtYXBmbiAhPT0gdW5kZWZpbmVkOwoJCQkJCXZhciBpdGVyRm4gPSBnZXRJdGVyRm4oTyk7CgkJCQkJdmFyIGksIGxlbmd0aCwgdmFsdWVzLCByZXN1bHQsIHN0ZXAsIGl0ZXJhdG9yOwoJCQkJCWlmIChpdGVyRm4gIT0gdW5kZWZpbmVkICYmICFpc0FycmF5SXRlcihpdGVyRm4pKSB7CgkJCQkJCWZvciAoaXRlcmF0b3IgPSBpdGVyRm4uY2FsbChPKSwgdmFsdWVzID0gW10sIGkgPSAwOyAhKHN0ZXAgPSBpdGVyYXRvci5uZXh0KCkpLmRvbmU7IGkrKykgewoJCQkJCQkJdmFsdWVzLnB1c2goc3RlcC52YWx1ZSk7CgkJCQkJCX0KCQkJCQkJTyA9IHZhbHVlczsKCQkJCQl9CgkJCQkJaWYgKG1hcHBpbmcgJiYgYUxlbiA+IDIpIG1hcGZuID0gY3R4KG1hcGZuLCBhcmd1bWVudHNbMl0sIDIpOwoJCQkJCWZvciAoaSA9IDAsIGxlbmd0aCA9IHRvTGVuZ3RoKE8ubGVuZ3RoKSwgcmVzdWx0ID0gYWxsb2NhdGUodGhpcywgbGVuZ3RoKTsgbGVuZ3RoID4gaTsgaSsrKSB7CgkJCQkJCXJlc3VsdFtpXSA9IG1hcHBpbmcgPyBtYXBmbihPW2ldLCBpKSA6IE9baV07CgkJCQkJfQoJCQkJCXJldHVybiByZXN1bHQ7CgkJCQl9OwoJCQkJdmFyICRvZiA9IGZ1bmN0aW9uIG9mKCAvKiAuLi5pdGVtcyAqLwoJCQkJKSB7CgkJCQkJdmFyIGluZGV4ID0gMDsKCQkJCQl2YXIgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aDsKCQkJCQl2YXIgcmVzdWx0ID0gYWxsb2NhdGUodGhpcywgbGVuZ3RoKTsKCQkJCQl3aGlsZSAobGVuZ3RoID4gaW5kZXgpIHJlc3VsdFtpbmRleF0gPSBhcmd1bWVudHNbaW5kZXgrK107CgkJCQkJcmV0dXJuIHJlc3VsdDsKCQkJCX07CgoJCQkJLy8gaU9TIFNhZmFyaSA2LnggZmFpbHMgaGVyZQoJCQkJdmFyIFRPX0xPQ0FMRV9CVUcgPSAhIVVpbnQ4QXJyYXkgJiYgZmFpbHMoZnVuY3Rpb24oKSB7CgkJCQkJYXJyYXlUb0xvY2FsZVN0cmluZy5jYWxsKG5ldyBVaW50OEFycmF5KDEpKTsKCQkJCX0pOwoJCQkJdmFyICR0b0xvY2FsZVN0cmluZyA9IGZ1bmN0aW9uIHRvTG9jYWxlU3RyaW5nKCkgewoJCQkJCXJldHVybiBhcnJheVRvTG9jYWxlU3RyaW5nLmFwcGx5KFRPX0xPQ0FMRV9CVUcgPyBhcnJheVNsaWNlLmNhbGwodmFsaWRhdGUodGhpcykpIDogdmFsaWRhdGUodGhpcyksIGFyZ3VtZW50cyk7CgkJCQl9OwoJCQkJdmFyIHByb3RvID0gewoJCQkJCWNvcHlXaXRoaW46IGZ1bmN0aW9uIGNvcHlXaXRoaW4odGFyZ2V0LCBzdGFydCAvKiAsIGVuZCAqLykgewoJCQkJCQlyZXR1cm4gYXJyYXlDb3B5V2l0aGluLmNhbGwodmFsaWRhdGUodGhpcyksIHRhcmdldCwgc3RhcnQsIGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkKTsKCQkJCQl9LAoJCQkJCWV2ZXJ5OiBmdW5jdGlvbiBldmVyeShjYWxsYmFja2ZuIC8qICwgdGhpc0FyZyAqLykgewoJCQkJCQlyZXR1cm4gYXJyYXlFdmVyeSh2YWxpZGF0ZSh0aGlzKSwgY2FsbGJhY2tmbiwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpOwoJCQkJCX0sCgkJCQkJZmlsbDogZnVuY3Rpb24gZmlsbCh2YWx1ZSAvKiAsIHN0YXJ0LCBlbmQgKi8pIHsKCQkJCQkJLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bnVzZWQtdmFycwoJCQkJCQlyZXR1cm4gYXJyYXlGaWxsLmFwcGx5KHZhbGlkYXRlKHRoaXMpLCBhcmd1bWVudHMpOwoJCQkJCX0sCgkJCQkJZmlsdGVyOiBmdW5jdGlvbiBmaWx0ZXIoY2FsbGJhY2tmbiAvKiAsIHRoaXNBcmcgKi8pIHsKCQkJCQkJcmV0dXJuIHNwZWNpZXNGcm9tTGlzdCh0aGlzLCBhcnJheUZpbHRlcih2YWxpZGF0ZSh0aGlzKSwgY2FsbGJhY2tmbiwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpKTsKCQkJCQl9LAoJCQkJCWZpbmQ6IGZ1bmN0aW9uIGZpbmQocHJlZGljYXRlIC8qICwgdGhpc0FyZyAqLykgewoJCQkJCQlyZXR1cm4gYXJyYXlGaW5kKHZhbGlkYXRlKHRoaXMpLCBwcmVkaWNhdGUsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsKCQkJCQl9LAoJCQkJCWZpbmRJbmRleDogZnVuY3Rpb24gZmluZEluZGV4KHByZWRpY2F0ZSAvKiAsIHRoaXNBcmcgKi8pIHsKCQkJCQkJcmV0dXJuIGFycmF5RmluZEluZGV4KHZhbGlkYXRlKHRoaXMpLCBwcmVkaWNhdGUsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsKCQkJCQl9LAoJCQkJCWZvckVhY2g6IGZ1bmN0aW9uIGZvckVhY2goY2FsbGJhY2tmbiAvKiAsIHRoaXNBcmcgKi8pIHsKCQkJCQkJYXJyYXlGb3JFYWNoKHZhbGlkYXRlKHRoaXMpLCBjYWxsYmFja2ZuLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7CgkJCQkJfSwKCQkJCQlpbmRleE9mOiBmdW5jdGlvbiBpbmRleE9mKHNlYXJjaEVsZW1lbnQgLyogLCBmcm9tSW5kZXggKi8pIHsKCQkJCQkJcmV0dXJuIGFycmF5SW5kZXhPZih2YWxpZGF0ZSh0aGlzKSwgc2VhcmNoRWxlbWVudCwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQpOwoJCQkJCX0sCgkJCQkJaW5jbHVkZXM6IGZ1bmN0aW9uIGluY2x1ZGVzKHNlYXJjaEVsZW1lbnQgLyogLCBmcm9tSW5kZXggKi8pIHsKCQkJCQkJcmV0dXJuIGFycmF5SW5jbHVkZXModmFsaWRhdGUodGhpcyksIHNlYXJjaEVsZW1lbnQsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsKCQkJCQl9LAoJCQkJCWpvaW46IGZ1bmN0aW9uIGpvaW4oc2VwYXJhdG9yKSB7CgkJCQkJCS8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW51c2VkLXZhcnMKCQkJCQkJcmV0dXJuIGFycmF5Sm9pbi5hcHBseSh2YWxpZGF0ZSh0aGlzKSwgYXJndW1lbnRzKTsKCQkJCQl9LAoJCQkJCWxhc3RJbmRleE9mOiBmdW5jdGlvbiBsYXN0SW5kZXhPZihzZWFyY2hFbGVtZW50IC8qICwgZnJvbUluZGV4ICovKSB7CgkJCQkJCS8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW51c2VkLXZhcnMKCQkJCQkJcmV0dXJuIGFycmF5TGFzdEluZGV4T2YuYXBwbHkodmFsaWRhdGUodGhpcyksIGFyZ3VtZW50cyk7CgkJCQkJfSwKCQkJCQltYXA6IGZ1bmN0aW9uIG1hcChtYXBmbiAvKiAsIHRoaXNBcmcgKi8pIHsKCQkJCQkJcmV0dXJuICRtYXAodmFsaWRhdGUodGhpcyksIG1hcGZuLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7CgkJCQkJfSwKCQkJCQlyZWR1Y2U6IGZ1bmN0aW9uIHJlZHVjZShjYWxsYmFja2ZuIC8qICwgaW5pdGlhbFZhbHVlICovKSB7CgkJCQkJCS8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW51c2VkLXZhcnMKCQkJCQkJcmV0dXJuIGFycmF5UmVkdWNlLmFwcGx5KHZhbGlkYXRlKHRoaXMpLCBhcmd1bWVudHMpOwoJCQkJCX0sCgkJCQkJcmVkdWNlUmlnaHQ6IGZ1bmN0aW9uIHJlZHVjZVJpZ2h0KGNhbGxiYWNrZm4gLyogLCBpbml0aWFsVmFsdWUgKi8pIHsKCQkJCQkJLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bnVzZWQtdmFycwoJCQkJCQlyZXR1cm4gYXJyYXlSZWR1Y2VSaWdodC5hcHBseSh2YWxpZGF0ZSh0aGlzKSwgYXJndW1lbnRzKTsKCQkJCQl9LAoJCQkJCXJldmVyc2U6IGZ1bmN0aW9uIHJldmVyc2UoKSB7CgkJCQkJCXZhciB0aGF0ID0gdGhpczsKCQkJCQkJdmFyIGxlbmd0aCA9IHZhbGlkYXRlKHRoYXQpLmxlbmd0aDsKCQkJCQkJdmFyIG1pZGRsZSA9IE1hdGguZmxvb3IobGVuZ3RoIC8gMik7CgkJCQkJCXZhciBpbmRleCA9IDA7CgkJCQkJCXZhciB2YWx1ZTsKCQkJCQkJd2hpbGUgKGluZGV4IDwgbWlkZGxlKSB7CgkJCQkJCQl2YWx1ZSA9IHRoYXRbaW5kZXhdOwoJCQkJCQkJdGhhdFtpbmRleCsrXSA9IHRoYXRbLS1sZW5ndGhdOwoJCQkJCQkJdGhhdFtsZW5ndGhdID0gdmFsdWU7CgkJCQkJCX0KCQkJCQkJcmV0dXJuIHRoYXQ7CgkJCQkJfSwKCQkJCQlzb21lOiBmdW5jdGlvbiBzb21lKGNhbGxiYWNrZm4gLyogLCB0aGlzQXJnICovKSB7CgkJCQkJCXJldHVybiBhcnJheVNvbWUodmFsaWRhdGUodGhpcyksIGNhbGxiYWNrZm4sIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsKCQkJCQl9LAoJCQkJCXNvcnQ6IGZ1bmN0aW9uIHNvcnQoY29tcGFyZWZuKSB7CgkJCQkJCXJldHVybiBhcnJheVNvcnQuY2FsbCh2YWxpZGF0ZSh0aGlzKSwgY29tcGFyZWZuKTsKCQkJCQl9LAoJCQkJCXN1YmFycmF5OiBmdW5jdGlvbiBzdWJhcnJheShiZWdpbiwgZW5kKSB7CgkJCQkJCXZhciBPID0gdmFsaWRhdGUodGhpcyk7CgkJCQkJCXZhciBsZW5ndGggPSBPLmxlbmd0aDsKCQkJCQkJdmFyICRiZWdpbiA9IHRvQWJzb2x1dGVJbmRleChiZWdpbiwgbGVuZ3RoKTsKCQkJCQkJcmV0dXJuIG5ldyAoc3BlY2llc0NvbnN0cnVjdG9yKE8sIE9bREVGX0NPTlNUUlVDVE9SXSkpKE8uYnVmZmVyLCBPLmJ5dGVPZmZzZXQgKyAkYmVnaW4gKiBPLkJZVEVTX1BFUl9FTEVNRU5ULCB0b0xlbmd0aCgoZW5kID09PSB1bmRlZmluZWQgPyBsZW5ndGggOiB0b0Fic29sdXRlSW5kZXgoZW5kLCBsZW5ndGgpKSAtICRiZWdpbikpOwoJCQkJCX0KCQkJCX07CgkJCQl2YXIgJHNsaWNlID0gZnVuY3Rpb24gc2xpY2Uoc3RhcnQsIGVuZCkgewoJCQkJCXJldHVybiBzcGVjaWVzRnJvbUxpc3QodGhpcywgYXJyYXlTbGljZS5jYWxsKHZhbGlkYXRlKHRoaXMpLCBzdGFydCwgZW5kKSk7CgkJCQl9OwoJCQkJdmFyICRzZXQgPSBmdW5jdGlvbiBzZXQoYXJyYXlMaWtlIC8qICwgb2Zmc2V0ICovKSB7CgkJCQkJdmFsaWRhdGUodGhpcyk7CgkJCQkJdmFyIG9mZnNldCA9IHRvT2Zmc2V0KGFyZ3VtZW50c1sxXSwgMSk7CgkJCQkJdmFyIGxlbmd0aCA9IHRoaXMubGVuZ3RoOwoJCQkJCXZhciBzcmMgPSB0b09iamVjdChhcnJheUxpa2UpOwoJCQkJCXZhciBsZW4gPSB0b0xlbmd0aChzcmMubGVuZ3RoKTsKCQkJCQl2YXIgaW5kZXggPSAwOwoJCQkJCWlmIChsZW4gKyBvZmZzZXQgPiBsZW5ndGgpIHRocm93IFJhbmdlRXJyb3IoV1JPTkdfTEVOR1RIKTsKCQkJCQl3aGlsZSAoaW5kZXggPCBsZW4pIHRoaXNbb2Zmc2V0ICsgaW5kZXhdID0gc3JjW2luZGV4KytdOwoJCQkJfTsKCQkJCXZhciAkaXRlcmF0b3JzID0gewoJCQkJCWVudHJpZXM6IGZ1bmN0aW9uIGVudHJpZXMoKSB7CgkJCQkJCXJldHVybiBhcnJheUVudHJpZXMuY2FsbCh2YWxpZGF0ZSh0aGlzKSk7CgkJCQkJfSwKCQkJCQlrZXlzOiBmdW5jdGlvbiBrZXlzKCkgewoJCQkJCQlyZXR1cm4gYXJyYXlLZXlzLmNhbGwodmFsaWRhdGUodGhpcykpOwoJCQkJCX0sCgkJCQkJdmFsdWVzOiBmdW5jdGlvbiB2YWx1ZXMoKSB7CgkJCQkJCXJldHVybiBhcnJheVZhbHVlcy5jYWxsKHZhbGlkYXRlKHRoaXMpKTsKCQkJCQl9CgkJCQl9OwoJCQkJdmFyIGlzVEFJbmRleCA9IGZ1bmN0aW9uIGlzVEFJbmRleCh0YXJnZXQsIGtleSkgewoJCQkJCXJldHVybiBpc09iamVjdCh0YXJnZXQpICYmIHRhcmdldFtUWVBFRF9BUlJBWV0gJiYgX3R5cGVvZihrZXkpICE9ICdzeW1ib2wnICYmIGtleSBpbiB0YXJnZXQgJiYgU3RyaW5nKCtrZXkpID09IFN0cmluZyhrZXkpOwoJCQkJfTsKCQkJCXZhciAkZ2V0RGVzYyA9IGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgewoJCQkJCXJldHVybiBpc1RBSW5kZXgodGFyZ2V0LCBrZXkgPSB0b1ByaW1pdGl2ZShrZXksIHRydWUpKSA/IHByb3BlcnR5RGVzYygyLCB0YXJnZXRba2V5XSkgOiBnT1BEKHRhcmdldCwga2V5KTsKCQkJCX07CgkJCQl2YXIgJHNldERlc2MgPSBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgZGVzYykgewoJCQkJCWlmIChpc1RBSW5kZXgodGFyZ2V0LCBrZXkgPSB0b1ByaW1pdGl2ZShrZXksIHRydWUpKSAmJiBpc09iamVjdChkZXNjKSAmJiBoYXMoZGVzYywgJ3ZhbHVlJykgJiYgIWhhcyhkZXNjLCAnZ2V0JykgJiYgIWhhcyhkZXNjLCAnc2V0JykKCQkJCQkJLy8gVE9ETzogYWRkIHZhbGlkYXRpb24gZGVzY3JpcHRvciB3L28gY2FsbGluZyBhY2Nlc3NvcnMKCQkJCQkJJiYgIWRlc2MuY29uZmlndXJhYmxlICYmICghaGFzKGRlc2MsICd3cml0YWJsZScpIHx8IGRlc2Mud3JpdGFibGUpICYmICghaGFzKGRlc2MsICdlbnVtZXJhYmxlJykgfHwgZGVzYy5lbnVtZXJhYmxlKSkgewoJCQkJCQl0YXJnZXRba2V5XSA9IGRlc2MudmFsdWU7CgkJCQkJCXJldHVybiB0YXJnZXQ7CgkJCQkJfQoJCQkJCXJldHVybiBkUCh0YXJnZXQsIGtleSwgZGVzYyk7CgkJCQl9OwoJCQkJaWYgKCFBTExfQ09OU1RSVUNUT1JTKSB7CgkJCQkJJEdPUEQuZiA9ICRnZXREZXNjOwoJCQkJCSREUC5mID0gJHNldERlc2M7CgkJCQl9CgkJCQkkZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICFBTExfQ09OU1RSVUNUT1JTLCAnT2JqZWN0JywgewoJCQkJCWdldE93blByb3BlcnR5RGVzY3JpcHRvcjogJGdldERlc2MsCgkJCQkJZGVmaW5lUHJvcGVydHk6ICRzZXREZXNjCgkJCQl9KTsKCQkJCWlmIChmYWlscyhmdW5jdGlvbigpIHsKCQkJCQlhcnJheVRvU3RyaW5nLmNhbGwoe30pOwoJCQkJfSkpIHsKCQkJCQlhcnJheVRvU3RyaW5nID0gYXJyYXlUb0xvY2FsZVN0cmluZyA9IGZ1bmN0aW9uIHRvU3RyaW5nKCkgewoJCQkJCQlyZXR1cm4gYXJyYXlKb2luLmNhbGwodGhpcyk7CgkJCQkJfTsKCQkJCX0KCQkJCXZhciAkVHlwZWRBcnJheVByb3RvdHlwZSQgPSByZWRlZmluZUFsbCh7fSwgcHJvdG8pOwoJCQkJcmVkZWZpbmVBbGwoJFR5cGVkQXJyYXlQcm90b3R5cGUkLCAkaXRlcmF0b3JzKTsKCQkJCWhpZGUoJFR5cGVkQXJyYXlQcm90b3R5cGUkLCBJVEVSQVRPUiwgJGl0ZXJhdG9ycy52YWx1ZXMpOwoJCQkJcmVkZWZpbmVBbGwoJFR5cGVkQXJyYXlQcm90b3R5cGUkLCB7CgkJCQkJc2xpY2U6ICRzbGljZSwKCQkJCQlzZXQ6ICRzZXQsCgkJCQkJY29uc3RydWN0b3I6IGZ1bmN0aW9uIGNvbnN0cnVjdG9yKCkgey8qIG5vb3AgKi8KCQkJCQl9LAoJCQkJCXRvU3RyaW5nOiBhcnJheVRvU3RyaW5nLAoJCQkJCXRvTG9jYWxlU3RyaW5nOiAkdG9Mb2NhbGVTdHJpbmcKCQkJCX0pOwoJCQkJYWRkR2V0dGVyKCRUeXBlZEFycmF5UHJvdG90eXBlJCwgJ2J1ZmZlcicsICdiJyk7CgkJCQlhZGRHZXR0ZXIoJFR5cGVkQXJyYXlQcm90b3R5cGUkLCAnYnl0ZU9mZnNldCcsICdvJyk7CgkJCQlhZGRHZXR0ZXIoJFR5cGVkQXJyYXlQcm90b3R5cGUkLCAnYnl0ZUxlbmd0aCcsICdsJyk7CgkJCQlhZGRHZXR0ZXIoJFR5cGVkQXJyYXlQcm90b3R5cGUkLCAnbGVuZ3RoJywgJ2UnKTsKCQkJCWRQKCRUeXBlZEFycmF5UHJvdG90eXBlJCwgVEFHLCB7CgkJCQkJZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkJCQkJCXJldHVybiB0aGlzW1RZUEVEX0FSUkFZXTsKCQkJCQl9CgkJCQl9KTsKCgkJCQkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXN0YXRlbWVudHMKCQkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oS0VZLCBCWVRFUywgd3JhcHBlciwgQ0xBTVBFRCkgewoJCQkJCUNMQU1QRUQgPSAhIUNMQU1QRUQ7CgkJCQkJdmFyIE5BTUUgPSBLRVkgKyAoQ0xBTVBFRCA/ICdDbGFtcGVkJyA6ICcnKSArICdBcnJheSc7CgkJCQkJdmFyIEdFVFRFUiA9ICdnZXQnICsgS0VZOwoJCQkJCXZhciBTRVRURVIgPSAnc2V0JyArIEtFWTsKCQkJCQl2YXIgVHlwZWRBcnJheSA9IGdsb2JhbFtOQU1FXTsKCQkJCQl2YXIgQmFzZSA9IFR5cGVkQXJyYXkgfHwge307CgkJCQkJdmFyIFRBQyA9IFR5cGVkQXJyYXkgJiYgZ2V0UHJvdG90eXBlT2YoVHlwZWRBcnJheSk7CgkJCQkJdmFyIEZPUkNFRCA9ICFUeXBlZEFycmF5IHx8ICEkdHlwZWQuQUJWOwoJCQkJCXZhciBPID0ge307CgkJCQkJdmFyIFR5cGVkQXJyYXlQcm90b3R5cGUgPSBUeXBlZEFycmF5ICYmIFR5cGVkQXJyYXlbUFJPVE9UWVBFXTsKCQkJCQl2YXIgZ2V0dGVyID0gZnVuY3Rpb24gZ2V0dGVyKHRoYXQsIGluZGV4KSB7CgkJCQkJCXZhciBkYXRhID0gdGhhdC5fZDsKCQkJCQkJcmV0dXJuIGRhdGEudltHRVRURVJdKGluZGV4ICogQllURVMgKyBkYXRhLm8sIExJVFRMRV9FTkRJQU4pOwoJCQkJCX07CgkJCQkJdmFyIHNldHRlciA9IGZ1bmN0aW9uIHNldHRlcih0aGF0LCBpbmRleCwgdmFsdWUpIHsKCQkJCQkJdmFyIGRhdGEgPSB0aGF0Ll9kOwoJCQkJCQlpZiAoQ0xBTVBFRCkgdmFsdWUgPSAodmFsdWUgPSBNYXRoLnJvdW5kKHZhbHVlKSkgPCAwID8gMCA6IHZhbHVlID4gMHhmZiA/IDB4ZmYgOiB2YWx1ZSAmIDB4ZmY7CgkJCQkJCWRhdGEudltTRVRURVJdKGluZGV4ICogQllURVMgKyBkYXRhLm8sIHZhbHVlLCBMSVRUTEVfRU5ESUFOKTsKCQkJCQl9OwoJCQkJCXZhciBhZGRFbGVtZW50ID0gZnVuY3Rpb24gYWRkRWxlbWVudCh0aGF0LCBpbmRleCkgewoJCQkJCQlkUCh0aGF0LCBpbmRleCwgewoJCQkJCQkJZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkJCQkJCQkJcmV0dXJuIGdldHRlcih0aGlzLCBpbmRleCk7CgkJCQkJCQl9LAoJCQkJCQkJc2V0OiBmdW5jdGlvbiBzZXQodmFsdWUpIHsKCQkJCQkJCQlyZXR1cm4gc2V0dGVyKHRoaXMsIGluZGV4LCB2YWx1ZSk7CgkJCQkJCQl9LAoJCQkJCQkJZW51bWVyYWJsZTogdHJ1ZQoJCQkJCQl9KTsKCQkJCQl9OwoJCQkJCWlmIChGT1JDRUQpIHsKCQkJCQkJVHlwZWRBcnJheSA9IHdyYXBwZXIoZnVuY3Rpb24odGhhdCwgZGF0YSwgJG9mZnNldCwgJGxlbmd0aCkgewoJCQkJCQkJYW5JbnN0YW5jZSh0aGF0LCBUeXBlZEFycmF5LCBOQU1FLCAnX2QnKTsKCQkJCQkJCXZhciBpbmRleCA9IDA7CgkJCQkJCQl2YXIgb2Zmc2V0ID0gMDsKCQkJCQkJCXZhciBidWZmZXIsIGJ5dGVMZW5ndGgsIGxlbmd0aCwga2xhc3M7CgkJCQkJCQlpZiAoIWlzT2JqZWN0KGRhdGEpKSB7CgkJCQkJCQkJbGVuZ3RoID0gdG9JbmRleChkYXRhKTsKCQkJCQkJCQlieXRlTGVuZ3RoID0gbGVuZ3RoICogQllURVM7CgkJCQkJCQkJYnVmZmVyID0gbmV3ICRBcnJheUJ1ZmZlcihieXRlTGVuZ3RoKTsKCQkJCQkJCX0gZWxzZSBpZiAoZGF0YSBpbnN0YW5jZW9mICRBcnJheUJ1ZmZlciB8fCAoa2xhc3MgPSBjbGFzc29mKGRhdGEpKSA9PSBBUlJBWV9CVUZGRVIgfHwga2xhc3MgPT0gU0hBUkVEX0JVRkZFUikgewoJCQkJCQkJCWJ1ZmZlciA9IGRhdGE7CgkJCQkJCQkJb2Zmc2V0ID0gdG9PZmZzZXQoJG9mZnNldCwgQllURVMpOwoJCQkJCQkJCXZhciAkbGVuID0gZGF0YS5ieXRlTGVuZ3RoOwoJCQkJCQkJCWlmICgkbGVuZ3RoID09PSB1bmRlZmluZWQpIHsKCQkJCQkJCQkJaWYgKCRsZW4gJSBCWVRFUykgdGhyb3cgUmFuZ2VFcnJvcihXUk9OR19MRU5HVEgpOwoJCQkJCQkJCQlieXRlTGVuZ3RoID0gJGxlbiAtIG9mZnNldDsKCQkJCQkJCQkJaWYgKGJ5dGVMZW5ndGggPCAwKSB0aHJvdyBSYW5nZUVycm9yKFdST05HX0xFTkdUSCk7CgkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJYnl0ZUxlbmd0aCA9IHRvTGVuZ3RoKCRsZW5ndGgpICogQllURVM7CgkJCQkJCQkJCWlmIChieXRlTGVuZ3RoICsgb2Zmc2V0ID4gJGxlbikgdGhyb3cgUmFuZ2VFcnJvcihXUk9OR19MRU5HVEgpOwoJCQkJCQkJCX0KCQkJCQkJCQlsZW5ndGggPSBieXRlTGVuZ3RoIC8gQllURVM7CgkJCQkJCQl9IGVsc2UgaWYgKFRZUEVEX0FSUkFZIGluIGRhdGEpIHsKCQkJCQkJCQlyZXR1cm4gZnJvbUxpc3QoVHlwZWRBcnJheSwgZGF0YSk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCXJldHVybiAkZnJvbS5jYWxsKFR5cGVkQXJyYXksIGRhdGEpOwoJCQkJCQkJfQoJCQkJCQkJaGlkZSh0aGF0LCAnX2QnLCB7CgkJCQkJCQkJYjogYnVmZmVyLAoJCQkJCQkJCW86IG9mZnNldCwKCQkJCQkJCQlsOiBieXRlTGVuZ3RoLAoJCQkJCQkJCWU6IGxlbmd0aCwKCQkJCQkJCQl2OiBuZXcgJERhdGFWaWV3KGJ1ZmZlcikKCQkJCQkJCX0pOwoJCQkJCQkJd2hpbGUgKGluZGV4IDwgbGVuZ3RoKSBhZGRFbGVtZW50KHRoYXQsIGluZGV4KyspOwoJCQkJCQl9KTsKCQkJCQkJVHlwZWRBcnJheVByb3RvdHlwZSA9IFR5cGVkQXJyYXlbUFJPVE9UWVBFXSA9IGNyZWF0ZSgkVHlwZWRBcnJheVByb3RvdHlwZSQpOwoJCQkJCQloaWRlKFR5cGVkQXJyYXlQcm90b3R5cGUsICdjb25zdHJ1Y3RvcicsIFR5cGVkQXJyYXkpOwoJCQkJCX0gZWxzZSBpZiAoIWZhaWxzKGZ1bmN0aW9uKCkgewoJCQkJCQlUeXBlZEFycmF5KDEpOwoJCQkJCX0pIHx8ICFmYWlscyhmdW5jdGlvbigpIHsKCQkJCQkJbmV3IFR5cGVkQXJyYXkoLTEpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLW5ldwoJCQkJCX0pIHx8ICEkaXRlckRldGVjdChmdW5jdGlvbihpdGVyKSB7CgkJCQkJCW5ldyBUeXBlZEFycmF5KCk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tbmV3CgkJCQkJCW5ldyBUeXBlZEFycmF5KG51bGwpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLW5ldwoJCQkJCQluZXcgVHlwZWRBcnJheSgxLjUpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLW5ldwoJCQkJCQluZXcgVHlwZWRBcnJheShpdGVyKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1uZXcKCQkJCQl9LCB0cnVlKSkgewoJCQkJCQlUeXBlZEFycmF5ID0gd3JhcHBlcihmdW5jdGlvbih0aGF0LCBkYXRhLCAkb2Zmc2V0LCAkbGVuZ3RoKSB7CgkJCQkJCQlhbkluc3RhbmNlKHRoYXQsIFR5cGVkQXJyYXksIE5BTUUpOwoJCQkJCQkJdmFyIGtsYXNzOwoJCQkJCQkJLy8gYHdzYCBtb2R1bGUgYnVnLCB0ZW1wb3JhcmlseSByZW1vdmUgdmFsaWRhdGlvbiBsZW5ndGggZm9yIFVpbnQ4QXJyYXkKCQkJCQkJCS8vIGh0dHBzOi8vZ2l0aHViLmNvbS93ZWJzb2NrZXRzL3dzL3B1bGwvNjQ1CgkJCQkJCQlpZiAoIWlzT2JqZWN0KGRhdGEpKSByZXR1cm4gbmV3IEJhc2UodG9JbmRleChkYXRhKSk7CgkJCQkJCQlpZiAoZGF0YSBpbnN0YW5jZW9mICRBcnJheUJ1ZmZlciB8fCAoa2xhc3MgPSBjbGFzc29mKGRhdGEpKSA9PSBBUlJBWV9CVUZGRVIgfHwga2xhc3MgPT0gU0hBUkVEX0JVRkZFUikgewoJCQkJCQkJCXJldHVybiAkbGVuZ3RoICE9PSB1bmRlZmluZWQgPyBuZXcgQmFzZShkYXRhLCB0b09mZnNldCgkb2Zmc2V0LCBCWVRFUyksICRsZW5ndGgpIDogJG9mZnNldCAhPT0gdW5kZWZpbmVkID8gbmV3IEJhc2UoZGF0YSwgdG9PZmZzZXQoJG9mZnNldCwgQllURVMpKSA6IG5ldyBCYXNlKGRhdGEpOwoJCQkJCQkJfQoJCQkJCQkJaWYgKFRZUEVEX0FSUkFZIGluIGRhdGEpIHJldHVybiBmcm9tTGlzdChUeXBlZEFycmF5LCBkYXRhKTsKCQkJCQkJCXJldHVybiAkZnJvbS5jYWxsKFR5cGVkQXJyYXksIGRhdGEpOwoJCQkJCQl9KTsKCQkJCQkJYXJyYXlGb3JFYWNoKFRBQyAhPT0gRnVuY3Rpb24ucHJvdG90eXBlID8gZ09QTihCYXNlKS5jb25jYXQoZ09QTihUQUMpKSA6IGdPUE4oQmFzZSksIGZ1bmN0aW9uKGtleSkgewoJCQkJCQkJaWYgKCEoa2V5IGluIFR5cGVkQXJyYXkpKSBoaWRlKFR5cGVkQXJyYXksIGtleSwgQmFzZVtrZXldKTsKCQkJCQkJfSk7CgkJCQkJCVR5cGVkQXJyYXlbUFJPVE9UWVBFXSA9IFR5cGVkQXJyYXlQcm90b3R5cGU7CgkJCQkJCWlmICghTElCUkFSWSkgVHlwZWRBcnJheVByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFR5cGVkQXJyYXk7CgkJCQkJfQoJCQkJCXZhciAkbmF0aXZlSXRlcmF0b3IgPSBUeXBlZEFycmF5UHJvdG90eXBlW0lURVJBVE9SXTsKCQkJCQl2YXIgQ09SUkVDVF9JVEVSX05BTUUgPSAhISRuYXRpdmVJdGVyYXRvciAmJiAoJG5hdGl2ZUl0ZXJhdG9yLm5hbWUgPT0gJ3ZhbHVlcycgfHwgJG5hdGl2ZUl0ZXJhdG9yLm5hbWUgPT0gdW5kZWZpbmVkKTsKCQkJCQl2YXIgJGl0ZXJhdG9yID0gJGl0ZXJhdG9ycy52YWx1ZXM7CgkJCQkJaGlkZShUeXBlZEFycmF5LCBUWVBFRF9DT05TVFJVQ1RPUiwgdHJ1ZSk7CgkJCQkJaGlkZShUeXBlZEFycmF5UHJvdG90eXBlLCBUWVBFRF9BUlJBWSwgTkFNRSk7CgkJCQkJaGlkZShUeXBlZEFycmF5UHJvdG90eXBlLCBWSUVXLCB0cnVlKTsKCQkJCQloaWRlKFR5cGVkQXJyYXlQcm90b3R5cGUsIERFRl9DT05TVFJVQ1RPUiwgVHlwZWRBcnJheSk7CgkJCQkJaWYgKENMQU1QRUQgPyBuZXcgVHlwZWRBcnJheSgxKVtUQUddICE9IE5BTUUgOiAhKFRBRyBpbiBUeXBlZEFycmF5UHJvdG90eXBlKSkgewoJCQkJCQlkUChUeXBlZEFycmF5UHJvdG90eXBlLCBUQUcsIHsKCQkJCQkJCWdldDogZnVuY3Rpb24gZ2V0KCkgewoJCQkJCQkJCXJldHVybiBOQU1FOwoJCQkJCQkJfQoJCQkJCQl9KTsKCQkJCQl9CgkJCQkJT1tOQU1FXSA9IFR5cGVkQXJyYXk7CgkJCQkJJGV4cG9ydCgkZXhwb3J0LkcgKyAkZXhwb3J0LlcgKyAkZXhwb3J0LkYgKiAoVHlwZWRBcnJheSAhPSBCYXNlKSwgTyk7CgkJCQkJJGV4cG9ydCgkZXhwb3J0LlMsIE5BTUUsIHsKCQkJCQkJQllURVNfUEVSX0VMRU1FTlQ6IEJZVEVTCgkJCQkJfSk7CgkJCQkJJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiBmYWlscyhmdW5jdGlvbigpIHsKCQkJCQkJQmFzZS5vZi5jYWxsKFR5cGVkQXJyYXksIDEpOwoJCQkJCX0pLCBOQU1FLCB7CgkJCQkJCWZyb206ICRmcm9tLAoJCQkJCQlvZjogJG9mCgkJCQkJfSk7CgkJCQkJaWYgKCEoQllURVNfUEVSX0VMRU1FTlQgaW4gVHlwZWRBcnJheVByb3RvdHlwZSkpIGhpZGUoVHlwZWRBcnJheVByb3RvdHlwZSwgQllURVNfUEVSX0VMRU1FTlQsIEJZVEVTKTsKCQkJCQkkZXhwb3J0KCRleHBvcnQuUCwgTkFNRSwgcHJvdG8pOwoJCQkJCXNldFNwZWNpZXMoTkFNRSk7CgkJCQkJJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiBGT1JDRURfU0VULCBOQU1FLCB7CgkJCQkJCXNldDogJHNldAoJCQkJCX0pOwoJCQkJCSRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogIUNPUlJFQ1RfSVRFUl9OQU1FLCBOQU1FLCAkaXRlcmF0b3JzKTsKCQkJCQlpZiAoIUxJQlJBUlkgJiYgVHlwZWRBcnJheVByb3RvdHlwZS50b1N0cmluZyAhPSBhcnJheVRvU3RyaW5nKSBUeXBlZEFycmF5UHJvdG90eXBlLnRvU3RyaW5nID0gYXJyYXlUb1N0cmluZzsKCQkJCQkkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIGZhaWxzKGZ1bmN0aW9uKCkgewoJCQkJCQluZXcgVHlwZWRBcnJheSgxKS5zbGljZSgpOwoJCQkJCX0pLCBOQU1FLCB7CgkJCQkJCXNsaWNlOiAkc2xpY2UKCQkJCQl9KTsKCQkJCQkkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIChmYWlscyhmdW5jdGlvbigpIHsKCQkJCQkJcmV0dXJuIFsxLCAyXS50b0xvY2FsZVN0cmluZygpICE9IG5ldyBUeXBlZEFycmF5KFsxLCAyXSkudG9Mb2NhbGVTdHJpbmcoKTsKCQkJCQl9KSB8fCAhZmFpbHMoZnVuY3Rpb24oKSB7CgkJCQkJCVR5cGVkQXJyYXlQcm90b3R5cGUudG9Mb2NhbGVTdHJpbmcuY2FsbChbMSwgMl0pOwoJCQkJCX0pKSwgTkFNRSwgewoJCQkJCQl0b0xvY2FsZVN0cmluZzogJHRvTG9jYWxlU3RyaW5nCgkJCQkJfSk7CgkJCQkJSXRlcmF0b3JzW05BTUVdID0gQ09SUkVDVF9JVEVSX05BTUUgPyAkbmF0aXZlSXRlcmF0b3IgOiAkaXRlcmF0b3I7CgkJCQkJaWYgKCFMSUJSQVJZICYmICFDT1JSRUNUX0lURVJfTkFNRSkgaGlkZShUeXBlZEFycmF5UHJvdG90eXBlLCBJVEVSQVRPUiwgJGl0ZXJhdG9yKTsKCQkJCX07CgkJCX0gZWxzZSBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKCkgey8qIGVtcHR5ICovCgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA0MDQzOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgoJCQl2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5NzY5KTsKCQkJdmFyIERFU0NSSVBUT1JTID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MTk0KTsKCQkJdmFyIExJQlJBUlkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY1NjcpOwoJCQl2YXIgJHR5cGVkID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2OTg1KTsKCQkJdmFyIGhpZGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkwMzYpOwoJCQl2YXIgcmVkZWZpbmVBbGwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcxODUpOwoJCQl2YXIgZmFpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyOCk7CgkJCXZhciBhbkluc3RhbmNlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4NjczKTsKCQkJdmFyIHRvSW50ZWdlciA9IF9fd2VicGFja19yZXF1aXJlX18oNjY5OSk7CgkJCXZhciB0b0xlbmd0aCA9IF9fd2VicGFja19yZXF1aXJlX18oNTIwMSk7CgkJCXZhciB0b0luZGV4ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5NzE1KTsKCQkJdmFyIGdPUE4gPSAoX193ZWJwYWNrX3JlcXVpcmVfXyg4NDgyKS5mKTsKCQkJdmFyIGRQID0gKF9fd2VicGFja19yZXF1aXJlX18oMTUxNSkuZik7CgkJCXZhciBhcnJheUZpbGwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpOwoJCQl2YXIgc2V0VG9TdHJpbmdUYWcgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUzMjEpOwoJCQl2YXIgQVJSQVlfQlVGRkVSID0gJ0FycmF5QnVmZmVyJzsKCQkJdmFyIERBVEFfVklFVyA9ICdEYXRhVmlldyc7CgkJCXZhciBQUk9UT1RZUEUgPSAncHJvdG90eXBlJzsKCQkJdmFyIFdST05HX0xFTkdUSCA9ICdXcm9uZyBsZW5ndGghJzsKCQkJdmFyIFdST05HX0lOREVYID0gJ1dyb25nIGluZGV4ISc7CgkJCXZhciAkQXJyYXlCdWZmZXIgPSBnbG9iYWxbQVJSQVlfQlVGRkVSXTsKCQkJdmFyICREYXRhVmlldyA9IGdsb2JhbFtEQVRBX1ZJRVddOwoJCQl2YXIgTWF0aCA9IGdsb2JhbC5NYXRoOwoJCQl2YXIgUmFuZ2VFcnJvciA9IGdsb2JhbC5SYW5nZUVycm9yOwovLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2hhZG93LXJlc3RyaWN0ZWQtbmFtZXMKCQkJdmFyIEluZmluaXR5ID0gZ2xvYmFsLkluZmluaXR5OwoJCQl2YXIgQmFzZUJ1ZmZlciA9ICRBcnJheUJ1ZmZlcjsKCQkJdmFyIGFicyA9IE1hdGguYWJzOwoJCQl2YXIgcG93ID0gTWF0aC5wb3c7CgkJCXZhciBmbG9vciA9IE1hdGguZmxvb3I7CgkJCXZhciBsb2cgPSBNYXRoLmxvZzsKCQkJdmFyIExOMiA9IE1hdGguTE4yOwoJCQl2YXIgQlVGRkVSID0gJ2J1ZmZlcic7CgkJCXZhciBCWVRFX0xFTkdUSCA9ICdieXRlTGVuZ3RoJzsKCQkJdmFyIEJZVEVfT0ZGU0VUID0gJ2J5dGVPZmZzZXQnOwoJCQl2YXIgJEJVRkZFUiA9IERFU0NSSVBUT1JTID8gJ19iJyA6IEJVRkZFUjsKCQkJdmFyICRMRU5HVEggPSBERVNDUklQVE9SUyA/ICdfbCcgOiBCWVRFX0xFTkdUSDsKCQkJdmFyICRPRkZTRVQgPSBERVNDUklQVE9SUyA/ICdfbycgOiBCWVRFX09GRlNFVDsKCi8vIElFRUU3NTQgY29udmVyc2lvbnMgYmFzZWQgb24gaHR0cHM6Ly9naXRodWIuY29tL2Zlcm9zcy9pZWVlNzU0CgkJCWZ1bmN0aW9uIHBhY2tJRUVFNzU0KHZhbHVlLCBtTGVuLCBuQnl0ZXMpIHsKCQkJCXZhciBidWZmZXIgPSBuZXcgQXJyYXkobkJ5dGVzKTsKCQkJCXZhciBlTGVuID0gbkJ5dGVzICogOCAtIG1MZW4gLSAxOwoJCQkJdmFyIGVNYXggPSAoMSA8PCBlTGVuKSAtIDE7CgkJCQl2YXIgZUJpYXMgPSBlTWF4ID4+IDE7CgkJCQl2YXIgcnQgPSBtTGVuID09PSAyMyA/IHBvdygyLCAtMjQpIC0gcG93KDIsIC03NykgOiAwOwoJCQkJdmFyIGkgPSAwOwoJCQkJdmFyIHMgPSB2YWx1ZSA8IDAgfHwgdmFsdWUgPT09IDAgJiYgMSAvIHZhbHVlIDwgMCA/IDEgOiAwOwoJCQkJdmFyIGUsIG0sIGM7CgkJCQl2YWx1ZSA9IGFicyh2YWx1ZSk7CgkJCQkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlCgkJCQlpZiAodmFsdWUgIT0gdmFsdWUgfHwgdmFsdWUgPT09IEluZmluaXR5KSB7CgkJCQkJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXNlbGYtY29tcGFyZQoJCQkJCW0gPSB2YWx1ZSAhPSB2YWx1ZSA/IDEgOiAwOwoJCQkJCWUgPSBlTWF4OwoJCQkJfSBlbHNlIHsKCQkJCQllID0gZmxvb3IobG9nKHZhbHVlKSAvIExOMik7CgkJCQkJaWYgKHZhbHVlICogKGMgPSBwb3coMiwgLWUpKSA8IDEpIHsKCQkJCQkJZS0tOwoJCQkJCQljICo9IDI7CgkJCQkJfQoJCQkJCWlmIChlICsgZUJpYXMgPj0gMSkgewoJCQkJCQl2YWx1ZSArPSBydCAvIGM7CgkJCQkJfSBlbHNlIHsKCQkJCQkJdmFsdWUgKz0gcnQgKiBwb3coMiwgMSAtIGVCaWFzKTsKCQkJCQl9CgkJCQkJaWYgKHZhbHVlICogYyA+PSAyKSB7CgkJCQkJCWUrKzsKCQkJCQkJYyAvPSAyOwoJCQkJCX0KCQkJCQlpZiAoZSArIGVCaWFzID49IGVNYXgpIHsKCQkJCQkJbSA9IDA7CgkJCQkJCWUgPSBlTWF4OwoJCQkJCX0gZWxzZSBpZiAoZSArIGVCaWFzID49IDEpIHsKCQkJCQkJbSA9ICh2YWx1ZSAqIGMgLSAxKSAqIHBvdygyLCBtTGVuKTsKCQkJCQkJZSA9IGUgKyBlQmlhczsKCQkJCQl9IGVsc2UgewoJCQkJCQltID0gdmFsdWUgKiBwb3coMiwgZUJpYXMgLSAxKSAqIHBvdygyLCBtTGVuKTsKCQkJCQkJZSA9IDA7CgkJCQkJfQoJCQkJfQoJCQkJZm9yICg7IG1MZW4gPj0gODsgYnVmZmVyW2krK10gPSBtICYgMjU1LCBtIC89IDI1NiwgbUxlbiAtPSA4KSA7CgkJCQllID0gZSA8PCBtTGVuIHwgbTsKCQkJCWVMZW4gKz0gbUxlbjsKCQkJCWZvciAoOyBlTGVuID4gMDsgYnVmZmVyW2krK10gPSBlICYgMjU1LCBlIC89IDI1NiwgZUxlbiAtPSA4KSA7CgkJCQlidWZmZXJbLS1pXSB8PSBzICogMTI4OwoJCQkJcmV0dXJuIGJ1ZmZlcjsKCQkJfQoKCQkJZnVuY3Rpb24gdW5wYWNrSUVFRTc1NChidWZmZXIsIG1MZW4sIG5CeXRlcykgewoJCQkJdmFyIGVMZW4gPSBuQnl0ZXMgKiA4IC0gbUxlbiAtIDE7CgkJCQl2YXIgZU1heCA9ICgxIDw8IGVMZW4pIC0gMTsKCQkJCXZhciBlQmlhcyA9IGVNYXggPj4gMTsKCQkJCXZhciBuQml0cyA9IGVMZW4gLSA3OwoJCQkJdmFyIGkgPSBuQnl0ZXMgLSAxOwoJCQkJdmFyIHMgPSBidWZmZXJbaS0tXTsKCQkJCXZhciBlID0gcyAmIDEyNzsKCQkJCXZhciBtOwoJCQkJcyA+Pj0gNzsKCQkJCWZvciAoOyBuQml0cyA+IDA7IGUgPSBlICogMjU2ICsgYnVmZmVyW2ldLCBpLS0sIG5CaXRzIC09IDgpIDsKCQkJCW0gPSBlICYgKDEgPDwgLW5CaXRzKSAtIDE7CgkJCQllID4+PSAtbkJpdHM7CgkJCQluQml0cyArPSBtTGVuOwoJCQkJZm9yICg7IG5CaXRzID4gMDsgbSA9IG0gKiAyNTYgKyBidWZmZXJbaV0sIGktLSwgbkJpdHMgLT0gOCkgOwoJCQkJaWYgKGUgPT09IDApIHsKCQkJCQllID0gMSAtIGVCaWFzOwoJCQkJfSBlbHNlIGlmIChlID09PSBlTWF4KSB7CgkJCQkJcmV0dXJuIG0gPyBOYU4gOiBzID8gLUluZmluaXR5IDogSW5maW5pdHk7CgkJCQl9IGVsc2UgewoJCQkJCW0gPSBtICsgcG93KDIsIG1MZW4pOwoJCQkJCWUgPSBlIC0gZUJpYXM7CgkJCQl9CgkJCQlyZXR1cm4gKHMgPyAtMSA6IDEpICogbSAqIHBvdygyLCBlIC0gbUxlbik7CgkJCX0KCgkJCWZ1bmN0aW9uIHVucGFja0kzMihieXRlcykgewoJCQkJcmV0dXJuIGJ5dGVzWzNdIDw8IDI0IHwgYnl0ZXNbMl0gPDwgMTYgfCBieXRlc1sxXSA8PCA4IHwgYnl0ZXNbMF07CgkJCX0KCgkJCWZ1bmN0aW9uIHBhY2tJOChpdCkgewoJCQkJcmV0dXJuIFtpdCAmIDB4ZmZdOwoJCQl9CgoJCQlmdW5jdGlvbiBwYWNrSTE2KGl0KSB7CgkJCQlyZXR1cm4gW2l0ICYgMHhmZiwgaXQgPj4gOCAmIDB4ZmZdOwoJCQl9CgoJCQlmdW5jdGlvbiBwYWNrSTMyKGl0KSB7CgkJCQlyZXR1cm4gW2l0ICYgMHhmZiwgaXQgPj4gOCAmIDB4ZmYsIGl0ID4+IDE2ICYgMHhmZiwgaXQgPj4gMjQgJiAweGZmXTsKCQkJfQoKCQkJZnVuY3Rpb24gcGFja0Y2NChpdCkgewoJCQkJcmV0dXJuIHBhY2tJRUVFNzU0KGl0LCA1MiwgOCk7CgkJCX0KCgkJCWZ1bmN0aW9uIHBhY2tGMzIoaXQpIHsKCQkJCXJldHVybiBwYWNrSUVFRTc1NChpdCwgMjMsIDQpOwoJCQl9CgoJCQlmdW5jdGlvbiBhZGRHZXR0ZXIoQywga2V5LCBpbnRlcm5hbCkgewoJCQkJZFAoQ1tQUk9UT1RZUEVdLCBrZXksIHsKCQkJCQlnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKCQkJCQkJcmV0dXJuIHRoaXNbaW50ZXJuYWxdOwoJCQkJCX0KCQkJCX0pOwoJCQl9CgoJCQlmdW5jdGlvbiBnZXQodmlldywgYnl0ZXMsIGluZGV4LCBpc0xpdHRsZUVuZGlhbikgewoJCQkJdmFyIG51bUluZGV4ID0gK2luZGV4OwoJCQkJdmFyIGludEluZGV4ID0gdG9JbmRleChudW1JbmRleCk7CgkJCQlpZiAoaW50SW5kZXggKyBieXRlcyA+IHZpZXdbJExFTkdUSF0pIHRocm93IFJhbmdlRXJyb3IoV1JPTkdfSU5ERVgpOwoJCQkJdmFyIHN0b3JlID0gdmlld1skQlVGRkVSXS5fYjsKCQkJCXZhciBzdGFydCA9IGludEluZGV4ICsgdmlld1skT0ZGU0VUXTsKCQkJCXZhciBwYWNrID0gc3RvcmUuc2xpY2Uoc3RhcnQsIHN0YXJ0ICsgYnl0ZXMpOwoJCQkJcmV0dXJuIGlzTGl0dGxlRW5kaWFuID8gcGFjayA6IHBhY2sucmV2ZXJzZSgpOwoJCQl9CgoJCQlmdW5jdGlvbiBzZXQodmlldywgYnl0ZXMsIGluZGV4LCBjb252ZXJzaW9uLCB2YWx1ZSwgaXNMaXR0bGVFbmRpYW4pIHsKCQkJCXZhciBudW1JbmRleCA9ICtpbmRleDsKCQkJCXZhciBpbnRJbmRleCA9IHRvSW5kZXgobnVtSW5kZXgpOwoJCQkJaWYgKGludEluZGV4ICsgYnl0ZXMgPiB2aWV3WyRMRU5HVEhdKSB0aHJvdyBSYW5nZUVycm9yKFdST05HX0lOREVYKTsKCQkJCXZhciBzdG9yZSA9IHZpZXdbJEJVRkZFUl0uX2I7CgkJCQl2YXIgc3RhcnQgPSBpbnRJbmRleCArIHZpZXdbJE9GRlNFVF07CgkJCQl2YXIgcGFjayA9IGNvbnZlcnNpb24oK3ZhbHVlKTsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgYnl0ZXM7IGkrKykgc3RvcmVbc3RhcnQgKyBpXSA9IHBhY2tbaXNMaXR0bGVFbmRpYW4gPyBpIDogYnl0ZXMgLSBpIC0gMV07CgkJCX0KCgkJCWlmICghJHR5cGVkLkFCVikgewoJCQkJJEFycmF5QnVmZmVyID0gZnVuY3Rpb24gQXJyYXlCdWZmZXIobGVuZ3RoKSB7CgkJCQkJYW5JbnN0YW5jZSh0aGlzLCAkQXJyYXlCdWZmZXIsIEFSUkFZX0JVRkZFUik7CgkJCQkJdmFyIGJ5dGVMZW5ndGggPSB0b0luZGV4KGxlbmd0aCk7CgkJCQkJdGhpcy5fYiA9IGFycmF5RmlsbC5jYWxsKG5ldyBBcnJheShieXRlTGVuZ3RoKSwgMCk7CgkJCQkJdGhpc1skTEVOR1RIXSA9IGJ5dGVMZW5ndGg7CgkJCQl9OwoJCQkJJERhdGFWaWV3ID0gZnVuY3Rpb24gRGF0YVZpZXcoYnVmZmVyLCBieXRlT2Zmc2V0LCBieXRlTGVuZ3RoKSB7CgkJCQkJYW5JbnN0YW5jZSh0aGlzLCAkRGF0YVZpZXcsIERBVEFfVklFVyk7CgkJCQkJYW5JbnN0YW5jZShidWZmZXIsICRBcnJheUJ1ZmZlciwgREFUQV9WSUVXKTsKCQkJCQl2YXIgYnVmZmVyTGVuZ3RoID0gYnVmZmVyWyRMRU5HVEhdOwoJCQkJCXZhciBvZmZzZXQgPSB0b0ludGVnZXIoYnl0ZU9mZnNldCk7CgkJCQkJaWYgKG9mZnNldCA8IDAgfHwgb2Zmc2V0ID4gYnVmZmVyTGVuZ3RoKSB0aHJvdyBSYW5nZUVycm9yKCdXcm9uZyBvZmZzZXQhJyk7CgkJCQkJYnl0ZUxlbmd0aCA9IGJ5dGVMZW5ndGggPT09IHVuZGVmaW5lZCA/IGJ1ZmZlckxlbmd0aCAtIG9mZnNldCA6IHRvTGVuZ3RoKGJ5dGVMZW5ndGgpOwoJCQkJCWlmIChvZmZzZXQgKyBieXRlTGVuZ3RoID4gYnVmZmVyTGVuZ3RoKSB0aHJvdyBSYW5nZUVycm9yKFdST05HX0xFTkdUSCk7CgkJCQkJdGhpc1skQlVGRkVSXSA9IGJ1ZmZlcjsKCQkJCQl0aGlzWyRPRkZTRVRdID0gb2Zmc2V0OwoJCQkJCXRoaXNbJExFTkdUSF0gPSBieXRlTGVuZ3RoOwoJCQkJfTsKCQkJCWlmIChERVNDUklQVE9SUykgewoJCQkJCWFkZEdldHRlcigkQXJyYXlCdWZmZXIsIEJZVEVfTEVOR1RILCAnX2wnKTsKCQkJCQlhZGRHZXR0ZXIoJERhdGFWaWV3LCBCVUZGRVIsICdfYicpOwoJCQkJCWFkZEdldHRlcigkRGF0YVZpZXcsIEJZVEVfTEVOR1RILCAnX2wnKTsKCQkJCQlhZGRHZXR0ZXIoJERhdGFWaWV3LCBCWVRFX09GRlNFVCwgJ19vJyk7CgkJCQl9CgkJCQlyZWRlZmluZUFsbCgkRGF0YVZpZXdbUFJPVE9UWVBFXSwgewoJCQkJCWdldEludDg6IGZ1bmN0aW9uIGdldEludDgoYnl0ZU9mZnNldCkgewoJCQkJCQlyZXR1cm4gZ2V0KHRoaXMsIDEsIGJ5dGVPZmZzZXQpWzBdIDw8IDI0ID4+IDI0OwoJCQkJCX0sCgkJCQkJZ2V0VWludDg6IGZ1bmN0aW9uIGdldFVpbnQ4KGJ5dGVPZmZzZXQpIHsKCQkJCQkJcmV0dXJuIGdldCh0aGlzLCAxLCBieXRlT2Zmc2V0KVswXTsKCQkJCQl9LAoJCQkJCWdldEludDE2OiBmdW5jdGlvbiBnZXRJbnQxNihieXRlT2Zmc2V0IC8qICwgbGl0dGxlRW5kaWFuICovKSB7CgkJCQkJCXZhciBieXRlcyA9IGdldCh0aGlzLCAyLCBieXRlT2Zmc2V0LCBhcmd1bWVudHNbMV0pOwoJCQkJCQlyZXR1cm4gKGJ5dGVzWzFdIDw8IDggfCBieXRlc1swXSkgPDwgMTYgPj4gMTY7CgkJCQkJfSwKCQkJCQlnZXRVaW50MTY6IGZ1bmN0aW9uIGdldFVpbnQxNihieXRlT2Zmc2V0IC8qICwgbGl0dGxlRW5kaWFuICovKSB7CgkJCQkJCXZhciBieXRlcyA9IGdldCh0aGlzLCAyLCBieXRlT2Zmc2V0LCBhcmd1bWVudHNbMV0pOwoJCQkJCQlyZXR1cm4gYnl0ZXNbMV0gPDwgOCB8IGJ5dGVzWzBdOwoJCQkJCX0sCgkJCQkJZ2V0SW50MzI6IGZ1bmN0aW9uIGdldEludDMyKGJ5dGVPZmZzZXQgLyogLCBsaXR0bGVFbmRpYW4gKi8pIHsKCQkJCQkJcmV0dXJuIHVucGFja0kzMihnZXQodGhpcywgNCwgYnl0ZU9mZnNldCwgYXJndW1lbnRzWzFdKSk7CgkJCQkJfSwKCQkJCQlnZXRVaW50MzI6IGZ1bmN0aW9uIGdldFVpbnQzMihieXRlT2Zmc2V0IC8qICwgbGl0dGxlRW5kaWFuICovKSB7CgkJCQkJCXJldHVybiB1bnBhY2tJMzIoZ2V0KHRoaXMsIDQsIGJ5dGVPZmZzZXQsIGFyZ3VtZW50c1sxXSkpID4+PiAwOwoJCQkJCX0sCgkJCQkJZ2V0RmxvYXQzMjogZnVuY3Rpb24gZ2V0RmxvYXQzMihieXRlT2Zmc2V0IC8qICwgbGl0dGxlRW5kaWFuICovKSB7CgkJCQkJCXJldHVybiB1bnBhY2tJRUVFNzU0KGdldCh0aGlzLCA0LCBieXRlT2Zmc2V0LCBhcmd1bWVudHNbMV0pLCAyMywgNCk7CgkJCQkJfSwKCQkJCQlnZXRGbG9hdDY0OiBmdW5jdGlvbiBnZXRGbG9hdDY0KGJ5dGVPZmZzZXQgLyogLCBsaXR0bGVFbmRpYW4gKi8pIHsKCQkJCQkJcmV0dXJuIHVucGFja0lFRUU3NTQoZ2V0KHRoaXMsIDgsIGJ5dGVPZmZzZXQsIGFyZ3VtZW50c1sxXSksIDUyLCA4KTsKCQkJCQl9LAoJCQkJCXNldEludDg6IGZ1bmN0aW9uIHNldEludDgoYnl0ZU9mZnNldCwgdmFsdWUpIHsKCQkJCQkJc2V0KHRoaXMsIDEsIGJ5dGVPZmZzZXQsIHBhY2tJOCwgdmFsdWUpOwoJCQkJCX0sCgkJCQkJc2V0VWludDg6IGZ1bmN0aW9uIHNldFVpbnQ4KGJ5dGVPZmZzZXQsIHZhbHVlKSB7CgkJCQkJCXNldCh0aGlzLCAxLCBieXRlT2Zmc2V0LCBwYWNrSTgsIHZhbHVlKTsKCQkJCQl9LAoJCQkJCXNldEludDE2OiBmdW5jdGlvbiBzZXRJbnQxNihieXRlT2Zmc2V0LCB2YWx1ZSAvKiAsIGxpdHRsZUVuZGlhbiAqLykgewoJCQkJCQlzZXQodGhpcywgMiwgYnl0ZU9mZnNldCwgcGFja0kxNiwgdmFsdWUsIGFyZ3VtZW50c1syXSk7CgkJCQkJfSwKCQkJCQlzZXRVaW50MTY6IGZ1bmN0aW9uIHNldFVpbnQxNihieXRlT2Zmc2V0LCB2YWx1ZSAvKiAsIGxpdHRsZUVuZGlhbiAqLykgewoJCQkJCQlzZXQodGhpcywgMiwgYnl0ZU9mZnNldCwgcGFja0kxNiwgdmFsdWUsIGFyZ3VtZW50c1syXSk7CgkJCQkJfSwKCQkJCQlzZXRJbnQzMjogZnVuY3Rpb24gc2V0SW50MzIoYnl0ZU9mZnNldCwgdmFsdWUgLyogLCBsaXR0bGVFbmRpYW4gKi8pIHsKCQkJCQkJc2V0KHRoaXMsIDQsIGJ5dGVPZmZzZXQsIHBhY2tJMzIsIHZhbHVlLCBhcmd1bWVudHNbMl0pOwoJCQkJCX0sCgkJCQkJc2V0VWludDMyOiBmdW5jdGlvbiBzZXRVaW50MzIoYnl0ZU9mZnNldCwgdmFsdWUgLyogLCBsaXR0bGVFbmRpYW4gKi8pIHsKCQkJCQkJc2V0KHRoaXMsIDQsIGJ5dGVPZmZzZXQsIHBhY2tJMzIsIHZhbHVlLCBhcmd1bWVudHNbMl0pOwoJCQkJCX0sCgkJCQkJc2V0RmxvYXQzMjogZnVuY3Rpb24gc2V0RmxvYXQzMihieXRlT2Zmc2V0LCB2YWx1ZSAvKiAsIGxpdHRsZUVuZGlhbiAqLykgewoJCQkJCQlzZXQodGhpcywgNCwgYnl0ZU9mZnNldCwgcGFja0YzMiwgdmFsdWUsIGFyZ3VtZW50c1syXSk7CgkJCQkJfSwKCQkJCQlzZXRGbG9hdDY0OiBmdW5jdGlvbiBzZXRGbG9hdDY0KGJ5dGVPZmZzZXQsIHZhbHVlIC8qICwgbGl0dGxlRW5kaWFuICovKSB7CgkJCQkJCXNldCh0aGlzLCA4LCBieXRlT2Zmc2V0LCBwYWNrRjY0LCB2YWx1ZSwgYXJndW1lbnRzWzJdKTsKCQkJCQl9CgkJCQl9KTsKCQkJfSBlbHNlIHsKCQkJCWlmICghZmFpbHMoZnVuY3Rpb24oKSB7CgkJCQkJJEFycmF5QnVmZmVyKDEpOwoJCQkJfSkgfHwgIWZhaWxzKGZ1bmN0aW9uKCkgewoJCQkJCW5ldyAkQXJyYXlCdWZmZXIoLTEpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLW5ldwoJCQkJfSkgfHwgZmFpbHMoZnVuY3Rpb24oKSB7CgkJCQkJbmV3ICRBcnJheUJ1ZmZlcigpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLW5ldwoJCQkJCW5ldyAkQXJyYXlCdWZmZXIoMS41KTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1uZXcKCQkJCQluZXcgJEFycmF5QnVmZmVyKE5hTik7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tbmV3CgkJCQkJcmV0dXJuICRBcnJheUJ1ZmZlci5uYW1lICE9IEFSUkFZX0JVRkZFUjsKCQkJCX0pKSB7CgkJCQkJJEFycmF5QnVmZmVyID0gZnVuY3Rpb24gQXJyYXlCdWZmZXIobGVuZ3RoKSB7CgkJCQkJCWFuSW5zdGFuY2UodGhpcywgJEFycmF5QnVmZmVyKTsKCQkJCQkJcmV0dXJuIG5ldyBCYXNlQnVmZmVyKHRvSW5kZXgobGVuZ3RoKSk7CgkJCQkJfTsKCQkJCQl2YXIgQXJyYXlCdWZmZXJQcm90byA9ICRBcnJheUJ1ZmZlcltQUk9UT1RZUEVdID0gQmFzZUJ1ZmZlcltQUk9UT1RZUEVdOwoJCQkJCWZvciAodmFyIGtleXMgPSBnT1BOKEJhc2VCdWZmZXIpLCBqID0gMCwga2V5OyBrZXlzLmxlbmd0aCA+IGo7KSB7CgkJCQkJCWlmICghKChrZXkgPSBrZXlzW2orK10pIGluICRBcnJheUJ1ZmZlcikpIGhpZGUoJEFycmF5QnVmZmVyLCBrZXksIEJhc2VCdWZmZXJba2V5XSk7CgkJCQkJfQoJCQkJCWlmICghTElCUkFSWSkgQXJyYXlCdWZmZXJQcm90by5jb25zdHJ1Y3RvciA9ICRBcnJheUJ1ZmZlcjsKCQkJCX0KCQkJCS8vIGlPUyBTYWZhcmkgNy54IGJ1ZwoJCQkJdmFyIHZpZXcgPSBuZXcgJERhdGFWaWV3KG5ldyAkQXJyYXlCdWZmZXIoMikpOwoJCQkJdmFyICRzZXRJbnQ4ID0gJERhdGFWaWV3W1BST1RPVFlQRV0uc2V0SW50ODsKCQkJCXZpZXcuc2V0SW50OCgwLCAyMTQ3NDgzNjQ4KTsKCQkJCXZpZXcuc2V0SW50OCgxLCAyMTQ3NDgzNjQ5KTsKCQkJCWlmICh2aWV3LmdldEludDgoMCkgfHwgIXZpZXcuZ2V0SW50OCgxKSkgcmVkZWZpbmVBbGwoJERhdGFWaWV3W1BST1RPVFlQRV0sIHsKCQkJCQlzZXRJbnQ4OiBmdW5jdGlvbiBzZXRJbnQ4KGJ5dGVPZmZzZXQsIHZhbHVlKSB7CgkJCQkJCSRzZXRJbnQ4LmNhbGwodGhpcywgYnl0ZU9mZnNldCwgdmFsdWUgPDwgMjQgPj4gMjQpOwoJCQkJCX0sCgkJCQkJc2V0VWludDg6IGZ1bmN0aW9uIHNldFVpbnQ4KGJ5dGVPZmZzZXQsIHZhbHVlKSB7CgkJCQkJCSRzZXRJbnQ4LmNhbGwodGhpcywgYnl0ZU9mZnNldCwgdmFsdWUgPDwgMjQgPj4gMjQpOwoJCQkJCX0KCQkJCX0sIHRydWUpOwoJCQl9CgkJCXNldFRvU3RyaW5nVGFnKCRBcnJheUJ1ZmZlciwgQVJSQVlfQlVGRkVSKTsKCQkJc2V0VG9TdHJpbmdUYWcoJERhdGFWaWV3LCBEQVRBX1ZJRVcpOwoJCQloaWRlKCREYXRhVmlld1tQUk9UT1RZUEVdLCAkdHlwZWQuVklFVywgdHJ1ZSk7CgkJCWV4cG9ydHNbQVJSQVlfQlVGRkVSXSA9ICRBcnJheUJ1ZmZlcjsKCQkJZXhwb3J0c1tEQVRBX1ZJRVddID0gJERhdGFWaWV3OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNjk4NToKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5NzY5KTsKCQkJdmFyIGhpZGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkwMzYpOwoJCQl2YXIgdWlkID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MTcpOwoJCQl2YXIgVFlQRUQgPSB1aWQoJ3R5cGVkX2FycmF5Jyk7CgkJCXZhciBWSUVXID0gdWlkKCd2aWV3Jyk7CgkJCXZhciBBQlYgPSAhIShnbG9iYWwuQXJyYXlCdWZmZXIgJiYgZ2xvYmFsLkRhdGFWaWV3KTsKCQkJdmFyIENPTlNUUiA9IEFCVjsKCQkJdmFyIGkgPSAwOwoJCQl2YXIgbCA9IDk7CgkJCXZhciBUeXBlZDsKCQkJdmFyIFR5cGVkQXJyYXlDb25zdHJ1Y3RvcnMgPSAnSW50OEFycmF5LFVpbnQ4QXJyYXksVWludDhDbGFtcGVkQXJyYXksSW50MTZBcnJheSxVaW50MTZBcnJheSxJbnQzMkFycmF5LFVpbnQzMkFycmF5LEZsb2F0MzJBcnJheSxGbG9hdDY0QXJyYXknLnNwbGl0KCcsJyk7CgkJCXdoaWxlIChpIDwgbCkgewoJCQkJaWYgKFR5cGVkID0gZ2xvYmFsW1R5cGVkQXJyYXlDb25zdHJ1Y3RvcnNbaSsrXV0pIHsKCQkJCQloaWRlKFR5cGVkLnByb3RvdHlwZSwgVFlQRUQsIHRydWUpOwoJCQkJCWhpZGUoVHlwZWQucHJvdG90eXBlLCBWSUVXLCB0cnVlKTsKCQkJCX0gZWxzZSBDT05TVFIgPSBmYWxzZTsKCQkJfQoJCQltb2R1bGUuZXhwb3J0cyA9IHsKCQkJCUFCVjogQUJWLAoJCQkJQ09OU1RSOiBDT05TVFIsCgkJCQlUWVBFRDogVFlQRUQsCgkJCQlWSUVXOiBWSUVXCgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA2MTc6CgkJLyoqKi8gKChtb2R1bGUpID0+IHsKCgkJCXZhciBpZCA9IDA7CgkJCXZhciBweCA9IE1hdGgucmFuZG9tKCk7CgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oa2V5KSB7CgkJCQlyZXR1cm4gJ1N5bWJvbCgnLmNvbmNhdChrZXkgPT09IHVuZGVmaW5lZCA/ICcnIDoga2V5LCAnKV8nLCAoKytpZCArIHB4KS50b1N0cmluZygzNikpOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gOTk4NzoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5NzY5KTsKCQkJdmFyIG5hdmlnYXRvciA9IGdsb2JhbC5uYXZpZ2F0b3I7CgkJCW1vZHVsZS5leHBvcnRzID0gbmF2aWdhdG9yICYmIG5hdmlnYXRvci51c2VyQWdlbnQgfHwgJyc7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA2ODEzOgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNDY4Nik7CgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQsIFRZUEUpIHsKCQkJCWlmICghaXNPYmplY3QoaXQpIHx8IGl0Ll90ICE9PSBUWVBFKSB0aHJvdyBUeXBlRXJyb3IoJ0luY29tcGF0aWJsZSByZWNlaXZlciwgJyArIFRZUEUgKyAnIHJlcXVpcmVkIScpOwoJCQkJcmV0dXJuIGl0OwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNDU4NDoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5NzY5KTsKCQkJdmFyIGNvcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUxNjUpOwoJCQl2YXIgTElCUkFSWSA9IF9fd2VicGFja19yZXF1aXJlX18oNjU2Nyk7CgkJCXZhciB3a3NFeHQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM4NzMpOwoJCQl2YXIgZGVmaW5lUHJvcGVydHkgPSAoX193ZWJwYWNrX3JlcXVpcmVfXygxNTE1KS5mKTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihuYW1lKSB7CgkJCQl2YXIgJFN5bWJvbCA9IGNvcmUuU3ltYm9sIHx8IChjb3JlLlN5bWJvbCA9IExJQlJBUlkgPyB7fSA6IGdsb2JhbC5TeW1ib2wgfHwge30pOwoJCQkJaWYgKG5hbWUuY2hhckF0KDApICE9ICdfJyAmJiAhKG5hbWUgaW4gJFN5bWJvbCkpIGRlZmluZVByb3BlcnR5KCRTeW1ib2wsIG5hbWUsIHsKCQkJCQl2YWx1ZTogd2tzRXh0LmYobmFtZSkKCQkJCX0pOwoJCQl9OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMzg3MzoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQlleHBvcnRzLmYgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI4NjcpOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMjg2NzoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgc3RvcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc0MCkoJ3drcycpOwoJCQl2YXIgdWlkID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MTcpOwoJCQl2YXIgX1N5bWJvbCA9IChfX3dlYnBhY2tfcmVxdWlyZV9fKDk3NjkpLlN5bWJvbCk7CgkJCXZhciBVU0VfU1lNQk9MID0gdHlwZW9mIF9TeW1ib2wgPT0gJ2Z1bmN0aW9uJzsKCQkJdmFyICRleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihuYW1lKSB7CgkJCQlyZXR1cm4gc3RvcmVbbmFtZV0gfHwgKHN0b3JlW25hbWVdID0gVVNFX1NZTUJPTCAmJiBfU3ltYm9sW25hbWVdIHx8IChVU0VfU1lNQk9MID8gX1N5bWJvbCA6IHVpZCkoJ1N5bWJvbC4nICsgbmFtZSkpOwoJCQl9OwoJCQkkZXhwb3J0cy5zdG9yZSA9IHN0b3JlOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNDQ3OgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciBjbGFzc29mID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5MzQpOwoJCQl2YXIgSVRFUkFUT1IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI4NjcpKCdpdGVyYXRvcicpOwoJCQl2YXIgSXRlcmF0b3JzID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNDQ0KTsKCQkJbW9kdWxlLmV4cG9ydHMgPSAoX193ZWJwYWNrX3JlcXVpcmVfXyg1MTY1KS5nZXRJdGVyYXRvck1ldGhvZCkgPSBmdW5jdGlvbihpdCkgewoJCQkJaWYgKGl0ICE9IHVuZGVmaW5lZCkgcmV0dXJuIGl0W0lURVJBVE9SXSB8fCBpdFsnQEBpdGVyYXRvciddIHx8IEl0ZXJhdG9yc1tjbGFzc29mKGl0KV07CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA0NTE0OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gaHR0cHM6Ly9naXRodWIuY29tL2JlbmphbWluZ3IvUmV4RXhwLmVzY2FwZQoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciAkcmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY5NTEpKC9bXFxeJCorPy4oKXxbXF17fV0vZywgJ1xcJCYnKTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdSZWdFeHAnLCB7CgkJCQllc2NhcGU6IGZ1bmN0aW9uIGVzY2FwZShpdCkgewoJCQkJCXJldHVybiAkcmUoaXQpOwoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDgyOTU6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyAyMi4xLjMuMyBBcnJheS5wcm90b3R5cGUuY29weVdpdGhpbih0YXJnZXQsIHN0YXJ0LCBlbmQgPSB0aGlzLmxlbmd0aCkKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQkkZXhwb3J0KCRleHBvcnQuUCwgJ0FycmF5JywgewoJCQkJY29weVdpdGhpbjogX193ZWJwYWNrX3JlcXVpcmVfXygxMjcwKQoJCQl9KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg0NTUzKSgnY29weVdpdGhpbicpOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNDUwNToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciAkZXZlcnkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk1NjkpKDQpOwoJCQkkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqICFfX3dlYnBhY2tfcmVxdWlyZV9fKDE4MDgpKFtdLmV2ZXJ5LCB0cnVlKSwgJ0FycmF5JywgewoJCQkJLy8gMjIuMS4zLjUgLyAxNS40LjQuMTYgQXJyYXkucHJvdG90eXBlLmV2ZXJ5KGNhbGxiYWNrZm4gWywgdGhpc0FyZ10pCgkJCQlldmVyeTogZnVuY3Rpb24gZXZlcnkoY2FsbGJhY2tmbiAvKiAsIHRoaXNBcmcgKi8pIHsKCQkJCQlyZXR1cm4gJGV2ZXJ5KHRoaXMsIGNhbGxiYWNrZm4sIGFyZ3VtZW50c1sxXSk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNTM5MDoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIyLjEuMy42IEFycmF5LnByb3RvdHlwZS5maWxsKHZhbHVlLCBzdGFydCA9IDAsIGVuZCA9IHRoaXMubGVuZ3RoKQoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCSRleHBvcnQoJGV4cG9ydC5QLCAnQXJyYXknLCB7CgkJCQlmaWxsOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDMpCgkJCX0pOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQ1NTMpKCdmaWxsJyk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAzNTk5OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyICRmaWx0ZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk1NjkpKDIpOwoJCQkkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqICFfX3dlYnBhY2tfcmVxdWlyZV9fKDE4MDgpKFtdLmZpbHRlciwgdHJ1ZSksICdBcnJheScsIHsKCQkJCS8vIDIyLjEuMy43IC8gMTUuNC40LjIwIEFycmF5LnByb3RvdHlwZS5maWx0ZXIoY2FsbGJhY2tmbiBbLCB0aGlzQXJnXSkKCQkJCWZpbHRlcjogZnVuY3Rpb24gZmlsdGVyKGNhbGxiYWNrZm4gLyogLCB0aGlzQXJnICovKSB7CgkJCQkJcmV0dXJuICRmaWx0ZXIodGhpcywgY2FsbGJhY2tmbiwgYXJndW1lbnRzWzFdKTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAxMzYxOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCi8vIDIyLjEuMy45IEFycmF5LnByb3RvdHlwZS5maW5kSW5kZXgocHJlZGljYXRlLCB0aGlzQXJnID0gdW5kZWZpbmVkKQoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciAkZmluZCA9IF9fd2VicGFja19yZXF1aXJlX18oOTU2OSkoNik7CgkJCXZhciBLRVkgPSAnZmluZEluZGV4JzsKCQkJdmFyIGZvcmNlZCA9IHRydWU7Ci8vIFNob3VsZG4ndCBza2lwIGhvbGVzCgkJCWlmIChLRVkgaW4gW10pIEFycmF5KDEpW0tFWV0oZnVuY3Rpb24oKSB7CgkJCQlmb3JjZWQgPSBmYWxzZTsKCQkJfSk7CgkJCSRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogZm9yY2VkLCAnQXJyYXknLCB7CgkJCQlmaW5kSW5kZXg6IGZ1bmN0aW9uIGZpbmRJbmRleChjYWxsYmFja2ZuIC8qICwgdGhhdCA9IHVuZGVmaW5lZCAqLykgewoJCQkJCXJldHVybiAkZmluZCh0aGlzLCBjYWxsYmFja2ZuLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7CgkJCQl9CgkJCX0pOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQ1NTMpKEtFWSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA5Mjc6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKLy8gMjIuMS4zLjggQXJyYXkucHJvdG90eXBlLmZpbmQocHJlZGljYXRlLCB0aGlzQXJnID0gdW5kZWZpbmVkKQoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciAkZmluZCA9IF9fd2VicGFja19yZXF1aXJlX18oOTU2OSkoNSk7CgkJCXZhciBLRVkgPSAnZmluZCc7CgkJCXZhciBmb3JjZWQgPSB0cnVlOwovLyBTaG91bGRuJ3Qgc2tpcCBob2xlcwoJCQlpZiAoS0VZIGluIFtdKSBBcnJheSgxKVtLRVldKGZ1bmN0aW9uKCkgewoJCQkJZm9yY2VkID0gZmFsc2U7CgkJCX0pOwoJCQkkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIGZvcmNlZCwgJ0FycmF5JywgewoJCQkJZmluZDogZnVuY3Rpb24gZmluZChjYWxsYmFja2ZuIC8qICwgdGhhdCA9IHVuZGVmaW5lZCAqLykgewoJCQkJCXJldHVybiAkZmluZCh0aGlzLCBjYWxsYmFja2ZuLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCk7CgkJCQl9CgkJCX0pOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQ1NTMpKEtFWSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAzOTI6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQl2YXIgJGZvckVhY2ggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk1NjkpKDApOwoJCQl2YXIgU1RSSUNUID0gX193ZWJwYWNrX3JlcXVpcmVfXygxODA4KShbXS5mb3JFYWNoLCB0cnVlKTsKCQkJJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiAhU1RSSUNULCAnQXJyYXknLCB7CgkJCQkvLyAyMi4xLjMuMTAgLyAxNS40LjQuMTggQXJyYXkucHJvdG90eXBlLmZvckVhY2goY2FsbGJhY2tmbiBbLCB0aGlzQXJnXSkKCQkJCWZvckVhY2g6IGZ1bmN0aW9uIGZvckVhY2goY2FsbGJhY2tmbiAvKiAsIHRoaXNBcmcgKi8pIHsKCQkJCQlyZXR1cm4gJGZvckVhY2godGhpcywgY2FsbGJhY2tmbiwgYXJndW1lbnRzWzFdKTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA3NzU2OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCgkJCXZhciBjdHggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg1NjMpOwoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciB0b09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNDgyMCk7CgkJCXZhciBjYWxsID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNzIyKTsKCQkJdmFyIGlzQXJyYXlJdGVyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2NTc3KTsKCQkJdmFyIHRvTGVuZ3RoID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MjAxKTsKCQkJdmFyIGNyZWF0ZVByb3BlcnR5ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMDEyKTsKCQkJdmFyIGdldEl0ZXJGbiA9IF9fd2VicGFja19yZXF1aXJlX18oNDQ3KTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhX193ZWJwYWNrX3JlcXVpcmVfXyg5MjkpKGZ1bmN0aW9uKGl0ZXIpIHsKCQkJCUFycmF5LmZyb20oaXRlcik7CgkJCX0pLCAnQXJyYXknLCB7CgkJCQkvLyAyMi4xLjIuMSBBcnJheS5mcm9tKGFycmF5TGlrZSwgbWFwZm4gPSB1bmRlZmluZWQsIHRoaXNBcmcgPSB1bmRlZmluZWQpCgkJCQlmcm9tOiBmdW5jdGlvbiBmcm9tKGFycmF5TGlrZSAvKiAsIG1hcGZuID0gdW5kZWZpbmVkLCB0aGlzQXJnID0gdW5kZWZpbmVkICovKSB7CgkJCQkJdmFyIE8gPSB0b09iamVjdChhcnJheUxpa2UpOwoJCQkJCXZhciBDID0gdHlwZW9mIHRoaXMgPT0gJ2Z1bmN0aW9uJyA/IHRoaXMgOiBBcnJheTsKCQkJCQl2YXIgYUxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CgkJCQkJdmFyIG1hcGZuID0gYUxlbiA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CgkJCQkJdmFyIG1hcHBpbmcgPSBtYXBmbiAhPT0gdW5kZWZpbmVkOwoJCQkJCXZhciBpbmRleCA9IDA7CgkJCQkJdmFyIGl0ZXJGbiA9IGdldEl0ZXJGbihPKTsKCQkJCQl2YXIgbGVuZ3RoLCByZXN1bHQsIHN0ZXAsIGl0ZXJhdG9yOwoJCQkJCWlmIChtYXBwaW5nKSBtYXBmbiA9IGN0eChtYXBmbiwgYUxlbiA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQsIDIpOwoJCQkJCS8vIGlmIG9iamVjdCBpc24ndCBpdGVyYWJsZSBvciBpdCdzIGFycmF5IHdpdGggZGVmYXVsdCBpdGVyYXRvciAtIHVzZSBzaW1wbGUgY2FzZQoJCQkJCWlmIChpdGVyRm4gIT0gdW5kZWZpbmVkICYmICEoQyA9PSBBcnJheSAmJiBpc0FycmF5SXRlcihpdGVyRm4pKSkgewoJCQkJCQlmb3IgKGl0ZXJhdG9yID0gaXRlckZuLmNhbGwoTyksIHJlc3VsdCA9IG5ldyBDKCk7ICEoc3RlcCA9IGl0ZXJhdG9yLm5leHQoKSkuZG9uZTsgaW5kZXgrKykgewoJCQkJCQkJY3JlYXRlUHJvcGVydHkocmVzdWx0LCBpbmRleCwgbWFwcGluZyA/IGNhbGwoaXRlcmF0b3IsIG1hcGZuLCBbc3RlcC52YWx1ZSwgaW5kZXhdLCB0cnVlKSA6IHN0ZXAudmFsdWUpOwoJCQkJCQl9CgkJCQkJfSBlbHNlIHsKCQkJCQkJbGVuZ3RoID0gdG9MZW5ndGgoTy5sZW5ndGgpOwoJCQkJCQlmb3IgKHJlc3VsdCA9IG5ldyBDKGxlbmd0aCk7IGxlbmd0aCA+IGluZGV4OyBpbmRleCsrKSB7CgkJCQkJCQljcmVhdGVQcm9wZXJ0eShyZXN1bHQsIGluZGV4LCBtYXBwaW5nID8gbWFwZm4oT1tpbmRleF0sIGluZGV4KSA6IE9baW5kZXhdKTsKCQkJCQkJfQoJCQkJCX0KCQkJCQlyZXN1bHQubGVuZ3RoID0gaW5kZXg7CgkJCQkJcmV0dXJuIHJlc3VsdDsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAxNjIyOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyICRpbmRleE9mID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2ODg5KShmYWxzZSk7CgkJCXZhciAkbmF0aXZlID0gW10uaW5kZXhPZjsKCQkJdmFyIE5FR0FUSVZFX1pFUk8gPSAhISRuYXRpdmUgJiYgMSAvIFsxXS5pbmRleE9mKDEsIC0wKSA8IDA7CgkJCSRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogKE5FR0FUSVZFX1pFUk8gfHwgIV9fd2VicGFja19yZXF1aXJlX18oMTgwOCkoJG5hdGl2ZSkpLCAnQXJyYXknLCB7CgkJCQkvLyAyMi4xLjMuMTEgLyAxNS40LjQuMTQgQXJyYXkucHJvdG90eXBlLmluZGV4T2Yoc2VhcmNoRWxlbWVudCBbLCBmcm9tSW5kZXhdKQoJCQkJaW5kZXhPZjogZnVuY3Rpb24gaW5kZXhPZihzZWFyY2hFbGVtZW50IC8qICwgZnJvbUluZGV4ID0gMCAqLykgewoJCQkJCXJldHVybiBORUdBVElWRV9aRVJPCgkJCQkJCS8vIGNvbnZlcnQgLTAgdG8gKzAKCQkJCQkJPyAkbmF0aXZlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgMCA6ICRpbmRleE9mKHRoaXMsIHNlYXJjaEVsZW1lbnQsIGFyZ3VtZW50c1sxXSk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNDc4OToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIyLjEuMi4yIC8gMTUuNC4zLjIgQXJyYXkuaXNBcnJheShhcmcpCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdBcnJheScsIHsKCQkJCWlzQXJyYXk6IF9fd2VicGFja19yZXF1aXJlX18oMTUwMikKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA4NzI2OgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgoJCQl2YXIgYWRkVG9VbnNjb3BhYmxlcyA9IF9fd2VicGFja19yZXF1aXJlX18oNDU1Myk7CgkJCXZhciBzdGVwID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5NDk4KTsKCQkJdmFyIEl0ZXJhdG9ycyA9IF9fd2VicGFja19yZXF1aXJlX18oMzQ0NCk7CgkJCXZhciB0b0lPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzMDkpOwoKLy8gMjIuMS4zLjQgQXJyYXkucHJvdG90eXBlLmVudHJpZXMoKQovLyAyMi4xLjMuMTMgQXJyYXkucHJvdG90eXBlLmtleXMoKQovLyAyMi4xLjMuMjkgQXJyYXkucHJvdG90eXBlLnZhbHVlcygpCi8vIDIyLjEuMy4zMCBBcnJheS5wcm90b3R5cGVbQEBpdGVyYXRvcl0oKQoJCQltb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oODkxNSkoQXJyYXksICdBcnJheScsIGZ1bmN0aW9uKGl0ZXJhdGVkLCBraW5kKSB7CgkJCQl0aGlzLl90ID0gdG9JT2JqZWN0KGl0ZXJhdGVkKTsgLy8gdGFyZ2V0CgkJCQl0aGlzLl9pID0gMDsgLy8gbmV4dCBpbmRleAoJCQkJdGhpcy5fayA9IGtpbmQ7IC8vIGtpbmQKCQkJCS8vIDIyLjEuNS4yLjEgJUFycmF5SXRlcmF0b3JQcm90b3R5cGUlLm5leHQoKQoJCQl9LCBmdW5jdGlvbigpIHsKCQkJCXZhciBPID0gdGhpcy5fdDsKCQkJCXZhciBraW5kID0gdGhpcy5fazsKCQkJCXZhciBpbmRleCA9IHRoaXMuX2krKzsKCQkJCWlmICghTyB8fCBpbmRleCA+PSBPLmxlbmd0aCkgewoJCQkJCXRoaXMuX3QgPSB1bmRlZmluZWQ7CgkJCQkJcmV0dXJuIHN0ZXAoMSk7CgkJCQl9CgkJCQlpZiAoa2luZCA9PSAna2V5cycpIHJldHVybiBzdGVwKDAsIGluZGV4KTsKCQkJCWlmIChraW5kID09ICd2YWx1ZXMnKSByZXR1cm4gc3RlcCgwLCBPW2luZGV4XSk7CgkJCQlyZXR1cm4gc3RlcCgwLCBbaW5kZXgsIE9baW5kZXhdXSk7CgkJCX0sICd2YWx1ZXMnKTsKCi8vIGFyZ3VtZW50c0xpc3RbQEBpdGVyYXRvcl0gaXMgJUFycmF5UHJvdG9fdmFsdWVzJSAoOS40LjQuNiwgOS40LjQuNykKCQkJSXRlcmF0b3JzLkFyZ3VtZW50cyA9IEl0ZXJhdG9ycy5BcnJheTsKCQkJYWRkVG9VbnNjb3BhYmxlcygna2V5cycpOwoJCQlhZGRUb1Vuc2NvcGFibGVzKCd2YWx1ZXMnKTsKCQkJYWRkVG9VbnNjb3BhYmxlcygnZW50cmllcycpOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNTQ0MjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyAyMi4xLjMuMTMgQXJyYXkucHJvdG90eXBlLmpvaW4oc2VwYXJhdG9yKQoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciB0b0lPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzMDkpOwoJCQl2YXIgYXJyYXlKb2luID0gW10uam9pbjsKCi8vIGZhbGxiYWNrIGZvciBub3QgYXJyYXktbGlrZSBzdHJpbmdzCgkJCSRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogKF9fd2VicGFja19yZXF1aXJlX18oNTg3NCkgIT0gT2JqZWN0IHx8ICFfX3dlYnBhY2tfcmVxdWlyZV9fKDE4MDgpKGFycmF5Sm9pbikpLCAnQXJyYXknLCB7CgkJCQlqb2luOiBmdW5jdGlvbiBqb2luKHNlcGFyYXRvcikgewoJCQkJCXJldHVybiBhcnJheUpvaW4uY2FsbCh0b0lPYmplY3QodGhpcyksIHNlcGFyYXRvciA9PT0gdW5kZWZpbmVkID8gJywnIDogc2VwYXJhdG9yKTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA1Nzg3OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIHRvSU9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMTMwOSk7CgkJCXZhciB0b0ludGVnZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY2OTkpOwoJCQl2YXIgdG9MZW5ndGggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUyMDEpOwoJCQl2YXIgJG5hdGl2ZSA9IFtdLmxhc3RJbmRleE9mOwoJCQl2YXIgTkVHQVRJVkVfWkVSTyA9ICEhJG5hdGl2ZSAmJiAxIC8gWzFdLmxhc3RJbmRleE9mKDEsIC0wKSA8IDA7CgkJCSRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogKE5FR0FUSVZFX1pFUk8gfHwgIV9fd2VicGFja19yZXF1aXJlX18oMTgwOCkoJG5hdGl2ZSkpLCAnQXJyYXknLCB7CgkJCQkvLyAyMi4xLjMuMTQgLyAxNS40LjQuMTUgQXJyYXkucHJvdG90eXBlLmxhc3RJbmRleE9mKHNlYXJjaEVsZW1lbnQgWywgZnJvbUluZGV4XSkKCQkJCWxhc3RJbmRleE9mOiBmdW5jdGlvbiBsYXN0SW5kZXhPZihzZWFyY2hFbGVtZW50IC8qICwgZnJvbUluZGV4ID0gQFsqLTFdICovKSB7CgkJCQkJLy8gY29udmVydCAtMCB0byArMAoJCQkJCWlmIChORUdBVElWRV9aRVJPKSByZXR1cm4gJG5hdGl2ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IDA7CgkJCQkJdmFyIE8gPSB0b0lPYmplY3QodGhpcyk7CgkJCQkJdmFyIGxlbmd0aCA9IHRvTGVuZ3RoKE8ubGVuZ3RoKTsKCQkJCQl2YXIgaW5kZXggPSBsZW5ndGggLSAxOwoJCQkJCWlmIChhcmd1bWVudHMubGVuZ3RoID4gMSkgaW5kZXggPSBNYXRoLm1pbihpbmRleCwgdG9JbnRlZ2VyKGFyZ3VtZW50c1sxXSkpOwoJCQkJCWlmIChpbmRleCA8IDApIGluZGV4ID0gbGVuZ3RoICsgaW5kZXg7CgkJCQkJZm9yICg7IGluZGV4ID49IDA7IGluZGV4LS0pIGlmIChpbmRleCBpbiBPKSBpZiAoT1tpbmRleF0gPT09IHNlYXJjaEVsZW1lbnQpIHJldHVybiBpbmRleCB8fCAwOwoJCQkJCXJldHVybiAtMTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA2ODQyOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyICRtYXAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk1NjkpKDEpOwoJCQkkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqICFfX3dlYnBhY2tfcmVxdWlyZV9fKDE4MDgpKFtdLm1hcCwgdHJ1ZSksICdBcnJheScsIHsKCQkJCS8vIDIyLjEuMy4xNSAvIDE1LjQuNC4xOSBBcnJheS5wcm90b3R5cGUubWFwKGNhbGxiYWNrZm4gWywgdGhpc0FyZ10pCgkJCQltYXA6IGZ1bmN0aW9uIG1hcChjYWxsYmFja2ZuIC8qICwgdGhpc0FyZyAqLykgewoJCQkJCXJldHVybiAkbWFwKHRoaXMsIGNhbGxiYWNrZm4sIGFyZ3VtZW50c1sxXSk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNDAxNToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciBjcmVhdGVQcm9wZXJ0eSA9IF9fd2VicGFja19yZXF1aXJlX18oMjAxMik7CgovLyBXZWJLaXQgQXJyYXkub2YgaXNuJ3QgZ2VuZXJpYwoJCQkkZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqIF9fd2VicGFja19yZXF1aXJlX18oMTI4KShmdW5jdGlvbigpIHsKCQkJCWZ1bmN0aW9uIEYoKSB7LyogZW1wdHkgKi8KCQkJCX0KCgkJCQlyZXR1cm4gIShBcnJheS5vZi5jYWxsKEYpIGluc3RhbmNlb2YgRik7CgkJCX0pLCAnQXJyYXknLCB7CgkJCQkvLyAyMi4xLjIuMyBBcnJheS5vZiggLi4uaXRlbXMpCgkJCQlvZjogZnVuY3Rpb24gb2YoIC8qIC4uLmFyZ3MgKi8KCQkJCSkgewoJCQkJCXZhciBpbmRleCA9IDA7CgkJCQkJdmFyIGFMZW4gPSBhcmd1bWVudHMubGVuZ3RoOwoJCQkJCXZhciByZXN1bHQgPSBuZXcgKHR5cGVvZiB0aGlzID09ICdmdW5jdGlvbicgPyB0aGlzIDogQXJyYXkpKGFMZW4pOwoJCQkJCXdoaWxlIChhTGVuID4gaW5kZXgpIGNyZWF0ZVByb3BlcnR5KHJlc3VsdCwgaW5kZXgsIGFyZ3VtZW50c1tpbmRleCsrXSk7CgkJCQkJcmVzdWx0Lmxlbmd0aCA9IGFMZW47CgkJCQkJcmV0dXJuIHJlc3VsdDsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA5ODE1OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyICRyZWR1Y2UgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU3MDgpOwoJCQkkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqICFfX3dlYnBhY2tfcmVxdWlyZV9fKDE4MDgpKFtdLnJlZHVjZVJpZ2h0LCB0cnVlKSwgJ0FycmF5JywgewoJCQkJLy8gMjIuMS4zLjE5IC8gMTUuNC40LjIyIEFycmF5LnByb3RvdHlwZS5yZWR1Y2VSaWdodChjYWxsYmFja2ZuIFssIGluaXRpYWxWYWx1ZV0pCgkJCQlyZWR1Y2VSaWdodDogZnVuY3Rpb24gcmVkdWNlUmlnaHQoY2FsbGJhY2tmbiAvKiAsIGluaXRpYWxWYWx1ZSAqLykgewoJCQkJCXJldHVybiAkcmVkdWNlKHRoaXMsIGNhbGxiYWNrZm4sIGFyZ3VtZW50cy5sZW5ndGgsIGFyZ3VtZW50c1sxXSwgdHJ1ZSk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMzc3MDoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciAkcmVkdWNlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1NzA4KTsKCQkJJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiAhX193ZWJwYWNrX3JlcXVpcmVfXygxODA4KShbXS5yZWR1Y2UsIHRydWUpLCAnQXJyYXknLCB7CgkJCQkvLyAyMi4xLjMuMTggLyAxNS40LjQuMjEgQXJyYXkucHJvdG90eXBlLnJlZHVjZShjYWxsYmFja2ZuIFssIGluaXRpYWxWYWx1ZV0pCgkJCQlyZWR1Y2U6IGZ1bmN0aW9uIHJlZHVjZShjYWxsYmFja2ZuIC8qICwgaW5pdGlhbFZhbHVlICovKSB7CgkJCQkJcmV0dXJuICRyZWR1Y2UodGhpcywgY2FsbGJhY2tmbiwgYXJndW1lbnRzLmxlbmd0aCwgYXJndW1lbnRzWzFdLCBmYWxzZSk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMTI2ODoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciBodG1sID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0NzUpOwoJCQl2YXIgY29mID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNDM0KTsKCQkJdmFyIHRvQWJzb2x1dGVJbmRleCA9IF9fd2VicGFja19yZXF1aXJlX18oNzQ0Myk7CgkJCXZhciB0b0xlbmd0aCA9IF9fd2VicGFja19yZXF1aXJlX18oNTIwMSk7CgkJCXZhciBhcnJheVNsaWNlID0gW10uc2xpY2U7CgovLyBmYWxsYmFjayBmb3Igbm90IGFycmF5LWxpa2UgRVMzIHN0cmluZ3MgYW5kIERPTSBvYmplY3RzCgkJCSRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogX193ZWJwYWNrX3JlcXVpcmVfXygxMjgpKGZ1bmN0aW9uKCkgewoJCQkJaWYgKGh0bWwpIGFycmF5U2xpY2UuY2FsbChodG1sKTsKCQkJfSksICdBcnJheScsIHsKCQkJCXNsaWNlOiBmdW5jdGlvbiBzbGljZShiZWdpbiwgZW5kKSB7CgkJCQkJdmFyIGxlbiA9IHRvTGVuZ3RoKHRoaXMubGVuZ3RoKTsKCQkJCQl2YXIga2xhc3MgPSBjb2YodGhpcyk7CgkJCQkJZW5kID0gZW5kID09PSB1bmRlZmluZWQgPyBsZW4gOiBlbmQ7CgkJCQkJaWYgKGtsYXNzID09ICdBcnJheScpIHJldHVybiBhcnJheVNsaWNlLmNhbGwodGhpcywgYmVnaW4sIGVuZCk7CgkJCQkJdmFyIHN0YXJ0ID0gdG9BYnNvbHV0ZUluZGV4KGJlZ2luLCBsZW4pOwoJCQkJCXZhciB1cFRvID0gdG9BYnNvbHV0ZUluZGV4KGVuZCwgbGVuKTsKCQkJCQl2YXIgc2l6ZSA9IHRvTGVuZ3RoKHVwVG8gLSBzdGFydCk7CgkJCQkJdmFyIGNsb25lZCA9IG5ldyBBcnJheShzaXplKTsKCQkJCQl2YXIgaSA9IDA7CgkJCQkJZm9yICg7IGkgPCBzaXplOyBpKyspIGNsb25lZFtpXSA9IGtsYXNzID09ICdTdHJpbmcnID8gdGhpcy5jaGFyQXQoc3RhcnQgKyBpKSA6IHRoaXNbc3RhcnQgKyBpXTsKCQkJCQlyZXR1cm4gY2xvbmVkOwoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDExNzA6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQl2YXIgJHNvbWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk1NjkpKDMpOwoJCQkkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqICFfX3dlYnBhY2tfcmVxdWlyZV9fKDE4MDgpKFtdLnNvbWUsIHRydWUpLCAnQXJyYXknLCB7CgkJCQkvLyAyMi4xLjMuMjMgLyAxNS40LjQuMTcgQXJyYXkucHJvdG90eXBlLnNvbWUoY2FsbGJhY2tmbiBbLCB0aGlzQXJnXSkKCQkJCXNvbWU6IGZ1bmN0aW9uIHNvbWUoY2FsbGJhY2tmbiAvKiAsIHRoaXNBcmcgKi8pIHsKCQkJCQlyZXR1cm4gJHNvbWUodGhpcywgY2FsbGJhY2tmbiwgYXJndW1lbnRzWzFdKTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA2MTIyOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIGFGdW5jdGlvbiA9IF9fd2VicGFja19yZXF1aXJlX18oNDgxMCk7CgkJCXZhciB0b09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNDgyMCk7CgkJCXZhciBmYWlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMTI4KTsKCQkJdmFyICRzb3J0ID0gW10uc29ydDsKCQkJdmFyIHRlc3QgPSBbMSwgMiwgM107CgkJCSRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogKGZhaWxzKGZ1bmN0aW9uKCkgewoJCQkJLy8gSUU4LQoJCQkJdGVzdC5zb3J0KHVuZGVmaW5lZCk7CgkJCX0pIHx8ICFmYWlscyhmdW5jdGlvbigpIHsKCQkJCS8vIFY4IGJ1ZwoJCQkJdGVzdC5zb3J0KG51bGwpOwoJCQkJLy8gT2xkIFdlYktpdAoJCQl9KSB8fCAhX193ZWJwYWNrX3JlcXVpcmVfXygxODA4KSgkc29ydCkpLCAnQXJyYXknLCB7CgkJCQkvLyAyMi4xLjMuMjUgQXJyYXkucHJvdG90eXBlLnNvcnQoY29tcGFyZWZuKQoJCQkJc29ydDogZnVuY3Rpb24gc29ydChjb21wYXJlZm4pIHsKCQkJCQlyZXR1cm4gY29tcGFyZWZuID09PSB1bmRlZmluZWQgPyAkc29ydC5jYWxsKHRvT2JqZWN0KHRoaXMpKSA6ICRzb3J0LmNhbGwodG9PYmplY3QodGhpcyksIGFGdW5jdGlvbihjb21wYXJlZm4pKTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA2MDA0OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygyMzM0KSgnQXJyYXknKTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDU1NDQ6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyAyMC4zLjMuMSAvIDE1LjkuNC40IERhdGUubm93KCkKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQkkZXhwb3J0KCRleHBvcnQuUywgJ0RhdGUnLCB7CgkJCQlub3c6IGZ1bmN0aW9uIG5vdygpIHsKCQkJCQlyZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNTM4NzoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIwLjMuNC4zNiAvIDE1LjkuNS40MyBEYXRlLnByb3RvdHlwZS50b0lTT1N0cmluZygpCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIHRvSVNPU3RyaW5nID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4MTUwKTsKCi8vIFBoYW50b21KUyAvIG9sZCBXZWJLaXQgaGFzIGEgYnJva2VuIGltcGxlbWVudGF0aW9ucwoJCQkkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIChEYXRlLnByb3RvdHlwZS50b0lTT1N0cmluZyAhPT0gdG9JU09TdHJpbmcpLCAnRGF0ZScsIHsKCQkJCXRvSVNPU3RyaW5nOiB0b0lTT1N0cmluZwoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDc1MTE6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQl2YXIgdG9PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ4MjApOwoJCQl2YXIgdG9QcmltaXRpdmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM0NDApOwoJCQkkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIF9fd2VicGFja19yZXF1aXJlX18oMTI4KShmdW5jdGlvbigpIHsKCQkJCXJldHVybiBuZXcgRGF0ZShOYU4pLnRvSlNPTigpICE9PSBudWxsIHx8IERhdGUucHJvdG90eXBlLnRvSlNPTi5jYWxsKHsKCQkJCQl0b0lTT1N0cmluZzogZnVuY3Rpb24gdG9JU09TdHJpbmcoKSB7CgkJCQkJCXJldHVybiAxOwoJCQkJCX0KCQkJCX0pICE9PSAxOwoJCQl9KSwgJ0RhdGUnLCB7CgkJCQkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnMKCQkJCXRvSlNPTjogZnVuY3Rpb24gdG9KU09OKGtleSkgewoJCQkJCXZhciBPID0gdG9PYmplY3QodGhpcyk7CgkJCQkJdmFyIHB2ID0gdG9QcmltaXRpdmUoTyk7CgkJCQkJcmV0dXJuIHR5cGVvZiBwdiA9PSAnbnVtYmVyJyAmJiAhaXNGaW5pdGUocHYpID8gbnVsbCA6IE8udG9JU09TdHJpbmcoKTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA5OTY4OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJdmFyIFRPX1BSSU1JVElWRSA9IF9fd2VicGFja19yZXF1aXJlX18oMjg2NykoJ3RvUHJpbWl0aXZlJyk7CgkJCXZhciBwcm90byA9IERhdGUucHJvdG90eXBlOwoJCQlpZiAoIShUT19QUklNSVRJVkUgaW4gcHJvdG8pKSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkwMzYpKHByb3RvLCBUT19QUklNSVRJVkUsIF9fd2VicGFja19yZXF1aXJlX18oMzQyMSkpOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNTI2OToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciBEYXRlUHJvdG8gPSBEYXRlLnByb3RvdHlwZTsKCQkJdmFyIElOVkFMSURfREFURSA9ICdJbnZhbGlkIERhdGUnOwoJCQl2YXIgVE9fU1RSSU5HID0gJ3RvU3RyaW5nJzsKCQkJdmFyICR0b1N0cmluZyA9IERhdGVQcm90b1tUT19TVFJJTkddOwoJCQl2YXIgZ2V0VGltZSA9IERhdGVQcm90by5nZXRUaW1lOwoJCQlpZiAobmV3IERhdGUoTmFOKSArICcnICE9IElOVkFMSURfREFURSkgewoJCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg4OTE0KShEYXRlUHJvdG8sIFRPX1NUUklORywgZnVuY3Rpb24gdG9TdHJpbmcoKSB7CgkJCQkJdmFyIHZhbHVlID0gZ2V0VGltZS5jYWxsKHRoaXMpOwoJCQkJCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmUKCQkJCQlyZXR1cm4gdmFsdWUgPT09IHZhbHVlID8gJHRvU3RyaW5nLmNhbGwodGhpcykgOiBJTlZBTElEX0RBVEU7CgkJCQl9KTsKCQkJfQoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gODM2MToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDE5LjIuMy4yIC8gMTUuMy40LjUgRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQodGhpc0FyZywgYXJncy4uLikKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQkkZXhwb3J0KCRleHBvcnQuUCwgJ0Z1bmN0aW9uJywgewoJCQkJYmluZDogX193ZWJwYWNrX3JlcXVpcmVfXyg0NzcpCgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gOTUwMzoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgoJCQl2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2ODYpOwoJCQl2YXIgZ2V0UHJvdG90eXBlT2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg5OTYpOwoJCQl2YXIgSEFTX0lOU1RBTkNFID0gX193ZWJwYWNrX3JlcXVpcmVfXygyODY3KSgnaGFzSW5zdGFuY2UnKTsKCQkJdmFyIEZ1bmN0aW9uUHJvdG8gPSBGdW5jdGlvbi5wcm90b3R5cGU7Ci8vIDE5LjIuMy42IEZ1bmN0aW9uLnByb3RvdHlwZVtAQGhhc0luc3RhbmNlXShWKQoJCQlpZiAoIShIQVNfSU5TVEFOQ0UgaW4gRnVuY3Rpb25Qcm90bykpIChfX3dlYnBhY2tfcmVxdWlyZV9fKDE1MTUpLmYpKEZ1bmN0aW9uUHJvdG8sIEhBU19JTlNUQU5DRSwgewoJCQkJdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKE8pIHsKCQkJCQlpZiAodHlwZW9mIHRoaXMgIT0gJ2Z1bmN0aW9uJyB8fCAhaXNPYmplY3QoTykpIHJldHVybiBmYWxzZTsKCQkJCQlpZiAoIWlzT2JqZWN0KHRoaXMucHJvdG90eXBlKSkgcmV0dXJuIE8gaW5zdGFuY2VvZiB0aGlzOwoJCQkJCS8vIGZvciBlbnZpcm9ubWVudCB3L28gbmF0aXZlIGBAQGhhc0luc3RhbmNlYCBsb2dpYyBlbm91Z2ggYGluc3RhbmNlb2ZgLCBidXQgYWRkIHRoaXM6CgkJCQkJd2hpbGUgKE8gPSBnZXRQcm90b3R5cGVPZihPKSkgaWYgKHRoaXMucHJvdG90eXBlID09PSBPKSByZXR1cm4gdHJ1ZTsKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNTgwODoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciBkUCA9IChfX3dlYnBhY2tfcmVxdWlyZV9fKDE1MTUpLmYpOwoJCQl2YXIgRlByb3RvID0gRnVuY3Rpb24ucHJvdG90eXBlOwoJCQl2YXIgbmFtZVJFID0gL15ccypmdW5jdGlvbiAoW14gKF0qKS87CgkJCXZhciBOQU1FID0gJ25hbWUnOwoKLy8gMTkuMi40LjIgbmFtZQoJCQlOQU1FIGluIEZQcm90byB8fCBfX3dlYnBhY2tfcmVxdWlyZV9fKDUxOTQpICYmIGRQKEZQcm90bywgTkFNRSwgewoJCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCQkJZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkJCQkJdHJ5IHsKCQkJCQkJcmV0dXJuICgnJyArIHRoaXMpLm1hdGNoKG5hbWVSRSlbMV07CgkJCQkJfSBjYXRjaCAoZSkgewoJCQkJCQlyZXR1cm4gJyc7CgkJCQkJfQoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDUzMToKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyIHN0cm9uZyA9IF9fd2VicGFja19yZXF1aXJlX18oOTcwOSk7CgkJCXZhciB2YWxpZGF0ZSA9IF9fd2VicGFja19yZXF1aXJlX18oNjgxMyk7CgkJCXZhciBNQVAgPSAnTWFwJzsKCi8vIDIzLjEgTWFwIE9iamVjdHMKCQkJbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk4OTMpKE1BUCwgZnVuY3Rpb24oZ2V0KSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24gTWFwKCkgewoJCQkJCXJldHVybiBnZXQodGhpcywgYXJndW1lbnRzLmxlbmd0aCA+IDAgPyBhcmd1bWVudHNbMF0gOiB1bmRlZmluZWQpOwoJCQkJfTsKCQkJfSwgewoJCQkJLy8gMjMuMS4zLjYgTWFwLnByb3RvdHlwZS5nZXQoa2V5KQoJCQkJZ2V0OiBmdW5jdGlvbiBnZXQoa2V5KSB7CgkJCQkJdmFyIGVudHJ5ID0gc3Ryb25nLmdldEVudHJ5KHZhbGlkYXRlKHRoaXMsIE1BUCksIGtleSk7CgkJCQkJcmV0dXJuIGVudHJ5ICYmIGVudHJ5LnY7CgkJCQl9LAoJCQkJLy8gMjMuMS4zLjkgTWFwLnByb3RvdHlwZS5zZXQoa2V5LCB2YWx1ZSkKCQkJCXNldDogZnVuY3Rpb24gc2V0KGtleSwgdmFsdWUpIHsKCQkJCQlyZXR1cm4gc3Ryb25nLmRlZih2YWxpZGF0ZSh0aGlzLCBNQVApLCBrZXkgPT09IDAgPyAwIDoga2V5LCB2YWx1ZSk7CgkJCQl9CgkJCX0sIHN0cm9uZywgdHJ1ZSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAzNTkyOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMjAuMi4yLjMgTWF0aC5hY29zaCh4KQoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciBsb2cxcCA9IF9fd2VicGFja19yZXF1aXJlX18oNDk3Nik7CgkJCXZhciBzcXJ0ID0gTWF0aC5zcXJ0OwoJCQl2YXIgJGFjb3NoID0gTWF0aC5hY29zaDsKCQkJJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhKCRhY29zaAoJCQkJLy8gVjggYnVnOiBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9MzUwOQoJCQkJJiYgTWF0aC5mbG9vcigkYWNvc2goTnVtYmVyLk1BWF9WQUxVRSkpID09IDcxMAoJCQkJLy8gVG9yIEJyb3dzZXIgYnVnOiBNYXRoLmFjb3NoKEluZmluaXR5KSAtPiBOYU4KCQkJCSYmICRhY29zaChJbmZpbml0eSkgPT0gSW5maW5pdHkpLCAnTWF0aCcsIHsKCQkJCWFjb3NoOiBmdW5jdGlvbiBhY29zaCh4KSB7CgkJCQkJcmV0dXJuICh4ID0gK3gpIDwgMSA/IE5hTiA6IHggPiA5NDkwNjI2NS42MjQyNTE1NiA/IE1hdGgubG9nKHgpICsgTWF0aC5MTjIgOiBsb2cxcCh4IC0gMSArIHNxcnQoeCAtIDEpICogc3FydCh4ICsgMSkpOwoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDU2MDU6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyAyMC4yLjIuNSBNYXRoLmFzaW5oKHgpCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyICRhc2luaCA9IE1hdGguYXNpbmg7CgoJCQlmdW5jdGlvbiBhc2luaCh4KSB7CgkJCQlyZXR1cm4gIWlzRmluaXRlKHggPSAreCkgfHwgeCA9PSAwID8geCA6IHggPCAwID8gLWFzaW5oKC14KSA6IE1hdGgubG9nKHggKyBNYXRoLnNxcnQoeCAqIHggKyAxKSk7CgkJCX0KCi8vIFRvciBCcm93c2VyIGJ1ZzogTWF0aC5hc2luaCgwKSAtPiAtMAoJCQkkZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICEoJGFzaW5oICYmIDEgLyAkYXNpbmgoMCkgPiAwKSwgJ01hdGgnLCB7CgkJCQlhc2luaDogYXNpbmgKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAzNzQ1OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMjAuMi4yLjcgTWF0aC5hdGFuaCh4KQoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciAkYXRhbmggPSBNYXRoLmF0YW5oOwoKLy8gVG9yIEJyb3dzZXIgYnVnOiBNYXRoLmF0YW5oKC0wKSAtPiAwCgkJCSRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogISgkYXRhbmggJiYgMSAvICRhdGFuaCgtMCkgPCAwKSwgJ01hdGgnLCB7CgkJCQlhdGFuaDogZnVuY3Rpb24gYXRhbmgoeCkgewoJCQkJCXJldHVybiAoeCA9ICt4KSA9PSAwID8geCA6IE1hdGgubG9nKCgxICsgeCkgLyAoMSAtIHgpKSAvIDI7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gOTUwNDoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIwLjIuMi45IE1hdGguY2JydCh4KQoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciBzaWduID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2NDg2KTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdNYXRoJywgewoJCQkJY2JydDogZnVuY3Rpb24gY2JydCh4KSB7CgkJCQkJcmV0dXJuIHNpZ24oeCA9ICt4KSAqIE1hdGgucG93KE1hdGguYWJzKHgpLCAxIC8gMyk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNDM4MzoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIwLjIuMi4xMSBNYXRoLmNsejMyKHgpCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdNYXRoJywgewoJCQkJY2x6MzI6IGZ1bmN0aW9uIGNsejMyKHgpIHsKCQkJCQlyZXR1cm4gKHggPj4+PSAwKSA/IDMxIC0gTWF0aC5mbG9vcihNYXRoLmxvZyh4ICsgMC41KSAqIE1hdGguTE9HMkUpIDogMzI7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNjYxMToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIwLjIuMi4xMiBNYXRoLmNvc2goeCkKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQl2YXIgZXhwID0gTWF0aC5leHA7CgkJCSRleHBvcnQoJGV4cG9ydC5TLCAnTWF0aCcsIHsKCQkJCWNvc2g6IGZ1bmN0aW9uIGNvc2goeCkgewoJCQkJCXJldHVybiAoZXhwKHggPSAreCkgKyBleHAoLXgpKSAvIDI7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMTQ4MDoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIwLjIuMi4xNCBNYXRoLmV4cG0xKHgpCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyICRleHBtMSA9IF9fd2VicGFja19yZXF1aXJlX18oODYzNik7CgkJCSRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogKCRleHBtMSAhPSBNYXRoLmV4cG0xKSwgJ01hdGgnLCB7CgkJCQlleHBtMTogJGV4cG0xCgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMzIyODoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIwLjIuMi4xNiBNYXRoLmZyb3VuZCh4KQoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCSRleHBvcnQoJGV4cG9ydC5TLCAnTWF0aCcsIHsKCQkJCWZyb3VuZDogX193ZWJwYWNrX3JlcXVpcmVfXygzMykKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAzNTQyOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMjAuMi4yLjE3IE1hdGguaHlwb3QoW3ZhbHVlMVssIHZhbHVlMlssIOKApiBdXV0pCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIGFicyA9IE1hdGguYWJzOwoJCQkkZXhwb3J0KCRleHBvcnQuUywgJ01hdGgnLCB7CgkJCQloeXBvdDogZnVuY3Rpb24gaHlwb3QodmFsdWUxLCB2YWx1ZTIpIHsKCQkJCQkvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVudXNlZC12YXJzCgkJCQkJdmFyIHN1bSA9IDA7CgkJCQkJdmFyIGkgPSAwOwoJCQkJCXZhciBhTGVuID0gYXJndW1lbnRzLmxlbmd0aDsKCQkJCQl2YXIgbGFyZyA9IDA7CgkJCQkJdmFyIGFyZywgZGl2OwoJCQkJCXdoaWxlIChpIDwgYUxlbikgewoJCQkJCQlhcmcgPSBhYnMoYXJndW1lbnRzW2krK10pOwoJCQkJCQlpZiAobGFyZyA8IGFyZykgewoJCQkJCQkJZGl2ID0gbGFyZyAvIGFyZzsKCQkJCQkJCXN1bSA9IHN1bSAqIGRpdiAqIGRpdiArIDE7CgkJCQkJCQlsYXJnID0gYXJnOwoJCQkJCQl9IGVsc2UgaWYgKGFyZyA+IDApIHsKCQkJCQkJCWRpdiA9IGFyZyAvIGxhcmc7CgkJCQkJCQlzdW0gKz0gZGl2ICogZGl2OwoJCQkJCQl9IGVsc2Ugc3VtICs9IGFyZzsKCQkJCQl9CgkJCQkJcmV0dXJuIGxhcmcgPT09IEluZmluaXR5ID8gSW5maW5pdHkgOiBsYXJnICogTWF0aC5zcXJ0KHN1bSk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNTAyOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMjAuMi4yLjE4IE1hdGguaW11bCh4LCB5KQoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciAkaW11bCA9IE1hdGguaW11bDsKCi8vIHNvbWUgV2ViS2l0IHZlcnNpb25zIGZhaWxzIHdpdGggYmlnIG51bWJlcnMsIHNvbWUgaGFzIHdyb25nIGFyaXR5CgkJCSRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogX193ZWJwYWNrX3JlcXVpcmVfXygxMjgpKGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuICRpbXVsKDB4ZmZmZmZmZmYsIDUpICE9IC01IHx8ICRpbXVsLmxlbmd0aCAhPSAyOwoJCQl9KSwgJ01hdGgnLCB7CgkJCQlpbXVsOiBmdW5jdGlvbiBpbXVsKHgsIHkpIHsKCQkJCQl2YXIgVUlOVDE2ID0gMHhmZmZmOwoJCQkJCXZhciB4biA9ICt4OwoJCQkJCXZhciB5biA9ICt5OwoJCQkJCXZhciB4bCA9IFVJTlQxNiAmIHhuOwoJCQkJCXZhciB5bCA9IFVJTlQxNiAmIHluOwoJCQkJCXJldHVybiAwIHwgeGwgKiB5bCArICgoVUlOVDE2ICYgeG4gPj4+IDE2KSAqIHlsICsgeGwgKiAoVUlOVDE2ICYgeW4gPj4+IDE2KSA8PCAxNiA+Pj4gMCk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNTgzNDoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIwLjIuMi4yMSBNYXRoLmxvZzEwKHgpCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdNYXRoJywgewoJCQkJbG9nMTA6IGZ1bmN0aW9uIGxvZzEwKHgpIHsKCQkJCQlyZXR1cm4gTWF0aC5sb2coeCkgKiBNYXRoLkxPRzEwRTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAzMzIxOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMjAuMi4yLjIwIE1hdGgubG9nMXAoeCkKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQkkZXhwb3J0KCRleHBvcnQuUywgJ01hdGgnLCB7CgkJCQlsb2cxcDogX193ZWJwYWNrX3JlcXVpcmVfXyg0OTc2KQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDU4MjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIwLjIuMi4yMiBNYXRoLmxvZzIoeCkKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQkkZXhwb3J0KCRleHBvcnQuUywgJ01hdGgnLCB7CgkJCQlsb2cyOiBmdW5jdGlvbiBsb2cyKHgpIHsKCQkJCQlyZXR1cm4gTWF0aC5sb2coeCkgLyBNYXRoLkxOMjsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA4NzAyOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMjAuMi4yLjI4IE1hdGguc2lnbih4KQoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCSRleHBvcnQoJGV4cG9ydC5TLCAnTWF0aCcsIHsKCQkJCXNpZ246IF9fd2VicGFja19yZXF1aXJlX18oNjQ4NikKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA3MzoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIwLjIuMi4zMCBNYXRoLnNpbmgoeCkKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQl2YXIgZXhwbTEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg2MzYpOwoJCQl2YXIgZXhwID0gTWF0aC5leHA7CgovLyBWOCBuZWFyIENocm9taXVtIDM4IGhhcyBhIHByb2JsZW0gd2l0aCB2ZXJ5IHNtYWxsIG51bWJlcnMKCQkJJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyOCkoZnVuY3Rpb24oKSB7CgkJCQlyZXR1cm4gIU1hdGguc2luaCgtMmUtMTcpICE9IC0yZS0xNzsKCQkJfSksICdNYXRoJywgewoJCQkJc2luaDogZnVuY3Rpb24gc2luaCh4KSB7CgkJCQkJcmV0dXJuIE1hdGguYWJzKHggPSAreCkgPCAxID8gKGV4cG0xKHgpIC0gZXhwbTEoLXgpKSAvIDIgOiAoZXhwKHggLSAxKSAtIGV4cCgteCAtIDEpKSAqIChNYXRoLkUgLyAyKTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA1MjIwOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMjAuMi4yLjMzIE1hdGgudGFuaCh4KQoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciBleHBtMSA9IF9fd2VicGFja19yZXF1aXJlX18oODYzNik7CgkJCXZhciBleHAgPSBNYXRoLmV4cDsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdNYXRoJywgewoJCQkJdGFuaDogZnVuY3Rpb24gdGFuaCh4KSB7CgkJCQkJdmFyIGEgPSBleHBtMSh4ID0gK3gpOwoJCQkJCXZhciBiID0gZXhwbTEoLXgpOwoJCQkJCXJldHVybiBhID09IEluZmluaXR5ID8gMSA6IGIgPT0gSW5maW5pdHkgPyAtMSA6IChhIC0gYikgLyAoZXhwKHgpICsgZXhwKC14KSk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNzc2NToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIwLjIuMi4zNCBNYXRoLnRydW5jKHgpCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdNYXRoJywgewoJCQkJdHJ1bmM6IGZ1bmN0aW9uIHRydW5jKGl0KSB7CgkJCQkJcmV0dXJuIChpdCA+IDAgPyBNYXRoLmZsb29yIDogTWF0aC5jZWlsKShpdCk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNzQyNToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgoJCQl2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5NzY5KTsKCQkJdmFyIGhhcyA9IF9fd2VicGFja19yZXF1aXJlX18oNDk5Nyk7CgkJCXZhciBjb2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI0MzQpOwoJCQl2YXIgaW5oZXJpdElmUmVxdWlyZWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxMTEpOwoJCQl2YXIgdG9QcmltaXRpdmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM0NDApOwoJCQl2YXIgZmFpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyOCk7CgkJCXZhciBnT1BOID0gKF9fd2VicGFja19yZXF1aXJlX18oODQ4MikuZik7CgkJCXZhciBnT1BEID0gKF9fd2VicGFja19yZXF1aXJlX18oODA5NikuZik7CgkJCXZhciBkUCA9IChfX3dlYnBhY2tfcmVxdWlyZV9fKDE1MTUpLmYpOwoJCQl2YXIgJHRyaW0gPSAoX193ZWJwYWNrX3JlcXVpcmVfXyg1MzU2KS50cmltKTsKCQkJdmFyIE5VTUJFUiA9ICdOdW1iZXInOwoJCQl2YXIgJE51bWJlciA9IGdsb2JhbFtOVU1CRVJdOwoJCQl2YXIgQmFzZSA9ICROdW1iZXI7CgkJCXZhciBwcm90byA9ICROdW1iZXIucHJvdG90eXBlOwovLyBPcGVyYSB+MTIgaGFzIGJyb2tlbiBPYmplY3QjdG9TdHJpbmcKCQkJdmFyIEJST0tFTl9DT0YgPSBjb2YoX193ZWJwYWNrX3JlcXVpcmVfXyg1MTQyKShwcm90bykpID09IE5VTUJFUjsKCQkJdmFyIFRSSU0gPSAoJ3RyaW0nIGluIFN0cmluZy5wcm90b3R5cGUpOwoKLy8gNy4xLjMgVG9OdW1iZXIoYXJndW1lbnQpCgkJCXZhciB0b051bWJlciA9IGZ1bmN0aW9uIHRvTnVtYmVyKGFyZ3VtZW50KSB7CgkJCQl2YXIgaXQgPSB0b1ByaW1pdGl2ZShhcmd1bWVudCwgZmFsc2UpOwoJCQkJaWYgKHR5cGVvZiBpdCA9PSAnc3RyaW5nJyAmJiBpdC5sZW5ndGggPiAyKSB7CgkJCQkJaXQgPSBUUklNID8gaXQudHJpbSgpIDogJHRyaW0oaXQsIDMpOwoJCQkJCXZhciBmaXJzdCA9IGl0LmNoYXJDb2RlQXQoMCk7CgkJCQkJdmFyIHRoaXJkLCByYWRpeCwgbWF4Q29kZTsKCQkJCQlpZiAoZmlyc3QgPT09IDQzIHx8IGZpcnN0ID09PSA0NSkgewoJCQkJCQl0aGlyZCA9IGl0LmNoYXJDb2RlQXQoMik7CgkJCQkJCWlmICh0aGlyZCA9PT0gODggfHwgdGhpcmQgPT09IDEyMCkgcmV0dXJuIE5hTjsgLy8gTnVtYmVyKCcrMHgxJykgc2hvdWxkIGJlIE5hTiwgb2xkIFY4IGZpeAoJCQkJCX0gZWxzZSBpZiAoZmlyc3QgPT09IDQ4KSB7CgkJCQkJCXN3aXRjaCAoaXQuY2hhckNvZGVBdCgxKSkgewoJCQkJCQkJY2FzZSA2NjoKCQkJCQkJCWNhc2UgOTg6CgkJCQkJCQkJcmFkaXggPSAyOwoJCQkJCQkJCW1heENvZGUgPSA0OTsKCQkJCQkJCQlicmVhazsKCQkJCQkJCS8vIGZhc3QgZXF1YWwgL14wYlswMV0rJC9pCgkJCQkJCQljYXNlIDc5OgoJCQkJCQkJY2FzZSAxMTE6CgkJCQkJCQkJcmFkaXggPSA4OwoJCQkJCQkJCW1heENvZGUgPSA1NTsKCQkJCQkJCQlicmVhazsKCQkJCQkJCS8vIGZhc3QgZXF1YWwgL14wb1swLTddKyQvaQoJCQkJCQkJZGVmYXVsdDoKCQkJCQkJCQlyZXR1cm4gK2l0OwoJCQkJCQl9CgkJCQkJCWZvciAodmFyIGRpZ2l0cyA9IGl0LnNsaWNlKDIpLCBpID0gMCwgbCA9IGRpZ2l0cy5sZW5ndGgsIGNvZGU7IGkgPCBsOyBpKyspIHsKCQkJCQkJCWNvZGUgPSBkaWdpdHMuY2hhckNvZGVBdChpKTsKCQkJCQkJCS8vIHBhcnNlSW50IHBhcnNlcyBhIHN0cmluZyB0byBhIGZpcnN0IHVuYXZhaWxhYmxlIHN5bWJvbAoJCQkJCQkJLy8gYnV0IFRvTnVtYmVyIHNob3VsZCByZXR1cm4gTmFOIGlmIGEgc3RyaW5nIGNvbnRhaW5zIHVuYXZhaWxhYmxlIHN5bWJvbHMKCQkJCQkJCWlmIChjb2RlIDwgNDggfHwgY29kZSA+IG1heENvZGUpIHJldHVybiBOYU47CgkJCQkJCX0KCQkJCQkJcmV0dXJuIHBhcnNlSW50KGRpZ2l0cywgcmFkaXgpOwoJCQkJCX0KCQkJCX0KCQkJCXJldHVybiAraXQ7CgkJCX07CgkJCWlmICghJE51bWJlcignIDBvMScpIHx8ICEkTnVtYmVyKCcwYjEnKSB8fCAkTnVtYmVyKCcrMHgxJykpIHsKCQkJCSROdW1iZXIgPSBmdW5jdGlvbiBOdW1iZXIodmFsdWUpIHsKCQkJCQl2YXIgaXQgPSBhcmd1bWVudHMubGVuZ3RoIDwgMSA/IDAgOiB2YWx1ZTsKCQkJCQl2YXIgdGhhdCA9IHRoaXM7CgkJCQkJcmV0dXJuIHRoYXQgaW5zdGFuY2VvZiAkTnVtYmVyCgkJCQkJLy8gY2hlY2sgb24gMS4uY29uc3RydWN0b3IoZm9vKSBjYXNlCgkJCQkJJiYgKEJST0tFTl9DT0YgPyBmYWlscyhmdW5jdGlvbigpIHsKCQkJCQkJcHJvdG8udmFsdWVPZi5jYWxsKHRoYXQpOwoJCQkJCX0pIDogY29mKHRoYXQpICE9IE5VTUJFUikgPyBpbmhlcml0SWZSZXF1aXJlZChuZXcgQmFzZSh0b051bWJlcihpdCkpLCB0aGF0LCAkTnVtYmVyKSA6IHRvTnVtYmVyKGl0KTsKCQkJCX07CgkJCQlmb3IgKHZhciBrZXlzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MTk0KSA/IGdPUE4oQmFzZSkgOiAoCgkJCQkJLy8gRVMzOgoJCQkJCSdNQVhfVkFMVUUsTUlOX1ZBTFVFLE5hTixORUdBVElWRV9JTkZJTklUWSxQT1NJVElWRV9JTkZJTklUWSwnICsKCQkJCQkvLyBFUzYgKGluIGNhc2UsIGlmIG1vZHVsZXMgd2l0aCBFUzYgTnVtYmVyIHN0YXRpY3MgcmVxdWlyZWQgYmVmb3JlKToKCQkJCQknRVBTSUxPTixpc0Zpbml0ZSxpc0ludGVnZXIsaXNOYU4saXNTYWZlSW50ZWdlcixNQVhfU0FGRV9JTlRFR0VSLCcgKyAnTUlOX1NBRkVfSU5URUdFUixwYXJzZUZsb2F0LHBhcnNlSW50LGlzSW50ZWdlcicpLnNwbGl0KCcsJyksIGogPSAwLCBrZXk7IGtleXMubGVuZ3RoID4gajsgaisrKSB7CgkJCQkJaWYgKGhhcyhCYXNlLCBrZXkgPSBrZXlzW2pdKSAmJiAhaGFzKCROdW1iZXIsIGtleSkpIHsKCQkJCQkJZFAoJE51bWJlciwga2V5LCBnT1BEKEJhc2UsIGtleSkpOwoJCQkJCX0KCQkJCX0KCQkJCSROdW1iZXIucHJvdG90eXBlID0gcHJvdG87CgkJCQlwcm90by5jb25zdHJ1Y3RvciA9ICROdW1iZXI7CgkJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDg5MTQpKGdsb2JhbCwgTlVNQkVSLCAkTnVtYmVyKTsKCQkJfQoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMjQ5OToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIwLjEuMi4xIE51bWJlci5FUFNJTE9OCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdOdW1iZXInLCB7CgkJCQlFUFNJTE9OOiBNYXRoLnBvdygyLCAtNTIpCgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMjc1MzoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIwLjEuMi4yIE51bWJlci5pc0Zpbml0ZShudW1iZXIpCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIF9pc0Zpbml0ZSA9IChfX3dlYnBhY2tfcmVxdWlyZV9fKDk3NjkpLmlzRmluaXRlKTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdOdW1iZXInLCB7CgkJCQlpc0Zpbml0ZTogZnVuY3Rpb24gaXNGaW5pdGUoaXQpIHsKCQkJCQlyZXR1cm4gdHlwZW9mIGl0ID09ICdudW1iZXInICYmIF9pc0Zpbml0ZShpdCk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMTQwMjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIwLjEuMi4zIE51bWJlci5pc0ludGVnZXIobnVtYmVyKQoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCSRleHBvcnQoJGV4cG9ydC5TLCAnTnVtYmVyJywgewoJCQkJaXNJbnRlZ2VyOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDk3NDApCgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNDIwMzoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIwLjEuMi40IE51bWJlci5pc05hTihudW1iZXIpCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdOdW1iZXInLCB7CgkJCQlpc05hTjogZnVuY3Rpb24gaXNOYU4obnVtYmVyKSB7CgkJCQkJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXNlbGYtY29tcGFyZQoJCQkJCXJldHVybiBudW1iZXIgIT0gbnVtYmVyOwoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDkwNzoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIwLjEuMi41IE51bWJlci5pc1NhZmVJbnRlZ2VyKG51bWJlcikKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQl2YXIgaXNJbnRlZ2VyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5NzQwKTsKCQkJdmFyIGFicyA9IE1hdGguYWJzOwoJCQkkZXhwb3J0KCRleHBvcnQuUywgJ051bWJlcicsIHsKCQkJCWlzU2FmZUludGVnZXI6IGZ1bmN0aW9uIGlzU2FmZUludGVnZXIobnVtYmVyKSB7CgkJCQkJcmV0dXJuIGlzSW50ZWdlcihudW1iZXIpICYmIGFicyhudW1iZXIpIDw9IDB4MWZmZmZmZmZmZmZmZmY7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNTYxNzoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIwLjEuMi42IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdOdW1iZXInLCB7CgkJCQlNQVhfU0FGRV9JTlRFR0VSOiAweDFmZmZmZmZmZmZmZmZmCgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNzA1OToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDIwLjEuMi4xMCBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUgoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCSRleHBvcnQoJGV4cG9ydC5TLCAnTnVtYmVyJywgewoJCQkJTUlOX1NBRkVfSU5URUdFUjogLTB4MWZmZmZmZmZmZmZmZmYKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAxMDM0OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQl2YXIgJHBhcnNlRmxvYXQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg3NTApOwovLyAyMC4xLjIuMTIgTnVtYmVyLnBhcnNlRmxvYXQoc3RyaW5nKQoJCQkkZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqIChOdW1iZXIucGFyc2VGbG9hdCAhPSAkcGFyc2VGbG9hdCksICdOdW1iZXInLCB7CgkJCQlwYXJzZUZsb2F0OiAkcGFyc2VGbG9hdAoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDQ5NTk6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciAkcGFyc2VJbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk5NTgpOwovLyAyMC4xLjIuMTMgTnVtYmVyLnBhcnNlSW50KHN0cmluZywgcmFkaXgpCgkJCSRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogKE51bWJlci5wYXJzZUludCAhPSAkcGFyc2VJbnQpLCAnTnVtYmVyJywgewoJCQkJcGFyc2VJbnQ6ICRwYXJzZUludAoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDQyNzU6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQl2YXIgdG9JbnRlZ2VyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2Njk5KTsKCQkJdmFyIGFOdW1iZXJWYWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18oMjE4Nyk7CgkJCXZhciByZXBlYXQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYyNzQpOwoJCQl2YXIgJHRvRml4ZWQgPSAxLjAudG9GaXhlZDsKCQkJdmFyIGZsb29yID0gTWF0aC5mbG9vcjsKCQkJdmFyIGRhdGEgPSBbMCwgMCwgMCwgMCwgMCwgMF07CgkJCXZhciBFUlJPUiA9ICdOdW1iZXIudG9GaXhlZDogaW5jb3JyZWN0IGludm9jYXRpb24hJzsKCQkJdmFyIFpFUk8gPSAnMCc7CgkJCXZhciBtdWx0aXBseSA9IGZ1bmN0aW9uIG11bHRpcGx5KG4sIGMpIHsKCQkJCXZhciBpID0gLTE7CgkJCQl2YXIgYzIgPSBjOwoJCQkJd2hpbGUgKCsraSA8IDYpIHsKCQkJCQljMiArPSBuICogZGF0YVtpXTsKCQkJCQlkYXRhW2ldID0gYzIgJSAxZTc7CgkJCQkJYzIgPSBmbG9vcihjMiAvIDFlNyk7CgkJCQl9CgkJCX07CgkJCXZhciBkaXZpZGUgPSBmdW5jdGlvbiBkaXZpZGUobikgewoJCQkJdmFyIGkgPSA2OwoJCQkJdmFyIGMgPSAwOwoJCQkJd2hpbGUgKC0taSA+PSAwKSB7CgkJCQkJYyArPSBkYXRhW2ldOwoJCQkJCWRhdGFbaV0gPSBmbG9vcihjIC8gbik7CgkJCQkJYyA9IGMgJSBuICogMWU3OwoJCQkJfQoJCQl9OwoJCQl2YXIgbnVtVG9TdHJpbmcgPSBmdW5jdGlvbiBudW1Ub1N0cmluZygpIHsKCQkJCXZhciBpID0gNjsKCQkJCXZhciBzID0gJyc7CgkJCQl3aGlsZSAoLS1pID49IDApIHsKCQkJCQlpZiAocyAhPT0gJycgfHwgaSA9PT0gMCB8fCBkYXRhW2ldICE9PSAwKSB7CgkJCQkJCXZhciB0ID0gU3RyaW5nKGRhdGFbaV0pOwoJCQkJCQlzID0gcyA9PT0gJycgPyB0IDogcyArIHJlcGVhdC5jYWxsKFpFUk8sIDcgLSB0Lmxlbmd0aCkgKyB0OwoJCQkJCX0KCQkJCX0KCQkJCXJldHVybiBzOwoJCQl9OwoJCQl2YXIgcG93ID0gZnVuY3Rpb24gcG93KHgsIG4sIGFjYykgewoJCQkJcmV0dXJuIG4gPT09IDAgPyBhY2MgOiBuICUgMiA9PT0gMSA/IHBvdyh4LCBuIC0gMSwgYWNjICogeCkgOiBwb3coeCAqIHgsIG4gLyAyLCBhY2MpOwoJCQl9OwoJCQl2YXIgbG9nID0gZnVuY3Rpb24gbG9nKHgpIHsKCQkJCXZhciBuID0gMDsKCQkJCXZhciB4MiA9IHg7CgkJCQl3aGlsZSAoeDIgPj0gNDA5NikgewoJCQkJCW4gKz0gMTI7CgkJCQkJeDIgLz0gNDA5NjsKCQkJCX0KCQkJCXdoaWxlICh4MiA+PSAyKSB7CgkJCQkJbiArPSAxOwoJCQkJCXgyIC89IDI7CgkJCQl9CgkJCQlyZXR1cm4gbjsKCQkJfTsKCQkJJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiAoISEkdG9GaXhlZCAmJiAoMC4wMDAwOC50b0ZpeGVkKDMpICE9PSAnMC4wMDAnIHx8IDAuOS50b0ZpeGVkKDApICE9PSAnMScgfHwgMS4yNTUudG9GaXhlZCgyKSAhPT0gJzEuMjUnIHx8IDEwMDAwMDAwMDAwMDAwMDAxMjguMC50b0ZpeGVkKDApICE9PSAnMTAwMDAwMDAwMDAwMDAwMDEyOCcpIHx8ICFfX3dlYnBhY2tfcmVxdWlyZV9fKDEyOCkoZnVuY3Rpb24oKSB7CgkJCQkvLyBWOCB+IEFuZHJvaWQgNC4zLQoJCQkJJHRvRml4ZWQuY2FsbCh7fSk7CgkJCX0pKSwgJ051bWJlcicsIHsKCQkJCXRvRml4ZWQ6IGZ1bmN0aW9uIHRvRml4ZWQoZnJhY3Rpb25EaWdpdHMpIHsKCQkJCQl2YXIgeCA9IGFOdW1iZXJWYWx1ZSh0aGlzLCBFUlJPUik7CgkJCQkJdmFyIGYgPSB0b0ludGVnZXIoZnJhY3Rpb25EaWdpdHMpOwoJCQkJCXZhciBzID0gJyc7CgkJCQkJdmFyIG0gPSBaRVJPOwoJCQkJCXZhciBlLCB6LCBqLCBrOwoJCQkJCWlmIChmIDwgMCB8fCBmID4gMjApIHRocm93IFJhbmdlRXJyb3IoRVJST1IpOwoJCQkJCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zZWxmLWNvbXBhcmUKCQkJCQlpZiAoeCAhPSB4KSByZXR1cm4gJ05hTic7CgkJCQkJaWYgKHggPD0gLTFlMjEgfHwgeCA+PSAxZTIxKSByZXR1cm4gU3RyaW5nKHgpOwoJCQkJCWlmICh4IDwgMCkgewoJCQkJCQlzID0gJy0nOwoJCQkJCQl4ID0gLXg7CgkJCQkJfQoJCQkJCWlmICh4ID4gMWUtMjEpIHsKCQkJCQkJZSA9IGxvZyh4ICogcG93KDIsIDY5LCAxKSkgLSA2OTsKCQkJCQkJeiA9IGUgPCAwID8geCAqIHBvdygyLCAtZSwgMSkgOiB4IC8gcG93KDIsIGUsIDEpOwoJCQkJCQl6ICo9IDB4MTAwMDAwMDAwMDAwMDA7CgkJCQkJCWUgPSA1MiAtIGU7CgkJCQkJCWlmIChlID4gMCkgewoJCQkJCQkJbXVsdGlwbHkoMCwgeik7CgkJCQkJCQlqID0gZjsKCQkJCQkJCXdoaWxlIChqID49IDcpIHsKCQkJCQkJCQltdWx0aXBseSgxZTcsIDApOwoJCQkJCQkJCWogLT0gNzsKCQkJCQkJCX0KCQkJCQkJCW11bHRpcGx5KHBvdygxMCwgaiwgMSksIDApOwoJCQkJCQkJaiA9IGUgLSAxOwoJCQkJCQkJd2hpbGUgKGogPj0gMjMpIHsKCQkJCQkJCQlkaXZpZGUoMSA8PCAyMyk7CgkJCQkJCQkJaiAtPSAyMzsKCQkJCQkJCX0KCQkJCQkJCWRpdmlkZSgxIDw8IGopOwoJCQkJCQkJbXVsdGlwbHkoMSwgMSk7CgkJCQkJCQlkaXZpZGUoMik7CgkJCQkJCQltID0gbnVtVG9TdHJpbmcoKTsKCQkJCQkJfSBlbHNlIHsKCQkJCQkJCW11bHRpcGx5KDAsIHopOwoJCQkJCQkJbXVsdGlwbHkoMSA8PCAtZSwgMCk7CgkJCQkJCQltID0gbnVtVG9TdHJpbmcoKSArIHJlcGVhdC5jYWxsKFpFUk8sIGYpOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWlmIChmID4gMCkgewoJCQkJCQlrID0gbS5sZW5ndGg7CgkJCQkJCW0gPSBzICsgKGsgPD0gZiA/ICcwLicgKyByZXBlYXQuY2FsbChaRVJPLCBmIC0gaykgKyBtIDogbS5zbGljZSgwLCBrIC0gZikgKyAnLicgKyBtLnNsaWNlKGsgLSBmKSk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJbSA9IHMgKyBtOwoJCQkJCX0KCQkJCQlyZXR1cm4gbTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAyNzYyOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyICRmYWlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMTI4KTsKCQkJdmFyIGFOdW1iZXJWYWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18oMjE4Nyk7CgkJCXZhciAkdG9QcmVjaXNpb24gPSAxLjAudG9QcmVjaXNpb247CgkJCSRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogKCRmYWlscyhmdW5jdGlvbigpIHsKCQkJCS8vIElFNy0KCQkJCXJldHVybiAkdG9QcmVjaXNpb24uY2FsbCgxLCB1bmRlZmluZWQpICE9PSAnMSc7CgkJCX0pIHx8ICEkZmFpbHMoZnVuY3Rpb24oKSB7CgkJCQkvLyBWOCB+IEFuZHJvaWQgNC4zLQoJCQkJJHRvUHJlY2lzaW9uLmNhbGwoe30pOwoJCQl9KSksICdOdW1iZXInLCB7CgkJCQl0b1ByZWNpc2lvbjogZnVuY3Rpb24gdG9QcmVjaXNpb24ocHJlY2lzaW9uKSB7CgkJCQkJdmFyIHRoYXQgPSBhTnVtYmVyVmFsdWUodGhpcywgJ051bWJlciN0b1ByZWNpc2lvbjogaW5jb3JyZWN0IGludm9jYXRpb24hJyk7CgkJCQkJcmV0dXJuIHByZWNpc2lvbiA9PT0gdW5kZWZpbmVkID8gJHRvUHJlY2lzaW9uLmNhbGwodGhhdCkgOiAkdG9QcmVjaXNpb24uY2FsbCh0aGF0LCBwcmVjaXNpb24pOwoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDI4ODU6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyAxOS4xLjMuMSBPYmplY3QuYXNzaWduKHRhcmdldCwgc291cmNlKQoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCSRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GLCAnT2JqZWN0JywgewoJCQkJYXNzaWduOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDc2NjYpCgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gODQwNjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKLy8gMTkuMS4yLjIgLyAxNS4yLjMuNSBPYmplY3QuY3JlYXRlKE8gWywgUHJvcGVydGllc10pCgkJCSRleHBvcnQoJGV4cG9ydC5TLCAnT2JqZWN0JywgewoJCQkJY3JlYXRlOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDUxNDIpCgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMTQwNToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKLy8gMTkuMS4yLjMgLyAxNS4yLjMuNyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhPLCBQcm9wZXJ0aWVzKQoJCQkkZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICFfX3dlYnBhY2tfcmVxdWlyZV9fKDUxOTQpLCAnT2JqZWN0JywgewoJCQkJZGVmaW5lUHJvcGVydGllczogX193ZWJwYWNrX3JlcXVpcmVfXyg2MzA5KQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDE2Njc6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7Ci8vIDE5LjEuMi40IC8gMTUuMi4zLjYgT2JqZWN0LmRlZmluZVByb3BlcnR5KE8sIFAsIEF0dHJpYnV0ZXMpCgkJCSRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogIV9fd2VicGFja19yZXF1aXJlX18oNTE5NCksICdPYmplY3QnLCB7CgkJCQlkZWZpbmVQcm9wZXJ0eTogKF9fd2VicGFja19yZXF1aXJlX18oMTUxNSkuZikKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAzMTMyOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMTkuMS4yLjUgT2JqZWN0LmZyZWV6ZShPKQoJCQl2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2ODYpOwoJCQl2YXIgbWV0YSA9IChfX3dlYnBhY2tfcmVxdWlyZV9fKDIzNjkpLm9uRnJlZXplKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg2NzYzKSgnZnJlZXplJywgZnVuY3Rpb24oJGZyZWV6ZSkgewoJCQkJcmV0dXJuIGZ1bmN0aW9uIGZyZWV6ZShpdCkgewoJCQkJCXJldHVybiAkZnJlZXplICYmIGlzT2JqZWN0KGl0KSA/ICRmcmVlemUobWV0YShpdCkpIDogaXQ7CgkJCQl9OwoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDI3NDA6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyAxOS4xLjIuNiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE8sIFApCgkJCXZhciB0b0lPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzMDkpOwoJCQl2YXIgJGdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IChfX3dlYnBhY2tfcmVxdWlyZV9fKDgwOTYpLmYpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDY3NjMpKCdnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3InLCBmdW5jdGlvbigpIHsKCQkJCXJldHVybiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoaXQsIGtleSkgewoJCQkJCXJldHVybiAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRvSU9iamVjdChpdCksIGtleSk7CgkJCQl9OwoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDc4ODI6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyAxOS4xLjIuNyBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhPKQoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDY3NjMpKCdnZXRPd25Qcm9wZXJ0eU5hbWVzJywgZnVuY3Rpb24oKSB7CgkJCQlyZXR1cm4gKF9fd2VicGFja19yZXF1aXJlX18oNzY0MykuZik7CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gOTg3OToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDE5LjEuMi45IE9iamVjdC5nZXRQcm90b3R5cGVPZihPKQoJCQl2YXIgdG9PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ4MjApOwoJCQl2YXIgJGdldFByb3RvdHlwZU9mID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4OTk2KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg2NzYzKSgnZ2V0UHJvdG90eXBlT2YnLCBmdW5jdGlvbigpIHsKCQkJCXJldHVybiBmdW5jdGlvbiBnZXRQcm90b3R5cGVPZihpdCkgewoJCQkJCXJldHVybiAkZ2V0UHJvdG90eXBlT2YodG9PYmplY3QoaXQpKTsKCQkJCX07CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNTUwNDoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDE5LjEuMi4xMSBPYmplY3QuaXNFeHRlbnNpYmxlKE8pCgkJCXZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNDY4Nik7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNjc2MykoJ2lzRXh0ZW5zaWJsZScsIGZ1bmN0aW9uKCRpc0V4dGVuc2libGUpIHsKCQkJCXJldHVybiBmdW5jdGlvbiBpc0V4dGVuc2libGUoaXQpIHsKCQkJCQlyZXR1cm4gaXNPYmplY3QoaXQpID8gJGlzRXh0ZW5zaWJsZSA/ICRpc0V4dGVuc2libGUoaXQpIDogdHJ1ZSA6IGZhbHNlOwoJCQkJfTsKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAzNDIyOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMTkuMS4yLjEyIE9iamVjdC5pc0Zyb3plbihPKQoJCQl2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2ODYpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDY3NjMpKCdpc0Zyb3plbicsIGZ1bmN0aW9uKCRpc0Zyb3plbikgewoJCQkJcmV0dXJuIGZ1bmN0aW9uIGlzRnJvemVuKGl0KSB7CgkJCQkJcmV0dXJuIGlzT2JqZWN0KGl0KSA/ICRpc0Zyb3plbiA/ICRpc0Zyb3plbihpdCkgOiBmYWxzZSA6IHRydWU7CgkJCQl9OwoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDU3NDE6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyAxOS4xLjIuMTMgT2JqZWN0LmlzU2VhbGVkKE8pCgkJCXZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNDY4Nik7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNjc2MykoJ2lzU2VhbGVkJywgZnVuY3Rpb24oJGlzU2VhbGVkKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24gaXNTZWFsZWQoaXQpIHsKCQkJCQlyZXR1cm4gaXNPYmplY3QoaXQpID8gJGlzU2VhbGVkID8gJGlzU2VhbGVkKGl0KSA6IGZhbHNlIDogdHJ1ZTsKCQkJCX07CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNTgwMzoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDE5LjEuMy4xMCBPYmplY3QuaXModmFsdWUxLCB2YWx1ZTIpCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdPYmplY3QnLCB7CgkJCQlpczogX193ZWJwYWNrX3JlcXVpcmVfXyg0MzkyKQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDgyMToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDE5LjEuMi4xNCBPYmplY3Qua2V5cyhPKQoJCQl2YXIgdG9PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ4MjApOwoJCQl2YXIgJGtleXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY0MzYpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDY3NjMpKCdrZXlzJywgZnVuY3Rpb24oKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24ga2V5cyhpdCkgewoJCQkJCXJldHVybiAka2V5cyh0b09iamVjdChpdCkpOwoJCQkJfTsKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA1NTYyOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMTkuMS4yLjE1IE9iamVjdC5wcmV2ZW50RXh0ZW5zaW9ucyhPKQoJCQl2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2ODYpOwoJCQl2YXIgbWV0YSA9IChfX3dlYnBhY2tfcmVxdWlyZV9fKDIzNjkpLm9uRnJlZXplKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg2NzYzKSgncHJldmVudEV4dGVuc2lvbnMnLCBmdW5jdGlvbigkcHJldmVudEV4dGVuc2lvbnMpIHsKCQkJCXJldHVybiBmdW5jdGlvbiBwcmV2ZW50RXh0ZW5zaW9ucyhpdCkgewoJCQkJCXJldHVybiAkcHJldmVudEV4dGVuc2lvbnMgJiYgaXNPYmplY3QoaXQpID8gJHByZXZlbnRFeHRlbnNpb25zKG1ldGEoaXQpKSA6IGl0OwoJCQkJfTsKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAzOTQ1OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMTkuMS4yLjE3IE9iamVjdC5zZWFsKE8pCgkJCXZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNDY4Nik7CgkJCXZhciBtZXRhID0gKF9fd2VicGFja19yZXF1aXJlX18oMjM2OSkub25GcmVlemUpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDY3NjMpKCdzZWFsJywgZnVuY3Rpb24oJHNlYWwpIHsKCQkJCXJldHVybiBmdW5jdGlvbiBzZWFsKGl0KSB7CgkJCQkJcmV0dXJuICRzZWFsICYmIGlzT2JqZWN0KGl0KSA/ICRzZWFsKG1ldGEoaXQpKSA6IGl0OwoJCQkJfTsKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA2OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMTkuMS4zLjE5IE9iamVjdC5zZXRQcm90b3R5cGVPZihPLCBwcm90bykKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQkkZXhwb3J0KCRleHBvcnQuUywgJ09iamVjdCcsIHsKCQkJCXNldFByb3RvdHlwZU9mOiAoX193ZWJwYWNrX3JlcXVpcmVfXygzNDU0KS5zZXQpCgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMzI4OToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyAxOS4xLjMuNiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nKCkKCQkJdmFyIGNsYXNzb2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkzNCk7CgkJCXZhciB0ZXN0ID0ge307CgkJCXRlc3RbX193ZWJwYWNrX3JlcXVpcmVfXygyODY3KSgndG9TdHJpbmdUYWcnKV0gPSAneic7CgkJCWlmICh0ZXN0ICsgJycgIT0gJ1tvYmplY3Qgel0nKSB7CgkJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDg5MTQpKE9iamVjdC5wcm90b3R5cGUsICd0b1N0cmluZycsIGZ1bmN0aW9uIHRvU3RyaW5nKCkgewoJCQkJCXJldHVybiAnW29iamVjdCAnICsgY2xhc3NvZih0aGlzKSArICddJzsKCQkJCX0sIHRydWUpOwoJCQl9CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAxNjQwOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQl2YXIgJHBhcnNlRmxvYXQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg3NTApOwovLyAxOC4yLjQgcGFyc2VGbG9hdChzdHJpbmcpCgkJCSRleHBvcnQoJGV4cG9ydC5HICsgJGV4cG9ydC5GICogKHBhcnNlRmxvYXQgIT0gJHBhcnNlRmxvYXQpLCB7CgkJCQlwYXJzZUZsb2F0OiAkcGFyc2VGbG9hdAoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDk4ODk6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciAkcGFyc2VJbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk5NTgpOwovLyAxOC4yLjUgcGFyc2VJbnQoc3RyaW5nLCByYWRpeCkKCQkJJGV4cG9ydCgkZXhwb3J0LkcgKyAkZXhwb3J0LkYgKiAocGFyc2VJbnQgIT0gJHBhcnNlSW50KSwgewoJCQkJcGFyc2VJbnQ6ICRwYXJzZUludAoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDU2MjM6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyIExJQlJBUlkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY1NjcpOwoJCQl2YXIgZ2xvYmFsID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5NzY5KTsKCQkJdmFyIGN0eCA9IF9fd2VicGFja19yZXF1aXJlX18oODU2Myk7CgkJCXZhciBjbGFzc29mID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5MzQpOwoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciBpc09iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNDY4Nik7CgkJCXZhciBhRnVuY3Rpb24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ4MTApOwoJCQl2YXIgYW5JbnN0YW5jZSA9IF9fd2VicGFja19yZXF1aXJlX18oODY3Myk7CgkJCXZhciBmb3JPZiA9IF9fd2VicGFja19yZXF1aXJlX18oMzM4OSk7CgkJCXZhciBzcGVjaWVzQ29uc3RydWN0b3IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc1NTQpOwoJCQl2YXIgdGFzayA9IChfX3dlYnBhY2tfcmVxdWlyZV9fKDUwMjkpLnNldCk7CgkJCXZhciBtaWNyb3Rhc2sgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI2ODQpKCk7CgkJCXZhciBuZXdQcm9taXNlQ2FwYWJpbGl0eU1vZHVsZSA9IF9fd2VicGFja19yZXF1aXJlX18oMjYzOCk7CgkJCXZhciBwZXJmb3JtID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNjQyKTsKCQkJdmFyIHVzZXJBZ2VudCA9IF9fd2VicGFja19yZXF1aXJlX18oOTk4Nyk7CgkJCXZhciBwcm9taXNlUmVzb2x2ZSA9IF9fd2VicGFja19yZXF1aXJlX18oNjM3OSk7CgkJCXZhciBQUk9NSVNFID0gJ1Byb21pc2UnOwoJCQl2YXIgVHlwZUVycm9yID0gZ2xvYmFsLlR5cGVFcnJvcjsKCQkJdmFyIHByb2Nlc3MgPSBnbG9iYWwucHJvY2VzczsKCQkJdmFyIHZlcnNpb25zID0gcHJvY2VzcyAmJiBwcm9jZXNzLnZlcnNpb25zOwoJCQl2YXIgdjggPSB2ZXJzaW9ucyAmJiB2ZXJzaW9ucy52OCB8fCAnJzsKCQkJdmFyICRQcm9taXNlID0gZ2xvYmFsW1BST01JU0VdOwoJCQl2YXIgaXNOb2RlID0gY2xhc3NvZihwcm9jZXNzKSA9PSAncHJvY2Vzcyc7CgkJCXZhciBlbXB0eSA9IGZ1bmN0aW9uIGVtcHR5KCkgey8qIGVtcHR5ICovCgkJCX07CgkJCXZhciBJbnRlcm5hbCwgbmV3R2VuZXJpY1Byb21pc2VDYXBhYmlsaXR5LCBPd25Qcm9taXNlQ2FwYWJpbGl0eSwgV3JhcHBlcjsKCQkJdmFyIG5ld1Byb21pc2VDYXBhYmlsaXR5ID0gbmV3R2VuZXJpY1Byb21pc2VDYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHlNb2R1bGUuZjsKCQkJdmFyIFVTRV9OQVRJVkUgPSAhIWZ1bmN0aW9uKCkgewoJCQkJdHJ5IHsKCQkJCQkvLyBjb3JyZWN0IHN1YmNsYXNzaW5nIHdpdGggQEBzcGVjaWVzIHN1cHBvcnQKCQkJCQl2YXIgcHJvbWlzZSA9ICRQcm9taXNlLnJlc29sdmUoMSk7CgkJCQkJdmFyIEZha2VQcm9taXNlID0gKHByb21pc2UuY29uc3RydWN0b3IgPSB7fSlbX193ZWJwYWNrX3JlcXVpcmVfXygyODY3KSgnc3BlY2llcycpXSA9IGZ1bmN0aW9uKGV4ZWMpIHsKCQkJCQkJZXhlYyhlbXB0eSwgZW1wdHkpOwoJCQkJCX07CgkJCQkJLy8gdW5oYW5kbGVkIHJlamVjdGlvbnMgdHJhY2tpbmcgc3VwcG9ydCwgTm9kZUpTIFByb21pc2Ugd2l0aG91dCBpdCBmYWlscyBAQHNwZWNpZXMgdGVzdAoJCQkJCXJldHVybiAoaXNOb2RlIHx8IHR5cGVvZiBQcm9taXNlUmVqZWN0aW9uRXZlbnQgPT0gJ2Z1bmN0aW9uJykgJiYgcHJvbWlzZS50aGVuKGVtcHR5KSBpbnN0YW5jZW9mIEZha2VQcm9taXNlCgkJCQkJCS8vIHY4IDYuNiAoTm9kZSAxMCBhbmQgQ2hyb21lIDY2KSBoYXZlIGEgYnVnIHdpdGggcmVzb2x2aW5nIGN1c3RvbSB0aGVuYWJsZXMKCQkJCQkJLy8gaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9ODMwNTY1CgkJCQkJCS8vIHdlIGNhbid0IGRldGVjdCBpdCBzeW5jaHJvbm91c2x5LCBzbyBqdXN0IGNoZWNrIHZlcnNpb25zCgkJCQkJCSYmIHY4LmluZGV4T2YoJzYuNicpICE9PSAwICYmIHVzZXJBZ2VudC5pbmRleE9mKCdDaHJvbWUvNjYnKSA9PT0gLTE7CgkJCQl9IGNhdGNoIChlKSB7LyogZW1wdHkgKi8KCQkJCX0KCQkJfSgpOwoKLy8gaGVscGVycwoJCQl2YXIgaXNUaGVuYWJsZSA9IGZ1bmN0aW9uIGlzVGhlbmFibGUoaXQpIHsKCQkJCXZhciB0aGVuOwoJCQkJcmV0dXJuIGlzT2JqZWN0KGl0KSAmJiB0eXBlb2YgKHRoZW4gPSBpdC50aGVuKSA9PSAnZnVuY3Rpb24nID8gdGhlbiA6IGZhbHNlOwoJCQl9OwoJCQl2YXIgbm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5KHByb21pc2UsIGlzUmVqZWN0KSB7CgkJCQlpZiAocHJvbWlzZS5fbikgcmV0dXJuOwoJCQkJcHJvbWlzZS5fbiA9IHRydWU7CgkJCQl2YXIgY2hhaW4gPSBwcm9taXNlLl9jOwoJCQkJbWljcm90YXNrKGZ1bmN0aW9uKCkgewoJCQkJCXZhciB2YWx1ZSA9IHByb21pc2UuX3Y7CgkJCQkJdmFyIG9rID0gcHJvbWlzZS5fcyA9PSAxOwoJCQkJCXZhciBpID0gMDsKCQkJCQl2YXIgcnVuID0gZnVuY3Rpb24gcnVuKHJlYWN0aW9uKSB7CgkJCQkJCXZhciBoYW5kbGVyID0gb2sgPyByZWFjdGlvbi5vayA6IHJlYWN0aW9uLmZhaWw7CgkJCQkJCXZhciByZXNvbHZlID0gcmVhY3Rpb24ucmVzb2x2ZTsKCQkJCQkJdmFyIHJlamVjdCA9IHJlYWN0aW9uLnJlamVjdDsKCQkJCQkJdmFyIGRvbWFpbiA9IHJlYWN0aW9uLmRvbWFpbjsKCQkJCQkJdmFyIHJlc3VsdCwgdGhlbiwgZXhpdGVkOwoJCQkJCQl0cnkgewoJCQkJCQkJaWYgKGhhbmRsZXIpIHsKCQkJCQkJCQlpZiAoIW9rKSB7CgkJCQkJCQkJCWlmIChwcm9taXNlLl9oID09IDIpIG9uSGFuZGxlVW5oYW5kbGVkKHByb21pc2UpOwoJCQkJCQkJCQlwcm9taXNlLl9oID0gMTsKCQkJCQkJCQl9CgkJCQkJCQkJaWYgKGhhbmRsZXIgPT09IHRydWUpIHJlc3VsdCA9IHZhbHVlOyBlbHNlIHsKCQkJCQkJCQkJaWYgKGRvbWFpbikgZG9tYWluLmVudGVyKCk7CgkJCQkJCQkJCXJlc3VsdCA9IGhhbmRsZXIodmFsdWUpOyAvLyBtYXkgdGhyb3cKCQkJCQkJCQkJaWYgKGRvbWFpbikgewoJCQkJCQkJCQkJZG9tYWluLmV4aXQoKTsKCQkJCQkJCQkJCWV4aXRlZCA9IHRydWU7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQkJaWYgKHJlc3VsdCA9PT0gcmVhY3Rpb24ucHJvbWlzZSkgewoJCQkJCQkJCQlyZWplY3QoVHlwZUVycm9yKCdQcm9taXNlLWNoYWluIGN5Y2xlJykpOwoJCQkJCQkJCX0gZWxzZSBpZiAodGhlbiA9IGlzVGhlbmFibGUocmVzdWx0KSkgewoJCQkJCQkJCQl0aGVuLmNhbGwocmVzdWx0LCByZXNvbHZlLCByZWplY3QpOwoJCQkJCQkJCX0gZWxzZSByZXNvbHZlKHJlc3VsdCk7CgkJCQkJCQl9IGVsc2UgcmVqZWN0KHZhbHVlKTsKCQkJCQkJfSBjYXRjaCAoZSkgewoJCQkJCQkJaWYgKGRvbWFpbiAmJiAhZXhpdGVkKSBkb21haW4uZXhpdCgpOwoJCQkJCQkJcmVqZWN0KGUpOwoJCQkJCQl9CgkJCQkJfTsKCQkJCQl3aGlsZSAoY2hhaW4ubGVuZ3RoID4gaSkgcnVuKGNoYWluW2krK10pOyAvLyB2YXJpYWJsZSBsZW5ndGggLSBjYW4ndCB1c2UgZm9yRWFjaAoJCQkJCXByb21pc2UuX2MgPSBbXTsKCQkJCQlwcm9taXNlLl9uID0gZmFsc2U7CgkJCQkJaWYgKGlzUmVqZWN0ICYmICFwcm9taXNlLl9oKSBvblVuaGFuZGxlZChwcm9taXNlKTsKCQkJCX0pOwoJCQl9OwoJCQl2YXIgb25VbmhhbmRsZWQgPSBmdW5jdGlvbiBvblVuaGFuZGxlZChwcm9taXNlKSB7CgkJCQl0YXNrLmNhbGwoZ2xvYmFsLCBmdW5jdGlvbigpIHsKCQkJCQl2YXIgdmFsdWUgPSBwcm9taXNlLl92OwoJCQkJCXZhciB1bmhhbmRsZWQgPSBpc1VuaGFuZGxlZChwcm9taXNlKTsKCQkJCQl2YXIgcmVzdWx0LCBoYW5kbGVyLCBjb25zb2xlOwoJCQkJCWlmICh1bmhhbmRsZWQpIHsKCQkJCQkJcmVzdWx0ID0gcGVyZm9ybShmdW5jdGlvbigpIHsKCQkJCQkJCWlmIChpc05vZGUpIHsKCQkJCQkJCQlwcm9jZXNzLmVtaXQoJ3VuaGFuZGxlZFJlamVjdGlvbicsIHZhbHVlLCBwcm9taXNlKTsKCQkJCQkJCX0gZWxzZSBpZiAoaGFuZGxlciA9IGdsb2JhbC5vbnVuaGFuZGxlZHJlamVjdGlvbikgewoJCQkJCQkJCWhhbmRsZXIoewoJCQkJCQkJCQlwcm9taXNlOiBwcm9taXNlLAoJCQkJCQkJCQlyZWFzb246IHZhbHVlCgkJCQkJCQkJfSk7CgkJCQkJCQl9IGVsc2UgaWYgKChjb25zb2xlID0gZ2xvYmFsLmNvbnNvbGUpICYmIGNvbnNvbGUuZXJyb3IpIHsKCQkJCQkJCQljb25zb2xlLmVycm9yKCdVbmhhbmRsZWQgcHJvbWlzZSByZWplY3Rpb24nLCB2YWx1ZSk7CgkJCQkJCQl9CgkJCQkJCX0pOwoJCQkJCQkvLyBCcm93c2VycyBzaG91bGQgbm90IHRyaWdnZXIgYHJlamVjdGlvbkhhbmRsZWRgIGV2ZW50IGlmIGl0IHdhcyBoYW5kbGVkIGhlcmUsIE5vZGVKUyAtIHNob3VsZAoJCQkJCQlwcm9taXNlLl9oID0gaXNOb2RlIHx8IGlzVW5oYW5kbGVkKHByb21pc2UpID8gMiA6IDE7CgkJCQkJfQoJCQkJCXByb21pc2UuX2EgPSB1bmRlZmluZWQ7CgkJCQkJaWYgKHVuaGFuZGxlZCAmJiByZXN1bHQuZSkgdGhyb3cgcmVzdWx0LnY7CgkJCQl9KTsKCQkJfTsKCQkJdmFyIGlzVW5oYW5kbGVkID0gZnVuY3Rpb24gaXNVbmhhbmRsZWQocHJvbWlzZSkgewoJCQkJcmV0dXJuIHByb21pc2UuX2ggIT09IDEgJiYgKHByb21pc2UuX2EgfHwgcHJvbWlzZS5fYykubGVuZ3RoID09PSAwOwoJCQl9OwoJCQl2YXIgb25IYW5kbGVVbmhhbmRsZWQgPSBmdW5jdGlvbiBvbkhhbmRsZVVuaGFuZGxlZChwcm9taXNlKSB7CgkJCQl0YXNrLmNhbGwoZ2xvYmFsLCBmdW5jdGlvbigpIHsKCQkJCQl2YXIgaGFuZGxlcjsKCQkJCQlpZiAoaXNOb2RlKSB7CgkJCQkJCXByb2Nlc3MuZW1pdCgncmVqZWN0aW9uSGFuZGxlZCcsIHByb21pc2UpOwoJCQkJCX0gZWxzZSBpZiAoaGFuZGxlciA9IGdsb2JhbC5vbnJlamVjdGlvbmhhbmRsZWQpIHsKCQkJCQkJaGFuZGxlcih7CgkJCQkJCQlwcm9taXNlOiBwcm9taXNlLAoJCQkJCQkJcmVhc29uOiBwcm9taXNlLl92CgkJCQkJCX0pOwoJCQkJCX0KCQkJCX0pOwoJCQl9OwoJCQl2YXIgJHJlamVjdCA9IGZ1bmN0aW9uICRyZWplY3QodmFsdWUpIHsKCQkJCXZhciBwcm9taXNlID0gdGhpczsKCQkJCWlmIChwcm9taXNlLl9kKSByZXR1cm47CgkJCQlwcm9taXNlLl9kID0gdHJ1ZTsKCQkJCXByb21pc2UgPSBwcm9taXNlLl93IHx8IHByb21pc2U7IC8vIHVud3JhcAoJCQkJcHJvbWlzZS5fdiA9IHZhbHVlOwoJCQkJcHJvbWlzZS5fcyA9IDI7CgkJCQlpZiAoIXByb21pc2UuX2EpIHByb21pc2UuX2EgPSBwcm9taXNlLl9jLnNsaWNlKCk7CgkJCQlub3RpZnkocHJvbWlzZSwgdHJ1ZSk7CgkJCX07CgkJCXZhciAkcmVzb2x2ZSA9IGZ1bmN0aW9uICRyZXNvbHZlKHZhbHVlKSB7CgkJCQl2YXIgcHJvbWlzZSA9IHRoaXM7CgkJCQl2YXIgdGhlbjsKCQkJCWlmIChwcm9taXNlLl9kKSByZXR1cm47CgkJCQlwcm9taXNlLl9kID0gdHJ1ZTsKCQkJCXByb21pc2UgPSBwcm9taXNlLl93IHx8IHByb21pc2U7IC8vIHVud3JhcAoJCQkJdHJ5IHsKCQkJCQlpZiAocHJvbWlzZSA9PT0gdmFsdWUpIHRocm93IFR5cGVFcnJvcignUHJvbWlzZSBjYW5cJ3QgYmUgcmVzb2x2ZWQgaXRzZWxmJyk7CgkJCQkJaWYgKHRoZW4gPSBpc1RoZW5hYmxlKHZhbHVlKSkgewoJCQkJCQltaWNyb3Rhc2soZnVuY3Rpb24oKSB7CgkJCQkJCQl2YXIgd3JhcHBlciA9IHsKCQkJCQkJCQlfdzogcHJvbWlzZSwKCQkJCQkJCQlfZDogZmFsc2UKCQkJCQkJCX07IC8vIHdyYXAKCQkJCQkJCXRyeSB7CgkJCQkJCQkJdGhlbi5jYWxsKHZhbHVlLCBjdHgoJHJlc29sdmUsIHdyYXBwZXIsIDEpLCBjdHgoJHJlamVjdCwgd3JhcHBlciwgMSkpOwoJCQkJCQkJfSBjYXRjaCAoZSkgewoJCQkJCQkJCSRyZWplY3QuY2FsbCh3cmFwcGVyLCBlKTsKCQkJCQkJCX0KCQkJCQkJfSk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJcHJvbWlzZS5fdiA9IHZhbHVlOwoJCQkJCQlwcm9taXNlLl9zID0gMTsKCQkJCQkJbm90aWZ5KHByb21pc2UsIGZhbHNlKTsKCQkJCQl9CgkJCQl9IGNhdGNoIChlKSB7CgkJCQkJJHJlamVjdC5jYWxsKHsKCQkJCQkJX3c6IHByb21pc2UsCgkJCQkJCV9kOiBmYWxzZQoJCQkJCX0sIGUpOyAvLyB3cmFwCgkJCQl9CgkJCX07CgovLyBjb25zdHJ1Y3RvciBwb2x5ZmlsbAoJCQlpZiAoIVVTRV9OQVRJVkUpIHsKCQkJCS8vIDI1LjQuMy4xIFByb21pc2UoZXhlY3V0b3IpCgkJCQkkUHJvbWlzZSA9IGZ1bmN0aW9uIFByb21pc2UoZXhlY3V0b3IpIHsKCQkJCQlhbkluc3RhbmNlKHRoaXMsICRQcm9taXNlLCBQUk9NSVNFLCAnX2gnKTsKCQkJCQlhRnVuY3Rpb24oZXhlY3V0b3IpOwoJCQkJCUludGVybmFsLmNhbGwodGhpcyk7CgkJCQkJdHJ5IHsKCQkJCQkJZXhlY3V0b3IoY3R4KCRyZXNvbHZlLCB0aGlzLCAxKSwgY3R4KCRyZWplY3QsIHRoaXMsIDEpKTsKCQkJCQl9IGNhdGNoIChlcnIpIHsKCQkJCQkJJHJlamVjdC5jYWxsKHRoaXMsIGVycik7CgkJCQkJfQoJCQkJfTsKCQkJCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFycwoJCQkJSW50ZXJuYWwgPSBmdW5jdGlvbiBQcm9taXNlKGV4ZWN1dG9yKSB7CgkJCQkJdGhpcy5fYyA9IFtdOyAvLyA8LSBhd2FpdGluZyByZWFjdGlvbnMKCQkJCQl0aGlzLl9hID0gdW5kZWZpbmVkOyAvLyA8LSBjaGVja2VkIGluIGlzVW5oYW5kbGVkIHJlYWN0aW9ucwoJCQkJCXRoaXMuX3MgPSAwOyAvLyA8LSBzdGF0ZQoJCQkJCXRoaXMuX2QgPSBmYWxzZTsgLy8gPC0gZG9uZQoJCQkJCXRoaXMuX3YgPSB1bmRlZmluZWQ7IC8vIDwtIHZhbHVlCgkJCQkJdGhpcy5faCA9IDA7IC8vIDwtIHJlamVjdGlvbiBzdGF0ZSwgMCAtIGRlZmF1bHQsIDEgLSBoYW5kbGVkLCAyIC0gdW5oYW5kbGVkCgkJCQkJdGhpcy5fbiA9IGZhbHNlOyAvLyA8LSBub3RpZnkKCQkJCX07CgkJCQlJbnRlcm5hbC5wcm90b3R5cGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcxODUpKCRQcm9taXNlLnByb3RvdHlwZSwgewoJCQkJCS8vIDI1LjQuNS4zIFByb21pc2UucHJvdG90eXBlLnRoZW4ob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQpCgkJCQkJdGhlbjogZnVuY3Rpb24gdGhlbihvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCkgewoJCQkJCQl2YXIgcmVhY3Rpb24gPSBuZXdQcm9taXNlQ2FwYWJpbGl0eShzcGVjaWVzQ29uc3RydWN0b3IodGhpcywgJFByb21pc2UpKTsKCQkJCQkJcmVhY3Rpb24ub2sgPSB0eXBlb2Ygb25GdWxmaWxsZWQgPT0gJ2Z1bmN0aW9uJyA/IG9uRnVsZmlsbGVkIDogdHJ1ZTsKCQkJCQkJcmVhY3Rpb24uZmFpbCA9IHR5cGVvZiBvblJlamVjdGVkID09ICdmdW5jdGlvbicgJiYgb25SZWplY3RlZDsKCQkJCQkJcmVhY3Rpb24uZG9tYWluID0gaXNOb2RlID8gcHJvY2Vzcy5kb21haW4gOiB1bmRlZmluZWQ7CgkJCQkJCXRoaXMuX2MucHVzaChyZWFjdGlvbik7CgkJCQkJCWlmICh0aGlzLl9hKSB0aGlzLl9hLnB1c2gocmVhY3Rpb24pOwoJCQkJCQlpZiAodGhpcy5fcykgbm90aWZ5KHRoaXMsIGZhbHNlKTsKCQkJCQkJcmV0dXJuIHJlYWN0aW9uLnByb21pc2U7CgkJCQkJfSwKCQkJCQkvLyAyNS40LjUuMSBQcm9taXNlLnByb3RvdHlwZS5jYXRjaChvblJlamVjdGVkKQoJCQkJCSdjYXRjaCc6IGZ1bmN0aW9uIF9jYXRjaChvblJlamVjdGVkKSB7CgkJCQkJCXJldHVybiB0aGlzLnRoZW4odW5kZWZpbmVkLCBvblJlamVjdGVkKTsKCQkJCQl9CgkJCQl9KTsKCQkJCU93blByb21pc2VDYXBhYmlsaXR5ID0gZnVuY3Rpb24gT3duUHJvbWlzZUNhcGFiaWxpdHkoKSB7CgkJCQkJdmFyIHByb21pc2UgPSBuZXcgSW50ZXJuYWwoKTsKCQkJCQl0aGlzLnByb21pc2UgPSBwcm9taXNlOwoJCQkJCXRoaXMucmVzb2x2ZSA9IGN0eCgkcmVzb2x2ZSwgcHJvbWlzZSwgMSk7CgkJCQkJdGhpcy5yZWplY3QgPSBjdHgoJHJlamVjdCwgcHJvbWlzZSwgMSk7CgkJCQl9OwoJCQkJbmV3UHJvbWlzZUNhcGFiaWxpdHlNb2R1bGUuZiA9IG5ld1Byb21pc2VDYXBhYmlsaXR5ID0gZnVuY3Rpb24gbmV3UHJvbWlzZUNhcGFiaWxpdHkoQykgewoJCQkJCXJldHVybiBDID09PSAkUHJvbWlzZSB8fCBDID09PSBXcmFwcGVyID8gbmV3IE93blByb21pc2VDYXBhYmlsaXR5KEMpIDogbmV3R2VuZXJpY1Byb21pc2VDYXBhYmlsaXR5KEMpOwoJCQkJfTsKCQkJfQoJCQkkZXhwb3J0KCRleHBvcnQuRyArICRleHBvcnQuVyArICRleHBvcnQuRiAqICFVU0VfTkFUSVZFLCB7CgkJCQlQcm9taXNlOiAkUHJvbWlzZQoJCQl9KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg1MzIxKSgkUHJvbWlzZSwgUFJPTUlTRSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMjMzNCkoUFJPTUlTRSk7CgkJCVdyYXBwZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUxNjUpW1BST01JU0VdOwoKLy8gc3RhdGljcwoJCQkkZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICFVU0VfTkFUSVZFLCBQUk9NSVNFLCB7CgkJCQkvLyAyNS40LjQuNSBQcm9taXNlLnJlamVjdChyKQoJCQkJcmVqZWN0OiBmdW5jdGlvbiByZWplY3QocikgewoJCQkJCXZhciBjYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkodGhpcyk7CgkJCQkJdmFyICQkcmVqZWN0ID0gY2FwYWJpbGl0eS5yZWplY3Q7CgkJCQkJJCRyZWplY3Qocik7CgkJCQkJcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKCQkJCX0KCQkJfSk7CgkJCSRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogKExJQlJBUlkgfHwgIVVTRV9OQVRJVkUpLCBQUk9NSVNFLCB7CgkJCQkvLyAyNS40LjQuNiBQcm9taXNlLnJlc29sdmUoeCkKCQkJCXJlc29sdmU6IGZ1bmN0aW9uIHJlc29sdmUoeCkgewoJCQkJCXJldHVybiBwcm9taXNlUmVzb2x2ZShMSUJSQVJZICYmIHRoaXMgPT09IFdyYXBwZXIgPyAkUHJvbWlzZSA6IHRoaXMsIHgpOwoJCQkJfQoJCQl9KTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhKFVTRV9OQVRJVkUgJiYgX193ZWJwYWNrX3JlcXVpcmVfXyg5MjkpKGZ1bmN0aW9uKGl0ZXIpIHsKCQkJCSRQcm9taXNlLmFsbChpdGVyKVsnY2F0Y2gnXShlbXB0eSk7CgkJCX0pKSwgUFJPTUlTRSwgewoJCQkJLy8gMjUuNC40LjEgUHJvbWlzZS5hbGwoaXRlcmFibGUpCgkJCQlhbGw6IGZ1bmN0aW9uIGFsbChpdGVyYWJsZSkgewoJCQkJCXZhciBDID0gdGhpczsKCQkJCQl2YXIgY2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5KEMpOwoJCQkJCXZhciByZXNvbHZlID0gY2FwYWJpbGl0eS5yZXNvbHZlOwoJCQkJCXZhciByZWplY3QgPSBjYXBhYmlsaXR5LnJlamVjdDsKCQkJCQl2YXIgcmVzdWx0ID0gcGVyZm9ybShmdW5jdGlvbigpIHsKCQkJCQkJdmFyIHZhbHVlcyA9IFtdOwoJCQkJCQl2YXIgaW5kZXggPSAwOwoJCQkJCQl2YXIgcmVtYWluaW5nID0gMTsKCQkJCQkJZm9yT2YoaXRlcmFibGUsIGZhbHNlLCBmdW5jdGlvbihwcm9taXNlKSB7CgkJCQkJCQl2YXIgJGluZGV4ID0gaW5kZXgrKzsKCQkJCQkJCXZhciBhbHJlYWR5Q2FsbGVkID0gZmFsc2U7CgkJCQkJCQl2YWx1ZXMucHVzaCh1bmRlZmluZWQpOwoJCQkJCQkJcmVtYWluaW5nKys7CgkJCQkJCQlDLnJlc29sdmUocHJvbWlzZSkudGhlbihmdW5jdGlvbih2YWx1ZSkgewoJCQkJCQkJCWlmIChhbHJlYWR5Q2FsbGVkKSByZXR1cm47CgkJCQkJCQkJYWxyZWFkeUNhbGxlZCA9IHRydWU7CgkJCQkJCQkJdmFsdWVzWyRpbmRleF0gPSB2YWx1ZTsKCQkJCQkJCQktLXJlbWFpbmluZyB8fCByZXNvbHZlKHZhbHVlcyk7CgkJCQkJCQl9LCByZWplY3QpOwoJCQkJCQl9KTsKCQkJCQkJLS1yZW1haW5pbmcgfHwgcmVzb2x2ZSh2YWx1ZXMpOwoJCQkJCX0pOwoJCQkJCWlmIChyZXN1bHQuZSkgcmVqZWN0KHJlc3VsdC52KTsKCQkJCQlyZXR1cm4gY2FwYWJpbGl0eS5wcm9taXNlOwoJCQkJfSwKCQkJCS8vIDI1LjQuNC40IFByb21pc2UucmFjZShpdGVyYWJsZSkKCQkJCXJhY2U6IGZ1bmN0aW9uIHJhY2UoaXRlcmFibGUpIHsKCQkJCQl2YXIgQyA9IHRoaXM7CgkJCQkJdmFyIGNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eShDKTsKCQkJCQl2YXIgcmVqZWN0ID0gY2FwYWJpbGl0eS5yZWplY3Q7CgkJCQkJdmFyIHJlc3VsdCA9IHBlcmZvcm0oZnVuY3Rpb24oKSB7CgkJCQkJCWZvck9mKGl0ZXJhYmxlLCBmYWxzZSwgZnVuY3Rpb24ocHJvbWlzZSkgewoJCQkJCQkJQy5yZXNvbHZlKHByb21pc2UpLnRoZW4oY2FwYWJpbGl0eS5yZXNvbHZlLCByZWplY3QpOwoJCQkJCQl9KTsKCQkJCQl9KTsKCQkJCQlpZiAocmVzdWx0LmUpIHJlamVjdChyZXN1bHQudik7CgkJCQkJcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA5MTg3OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMjYuMS4xIFJlZmxlY3QuYXBwbHkodGFyZ2V0LCB0aGlzQXJndW1lbnQsIGFyZ3VtZW50c0xpc3QpCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIGFGdW5jdGlvbiA9IF9fd2VicGFja19yZXF1aXJlX18oNDgxMCk7CgkJCXZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNjE2Nik7CgkJCXZhciByQXBwbHkgPSAoKF9fd2VicGFja19yZXF1aXJlX18oOTc2OSkuUmVmbGVjdCkgfHwge30pLmFwcGx5OwoJCQl2YXIgZkFwcGx5ID0gRnVuY3Rpb24uYXBwbHk7Ci8vIE1TIEVkZ2UgYXJndW1lbnRzTGlzdCBhcmd1bWVudCBpcyBvcHRpb25hbAoJCQkkZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICFfX3dlYnBhY2tfcmVxdWlyZV9fKDEyOCkoZnVuY3Rpb24oKSB7CgkJCQlyQXBwbHkoZnVuY3Rpb24oKSB7LyogZW1wdHkgKi8KCQkJCX0pOwoJCQl9KSwgJ1JlZmxlY3QnLCB7CgkJCQlhcHBseTogZnVuY3Rpb24gYXBwbHkodGFyZ2V0LCB0aGlzQXJndW1lbnQsIGFyZ3VtZW50c0xpc3QpIHsKCQkJCQl2YXIgVCA9IGFGdW5jdGlvbih0YXJnZXQpOwoJCQkJCXZhciBMID0gYW5PYmplY3QoYXJndW1lbnRzTGlzdCk7CgkJCQkJcmV0dXJuIHJBcHBseSA/IHJBcHBseShULCB0aGlzQXJndW1lbnQsIEwpIDogZkFwcGx5LmNhbGwoVCwgdGhpc0FyZ3VtZW50LCBMKTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA3ODY4OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMjYuMS4yIFJlZmxlY3QuY29uc3RydWN0KHRhcmdldCwgYXJndW1lbnRzTGlzdCBbLCBuZXdUYXJnZXRdKQoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciBjcmVhdGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUxNDIpOwoJCQl2YXIgYUZ1bmN0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0ODEwKTsKCQkJdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MTY2KTsKCQkJdmFyIGlzT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0Njg2KTsKCQkJdmFyIGZhaWxzID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMjgpOwoJCQl2YXIgYmluZCA9IF9fd2VicGFja19yZXF1aXJlX18oNDc3KTsKCQkJdmFyIHJDb25zdHJ1Y3QgPSAoKF9fd2VicGFja19yZXF1aXJlX18oOTc2OSkuUmVmbGVjdCkgfHwge30pLmNvbnN0cnVjdDsKCi8vIE1TIEVkZ2Ugc3VwcG9ydHMgb25seSAyIGFyZ3VtZW50cyBhbmQgYXJndW1lbnRzTGlzdCBhcmd1bWVudCBpcyBvcHRpb25hbAovLyBGRiBOaWdodGx5IHNldHMgdGhpcmQgYXJndW1lbnQgYXMgYG5ldy50YXJnZXRgLCBidXQgZG9lcyBub3QgY3JlYXRlIGB0aGlzYCBmcm9tIGl0CgkJCXZhciBORVdfVEFSR0VUX0JVRyA9IGZhaWxzKGZ1bmN0aW9uKCkgewoJCQkJZnVuY3Rpb24gRigpIHsvKiBlbXB0eSAqLwoJCQkJfQoKCQkJCXJldHVybiAhKHJDb25zdHJ1Y3QoZnVuY3Rpb24oKSB7LyogZW1wdHkgKi8KCQkJCX0sIFtdLCBGKSBpbnN0YW5jZW9mIEYpOwoJCQl9KTsKCQkJdmFyIEFSR1NfQlVHID0gIWZhaWxzKGZ1bmN0aW9uKCkgewoJCQkJckNvbnN0cnVjdChmdW5jdGlvbigpIHsvKiBlbXB0eSAqLwoJCQkJfSk7CgkJCX0pOwoJCQkkZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqIChORVdfVEFSR0VUX0JVRyB8fCBBUkdTX0JVRyksICdSZWZsZWN0JywgewoJCQkJY29uc3RydWN0OiBmdW5jdGlvbiBjb25zdHJ1Y3QoVGFyZ2V0LCBhcmdzIC8qICwgbmV3VGFyZ2V0ICovKSB7CgkJCQkJYUZ1bmN0aW9uKFRhcmdldCk7CgkJCQkJYW5PYmplY3QoYXJncyk7CgkJCQkJdmFyIG5ld1RhcmdldCA9IGFyZ3VtZW50cy5sZW5ndGggPCAzID8gVGFyZ2V0IDogYUZ1bmN0aW9uKGFyZ3VtZW50c1syXSk7CgkJCQkJaWYgKEFSR1NfQlVHICYmICFORVdfVEFSR0VUX0JVRykgcmV0dXJuIHJDb25zdHJ1Y3QoVGFyZ2V0LCBhcmdzLCBuZXdUYXJnZXQpOwoJCQkJCWlmIChUYXJnZXQgPT0gbmV3VGFyZ2V0KSB7CgkJCQkJCS8vIHcvbyBhbHRlcmVkIG5ld1RhcmdldCwgb3B0aW1pemF0aW9uIGZvciAwLTQgYXJndW1lbnRzCgkJCQkJCXN3aXRjaCAoYXJncy5sZW5ndGgpIHsKCQkJCQkJCWNhc2UgMDoKCQkJCQkJCQlyZXR1cm4gbmV3IFRhcmdldCgpOwoJCQkJCQkJY2FzZSAxOgoJCQkJCQkJCXJldHVybiBuZXcgVGFyZ2V0KGFyZ3NbMF0pOwoJCQkJCQkJY2FzZSAyOgoJCQkJCQkJCXJldHVybiBuZXcgVGFyZ2V0KGFyZ3NbMF0sIGFyZ3NbMV0pOwoJCQkJCQkJY2FzZSAzOgoJCQkJCQkJCXJldHVybiBuZXcgVGFyZ2V0KGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0pOwoJCQkJCQkJY2FzZSA0OgoJCQkJCQkJCXJldHVybiBuZXcgVGFyZ2V0KGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0sIGFyZ3NbM10pOwoJCQkJCQl9CgkJCQkJCS8vIHcvbyBhbHRlcmVkIG5ld1RhcmdldCwgbG90IG9mIGFyZ3VtZW50cyBjYXNlCgkJCQkJCXZhciAkYXJncyA9IFtudWxsXTsKCQkJCQkJJGFyZ3MucHVzaC5hcHBseSgkYXJncywgYXJncyk7CgkJCQkJCXJldHVybiBuZXcgKGJpbmQuYXBwbHkoVGFyZ2V0LCAkYXJncykpKCk7CgkJCQkJfQoJCQkJCS8vIHdpdGggYWx0ZXJlZCBuZXdUYXJnZXQsIG5vdCBzdXBwb3J0IGJ1aWx0LWluIGNvbnN0cnVjdG9ycwoJCQkJCXZhciBwcm90byA9IG5ld1RhcmdldC5wcm90b3R5cGU7CgkJCQkJdmFyIGluc3RhbmNlID0gY3JlYXRlKGlzT2JqZWN0KHByb3RvKSA/IHByb3RvIDogT2JqZWN0LnByb3RvdHlwZSk7CgkJCQkJdmFyIHJlc3VsdCA9IEZ1bmN0aW9uLmFwcGx5LmNhbGwoVGFyZ2V0LCBpbnN0YW5jZSwgYXJncyk7CgkJCQkJcmV0dXJuIGlzT2JqZWN0KHJlc3VsdCkgPyByZXN1bHQgOiBpbnN0YW5jZTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAyMjI6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyAyNi4xLjMgUmVmbGVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIHByb3BlcnR5S2V5LCBhdHRyaWJ1dGVzKQoJCQl2YXIgZFAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1MTUpOwoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNjE2Nik7CgkJCXZhciB0b1ByaW1pdGl2ZSA9IF9fd2VicGFja19yZXF1aXJlX18oMzQ0MCk7CgovLyBNUyBFZGdlIGhhcyBicm9rZW4gUmVmbGVjdC5kZWZpbmVQcm9wZXJ0eSAtIHRocm93aW5nIGluc3RlYWQgb2YgcmV0dXJuaW5nIGZhbHNlCgkJCSRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogX193ZWJwYWNrX3JlcXVpcmVfXygxMjgpKGZ1bmN0aW9uKCkgewoJCQkJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVuZGVmCgkJCQlSZWZsZWN0LmRlZmluZVByb3BlcnR5KGRQLmYoe30sIDEsIHsKCQkJCQl2YWx1ZTogMQoJCQkJfSksIDEsIHsKCQkJCQl2YWx1ZTogMgoJCQkJfSk7CgkJCX0pLCAnUmVmbGVjdCcsIHsKCQkJCWRlZmluZVByb3BlcnR5OiBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIHByb3BlcnR5S2V5LCBhdHRyaWJ1dGVzKSB7CgkJCQkJYW5PYmplY3QodGFyZ2V0KTsKCQkJCQlwcm9wZXJ0eUtleSA9IHRvUHJpbWl0aXZlKHByb3BlcnR5S2V5LCB0cnVlKTsKCQkJCQlhbk9iamVjdChhdHRyaWJ1dGVzKTsKCQkJCQl0cnkgewoJCQkJCQlkUC5mKHRhcmdldCwgcHJvcGVydHlLZXksIGF0dHJpYnV0ZXMpOwoJCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCQl9IGNhdGNoIChlKSB7CgkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQl9CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNzQyODoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDI2LjEuNCBSZWZsZWN0LmRlbGV0ZVByb3BlcnR5KHRhcmdldCwgcHJvcGVydHlLZXkpCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIGdPUEQgPSAoX193ZWJwYWNrX3JlcXVpcmVfXyg4MDk2KS5mKTsKCQkJdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MTY2KTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdSZWZsZWN0JywgewoJCQkJZGVsZXRlUHJvcGVydHk6IGZ1bmN0aW9uIGRlbGV0ZVByb3BlcnR5KHRhcmdldCwgcHJvcGVydHlLZXkpIHsKCQkJCQl2YXIgZGVzYyA9IGdPUEQoYW5PYmplY3QodGFyZ2V0KSwgcHJvcGVydHlLZXkpOwoJCQkJCXJldHVybiBkZXNjICYmICFkZXNjLmNvbmZpZ3VyYWJsZSA/IGZhbHNlIDogZGVsZXRlIHRhcmdldFtwcm9wZXJ0eUtleV07CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNzI0NjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyAyNi4xLjUgUmVmbGVjdC5lbnVtZXJhdGUodGFyZ2V0KQoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNjE2Nik7CgkJCXZhciBFbnVtZXJhdGUgPSBmdW5jdGlvbiBFbnVtZXJhdGUoaXRlcmF0ZWQpIHsKCQkJCXRoaXMuX3QgPSBhbk9iamVjdChpdGVyYXRlZCk7IC8vIHRhcmdldAoJCQkJdGhpcy5faSA9IDA7IC8vIG5leHQgaW5kZXgKCQkJCXZhciBrZXlzID0gdGhpcy5fayA9IFtdOyAvLyBrZXlzCgkJCQl2YXIga2V5OwoJCQkJZm9yIChrZXkgaW4gaXRlcmF0ZWQpIGtleXMucHVzaChrZXkpOwoJCQl9OwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDgzMTEpKEVudW1lcmF0ZSwgJ09iamVjdCcsIGZ1bmN0aW9uKCkgewoJCQkJdmFyIHRoYXQgPSB0aGlzOwoJCQkJdmFyIGtleXMgPSB0aGF0Ll9rOwoJCQkJdmFyIGtleTsKCQkJCWRvIHsKCQkJCQlpZiAodGhhdC5faSA+PSBrZXlzLmxlbmd0aCkgcmV0dXJuIHsKCQkJCQkJdmFsdWU6IHVuZGVmaW5lZCwKCQkJCQkJZG9uZTogdHJ1ZQoJCQkJCX07CgkJCQl9IHdoaWxlICghKChrZXkgPSBrZXlzW3RoYXQuX2krK10pIGluIHRoYXQuX3QpKTsKCQkJCXJldHVybiB7CgkJCQkJdmFsdWU6IGtleSwKCQkJCQlkb25lOiBmYWxzZQoJCQkJfTsKCQkJfSk7CgkJCSRleHBvcnQoJGV4cG9ydC5TLCAnUmVmbGVjdCcsIHsKCQkJCWVudW1lcmF0ZTogZnVuY3Rpb24gZW51bWVyYXRlKHRhcmdldCkgewoJCQkJCXJldHVybiBuZXcgRW51bWVyYXRlKHRhcmdldCk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNTIwNToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDI2LjEuNyBSZWZsZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIHByb3BlcnR5S2V5KQoJCQl2YXIgZ09QRCA9IF9fd2VicGFja19yZXF1aXJlX18oODA5Nik7CgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MTY2KTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdSZWZsZWN0JywgewoJCQkJZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBwcm9wZXJ0eUtleSkgewoJCQkJCXJldHVybiBnT1BELmYoYW5PYmplY3QodGFyZ2V0KSwgcHJvcGVydHlLZXkpOwoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDk4MToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDI2LjEuOCBSZWZsZWN0LmdldFByb3RvdHlwZU9mKHRhcmdldCkKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQl2YXIgZ2V0UHJvdG8gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg5OTYpOwoJCQl2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYxNjYpOwoJCQkkZXhwb3J0KCRleHBvcnQuUywgJ1JlZmxlY3QnLCB7CgkJCQlnZXRQcm90b3R5cGVPZjogZnVuY3Rpb24gZ2V0UHJvdG90eXBlT2YodGFyZ2V0KSB7CgkJCQkJcmV0dXJuIGdldFByb3RvKGFuT2JqZWN0KHRhcmdldCkpOwoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDk0MjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDI2LjEuNiBSZWZsZWN0LmdldCh0YXJnZXQsIHByb3BlcnR5S2V5IFssIHJlY2VpdmVyXSkKCQkJdmFyIGdPUEQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgwOTYpOwoJCQl2YXIgZ2V0UHJvdG90eXBlT2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg5OTYpOwoJCQl2YXIgaGFzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0OTk3KTsKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQl2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2ODYpOwoJCQl2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYxNjYpOwoKCQkJZnVuY3Rpb24gZ2V0KHRhcmdldCwgcHJvcGVydHlLZXkgLyogLCByZWNlaXZlciAqLykgewoJCQkJdmFyIHJlY2VpdmVyID0gYXJndW1lbnRzLmxlbmd0aCA8IDMgPyB0YXJnZXQgOiBhcmd1bWVudHNbMl07CgkJCQl2YXIgZGVzYywgcHJvdG87CgkJCQlpZiAoYW5PYmplY3QodGFyZ2V0KSA9PT0gcmVjZWl2ZXIpIHJldHVybiB0YXJnZXRbcHJvcGVydHlLZXldOwoJCQkJaWYgKGRlc2MgPSBnT1BELmYodGFyZ2V0LCBwcm9wZXJ0eUtleSkpIHJldHVybiBoYXMoZGVzYywgJ3ZhbHVlJykgPyBkZXNjLnZhbHVlIDogZGVzYy5nZXQgIT09IHVuZGVmaW5lZCA/IGRlc2MuZ2V0LmNhbGwocmVjZWl2ZXIpIDogdW5kZWZpbmVkOwoJCQkJaWYgKGlzT2JqZWN0KHByb3RvID0gZ2V0UHJvdG90eXBlT2YodGFyZ2V0KSkpIHJldHVybiBnZXQocHJvdG8sIHByb3BlcnR5S2V5LCByZWNlaXZlcik7CgkJCX0KCgkJCSRleHBvcnQoJGV4cG9ydC5TLCAnUmVmbGVjdCcsIHsKCQkJCWdldDogZ2V0CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMTg1OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMjYuMS45IFJlZmxlY3QuaGFzKHRhcmdldCwgcHJvcGVydHlLZXkpCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdSZWZsZWN0JywgewoJCQkJaGFzOiBmdW5jdGlvbiBoYXModGFyZ2V0LCBwcm9wZXJ0eUtleSkgewoJCQkJCXJldHVybiBwcm9wZXJ0eUtleSBpbiB0YXJnZXQ7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNzMyMDoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDI2LjEuMTAgUmVmbGVjdC5pc0V4dGVuc2libGUodGFyZ2V0KQoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNjE2Nik7CgkJCXZhciAkaXNFeHRlbnNpYmxlID0gT2JqZWN0LmlzRXh0ZW5zaWJsZTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdSZWZsZWN0JywgewoJCQkJaXNFeHRlbnNpYmxlOiBmdW5jdGlvbiBpc0V4dGVuc2libGUodGFyZ2V0KSB7CgkJCQkJYW5PYmplY3QodGFyZ2V0KTsKCQkJCQlyZXR1cm4gJGlzRXh0ZW5zaWJsZSA/ICRpc0V4dGVuc2libGUodGFyZ2V0KSA6IHRydWU7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMjgwMjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDI2LjEuMTEgUmVmbGVjdC5vd25LZXlzKHRhcmdldCkKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQkkZXhwb3J0KCRleHBvcnQuUywgJ1JlZmxlY3QnLCB7CgkJCQlvd25LZXlzOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDMzNzUpCgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNDQ4MToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIDI2LjEuMTIgUmVmbGVjdC5wcmV2ZW50RXh0ZW5zaW9ucyh0YXJnZXQpCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MTY2KTsKCQkJdmFyICRwcmV2ZW50RXh0ZW5zaW9ucyA9IE9iamVjdC5wcmV2ZW50RXh0ZW5zaW9uczsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdSZWZsZWN0JywgewoJCQkJcHJldmVudEV4dGVuc2lvbnM6IGZ1bmN0aW9uIHByZXZlbnRFeHRlbnNpb25zKHRhcmdldCkgewoJCQkJCWFuT2JqZWN0KHRhcmdldCk7CgkJCQkJdHJ5IHsKCQkJCQkJaWYgKCRwcmV2ZW50RXh0ZW5zaW9ucykgJHByZXZlbnRFeHRlbnNpb25zKHRhcmdldCk7CgkJCQkJCXJldHVybiB0cnVlOwoJCQkJCX0gY2F0Y2ggKGUpIHsKCQkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJCX0KCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAzNDg4OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMjYuMS4xNCBSZWZsZWN0LnNldFByb3RvdHlwZU9mKHRhcmdldCwgcHJvdG8pCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIHNldFByb3RvID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNDU0KTsKCQkJaWYgKHNldFByb3RvKSAkZXhwb3J0KCRleHBvcnQuUywgJ1JlZmxlY3QnLCB7CgkJCQlzZXRQcm90b3R5cGVPZjogZnVuY3Rpb24gc2V0UHJvdG90eXBlT2YodGFyZ2V0LCBwcm90bykgewoJCQkJCXNldFByb3RvLmNoZWNrKHRhcmdldCwgcHJvdG8pOwoJCQkJCXRyeSB7CgkJCQkJCXNldFByb3RvLnNldCh0YXJnZXQsIHByb3RvKTsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfSBjYXRjaCAoZSkgewoJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJfQoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDM0Mzg6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyAyNi4xLjEzIFJlZmxlY3Quc2V0KHRhcmdldCwgcHJvcGVydHlLZXksIFYgWywgcmVjZWl2ZXJdKQoJCQl2YXIgZFAgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1MTUpOwoJCQl2YXIgZ09QRCA9IF9fd2VicGFja19yZXF1aXJlX18oODA5Nik7CgkJCXZhciBnZXRQcm90b3R5cGVPZiA9IF9fd2VicGFja19yZXF1aXJlX18oODk5Nik7CgkJCXZhciBoYXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ5OTcpOwoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciBjcmVhdGVEZXNjID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3MjMpOwoJCQl2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYxNjYpOwoJCQl2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2ODYpOwoKCQkJZnVuY3Rpb24gc2V0KHRhcmdldCwgcHJvcGVydHlLZXksIFYgLyogLCByZWNlaXZlciAqLykgewoJCQkJdmFyIHJlY2VpdmVyID0gYXJndW1lbnRzLmxlbmd0aCA8IDQgPyB0YXJnZXQgOiBhcmd1bWVudHNbM107CgkJCQl2YXIgb3duRGVzYyA9IGdPUEQuZihhbk9iamVjdCh0YXJnZXQpLCBwcm9wZXJ0eUtleSk7CgkJCQl2YXIgZXhpc3RpbmdEZXNjcmlwdG9yLCBwcm90bzsKCQkJCWlmICghb3duRGVzYykgewoJCQkJCWlmIChpc09iamVjdChwcm90byA9IGdldFByb3RvdHlwZU9mKHRhcmdldCkpKSB7CgkJCQkJCXJldHVybiBzZXQocHJvdG8sIHByb3BlcnR5S2V5LCBWLCByZWNlaXZlcik7CgkJCQkJfQoJCQkJCW93bkRlc2MgPSBjcmVhdGVEZXNjKDApOwoJCQkJfQoJCQkJaWYgKGhhcyhvd25EZXNjLCAndmFsdWUnKSkgewoJCQkJCWlmIChvd25EZXNjLndyaXRhYmxlID09PSBmYWxzZSB8fCAhaXNPYmplY3QocmVjZWl2ZXIpKSByZXR1cm4gZmFsc2U7CgkJCQkJaWYgKGV4aXN0aW5nRGVzY3JpcHRvciA9IGdPUEQuZihyZWNlaXZlciwgcHJvcGVydHlLZXkpKSB7CgkJCQkJCWlmIChleGlzdGluZ0Rlc2NyaXB0b3IuZ2V0IHx8IGV4aXN0aW5nRGVzY3JpcHRvci5zZXQgfHwgZXhpc3RpbmdEZXNjcmlwdG9yLndyaXRhYmxlID09PSBmYWxzZSkgcmV0dXJuIGZhbHNlOwoJCQkJCQlleGlzdGluZ0Rlc2NyaXB0b3IudmFsdWUgPSBWOwoJCQkJCQlkUC5mKHJlY2VpdmVyLCBwcm9wZXJ0eUtleSwgZXhpc3RpbmdEZXNjcmlwdG9yKTsKCQkJCQl9IGVsc2UgZFAuZihyZWNlaXZlciwgcHJvcGVydHlLZXksIGNyZWF0ZURlc2MoMCwgVikpOwoJCQkJCXJldHVybiB0cnVlOwoJCQkJfQoJCQkJcmV0dXJuIG93bkRlc2Muc2V0ID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IChvd25EZXNjLnNldC5jYWxsKHJlY2VpdmVyLCBWKSwgdHJ1ZSk7CgkJCX0KCgkJCSRleHBvcnQoJGV4cG9ydC5TLCAnUmVmbGVjdCcsIHsKCQkJCXNldDogc2V0CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMzU3MzoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciBnbG9iYWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk3NjkpOwoJCQl2YXIgaW5oZXJpdElmUmVxdWlyZWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxMTEpOwoJCQl2YXIgZFAgPSAoX193ZWJwYWNrX3JlcXVpcmVfXygxNTE1KS5mKTsKCQkJdmFyIGdPUE4gPSAoX193ZWJwYWNrX3JlcXVpcmVfXyg4NDgyKS5mKTsKCQkJdmFyIGlzUmVnRXhwID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4NDMwKTsKCQkJdmFyICRmbGFncyA9IF9fd2VicGFja19yZXF1aXJlX18oMTU1OCk7CgkJCXZhciAkUmVnRXhwID0gZ2xvYmFsLlJlZ0V4cDsKCQkJdmFyIEJhc2UgPSAkUmVnRXhwOwoJCQl2YXIgcHJvdG8gPSAkUmVnRXhwLnByb3RvdHlwZTsKCQkJdmFyIHJlMSA9IC9hL2c7CgkJCXZhciByZTIgPSAvYS9nOwovLyAibmV3IiBjcmVhdGVzIGEgbmV3IG9iamVjdCwgb2xkIHdlYmtpdCBidWdneSBoZXJlCgkJCXZhciBDT1JSRUNUX05FVyA9IG5ldyAkUmVnRXhwKHJlMSkgIT09IHJlMTsKCQkJaWYgKF9fd2VicGFja19yZXF1aXJlX18oNTE5NCkgJiYgKCFDT1JSRUNUX05FVyB8fCBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyOCkoZnVuY3Rpb24oKSB7CgkJCQlyZTJbX193ZWJwYWNrX3JlcXVpcmVfXygyODY3KSgnbWF0Y2gnKV0gPSBmYWxzZTsKCQkJCS8vIFJlZ0V4cCBjb25zdHJ1Y3RvciBjYW4gYWx0ZXIgZmxhZ3MgYW5kIElzUmVnRXhwIHdvcmtzIGNvcnJlY3Qgd2l0aCBAQG1hdGNoCgkJCQlyZXR1cm4gJFJlZ0V4cChyZTEpICE9IHJlMSB8fCAkUmVnRXhwKHJlMikgPT0gcmUyIHx8ICRSZWdFeHAocmUxLCAnaScpICE9ICcvYS9pJzsKCQkJfSkpKSB7CgkJCQkkUmVnRXhwID0gZnVuY3Rpb24gUmVnRXhwKHAsIGYpIHsKCQkJCQl2YXIgdGlSRSA9IHRoaXMgaW5zdGFuY2VvZiAkUmVnRXhwOwoJCQkJCXZhciBwaVJFID0gaXNSZWdFeHAocCk7CgkJCQkJdmFyIGZpVSA9IGYgPT09IHVuZGVmaW5lZDsKCQkJCQlyZXR1cm4gIXRpUkUgJiYgcGlSRSAmJiBwLmNvbnN0cnVjdG9yID09PSAkUmVnRXhwICYmIGZpVSA/IHAgOiBpbmhlcml0SWZSZXF1aXJlZChDT1JSRUNUX05FVyA/IG5ldyBCYXNlKHBpUkUgJiYgIWZpVSA/IHAuc291cmNlIDogcCwgZikgOiBCYXNlKChwaVJFID0gcCBpbnN0YW5jZW9mICRSZWdFeHApID8gcC5zb3VyY2UgOiBwLCBwaVJFICYmIGZpVSA/ICRmbGFncy5jYWxsKHApIDogZiksIHRpUkUgPyB0aGlzIDogcHJvdG8sICRSZWdFeHApOwoJCQkJfTsKCQkJCXZhciBwcm94eSA9IGZ1bmN0aW9uIHByb3h5KGtleSkgewoJCQkJCWtleSBpbiAkUmVnRXhwIHx8IGRQKCRSZWdFeHAsIGtleSwgewoJCQkJCQljb25maWd1cmFibGU6IHRydWUsCgkJCQkJCWdldDogZnVuY3Rpb24gZ2V0KCkgewoJCQkJCQkJcmV0dXJuIEJhc2Vba2V5XTsKCQkJCQkJfSwKCQkJCQkJc2V0OiBmdW5jdGlvbiBzZXQoaXQpIHsKCQkJCQkJCUJhc2Vba2V5XSA9IGl0OwoJCQkJCQl9CgkJCQkJfSk7CgkJCQl9OwoJCQkJZm9yICh2YXIga2V5cyA9IGdPUE4oQmFzZSksIGkgPSAwOyBrZXlzLmxlbmd0aCA+IGk7KSBwcm94eShrZXlzW2krK10pOwoJCQkJcHJvdG8uY29uc3RydWN0b3IgPSAkUmVnRXhwOwoJCQkJJFJlZ0V4cC5wcm90b3R5cGUgPSBwcm90bzsKCQkJCV9fd2VicGFja19yZXF1aXJlX18oODkxNCkoZ2xvYmFsLCAnUmVnRXhwJywgJFJlZ0V4cCk7CgkJCX0KCQkJX193ZWJwYWNrX3JlcXVpcmVfXygyMzM0KSgnUmVnRXhwJyk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAzNTAyOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCgkJCXZhciByZWdleHBFeGVjID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1NjA3KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KSh7CgkJCQl0YXJnZXQ6ICdSZWdFeHAnLAoJCQkJcHJvdG86IHRydWUsCgkJCQlmb3JjZWQ6IHJlZ2V4cEV4ZWMgIT09IC8uLy5leGVjCgkJCX0sIHsKCQkJCWV4ZWM6IHJlZ2V4cEV4ZWMKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA0OTY1OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gMjEuMi41LjMgZ2V0IFJlZ0V4cC5wcm90b3R5cGUuZmxhZ3MoKQoJCQlpZiAoX193ZWJwYWNrX3JlcXVpcmVfXyg1MTk0KSAmJiAvLi9nLmZsYWdzICE9ICdnJykgKF9fd2VicGFja19yZXF1aXJlX18oMTUxNSkuZikoUmVnRXhwLnByb3RvdHlwZSwgJ2ZsYWdzJywgewoJCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCQkJZ2V0OiBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1NTgpCgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMjA5NzoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgoJCQl2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYxNjYpOwoJCQl2YXIgdG9MZW5ndGggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUyMDEpOwoJCQl2YXIgYWR2YW5jZVN0cmluZ0luZGV4ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2NjkzKTsKCQkJdmFyIHJlZ0V4cEV4ZWMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM3OTUpOwoKLy8gQEBtYXRjaCBsb2dpYwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQ0ODUpKCdtYXRjaCcsIDEsIGZ1bmN0aW9uKGRlZmluZWQsIE1BVENILCAkbWF0Y2gsIG1heWJlQ2FsbE5hdGl2ZSkgewoJCQkJcmV0dXJuIFsKCQkJCQkvLyBgU3RyaW5nLnByb3RvdHlwZS5tYXRjaGAgbWV0aG9kCgkJCQkJLy8gaHR0cHM6Ly90YzM5LmdpdGh1Yi5pby9lY21hMjYyLyNzZWMtc3RyaW5nLnByb3RvdHlwZS5tYXRjaAoJCQkJCWZ1bmN0aW9uIG1hdGNoKHJlZ2V4cCkgewoJCQkJCQl2YXIgTyA9IGRlZmluZWQodGhpcyk7CgkJCQkJCXZhciBmbiA9IHJlZ2V4cCA9PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiByZWdleHBbTUFUQ0hdOwoJCQkJCQlyZXR1cm4gZm4gIT09IHVuZGVmaW5lZCA/IGZuLmNhbGwocmVnZXhwLCBPKSA6IG5ldyBSZWdFeHAocmVnZXhwKVtNQVRDSF0oU3RyaW5nKE8pKTsKCQkJCQl9LAoJCQkJCS8vIGBSZWdFeHAucHJvdG90eXBlW0BAbWF0Y2hdYCBtZXRob2QKCQkJCQkvLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1yZWdleHAucHJvdG90eXBlLUBAbWF0Y2gKCQkJCQlmdW5jdGlvbihyZWdleHApIHsKCQkJCQkJdmFyIHJlcyA9IG1heWJlQ2FsbE5hdGl2ZSgkbWF0Y2gsIHJlZ2V4cCwgdGhpcyk7CgkJCQkJCWlmIChyZXMuZG9uZSkgcmV0dXJuIHJlcy52YWx1ZTsKCQkJCQkJdmFyIHJ4ID0gYW5PYmplY3QocmVnZXhwKTsKCQkJCQkJdmFyIFMgPSBTdHJpbmcodGhpcyk7CgkJCQkJCWlmICghcnguZ2xvYmFsKSByZXR1cm4gcmVnRXhwRXhlYyhyeCwgUyk7CgkJCQkJCXZhciBmdWxsVW5pY29kZSA9IHJ4LnVuaWNvZGU7CgkJCQkJCXJ4Lmxhc3RJbmRleCA9IDA7CgkJCQkJCXZhciBBID0gW107CgkJCQkJCXZhciBuID0gMDsKCQkJCQkJdmFyIHJlc3VsdDsKCQkJCQkJd2hpbGUgKChyZXN1bHQgPSByZWdFeHBFeGVjKHJ4LCBTKSkgIT09IG51bGwpIHsKCQkJCQkJCXZhciBtYXRjaFN0ciA9IFN0cmluZyhyZXN1bHRbMF0pOwoJCQkJCQkJQVtuXSA9IG1hdGNoU3RyOwoJCQkJCQkJaWYgKG1hdGNoU3RyID09PSAnJykgcngubGFzdEluZGV4ID0gYWR2YW5jZVN0cmluZ0luZGV4KFMsIHRvTGVuZ3RoKHJ4Lmxhc3RJbmRleCksIGZ1bGxVbmljb2RlKTsKCQkJCQkJCW4rKzsKCQkJCQkJfQoJCQkJCQlyZXR1cm4gbiA9PT0gMCA/IG51bGwgOiBBOwoJCQkJCX1dOwoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDc2OTE6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MTY2KTsKCQkJdmFyIHRvT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0ODIwKTsKCQkJdmFyIHRvTGVuZ3RoID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MjAxKTsKCQkJdmFyIHRvSW50ZWdlciA9IF9fd2VicGFja19yZXF1aXJlX18oNjY5OSk7CgkJCXZhciBhZHZhbmNlU3RyaW5nSW5kZXggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY2OTMpOwoJCQl2YXIgcmVnRXhwRXhlYyA9IF9fd2VicGFja19yZXF1aXJlX18oMzc5NSk7CgkJCXZhciBtYXggPSBNYXRoLm1heDsKCQkJdmFyIG1pbiA9IE1hdGgubWluOwoJCQl2YXIgZmxvb3IgPSBNYXRoLmZsb29yOwoJCQl2YXIgU1VCU1RJVFVUSU9OX1NZTUJPTFMgPSAvXCQoWyQmYCddfFxkXGQ/fDxbXj5dKj4pL2c7CgkJCXZhciBTVUJTVElUVVRJT05fU1lNQk9MU19OT19OQU1FRCA9IC9cJChbJCZgJ118XGRcZD8pL2c7CgkJCXZhciBtYXliZVRvU3RyaW5nID0gZnVuY3Rpb24gbWF5YmVUb1N0cmluZyhpdCkgewoJCQkJcmV0dXJuIGl0ID09PSB1bmRlZmluZWQgPyBpdCA6IFN0cmluZyhpdCk7CgkJCX07CgovLyBAQHJlcGxhY2UgbG9naWMKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg0NDg1KSgncmVwbGFjZScsIDIsIGZ1bmN0aW9uKGRlZmluZWQsIFJFUExBQ0UsICRyZXBsYWNlLCBtYXliZUNhbGxOYXRpdmUpIHsKCQkJCXJldHVybiBbCgkJCQkJLy8gYFN0cmluZy5wcm90b3R5cGUucmVwbGFjZWAgbWV0aG9kCgkJCQkJLy8gaHR0cHM6Ly90YzM5LmdpdGh1Yi5pby9lY21hMjYyLyNzZWMtc3RyaW5nLnByb3RvdHlwZS5yZXBsYWNlCgkJCQkJZnVuY3Rpb24gcmVwbGFjZShzZWFyY2hWYWx1ZSwgcmVwbGFjZVZhbHVlKSB7CgkJCQkJCXZhciBPID0gZGVmaW5lZCh0aGlzKTsKCQkJCQkJdmFyIGZuID0gc2VhcmNoVmFsdWUgPT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogc2VhcmNoVmFsdWVbUkVQTEFDRV07CgkJCQkJCXJldHVybiBmbiAhPT0gdW5kZWZpbmVkID8gZm4uY2FsbChzZWFyY2hWYWx1ZSwgTywgcmVwbGFjZVZhbHVlKSA6ICRyZXBsYWNlLmNhbGwoU3RyaW5nKE8pLCBzZWFyY2hWYWx1ZSwgcmVwbGFjZVZhbHVlKTsKCQkJCQl9LAoJCQkJCS8vIGBSZWdFeHAucHJvdG90eXBlW0BAcmVwbGFjZV1gIG1ldGhvZAoJCQkJCS8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLXJlZ2V4cC5wcm90b3R5cGUtQEByZXBsYWNlCgkJCQkJZnVuY3Rpb24ocmVnZXhwLCByZXBsYWNlVmFsdWUpIHsKCQkJCQkJdmFyIHJlcyA9IG1heWJlQ2FsbE5hdGl2ZSgkcmVwbGFjZSwgcmVnZXhwLCB0aGlzLCByZXBsYWNlVmFsdWUpOwoJCQkJCQlpZiAocmVzLmRvbmUpIHJldHVybiByZXMudmFsdWU7CgkJCQkJCXZhciByeCA9IGFuT2JqZWN0KHJlZ2V4cCk7CgkJCQkJCXZhciBTID0gU3RyaW5nKHRoaXMpOwoJCQkJCQl2YXIgZnVuY3Rpb25hbFJlcGxhY2UgPSB0eXBlb2YgcmVwbGFjZVZhbHVlID09PSAnZnVuY3Rpb24nOwoJCQkJCQlpZiAoIWZ1bmN0aW9uYWxSZXBsYWNlKSByZXBsYWNlVmFsdWUgPSBTdHJpbmcocmVwbGFjZVZhbHVlKTsKCQkJCQkJdmFyIGdsb2JhbCA9IHJ4Lmdsb2JhbDsKCQkJCQkJaWYgKGdsb2JhbCkgewoJCQkJCQkJdmFyIGZ1bGxVbmljb2RlID0gcngudW5pY29kZTsKCQkJCQkJCXJ4Lmxhc3RJbmRleCA9IDA7CgkJCQkJCX0KCQkJCQkJdmFyIHJlc3VsdHMgPSBbXTsKCQkJCQkJd2hpbGUgKHRydWUpIHsKCQkJCQkJCXZhciByZXN1bHQgPSByZWdFeHBFeGVjKHJ4LCBTKTsKCQkJCQkJCWlmIChyZXN1bHQgPT09IG51bGwpIGJyZWFrOwoJCQkJCQkJcmVzdWx0cy5wdXNoKHJlc3VsdCk7CgkJCQkJCQlpZiAoIWdsb2JhbCkgYnJlYWs7CgkJCQkJCQl2YXIgbWF0Y2hTdHIgPSBTdHJpbmcocmVzdWx0WzBdKTsKCQkJCQkJCWlmIChtYXRjaFN0ciA9PT0gJycpIHJ4Lmxhc3RJbmRleCA9IGFkdmFuY2VTdHJpbmdJbmRleChTLCB0b0xlbmd0aChyeC5sYXN0SW5kZXgpLCBmdWxsVW5pY29kZSk7CgkJCQkJCX0KCQkJCQkJdmFyIGFjY3VtdWxhdGVkUmVzdWx0ID0gJyc7CgkJCQkJCXZhciBuZXh0U291cmNlUG9zaXRpb24gPSAwOwoJCQkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHJlc3VsdHMubGVuZ3RoOyBpKyspIHsKCQkJCQkJCXJlc3VsdCA9IHJlc3VsdHNbaV07CgkJCQkJCQl2YXIgbWF0Y2hlZCA9IFN0cmluZyhyZXN1bHRbMF0pOwoJCQkJCQkJdmFyIHBvc2l0aW9uID0gbWF4KG1pbih0b0ludGVnZXIocmVzdWx0LmluZGV4KSwgUy5sZW5ndGgpLCAwKTsKCQkJCQkJCXZhciBjYXB0dXJlcyA9IFtdOwoJCQkJCQkJLy8gTk9URTogVGhpcyBpcyBlcXVpdmFsZW50IHRvCgkJCQkJCQkvLyAgIGNhcHR1cmVzID0gcmVzdWx0LnNsaWNlKDEpLm1hcChtYXliZVRvU3RyaW5nKQoJCQkJCQkJLy8gYnV0IGZvciBzb21lIHJlYXNvbiBgbmF0aXZlU2xpY2UuY2FsbChyZXN1bHQsIDEsIHJlc3VsdC5sZW5ndGgpYCAoY2FsbGVkIGluCgkJCQkJCQkvLyB0aGUgc2xpY2UgcG9seWZpbGwgd2hlbiBzbGljaW5nIG5hdGl2ZSBhcnJheXMpICJkb2Vzbid0IHdvcmsiIGluIHNhZmFyaSA5IGFuZAoJCQkJCQkJLy8gY2F1c2VzIGEgY3Jhc2ggKGh0dHBzOi8vcGFzdGViaW4uY29tL04yMVF6ZVFBKSB3aGVuIHRyeWluZyB0byBkZWJ1ZyBpdC4KCQkJCQkJCWZvciAodmFyIGogPSAxOyBqIDwgcmVzdWx0Lmxlbmd0aDsgaisrKSBjYXB0dXJlcy5wdXNoKG1heWJlVG9TdHJpbmcocmVzdWx0W2pdKSk7CgkJCQkJCQl2YXIgbmFtZWRDYXB0dXJlcyA9IHJlc3VsdC5ncm91cHM7CgkJCQkJCQlpZiAoZnVuY3Rpb25hbFJlcGxhY2UpIHsKCQkJCQkJCQl2YXIgcmVwbGFjZXJBcmdzID0gW21hdGNoZWRdLmNvbmNhdChjYXB0dXJlcywgcG9zaXRpb24sIFMpOwoJCQkJCQkJCWlmIChuYW1lZENhcHR1cmVzICE9PSB1bmRlZmluZWQpIHJlcGxhY2VyQXJncy5wdXNoKG5hbWVkQ2FwdHVyZXMpOwoJCQkJCQkJCXZhciByZXBsYWNlbWVudCA9IFN0cmluZyhyZXBsYWNlVmFsdWUuYXBwbHkodW5kZWZpbmVkLCByZXBsYWNlckFyZ3MpKTsKCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJcmVwbGFjZW1lbnQgPSBnZXRTdWJzdGl0dXRpb24obWF0Y2hlZCwgUywgcG9zaXRpb24sIGNhcHR1cmVzLCBuYW1lZENhcHR1cmVzLCByZXBsYWNlVmFsdWUpOwoJCQkJCQkJfQoJCQkJCQkJaWYgKHBvc2l0aW9uID49IG5leHRTb3VyY2VQb3NpdGlvbikgewoJCQkJCQkJCWFjY3VtdWxhdGVkUmVzdWx0ICs9IFMuc2xpY2UobmV4dFNvdXJjZVBvc2l0aW9uLCBwb3NpdGlvbikgKyByZXBsYWNlbWVudDsKCQkJCQkJCQluZXh0U291cmNlUG9zaXRpb24gPSBwb3NpdGlvbiArIG1hdGNoZWQubGVuZ3RoOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCXJldHVybiBhY2N1bXVsYXRlZFJlc3VsdCArIFMuc2xpY2UobmV4dFNvdXJjZVBvc2l0aW9uKTsKCQkJCQl9XTsKCgkJCQkvLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1nZXRzdWJzdGl0dXRpb24KCQkJCWZ1bmN0aW9uIGdldFN1YnN0aXR1dGlvbihtYXRjaGVkLCBzdHIsIHBvc2l0aW9uLCBjYXB0dXJlcywgbmFtZWRDYXB0dXJlcywgcmVwbGFjZW1lbnQpIHsKCQkJCQl2YXIgdGFpbFBvcyA9IHBvc2l0aW9uICsgbWF0Y2hlZC5sZW5ndGg7CgkJCQkJdmFyIG0gPSBjYXB0dXJlcy5sZW5ndGg7CgkJCQkJdmFyIHN5bWJvbHMgPSBTVUJTVElUVVRJT05fU1lNQk9MU19OT19OQU1FRDsKCQkJCQlpZiAobmFtZWRDYXB0dXJlcyAhPT0gdW5kZWZpbmVkKSB7CgkJCQkJCW5hbWVkQ2FwdHVyZXMgPSB0b09iamVjdChuYW1lZENhcHR1cmVzKTsKCQkJCQkJc3ltYm9scyA9IFNVQlNUSVRVVElPTl9TWU1CT0xTOwoJCQkJCX0KCQkJCQlyZXR1cm4gJHJlcGxhY2UuY2FsbChyZXBsYWNlbWVudCwgc3ltYm9scywgZnVuY3Rpb24obWF0Y2gsIGNoKSB7CgkJCQkJCXZhciBjYXB0dXJlOwoJCQkJCQlzd2l0Y2ggKGNoLmNoYXJBdCgwKSkgewoJCQkJCQkJY2FzZSAnJCc6CgkJCQkJCQkJcmV0dXJuICckJzsKCQkJCQkJCWNhc2UgJyYnOgoJCQkJCQkJCXJldHVybiBtYXRjaGVkOwoJCQkJCQkJY2FzZSAnYCc6CgkJCQkJCQkJcmV0dXJuIHN0ci5zbGljZSgwLCBwb3NpdGlvbik7CgkJCQkJCQljYXNlICdcJyc6CgkJCQkJCQkJcmV0dXJuIHN0ci5zbGljZSh0YWlsUG9zKTsKCQkJCQkJCWNhc2UgJzwnOgoJCQkJCQkJCWNhcHR1cmUgPSBuYW1lZENhcHR1cmVzW2NoLnNsaWNlKDEsIC0xKV07CgkJCQkJCQkJYnJlYWs7CgkJCQkJCQlkZWZhdWx0OgoJCQkJCQkJCS8vIFxkXGQ/CgkJCQkJCQkJdmFyIG4gPSArY2g7CgkJCQkJCQkJaWYgKG4gPT09IDApIHJldHVybiBtYXRjaDsKCQkJCQkJCQlpZiAobiA+IG0pIHsKCQkJCQkJCQkJdmFyIGYgPSBmbG9vcihuIC8gMTApOwoJCQkJCQkJCQlpZiAoZiA9PT0gMCkgcmV0dXJuIG1hdGNoOwoJCQkJCQkJCQlpZiAoZiA8PSBtKSByZXR1cm4gY2FwdHVyZXNbZiAtIDFdID09PSB1bmRlZmluZWQgPyBjaC5jaGFyQXQoMSkgOiBjYXB0dXJlc1tmIC0gMV0gKyBjaC5jaGFyQXQoMSk7CgkJCQkJCQkJCXJldHVybiBtYXRjaDsKCQkJCQkJCQl9CgkJCQkJCQkJY2FwdHVyZSA9IGNhcHR1cmVzW24gLSAxXTsKCQkJCQkJfQoJCQkJCQlyZXR1cm4gY2FwdHVyZSA9PT0gdW5kZWZpbmVkID8gJycgOiBjYXB0dXJlOwoJCQkJCX0pOwoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDk1MTE6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MTY2KTsKCQkJdmFyIHNhbWVWYWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18oNDM5Mik7CgkJCXZhciByZWdFeHBFeGVjID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNzk1KTsKCi8vIEBAc2VhcmNoIGxvZ2ljCgkJCV9fd2VicGFja19yZXF1aXJlX18oNDQ4NSkoJ3NlYXJjaCcsIDEsIGZ1bmN0aW9uKGRlZmluZWQsIFNFQVJDSCwgJHNlYXJjaCwgbWF5YmVDYWxsTmF0aXZlKSB7CgkJCQlyZXR1cm4gWwoJCQkJCS8vIGBTdHJpbmcucHJvdG90eXBlLnNlYXJjaGAgbWV0aG9kCgkJCQkJLy8gaHR0cHM6Ly90YzM5LmdpdGh1Yi5pby9lY21hMjYyLyNzZWMtc3RyaW5nLnByb3RvdHlwZS5zZWFyY2gKCQkJCQlmdW5jdGlvbiBzZWFyY2gocmVnZXhwKSB7CgkJCQkJCXZhciBPID0gZGVmaW5lZCh0aGlzKTsKCQkJCQkJdmFyIGZuID0gcmVnZXhwID09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IHJlZ2V4cFtTRUFSQ0hdOwoJCQkJCQlyZXR1cm4gZm4gIT09IHVuZGVmaW5lZCA/IGZuLmNhbGwocmVnZXhwLCBPKSA6IG5ldyBSZWdFeHAocmVnZXhwKVtTRUFSQ0hdKFN0cmluZyhPKSk7CgkJCQkJfSwKCQkJCQkvLyBgUmVnRXhwLnByb3RvdHlwZVtAQHNlYXJjaF1gIG1ldGhvZAoJCQkJCS8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vZWNtYTI2Mi8jc2VjLXJlZ2V4cC5wcm90b3R5cGUtQEBzZWFyY2gKCQkJCQlmdW5jdGlvbihyZWdleHApIHsKCQkJCQkJdmFyIHJlcyA9IG1heWJlQ2FsbE5hdGl2ZSgkc2VhcmNoLCByZWdleHAsIHRoaXMpOwoJCQkJCQlpZiAocmVzLmRvbmUpIHJldHVybiByZXMudmFsdWU7CgkJCQkJCXZhciByeCA9IGFuT2JqZWN0KHJlZ2V4cCk7CgkJCQkJCXZhciBTID0gU3RyaW5nKHRoaXMpOwoJCQkJCQl2YXIgcHJldmlvdXNMYXN0SW5kZXggPSByeC5sYXN0SW5kZXg7CgkJCQkJCWlmICghc2FtZVZhbHVlKHByZXZpb3VzTGFzdEluZGV4LCAwKSkgcngubGFzdEluZGV4ID0gMDsKCQkJCQkJdmFyIHJlc3VsdCA9IHJlZ0V4cEV4ZWMocngsIFMpOwoJCQkJCQlpZiAoIXNhbWVWYWx1ZShyeC5sYXN0SW5kZXgsIHByZXZpb3VzTGFzdEluZGV4KSkgcngubGFzdEluZGV4ID0gcHJldmlvdXNMYXN0SW5kZXg7CgkJCQkJCXJldHVybiByZXN1bHQgPT09IG51bGwgPyAtMSA6IHJlc3VsdC5pbmRleDsKCQkJCQl9XTsKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA1ODQ2OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCgkJCXZhciBpc1JlZ0V4cCA9IF9fd2VicGFja19yZXF1aXJlX18oODQzMCk7CgkJCXZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNjE2Nik7CgkJCXZhciBzcGVjaWVzQ29uc3RydWN0b3IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc1NTQpOwoJCQl2YXIgYWR2YW5jZVN0cmluZ0luZGV4ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2NjkzKTsKCQkJdmFyIHRvTGVuZ3RoID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MjAxKTsKCQkJdmFyIGNhbGxSZWdFeHBFeGVjID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNzk1KTsKCQkJdmFyIHJlZ2V4cEV4ZWMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU2MDcpOwoJCQl2YXIgZmFpbHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEyOCk7CgkJCXZhciAkbWluID0gTWF0aC5taW47CgkJCXZhciAkcHVzaCA9IFtdLnB1c2g7CgkJCXZhciAkU1BMSVQgPSAnc3BsaXQnOwoJCQl2YXIgTEVOR1RIID0gJ2xlbmd0aCc7CgkJCXZhciBMQVNUX0lOREVYID0gJ2xhc3RJbmRleCc7CgkJCXZhciBNQVhfVUlOVDMyID0gMHhmZmZmZmZmZjsKCi8vIGJhYmVsLW1pbmlmeSB0cmFuc3BpbGVzIFJlZ0V4cCgneCcsICd5JykgLT4gL3gveSBhbmQgaXQgY2F1c2VzIFN5bnRheEVycm9yCgkJCXZhciBTVVBQT1JUU19ZID0gIWZhaWxzKGZ1bmN0aW9uKCkgewoJCQkJUmVnRXhwKE1BWF9VSU5UMzIsICd5Jyk7CgkJCX0pOwoKLy8gQEBzcGxpdCBsb2dpYwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQ0ODUpKCdzcGxpdCcsIDIsIGZ1bmN0aW9uKGRlZmluZWQsIFNQTElULCAkc3BsaXQsIG1heWJlQ2FsbE5hdGl2ZSkgewoJCQkJdmFyIGludGVybmFsU3BsaXQ7CgkJCQlpZiAoJ2FiYmMnWyRTUExJVF0oLyhiKSovKVsxXSA9PSAnYycgfHwgJ3Rlc3QnWyRTUExJVF0oLyg/OikvLCAtMSlbTEVOR1RIXSAhPSA0IHx8ICdhYidbJFNQTElUXSgvKD86YWIpKi8pW0xFTkdUSF0gIT0gMiB8fCAnLidbJFNQTElUXSgvKC4/KSguPykvKVtMRU5HVEhdICE9IDQgfHwgJy4nWyRTUExJVF0oLygpKCkvKVtMRU5HVEhdID4gMSB8fCAnJ1skU1BMSVRdKC8uPy8pW0xFTkdUSF0pIHsKCQkJCQkvLyBiYXNlZCBvbiBlczUtc2hpbSBpbXBsZW1lbnRhdGlvbiwgbmVlZCB0byByZXdvcmsgaXQKCQkJCQlpbnRlcm5hbFNwbGl0ID0gZnVuY3Rpb24gaW50ZXJuYWxTcGxpdChzZXBhcmF0b3IsIGxpbWl0KSB7CgkJCQkJCXZhciBzdHJpbmcgPSBTdHJpbmcodGhpcyk7CgkJCQkJCWlmIChzZXBhcmF0b3IgPT09IHVuZGVmaW5lZCAmJiBsaW1pdCA9PT0gMCkgcmV0dXJuIFtdOwoJCQkJCQkvLyBJZiBgc2VwYXJhdG9yYCBpcyBub3QgYSByZWdleCwgdXNlIG5hdGl2ZSBzcGxpdAoJCQkJCQlpZiAoIWlzUmVnRXhwKHNlcGFyYXRvcikpIHJldHVybiAkc3BsaXQuY2FsbChzdHJpbmcsIHNlcGFyYXRvciwgbGltaXQpOwoJCQkJCQl2YXIgb3V0cHV0ID0gW107CgkJCQkJCXZhciBmbGFncyA9IChzZXBhcmF0b3IuaWdub3JlQ2FzZSA/ICdpJyA6ICcnKSArIChzZXBhcmF0b3IubXVsdGlsaW5lID8gJ20nIDogJycpICsgKHNlcGFyYXRvci51bmljb2RlID8gJ3UnIDogJycpICsgKHNlcGFyYXRvci5zdGlja3kgPyAneScgOiAnJyk7CgkJCQkJCXZhciBsYXN0TGFzdEluZGV4ID0gMDsKCQkJCQkJdmFyIHNwbGl0TGltaXQgPSBsaW1pdCA9PT0gdW5kZWZpbmVkID8gTUFYX1VJTlQzMiA6IGxpbWl0ID4+PiAwOwoJCQkJCQkvLyBNYWtlIGBnbG9iYWxgIGFuZCBhdm9pZCBgbGFzdEluZGV4YCBpc3N1ZXMgYnkgd29ya2luZyB3aXRoIGEgY29weQoJCQkJCQl2YXIgc2VwYXJhdG9yQ29weSA9IG5ldyBSZWdFeHAoc2VwYXJhdG9yLnNvdXJjZSwgZmxhZ3MgKyAnZycpOwoJCQkJCQl2YXIgbWF0Y2gsIGxhc3RJbmRleCwgbGFzdExlbmd0aDsKCQkJCQkJd2hpbGUgKG1hdGNoID0gcmVnZXhwRXhlYy5jYWxsKHNlcGFyYXRvckNvcHksIHN0cmluZykpIHsKCQkJCQkJCWxhc3RJbmRleCA9IHNlcGFyYXRvckNvcHlbTEFTVF9JTkRFWF07CgkJCQkJCQlpZiAobGFzdEluZGV4ID4gbGFzdExhc3RJbmRleCkgewoJCQkJCQkJCW91dHB1dC5wdXNoKHN0cmluZy5zbGljZShsYXN0TGFzdEluZGV4LCBtYXRjaC5pbmRleCkpOwoJCQkJCQkJCWlmIChtYXRjaFtMRU5HVEhdID4gMSAmJiBtYXRjaC5pbmRleCA8IHN0cmluZ1tMRU5HVEhdKSAkcHVzaC5hcHBseShvdXRwdXQsIG1hdGNoLnNsaWNlKDEpKTsKCQkJCQkJCQlsYXN0TGVuZ3RoID0gbWF0Y2hbMF1bTEVOR1RIXTsKCQkJCQkJCQlsYXN0TGFzdEluZGV4ID0gbGFzdEluZGV4OwoJCQkJCQkJCWlmIChvdXRwdXRbTEVOR1RIXSA+PSBzcGxpdExpbWl0KSBicmVhazsKCQkJCQkJCX0KCQkJCQkJCWlmIChzZXBhcmF0b3JDb3B5W0xBU1RfSU5ERVhdID09PSBtYXRjaC5pbmRleCkgc2VwYXJhdG9yQ29weVtMQVNUX0lOREVYXSsrOyAvLyBBdm9pZCBhbiBpbmZpbml0ZSBsb29wCgkJCQkJCX0KCQkJCQkJaWYgKGxhc3RMYXN0SW5kZXggPT09IHN0cmluZ1tMRU5HVEhdKSB7CgkJCQkJCQlpZiAobGFzdExlbmd0aCB8fCAhc2VwYXJhdG9yQ29weS50ZXN0KCcnKSkgb3V0cHV0LnB1c2goJycpOwoJCQkJCQl9IGVsc2Ugb3V0cHV0LnB1c2goc3RyaW5nLnNsaWNlKGxhc3RMYXN0SW5kZXgpKTsKCQkJCQkJcmV0dXJuIG91dHB1dFtMRU5HVEhdID4gc3BsaXRMaW1pdCA/IG91dHB1dC5zbGljZSgwLCBzcGxpdExpbWl0KSA6IG91dHB1dDsKCQkJCQl9OwoJCQkJCS8vIENoYWtyYSwgVjgKCQkJCX0gZWxzZSBpZiAoJzAnWyRTUExJVF0odW5kZWZpbmVkLCAwKVtMRU5HVEhdKSB7CgkJCQkJaW50ZXJuYWxTcGxpdCA9IGZ1bmN0aW9uIGludGVybmFsU3BsaXQoc2VwYXJhdG9yLCBsaW1pdCkgewoJCQkJCQlyZXR1cm4gc2VwYXJhdG9yID09PSB1bmRlZmluZWQgJiYgbGltaXQgPT09IDAgPyBbXSA6ICRzcGxpdC5jYWxsKHRoaXMsIHNlcGFyYXRvciwgbGltaXQpOwoJCQkJCX07CgkJCQl9IGVsc2UgewoJCQkJCWludGVybmFsU3BsaXQgPSAkc3BsaXQ7CgkJCQl9CgkJCQlyZXR1cm4gWwoJCQkJCS8vIGBTdHJpbmcucHJvdG90eXBlLnNwbGl0YCBtZXRob2QKCQkJCQkvLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1zdHJpbmcucHJvdG90eXBlLnNwbGl0CgkJCQkJZnVuY3Rpb24gc3BsaXQoc2VwYXJhdG9yLCBsaW1pdCkgewoJCQkJCQl2YXIgTyA9IGRlZmluZWQodGhpcyk7CgkJCQkJCXZhciBzcGxpdHRlciA9IHNlcGFyYXRvciA9PSB1bmRlZmluZWQgPyB1bmRlZmluZWQgOiBzZXBhcmF0b3JbU1BMSVRdOwoJCQkJCQlyZXR1cm4gc3BsaXR0ZXIgIT09IHVuZGVmaW5lZCA/IHNwbGl0dGVyLmNhbGwoc2VwYXJhdG9yLCBPLCBsaW1pdCkgOiBpbnRlcm5hbFNwbGl0LmNhbGwoU3RyaW5nKE8pLCBzZXBhcmF0b3IsIGxpbWl0KTsKCQkJCQl9LAoJCQkJCS8vIGBSZWdFeHAucHJvdG90eXBlW0BAc3BsaXRdYCBtZXRob2QKCQkJCQkvLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL2VjbWEyNjIvI3NlYy1yZWdleHAucHJvdG90eXBlLUBAc3BsaXQKCQkJCQkvLwoJCQkJCS8vIE5PVEU6IFRoaXMgY2Fubm90IGJlIHByb3Blcmx5IHBvbHlmaWxsZWQgaW4gZW5naW5lcyB0aGF0IGRvbid0IHN1cHBvcnQKCQkJCQkvLyB0aGUgJ3knIGZsYWcuCgkJCQkJZnVuY3Rpb24ocmVnZXhwLCBsaW1pdCkgewoJCQkJCQl2YXIgcmVzID0gbWF5YmVDYWxsTmF0aXZlKGludGVybmFsU3BsaXQsIHJlZ2V4cCwgdGhpcywgbGltaXQsIGludGVybmFsU3BsaXQgIT09ICRzcGxpdCk7CgkJCQkJCWlmIChyZXMuZG9uZSkgcmV0dXJuIHJlcy52YWx1ZTsKCQkJCQkJdmFyIHJ4ID0gYW5PYmplY3QocmVnZXhwKTsKCQkJCQkJdmFyIFMgPSBTdHJpbmcodGhpcyk7CgkJCQkJCXZhciBDID0gc3BlY2llc0NvbnN0cnVjdG9yKHJ4LCBSZWdFeHApOwoJCQkJCQl2YXIgdW5pY29kZU1hdGNoaW5nID0gcngudW5pY29kZTsKCQkJCQkJdmFyIGZsYWdzID0gKHJ4Lmlnbm9yZUNhc2UgPyAnaScgOiAnJykgKyAocngubXVsdGlsaW5lID8gJ20nIDogJycpICsgKHJ4LnVuaWNvZGUgPyAndScgOiAnJykgKyAoU1VQUE9SVFNfWSA/ICd5JyA6ICdnJyk7CgoJCQkJCQkvLyBeKD8gKyByeCArICkgaXMgbmVlZGVkLCBpbiBjb21iaW5hdGlvbiB3aXRoIHNvbWUgUyBzbGljaW5nLCB0bwoJCQkJCQkvLyBzaW11bGF0ZSB0aGUgJ3knIGZsYWcuCgkJCQkJCXZhciBzcGxpdHRlciA9IG5ldyBDKFNVUFBPUlRTX1kgPyByeCA6ICdeKD86JyArIHJ4LnNvdXJjZSArICcpJywgZmxhZ3MpOwoJCQkJCQl2YXIgbGltID0gbGltaXQgPT09IHVuZGVmaW5lZCA/IE1BWF9VSU5UMzIgOiBsaW1pdCA+Pj4gMDsKCQkJCQkJaWYgKGxpbSA9PT0gMCkgcmV0dXJuIFtdOwoJCQkJCQlpZiAoUy5sZW5ndGggPT09IDApIHJldHVybiBjYWxsUmVnRXhwRXhlYyhzcGxpdHRlciwgUykgPT09IG51bGwgPyBbU10gOiBbXTsKCQkJCQkJdmFyIHAgPSAwOwoJCQkJCQl2YXIgcSA9IDA7CgkJCQkJCXZhciBBID0gW107CgkJCQkJCXdoaWxlIChxIDwgUy5sZW5ndGgpIHsKCQkJCQkJCXNwbGl0dGVyLmxhc3RJbmRleCA9IFNVUFBPUlRTX1kgPyBxIDogMDsKCQkJCQkJCXZhciB6ID0gY2FsbFJlZ0V4cEV4ZWMoc3BsaXR0ZXIsIFNVUFBPUlRTX1kgPyBTIDogUy5zbGljZShxKSk7CgkJCQkJCQl2YXIgZTsKCQkJCQkJCWlmICh6ID09PSBudWxsIHx8IChlID0gJG1pbih0b0xlbmd0aChzcGxpdHRlci5sYXN0SW5kZXggKyAoU1VQUE9SVFNfWSA/IDAgOiBxKSksIFMubGVuZ3RoKSkgPT09IHApIHsKCQkJCQkJCQlxID0gYWR2YW5jZVN0cmluZ0luZGV4KFMsIHEsIHVuaWNvZGVNYXRjaGluZyk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCUEucHVzaChTLnNsaWNlKHAsIHEpKTsKCQkJCQkJCQlpZiAoQS5sZW5ndGggPT09IGxpbSkgcmV0dXJuIEE7CgkJCQkJCQkJZm9yICh2YXIgaSA9IDE7IGkgPD0gei5sZW5ndGggLSAxOyBpKyspIHsKCQkJCQkJCQkJQS5wdXNoKHpbaV0pOwoJCQkJCQkJCQlpZiAoQS5sZW5ndGggPT09IGxpbSkgcmV0dXJuIEE7CgkJCQkJCQkJfQoJCQkJCQkJCXEgPSBwID0gZTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQlBLnB1c2goUy5zbGljZShwKSk7CgkJCQkJCXJldHVybiBBOwoJCQkJCX1dOwoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDkwMzg6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg0OTY1KTsKCQkJdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MTY2KTsKCQkJdmFyICRmbGFncyA9IF9fd2VicGFja19yZXF1aXJlX18oMTU1OCk7CgkJCXZhciBERVNDUklQVE9SUyA9IF9fd2VicGFja19yZXF1aXJlX18oNTE5NCk7CgkJCXZhciBUT19TVFJJTkcgPSAndG9TdHJpbmcnOwoJCQl2YXIgJHRvU3RyaW5nID0gLy4vW1RPX1NUUklOR107CgkJCXZhciBkZWZpbmUgPSBmdW5jdGlvbiBkZWZpbmUoZm4pIHsKCQkJCV9fd2VicGFja19yZXF1aXJlX18oODkxNCkoUmVnRXhwLnByb3RvdHlwZSwgVE9fU1RSSU5HLCBmbiwgdHJ1ZSk7CgkJCX07CgovLyAyMS4yLjUuMTQgUmVnRXhwLnByb3RvdHlwZS50b1N0cmluZygpCgkJCWlmIChfX3dlYnBhY2tfcmVxdWlyZV9fKDEyOCkoZnVuY3Rpb24oKSB7CgkJCQlyZXR1cm4gJHRvU3RyaW5nLmNhbGwoewoJCQkJCXNvdXJjZTogJ2EnLAoJCQkJCWZsYWdzOiAnYicKCQkJCX0pICE9ICcvYS9iJzsKCQkJfSkpIHsKCQkJCWRlZmluZShmdW5jdGlvbiB0b1N0cmluZygpIHsKCQkJCQl2YXIgUiA9IGFuT2JqZWN0KHRoaXMpOwoJCQkJCXJldHVybiAnLycuY29uY2F0KFIuc291cmNlLCAnLycsICdmbGFncycgaW4gUiA/IFIuZmxhZ3MgOiAhREVTQ1JJUFRPUlMgJiYgUiBpbnN0YW5jZW9mIFJlZ0V4cCA/ICRmbGFncy5jYWxsKFIpIDogdW5kZWZpbmVkKTsKCQkJCX0pOwoJCQkJLy8gRkY0NC0gUmVnRXhwI3RvU3RyaW5nIGhhcyBhIHdyb25nIG5hbWUKCQkJfSBlbHNlIGlmICgkdG9TdHJpbmcubmFtZSAhPSBUT19TVFJJTkcpIHsKCQkJCWRlZmluZShmdW5jdGlvbiB0b1N0cmluZygpIHsKCQkJCQlyZXR1cm4gJHRvU3RyaW5nLmNhbGwodGhpcyk7CgkJCQl9KTsKCQkJfQoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNjgyNToKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyIHN0cm9uZyA9IF9fd2VicGFja19yZXF1aXJlX18oOTcwOSk7CgkJCXZhciB2YWxpZGF0ZSA9IF9fd2VicGFja19yZXF1aXJlX18oNjgxMyk7CgkJCXZhciBTRVQgPSAnU2V0JzsKCi8vIDIzLjIgU2V0IE9iamVjdHMKCQkJbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk4OTMpKFNFVCwgZnVuY3Rpb24oZ2V0KSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24gU2V0KCkgewoJCQkJCXJldHVybiBnZXQodGhpcywgYXJndW1lbnRzLmxlbmd0aCA+IDAgPyBhcmd1bWVudHNbMF0gOiB1bmRlZmluZWQpOwoJCQkJfTsKCQkJfSwgewoJCQkJLy8gMjMuMi4zLjEgU2V0LnByb3RvdHlwZS5hZGQodmFsdWUpCgkJCQlhZGQ6IGZ1bmN0aW9uIGFkZCh2YWx1ZSkgewoJCQkJCXJldHVybiBzdHJvbmcuZGVmKHZhbGlkYXRlKHRoaXMsIFNFVCksIHZhbHVlID0gdmFsdWUgPT09IDAgPyAwIDogdmFsdWUsIHZhbHVlKTsKCQkJCX0KCQkJfSwgc3Ryb25nKTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDEzNjU6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKLy8gQi4yLjMuMiBTdHJpbmcucHJvdG90eXBlLmFuY2hvcihuYW1lKQoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQ3MzYpKCdhbmNob3InLCBmdW5jdGlvbihjcmVhdGVIVE1MKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24gYW5jaG9yKG5hbWUpIHsKCQkJCQlyZXR1cm4gY3JlYXRlSFRNTCh0aGlzLCAnYScsICduYW1lJywgbmFtZSk7CgkJCQl9OwoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDQ5OTM6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKLy8gQi4yLjMuMyBTdHJpbmcucHJvdG90eXBlLmJpZygpCgkJCV9fd2VicGFja19yZXF1aXJlX18oNDczNikoJ2JpZycsIGZ1bmN0aW9uKGNyZWF0ZUhUTUwpIHsKCQkJCXJldHVybiBmdW5jdGlvbiBiaWcoKSB7CgkJCQkJcmV0dXJuIGNyZWF0ZUhUTUwodGhpcywgJ2JpZycsICcnLCAnJyk7CgkJCQl9OwoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDY3OTE6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKLy8gQi4yLjMuNCBTdHJpbmcucHJvdG90eXBlLmJsaW5rKCkKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg0NzM2KSgnYmxpbmsnLCBmdW5jdGlvbihjcmVhdGVIVE1MKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24gYmxpbmsoKSB7CgkJCQkJcmV0dXJuIGNyZWF0ZUhUTUwodGhpcywgJ2JsaW5rJywgJycsICcnKTsKCQkJCX07CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNzk5NDoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyBCLjIuMy41IFN0cmluZy5wcm90b3R5cGUuYm9sZCgpCgkJCV9fd2VicGFja19yZXF1aXJlX18oNDczNikoJ2JvbGQnLCBmdW5jdGlvbihjcmVhdGVIVE1MKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24gYm9sZCgpIHsKCQkJCQlyZXR1cm4gY3JlYXRlSFRNTCh0aGlzLCAnYicsICcnLCAnJyk7CgkJCQl9OwoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDMyOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyICRhdCA9IF9fd2VicGFja19yZXF1aXJlX18oNzczMCkoZmFsc2UpOwoJCQkkZXhwb3J0KCRleHBvcnQuUCwgJ1N0cmluZycsIHsKCQkJCS8vIDIxLjEuMy4zIFN0cmluZy5wcm90b3R5cGUuY29kZVBvaW50QXQocG9zKQoJCQkJY29kZVBvaW50QXQ6IGZ1bmN0aW9uIGNvZGVQb2ludEF0KHBvcykgewoJCQkJCXJldHVybiAkYXQodGhpcywgcG9zKTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAyNjk4OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwovLyAyMS4xLjMuNiBTdHJpbmcucHJvdG90eXBlLmVuZHNXaXRoKHNlYXJjaFN0cmluZyBbLCBlbmRQb3NpdGlvbl0pCgoKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQl2YXIgdG9MZW5ndGggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUyMDEpOwoJCQl2YXIgY29udGV4dCA9IF9fd2VicGFja19yZXF1aXJlX18oMzE5NCk7CgkJCXZhciBFTkRTX1dJVEggPSAnZW5kc1dpdGgnOwoJCQl2YXIgJGVuZHNXaXRoID0gJydbRU5EU19XSVRIXTsKCQkJJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiBfX3dlYnBhY2tfcmVxdWlyZV9fKDk4NTcpKEVORFNfV0lUSCksICdTdHJpbmcnLCB7CgkJCQllbmRzV2l0aDogZnVuY3Rpb24gZW5kc1dpdGgoc2VhcmNoU3RyaW5nIC8qICwgZW5kUG9zaXRpb24gPSBAbGVuZ3RoICovKSB7CgkJCQkJdmFyIHRoYXQgPSBjb250ZXh0KHRoaXMsIHNlYXJjaFN0cmluZywgRU5EU19XSVRIKTsKCQkJCQl2YXIgZW5kUG9zaXRpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZDsKCQkJCQl2YXIgbGVuID0gdG9MZW5ndGgodGhhdC5sZW5ndGgpOwoJCQkJCXZhciBlbmQgPSBlbmRQb3NpdGlvbiA9PT0gdW5kZWZpbmVkID8gbGVuIDogTWF0aC5taW4odG9MZW5ndGgoZW5kUG9zaXRpb24pLCBsZW4pOwoJCQkJCXZhciBzZWFyY2ggPSBTdHJpbmcoc2VhcmNoU3RyaW5nKTsKCQkJCQlyZXR1cm4gJGVuZHNXaXRoID8gJGVuZHNXaXRoLmNhbGwodGhhdCwgc2VhcmNoLCBlbmQpIDogdGhhdC5zbGljZShlbmQgLSBzZWFyY2gubGVuZ3RoLCBlbmQpID09PSBzZWFyY2g7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gOTg0MToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyBCLjIuMy42IFN0cmluZy5wcm90b3R5cGUuZml4ZWQoKQoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQ3MzYpKCdmaXhlZCcsIGZ1bmN0aW9uKGNyZWF0ZUhUTUwpIHsKCQkJCXJldHVybiBmdW5jdGlvbiBmaXhlZCgpIHsKCQkJCQlyZXR1cm4gY3JlYXRlSFRNTCh0aGlzLCAndHQnLCAnJywgJycpOwoJCQkJfTsKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA4Mjg2OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCi8vIEIuMi4zLjcgU3RyaW5nLnByb3RvdHlwZS5mb250Y29sb3IoY29sb3IpCgkJCV9fd2VicGFja19yZXF1aXJlX18oNDczNikoJ2ZvbnRjb2xvcicsIGZ1bmN0aW9uKGNyZWF0ZUhUTUwpIHsKCQkJCXJldHVybiBmdW5jdGlvbiBmb250Y29sb3IoY29sb3IpIHsKCQkJCQlyZXR1cm4gY3JlYXRlSFRNTCh0aGlzLCAnZm9udCcsICdjb2xvcicsIGNvbG9yKTsKCQkJCX07CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gOTU3ODoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyBCLjIuMy44IFN0cmluZy5wcm90b3R5cGUuZm9udHNpemUoc2l6ZSkKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg0NzM2KSgnZm9udHNpemUnLCBmdW5jdGlvbihjcmVhdGVIVE1MKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24gZm9udHNpemUoc2l6ZSkgewoJCQkJCXJldHVybiBjcmVhdGVIVE1MKHRoaXMsICdmb250JywgJ3NpemUnLCBzaXplKTsKCQkJCX07CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMzQ1NjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIHRvQWJzb2x1dGVJbmRleCA9IF9fd2VicGFja19yZXF1aXJlX18oNzQ0Myk7CgkJCXZhciBmcm9tQ2hhckNvZGUgPSBTdHJpbmcuZnJvbUNoYXJDb2RlOwoJCQl2YXIgJGZyb21Db2RlUG9pbnQgPSBTdHJpbmcuZnJvbUNvZGVQb2ludDsKCi8vIGxlbmd0aCBzaG91bGQgYmUgMSwgb2xkIEZGIHByb2JsZW0KCQkJJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAoISEkZnJvbUNvZGVQb2ludCAmJiAkZnJvbUNvZGVQb2ludC5sZW5ndGggIT0gMSksICdTdHJpbmcnLCB7CgkJCQkvLyAyMS4xLjIuMiBTdHJpbmcuZnJvbUNvZGVQb2ludCguLi5jb2RlUG9pbnRzKQoJCQkJZnJvbUNvZGVQb2ludDogZnVuY3Rpb24gZnJvbUNvZGVQb2ludCh4KSB7CgkJCQkJLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bnVzZWQtdmFycwoJCQkJCXZhciByZXMgPSBbXTsKCQkJCQl2YXIgYUxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CgkJCQkJdmFyIGkgPSAwOwoJCQkJCXZhciBjb2RlOwoJCQkJCXdoaWxlIChhTGVuID4gaSkgewoJCQkJCQljb2RlID0gK2FyZ3VtZW50c1tpKytdOwoJCQkJCQlpZiAodG9BYnNvbHV0ZUluZGV4KGNvZGUsIDB4MTBmZmZmKSAhPT0gY29kZSkgdGhyb3cgUmFuZ2VFcnJvcihjb2RlICsgJyBpcyBub3QgYSB2YWxpZCBjb2RlIHBvaW50Jyk7CgkJCQkJCXJlcy5wdXNoKGNvZGUgPCAweDEwMDAwID8gZnJvbUNoYXJDb2RlKGNvZGUpIDogZnJvbUNoYXJDb2RlKCgoY29kZSAtPSAweDEwMDAwKSA+PiAxMCkgKyAweGQ4MDAsIGNvZGUgJSAweDQwMCArIDB4ZGMwMCkpOwoJCQkJCX0KCQkJCQlyZXR1cm4gcmVzLmpvaW4oJycpOwoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDk1NTQ6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7Ci8vIDIxLjEuMy43IFN0cmluZy5wcm90b3R5cGUuaW5jbHVkZXMoc2VhcmNoU3RyaW5nLCBwb3NpdGlvbiA9IDApCgoKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQl2YXIgY29udGV4dCA9IF9fd2VicGFja19yZXF1aXJlX18oMzE5NCk7CgkJCXZhciBJTkNMVURFUyA9ICdpbmNsdWRlcyc7CgkJCSRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogX193ZWJwYWNrX3JlcXVpcmVfXyg5ODU3KShJTkNMVURFUyksICdTdHJpbmcnLCB7CgkJCQlpbmNsdWRlczogZnVuY3Rpb24gaW5jbHVkZXMoc2VhcmNoU3RyaW5nIC8qICwgcG9zaXRpb24gPSAwICovKSB7CgkJCQkJcmV0dXJuICEhfmNvbnRleHQodGhpcywgc2VhcmNoU3RyaW5nLCBJTkNMVURFUykuaW5kZXhPZihzZWFyY2hTdHJpbmcsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA2NzA3OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCi8vIEIuMi4zLjkgU3RyaW5nLnByb3RvdHlwZS5pdGFsaWNzKCkKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg0NzM2KSgnaXRhbGljcycsIGZ1bmN0aW9uKGNyZWF0ZUhUTUwpIHsKCQkJCXJldHVybiBmdW5jdGlvbiBpdGFsaWNzKCkgewoJCQkJCXJldHVybiBjcmVhdGVIVE1MKHRoaXMsICdpJywgJycsICcnKTsKCQkJCX07CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gOTQ4MjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgoJCQl2YXIgJGF0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NzMwKSh0cnVlKTsKCi8vIDIxLjEuMy4yNyBTdHJpbmcucHJvdG90eXBlW0BAaXRlcmF0b3JdKCkKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg4OTE1KShTdHJpbmcsICdTdHJpbmcnLCBmdW5jdGlvbihpdGVyYXRlZCkgewoJCQkJdGhpcy5fdCA9IFN0cmluZyhpdGVyYXRlZCk7IC8vIHRhcmdldAoJCQkJdGhpcy5faSA9IDA7IC8vIG5leHQgaW5kZXgKCQkJCS8vIDIxLjEuNS4yLjEgJVN0cmluZ0l0ZXJhdG9yUHJvdG90eXBlJS5uZXh0KCkKCQkJfSwgZnVuY3Rpb24oKSB7CgkJCQl2YXIgTyA9IHRoaXMuX3Q7CgkJCQl2YXIgaW5kZXggPSB0aGlzLl9pOwoJCQkJdmFyIHBvaW50OwoJCQkJaWYgKGluZGV4ID49IE8ubGVuZ3RoKSByZXR1cm4gewoJCQkJCXZhbHVlOiB1bmRlZmluZWQsCgkJCQkJZG9uZTogdHJ1ZQoJCQkJfTsKCQkJCXBvaW50ID0gJGF0KE8sIGluZGV4KTsKCQkJCXRoaXMuX2kgKz0gcG9pbnQubGVuZ3RoOwoJCQkJcmV0dXJuIHsKCQkJCQl2YWx1ZTogcG9pbnQsCgkJCQkJZG9uZTogZmFsc2UKCQkJCX07CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNzk0MToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyBCLjIuMy4xMCBTdHJpbmcucHJvdG90eXBlLmxpbmsodXJsKQoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQ3MzYpKCdsaW5rJywgZnVuY3Rpb24oY3JlYXRlSFRNTCkgewoJCQkJcmV0dXJuIGZ1bmN0aW9uIGxpbmsodXJsKSB7CgkJCQkJcmV0dXJuIGNyZWF0ZUhUTUwodGhpcywgJ2EnLCAnaHJlZicsIHVybCk7CgkJCQl9OwoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDgxNzM6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciB0b0lPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDEzMDkpOwoJCQl2YXIgdG9MZW5ndGggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUyMDEpOwoJCQkkZXhwb3J0KCRleHBvcnQuUywgJ1N0cmluZycsIHsKCQkJCS8vIDIxLjEuMi40IFN0cmluZy5yYXcoY2FsbFNpdGUsIC4uLnN1YnN0aXR1dGlvbnMpCgkJCQlyYXc6IGZ1bmN0aW9uIHJhdyhjYWxsU2l0ZSkgewoJCQkJCXZhciB0cGwgPSB0b0lPYmplY3QoY2FsbFNpdGUucmF3KTsKCQkJCQl2YXIgbGVuID0gdG9MZW5ndGgodHBsLmxlbmd0aCk7CgkJCQkJdmFyIGFMZW4gPSBhcmd1bWVudHMubGVuZ3RoOwoJCQkJCXZhciByZXMgPSBbXTsKCQkJCQl2YXIgaSA9IDA7CgkJCQkJd2hpbGUgKGxlbiA+IGkpIHsKCQkJCQkJcmVzLnB1c2goU3RyaW5nKHRwbFtpKytdKSk7CgkJCQkJCWlmIChpIDwgYUxlbikgcmVzLnB1c2goU3RyaW5nKGFyZ3VtZW50c1tpXSkpOwoJCQkJCX0KCQkJCQlyZXR1cm4gcmVzLmpvaW4oJycpOwoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDE2NTg6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCSRleHBvcnQoJGV4cG9ydC5QLCAnU3RyaW5nJywgewoJCQkJLy8gMjEuMS4zLjEzIFN0cmluZy5wcm90b3R5cGUucmVwZWF0KGNvdW50KQoJCQkJcmVwZWF0OiBfX3dlYnBhY2tfcmVxdWlyZV9fKDYyNzQpCgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMjY5NzoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyBCLjIuMy4xMSBTdHJpbmcucHJvdG90eXBlLnNtYWxsKCkKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg0NzM2KSgnc21hbGwnLCBmdW5jdGlvbihjcmVhdGVIVE1MKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24gc21hbGwoKSB7CgkJCQkJcmV0dXJuIGNyZWF0ZUhUTUwodGhpcywgJ3NtYWxsJywgJycsICcnKTsKCQkJCX07CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNTI5ODoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKLy8gMjEuMS4zLjE4IFN0cmluZy5wcm90b3R5cGUuc3RhcnRzV2l0aChzZWFyY2hTdHJpbmcgWywgcG9zaXRpb24gXSkKCgoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciB0b0xlbmd0aCA9IF9fd2VicGFja19yZXF1aXJlX18oNTIwMSk7CgkJCXZhciBjb250ZXh0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMTk0KTsKCQkJdmFyIFNUQVJUU19XSVRIID0gJ3N0YXJ0c1dpdGgnOwoJCQl2YXIgJHN0YXJ0c1dpdGggPSAnJ1tTVEFSVFNfV0lUSF07CgkJCSRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogX193ZWJwYWNrX3JlcXVpcmVfXyg5ODU3KShTVEFSVFNfV0lUSCksICdTdHJpbmcnLCB7CgkJCQlzdGFydHNXaXRoOiBmdW5jdGlvbiBzdGFydHNXaXRoKHNlYXJjaFN0cmluZyAvKiAsIHBvc2l0aW9uID0gMCAqLykgewoJCQkJCXZhciB0aGF0ID0gY29udGV4dCh0aGlzLCBzZWFyY2hTdHJpbmcsIFNUQVJUU19XSVRIKTsKCQkJCQl2YXIgaW5kZXggPSB0b0xlbmd0aChNYXRoLm1pbihhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCwgdGhhdC5sZW5ndGgpKTsKCQkJCQl2YXIgc2VhcmNoID0gU3RyaW5nKHNlYXJjaFN0cmluZyk7CgkJCQkJcmV0dXJuICRzdGFydHNXaXRoID8gJHN0YXJ0c1dpdGguY2FsbCh0aGF0LCBzZWFyY2gsIGluZGV4KSA6IHRoYXQuc2xpY2UoaW5kZXgsIGluZGV4ICsgc2VhcmNoLmxlbmd0aCkgPT09IHNlYXJjaDsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAzMzM0OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCi8vIEIuMi4zLjEyIFN0cmluZy5wcm90b3R5cGUuc3RyaWtlKCkKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg0NzM2KSgnc3RyaWtlJywgZnVuY3Rpb24oY3JlYXRlSFRNTCkgewoJCQkJcmV0dXJuIGZ1bmN0aW9uIHN0cmlrZSgpIHsKCQkJCQlyZXR1cm4gY3JlYXRlSFRNTCh0aGlzLCAnc3RyaWtlJywgJycsICcnKTsKCQkJCX07CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gOTI2NjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyBCLjIuMy4xMyBTdHJpbmcucHJvdG90eXBlLnN1YigpCgkJCV9fd2VicGFja19yZXF1aXJlX18oNDczNikoJ3N1YicsIGZ1bmN0aW9uKGNyZWF0ZUhUTUwpIHsKCQkJCXJldHVybiBmdW5jdGlvbiBzdWIoKSB7CgkJCQkJcmV0dXJuIGNyZWF0ZUhUTUwodGhpcywgJ3N1YicsICcnLCAnJyk7CgkJCQl9OwoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDQ2NzU6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKLy8gQi4yLjMuMTQgU3RyaW5nLnByb3RvdHlwZS5zdXAoKQoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQ3MzYpKCdzdXAnLCBmdW5jdGlvbihjcmVhdGVIVE1MKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24gc3VwKCkgewoJCQkJCXJldHVybiBjcmVhdGVIVE1MKHRoaXMsICdzdXAnLCAnJywgJycpOwoJCQkJfTsKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA2NzAxOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCi8vIDIxLjEuMy4yNSBTdHJpbmcucHJvdG90eXBlLnRyaW0oKQoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDUzNTYpKCd0cmltJywgZnVuY3Rpb24oJHRyaW0pIHsKCQkJCXJldHVybiBmdW5jdGlvbiB0cmltKCkgewoJCQkJCXJldHVybiAkdHJpbSh0aGlzLCAzKTsKCQkJCX07CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNDA4NjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyBFQ01BU2NyaXB0IDYgc3ltYm9scyBzaGltCgkJCWZ1bmN0aW9uIF90eXBlb2YobykgewoJCQkJJ0BiYWJlbC9oZWxwZXJzIC0gdHlwZW9mJzsKCQkJCXJldHVybiBfdHlwZW9mID0gJ2Z1bmN0aW9uJyA9PSB0eXBlb2YgU3ltYm9sICYmICdzeW1ib2wnID09IHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPyBmdW5jdGlvbihvKSB7CgkJCQkJcmV0dXJuIHR5cGVvZiBvOwoJCQkJfSA6IGZ1bmN0aW9uKG8pIHsKCQkJCQlyZXR1cm4gbyAmJiAnZnVuY3Rpb24nID09IHR5cGVvZiBTeW1ib2wgJiYgby5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG8gIT09IFN5bWJvbC5wcm90b3R5cGUgPyAnc3ltYm9sJyA6IHR5cGVvZiBvOwoJCQkJfSwgX3R5cGVvZihvKTsKCQkJfQoKCQkJdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oOTc2OSk7CgkJCXZhciBoYXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ5OTcpOwoJCQl2YXIgREVTQ1JJUFRPUlMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUxOTQpOwoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciByZWRlZmluZSA9IF9fd2VicGFja19yZXF1aXJlX18oODkxNCk7CgkJCXZhciBNRVRBID0gKF9fd2VicGFja19yZXF1aXJlX18oMjM2OSkuS0VZKTsKCQkJdmFyICRmYWlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMTI4KTsKCQkJdmFyIHNoYXJlZCA9IF9fd2VicGFja19yZXF1aXJlX18oNzQwKTsKCQkJdmFyIHNldFRvU3RyaW5nVGFnID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MzIxKTsKCQkJdmFyIHVpZCA9IF9fd2VicGFja19yZXF1aXJlX18oNjE3KTsKCQkJdmFyIHdrcyA9IF9fd2VicGFja19yZXF1aXJlX18oMjg2Nyk7CgkJCXZhciB3a3NFeHQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM4NzMpOwoJCQl2YXIgd2tzRGVmaW5lID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0NTg0KTsKCQkJdmFyIGVudW1LZXlzID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNDEwKTsKCQkJdmFyIGlzQXJyYXkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1MDIpOwoJCQl2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYxNjYpOwoJCQl2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2ODYpOwoJCQl2YXIgdG9PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ4MjApOwoJCQl2YXIgdG9JT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMzA5KTsKCQkJdmFyIHRvUHJpbWl0aXZlID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNDQwKTsKCQkJdmFyIGNyZWF0ZURlc2MgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDcyMyk7CgkJCXZhciBfY3JlYXRlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MTQyKTsKCQkJdmFyIGdPUE5FeHQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc2NDMpOwoJCQl2YXIgJEdPUEQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgwOTYpOwoJCQl2YXIgJEdPUFMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU5NDQpOwoJCQl2YXIgJERQID0gX193ZWJwYWNrX3JlcXVpcmVfXygxNTE1KTsKCQkJdmFyICRrZXlzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2NDM2KTsKCQkJdmFyIGdPUEQgPSAkR09QRC5mOwoJCQl2YXIgZFAgPSAkRFAuZjsKCQkJdmFyIGdPUE4gPSBnT1BORXh0LmY7CgkJCXZhciAkU3ltYm9sID0gZ2xvYmFsLlN5bWJvbDsKCQkJdmFyICRKU09OID0gZ2xvYmFsLkpTT047CgkJCXZhciBfc3RyaW5naWZ5ID0gJEpTT04gJiYgJEpTT04uc3RyaW5naWZ5OwoJCQl2YXIgUFJPVE9UWVBFID0gJ3Byb3RvdHlwZSc7CgkJCXZhciBISURERU4gPSB3a3MoJ19oaWRkZW4nKTsKCQkJdmFyIFRPX1BSSU1JVElWRSA9IHdrcygndG9QcmltaXRpdmUnKTsKCQkJdmFyIGlzRW51bSA9IHt9LnByb3BlcnR5SXNFbnVtZXJhYmxlOwoJCQl2YXIgU3ltYm9sUmVnaXN0cnkgPSBzaGFyZWQoJ3N5bWJvbC1yZWdpc3RyeScpOwoJCQl2YXIgQWxsU3ltYm9scyA9IHNoYXJlZCgnc3ltYm9scycpOwoJCQl2YXIgT1BTeW1ib2xzID0gc2hhcmVkKCdvcC1zeW1ib2xzJyk7CgkJCXZhciBPYmplY3RQcm90byA9IE9iamVjdFtQUk9UT1RZUEVdOwoJCQl2YXIgVVNFX05BVElWRSA9IHR5cGVvZiAkU3ltYm9sID09ICdmdW5jdGlvbicgJiYgISEkR09QUy5mOwoJCQl2YXIgUU9iamVjdCA9IGdsb2JhbC5RT2JqZWN0OwovLyBEb24ndCB1c2Ugc2V0dGVycyBpbiBRdCBTY3JpcHQsIGh0dHBzOi8vZ2l0aHViLmNvbS96bG9pcm9jay9jb3JlLWpzL2lzc3Vlcy8xNzMKCQkJdmFyIHNldHRlciA9ICFRT2JqZWN0IHx8ICFRT2JqZWN0W1BST1RPVFlQRV0gfHwgIVFPYmplY3RbUFJPVE9UWVBFXS5maW5kQ2hpbGQ7CgovLyBmYWxsYmFjayBmb3Igb2xkIEFuZHJvaWQsIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvdjgvaXNzdWVzL2RldGFpbD9pZD02ODcKCQkJdmFyIHNldFN5bWJvbERlc2MgPSBERVNDUklQVE9SUyAmJiAkZmFpbHMoZnVuY3Rpb24oKSB7CgkJCQlyZXR1cm4gX2NyZWF0ZShkUCh7fSwgJ2EnLCB7CgkJCQkJZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CgkJCQkJCXJldHVybiBkUCh0aGlzLCAnYScsIHsKCQkJCQkJCXZhbHVlOiA3CgkJCQkJCX0pLmE7CgkJCQkJfQoJCQkJfSkpLmEgIT0gNzsKCQkJfSkgPyBmdW5jdGlvbihpdCwga2V5LCBEKSB7CgkJCQl2YXIgcHJvdG9EZXNjID0gZ09QRChPYmplY3RQcm90bywga2V5KTsKCQkJCWlmIChwcm90b0Rlc2MpIGRlbGV0ZSBPYmplY3RQcm90b1trZXldOwoJCQkJZFAoaXQsIGtleSwgRCk7CgkJCQlpZiAocHJvdG9EZXNjICYmIGl0ICE9PSBPYmplY3RQcm90bykgZFAoT2JqZWN0UHJvdG8sIGtleSwgcHJvdG9EZXNjKTsKCQkJfSA6IGRQOwoJCQl2YXIgd3JhcCA9IGZ1bmN0aW9uIHdyYXAodGFnKSB7CgkJCQl2YXIgc3ltID0gQWxsU3ltYm9sc1t0YWddID0gX2NyZWF0ZSgkU3ltYm9sW1BST1RPVFlQRV0pOwoJCQkJc3ltLl9rID0gdGFnOwoJCQkJcmV0dXJuIHN5bTsKCQkJfTsKCQkJdmFyIGlzU3ltYm9sID0gVVNFX05BVElWRSAmJiBfdHlwZW9mKCRTeW1ib2wuaXRlcmF0b3IpID09ICdzeW1ib2wnID8gZnVuY3Rpb24oaXQpIHsKCQkJCXJldHVybiBfdHlwZW9mKGl0KSA9PSAnc3ltYm9sJzsKCQkJfSA6IGZ1bmN0aW9uKGl0KSB7CgkJCQlyZXR1cm4gaXQgaW5zdGFuY2VvZiAkU3ltYm9sOwoJCQl9OwoJCQl2YXIgJGRlZmluZVByb3BlcnR5ID0gZnVuY3Rpb24gZGVmaW5lUHJvcGVydHkoaXQsIGtleSwgRCkgewoJCQkJaWYgKGl0ID09PSBPYmplY3RQcm90bykgJGRlZmluZVByb3BlcnR5KE9QU3ltYm9scywga2V5LCBEKTsKCQkJCWFuT2JqZWN0KGl0KTsKCQkJCWtleSA9IHRvUHJpbWl0aXZlKGtleSwgdHJ1ZSk7CgkJCQlhbk9iamVjdChEKTsKCQkJCWlmIChoYXMoQWxsU3ltYm9scywga2V5KSkgewoJCQkJCWlmICghRC5lbnVtZXJhYmxlKSB7CgkJCQkJCWlmICghaGFzKGl0LCBISURERU4pKSBkUChpdCwgSElEREVOLCBjcmVhdGVEZXNjKDEsIHt9KSk7CgkJCQkJCWl0W0hJRERFTl1ba2V5XSA9IHRydWU7CgkJCQkJfSBlbHNlIHsKCQkJCQkJaWYgKGhhcyhpdCwgSElEREVOKSAmJiBpdFtISURERU5dW2tleV0pIGl0W0hJRERFTl1ba2V5XSA9IGZhbHNlOwoJCQkJCQlEID0gX2NyZWF0ZShELCB7CgkJCQkJCQllbnVtZXJhYmxlOiBjcmVhdGVEZXNjKDAsIGZhbHNlKQoJCQkJCQl9KTsKCQkJCQl9CgkJCQkJcmV0dXJuIHNldFN5bWJvbERlc2MoaXQsIGtleSwgRCk7CgkJCQl9CgkJCQlyZXR1cm4gZFAoaXQsIGtleSwgRCk7CgkJCX07CgkJCXZhciAkZGVmaW5lUHJvcGVydGllcyA9IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXMoaXQsIFApIHsKCQkJCWFuT2JqZWN0KGl0KTsKCQkJCXZhciBrZXlzID0gZW51bUtleXMoUCA9IHRvSU9iamVjdChQKSk7CgkJCQl2YXIgaSA9IDA7CgkJCQl2YXIgbCA9IGtleXMubGVuZ3RoOwoJCQkJdmFyIGtleTsKCQkJCXdoaWxlIChsID4gaSkgJGRlZmluZVByb3BlcnR5KGl0LCBrZXkgPSBrZXlzW2krK10sIFBba2V5XSk7CgkJCQlyZXR1cm4gaXQ7CgkJCX07CgkJCXZhciAkY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlKGl0LCBQKSB7CgkJCQlyZXR1cm4gUCA9PT0gdW5kZWZpbmVkID8gX2NyZWF0ZShpdCkgOiAkZGVmaW5lUHJvcGVydGllcyhfY3JlYXRlKGl0KSwgUCk7CgkJCX07CgkJCXZhciAkcHJvcGVydHlJc0VudW1lcmFibGUgPSBmdW5jdGlvbiBwcm9wZXJ0eUlzRW51bWVyYWJsZShrZXkpIHsKCQkJCXZhciBFID0gaXNFbnVtLmNhbGwodGhpcywga2V5ID0gdG9QcmltaXRpdmUoa2V5LCB0cnVlKSk7CgkJCQlpZiAodGhpcyA9PT0gT2JqZWN0UHJvdG8gJiYgaGFzKEFsbFN5bWJvbHMsIGtleSkgJiYgIWhhcyhPUFN5bWJvbHMsIGtleSkpIHJldHVybiBmYWxzZTsKCQkJCXJldHVybiBFIHx8ICFoYXModGhpcywga2V5KSB8fCAhaGFzKEFsbFN5bWJvbHMsIGtleSkgfHwgaGFzKHRoaXMsIEhJRERFTikgJiYgdGhpc1tISURERU5dW2tleV0gPyBFIDogdHJ1ZTsKCQkJfTsKCQkJdmFyICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoaXQsIGtleSkgewoJCQkJaXQgPSB0b0lPYmplY3QoaXQpOwoJCQkJa2V5ID0gdG9QcmltaXRpdmUoa2V5LCB0cnVlKTsKCQkJCWlmIChpdCA9PT0gT2JqZWN0UHJvdG8gJiYgaGFzKEFsbFN5bWJvbHMsIGtleSkgJiYgIWhhcyhPUFN5bWJvbHMsIGtleSkpIHJldHVybjsKCQkJCXZhciBEID0gZ09QRChpdCwga2V5KTsKCQkJCWlmIChEICYmIGhhcyhBbGxTeW1ib2xzLCBrZXkpICYmICEoaGFzKGl0LCBISURERU4pICYmIGl0W0hJRERFTl1ba2V5XSkpIEQuZW51bWVyYWJsZSA9IHRydWU7CgkJCQlyZXR1cm4gRDsKCQkJfTsKCQkJdmFyICRnZXRPd25Qcm9wZXJ0eU5hbWVzID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlOYW1lcyhpdCkgewoJCQkJdmFyIG5hbWVzID0gZ09QTih0b0lPYmplY3QoaXQpKTsKCQkJCXZhciByZXN1bHQgPSBbXTsKCQkJCXZhciBpID0gMDsKCQkJCXZhciBrZXk7CgkJCQl3aGlsZSAobmFtZXMubGVuZ3RoID4gaSkgewoJCQkJCWlmICghaGFzKEFsbFN5bWJvbHMsIGtleSA9IG5hbWVzW2krK10pICYmIGtleSAhPSBISURERU4gJiYga2V5ICE9IE1FVEEpIHJlc3VsdC5wdXNoKGtleSk7CgkJCQl9CgkJCQlyZXR1cm4gcmVzdWx0OwoJCQl9OwoJCQl2YXIgJGdldE93blByb3BlcnR5U3ltYm9scyA9IGZ1bmN0aW9uIGdldE93blByb3BlcnR5U3ltYm9scyhpdCkgewoJCQkJdmFyIElTX09QID0gaXQgPT09IE9iamVjdFByb3RvOwoJCQkJdmFyIG5hbWVzID0gZ09QTihJU19PUCA/IE9QU3ltYm9scyA6IHRvSU9iamVjdChpdCkpOwoJCQkJdmFyIHJlc3VsdCA9IFtdOwoJCQkJdmFyIGkgPSAwOwoJCQkJdmFyIGtleTsKCQkJCXdoaWxlIChuYW1lcy5sZW5ndGggPiBpKSB7CgkJCQkJaWYgKGhhcyhBbGxTeW1ib2xzLCBrZXkgPSBuYW1lc1tpKytdKSAmJiAoSVNfT1AgPyBoYXMoT2JqZWN0UHJvdG8sIGtleSkgOiB0cnVlKSkgcmVzdWx0LnB1c2goQWxsU3ltYm9sc1trZXldKTsKCQkJCX0KCQkJCXJldHVybiByZXN1bHQ7CgkJCX07CgovLyAxOS40LjEuMSBTeW1ib2woW2Rlc2NyaXB0aW9uXSkKCQkJaWYgKCFVU0VfTkFUSVZFKSB7CgkJCQkkU3ltYm9sID0gZnVuY3Rpb24gX1N5bWJvbCgpIHsKCQkJCQlpZiAodGhpcyBpbnN0YW5jZW9mICRTeW1ib2wpIHRocm93IFR5cGVFcnJvcignU3ltYm9sIGlzIG5vdCBhIGNvbnN0cnVjdG9yIScpOwoJCQkJCXZhciB0YWcgPSB1aWQoYXJndW1lbnRzLmxlbmd0aCA+IDAgPyBhcmd1bWVudHNbMF0gOiB1bmRlZmluZWQpOwoJCQkJCXZhciAkc2V0ID0gZnVuY3Rpb24gJHNldCh2YWx1ZSkgewoJCQkJCQlpZiAodGhpcyA9PT0gT2JqZWN0UHJvdG8pICRzZXQuY2FsbChPUFN5bWJvbHMsIHZhbHVlKTsKCQkJCQkJaWYgKGhhcyh0aGlzLCBISURERU4pICYmIGhhcyh0aGlzW0hJRERFTl0sIHRhZykpIHRoaXNbSElEREVOXVt0YWddID0gZmFsc2U7CgkJCQkJCXNldFN5bWJvbERlc2ModGhpcywgdGFnLCBjcmVhdGVEZXNjKDEsIHZhbHVlKSk7CgkJCQkJfTsKCQkJCQlpZiAoREVTQ1JJUFRPUlMgJiYgc2V0dGVyKSBzZXRTeW1ib2xEZXNjKE9iamVjdFByb3RvLCB0YWcsIHsKCQkJCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCQkJCQlzZXQ6ICRzZXQKCQkJCQl9KTsKCQkJCQlyZXR1cm4gd3JhcCh0YWcpOwoJCQkJfTsKCQkJCXJlZGVmaW5lKCRTeW1ib2xbUFJPVE9UWVBFXSwgJ3RvU3RyaW5nJywgZnVuY3Rpb24gdG9TdHJpbmcoKSB7CgkJCQkJcmV0dXJuIHRoaXMuX2s7CgkJCQl9KTsKCQkJCSRHT1BELmYgPSAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOwoJCQkJJERQLmYgPSAkZGVmaW5lUHJvcGVydHk7CgkJCQkoX193ZWJwYWNrX3JlcXVpcmVfXyg4NDgyKS5mKSA9IGdPUE5FeHQuZiA9ICRnZXRPd25Qcm9wZXJ0eU5hbWVzOwoJCQkJKF9fd2VicGFja19yZXF1aXJlX18oMjI3MSkuZikgPSAkcHJvcGVydHlJc0VudW1lcmFibGU7CgkJCQkkR09QUy5mID0gJGdldE93blByb3BlcnR5U3ltYm9sczsKCQkJCWlmIChERVNDUklQVE9SUyAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXyg2NTY3KSkgewoJCQkJCXJlZGVmaW5lKE9iamVjdFByb3RvLCAncHJvcGVydHlJc0VudW1lcmFibGUnLCAkcHJvcGVydHlJc0VudW1lcmFibGUsIHRydWUpOwoJCQkJfQoJCQkJd2tzRXh0LmYgPSBmdW5jdGlvbihuYW1lKSB7CgkJCQkJcmV0dXJuIHdyYXAod2tzKG5hbWUpKTsKCQkJCX07CgkJCX0KCQkJJGV4cG9ydCgkZXhwb3J0LkcgKyAkZXhwb3J0LlcgKyAkZXhwb3J0LkYgKiAhVVNFX05BVElWRSwgewoJCQkJU3ltYm9sOiAkU3ltYm9sCgkJCX0pOwoJCQlmb3IgKHZhciBlczZTeW1ib2xzID0KCQkJCS8vIDE5LjQuMi4yLCAxOS40LjIuMywgMTkuNC4yLjQsIDE5LjQuMi42LCAxOS40LjIuOCwgMTkuNC4yLjksIDE5LjQuMi4xMCwgMTkuNC4yLjExLCAxOS40LjIuMTIsIDE5LjQuMi4xMywgMTkuNC4yLjE0CgkJCQknaGFzSW5zdGFuY2UsaXNDb25jYXRTcHJlYWRhYmxlLGl0ZXJhdG9yLG1hdGNoLHJlcGxhY2Usc2VhcmNoLHNwZWNpZXMsc3BsaXQsdG9QcmltaXRpdmUsdG9TdHJpbmdUYWcsdW5zY29wYWJsZXMnLnNwbGl0KCcsJyksIGogPSAwOyBlczZTeW1ib2xzLmxlbmd0aCA+IGo7KSB3a3MoZXM2U3ltYm9sc1tqKytdKTsKCQkJZm9yICh2YXIgd2VsbEtub3duU3ltYm9scyA9ICRrZXlzKHdrcy5zdG9yZSksIGsgPSAwOyB3ZWxsS25vd25TeW1ib2xzLmxlbmd0aCA+IGs7KSB3a3NEZWZpbmUod2VsbEtub3duU3ltYm9sc1trKytdKTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhVVNFX05BVElWRSwgJ1N5bWJvbCcsIHsKCQkJCS8vIDE5LjQuMi4xIFN5bWJvbC5mb3Ioa2V5KQoJCQkJJ2Zvcic6IGZ1bmN0aW9uIF9mb3Ioa2V5KSB7CgkJCQkJcmV0dXJuIGhhcyhTeW1ib2xSZWdpc3RyeSwga2V5ICs9ICcnKSA/IFN5bWJvbFJlZ2lzdHJ5W2tleV0gOiBTeW1ib2xSZWdpc3RyeVtrZXldID0gJFN5bWJvbChrZXkpOwoJCQkJfSwKCQkJCS8vIDE5LjQuMi41IFN5bWJvbC5rZXlGb3Ioc3ltKQoJCQkJa2V5Rm9yOiBmdW5jdGlvbiBrZXlGb3Ioc3ltKSB7CgkJCQkJaWYgKCFpc1N5bWJvbChzeW0pKSB0aHJvdyBUeXBlRXJyb3Ioc3ltICsgJyBpcyBub3QgYSBzeW1ib2whJyk7CgkJCQkJZm9yICh2YXIga2V5IGluIFN5bWJvbFJlZ2lzdHJ5KSBpZiAoU3ltYm9sUmVnaXN0cnlba2V5XSA9PT0gc3ltKSByZXR1cm4ga2V5OwoJCQkJfSwKCQkJCXVzZVNldHRlcjogZnVuY3Rpb24gdXNlU2V0dGVyKCkgewoJCQkJCXNldHRlciA9IHRydWU7CgkJCQl9LAoJCQkJdXNlU2ltcGxlOiBmdW5jdGlvbiB1c2VTaW1wbGUoKSB7CgkJCQkJc2V0dGVyID0gZmFsc2U7CgkJCQl9CgkJCX0pOwoJCQkkZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICFVU0VfTkFUSVZFLCAnT2JqZWN0JywgewoJCQkJLy8gMTkuMS4yLjIgT2JqZWN0LmNyZWF0ZShPIFssIFByb3BlcnRpZXNdKQoJCQkJY3JlYXRlOiAkY3JlYXRlLAoJCQkJLy8gMTkuMS4yLjQgT2JqZWN0LmRlZmluZVByb3BlcnR5KE8sIFAsIEF0dHJpYnV0ZXMpCgkJCQlkZWZpbmVQcm9wZXJ0eTogJGRlZmluZVByb3BlcnR5LAoJCQkJLy8gMTkuMS4yLjMgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoTywgUHJvcGVydGllcykKCQkJCWRlZmluZVByb3BlcnRpZXM6ICRkZWZpbmVQcm9wZXJ0aWVzLAoJCQkJLy8gMTkuMS4yLjYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihPLCBQKQoJCQkJZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOiAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLAoJCQkJLy8gMTkuMS4yLjcgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoTykKCQkJCWdldE93blByb3BlcnR5TmFtZXM6ICRnZXRPd25Qcm9wZXJ0eU5hbWVzLAoJCQkJLy8gMTkuMS4yLjggT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhPKQoJCQkJZ2V0T3duUHJvcGVydHlTeW1ib2xzOiAkZ2V0T3duUHJvcGVydHlTeW1ib2xzCgkJCX0pOwoKLy8gQ2hyb21lIDM4IGFuZCAzOSBgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9sc2AgZmFpbHMgb24gcHJpbWl0aXZlcwovLyBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvdjgvaXNzdWVzL2RldGFpbD9pZD0zNDQzCgkJCXZhciBGQUlMU19PTl9QUklNSVRJVkVTID0gJGZhaWxzKGZ1bmN0aW9uKCkgewoJCQkJJEdPUFMuZigxKTsKCQkJfSk7CgkJCSRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogRkFJTFNfT05fUFJJTUlUSVZFUywgJ09iamVjdCcsIHsKCQkJCWdldE93blByb3BlcnR5U3ltYm9sczogZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlTeW1ib2xzKGl0KSB7CgkJCQkJcmV0dXJuICRHT1BTLmYodG9PYmplY3QoaXQpKTsKCQkJCX0KCQkJfSk7CgovLyAyNC4zLjIgSlNPTi5zdHJpbmdpZnkodmFsdWUgWywgcmVwbGFjZXIgWywgc3BhY2VdXSkKCQkJJEpTT04gJiYgJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAoIVVTRV9OQVRJVkUgfHwgJGZhaWxzKGZ1bmN0aW9uKCkgewoJCQkJdmFyIFMgPSAkU3ltYm9sKCk7CgkJCQkvLyBNUyBFZGdlIGNvbnZlcnRzIHN5bWJvbCB2YWx1ZXMgdG8gSlNPTiBhcyB7fQoJCQkJLy8gV2ViS2l0IGNvbnZlcnRzIHN5bWJvbCB2YWx1ZXMgdG8gSlNPTiBhcyBudWxsCgkJCQkvLyBWOCB0aHJvd3Mgb24gYm94ZWQgc3ltYm9scwoJCQkJcmV0dXJuIF9zdHJpbmdpZnkoW1NdKSAhPSAnW251bGxdJyB8fCBfc3RyaW5naWZ5KHsKCQkJCQlhOiBTCgkJCQl9KSAhPSAne30nIHx8IF9zdHJpbmdpZnkoT2JqZWN0KFMpKSAhPSAne30nOwoJCQl9KSksICdKU09OJywgewoJCQkJc3RyaW5naWZ5OiBmdW5jdGlvbiBzdHJpbmdpZnkoaXQpIHsKCQkJCQl2YXIgYXJncyA9IFtpdF07CgkJCQkJdmFyIGkgPSAxOwoJCQkJCXZhciByZXBsYWNlciwgJHJlcGxhY2VyOwoJCQkJCXdoaWxlIChhcmd1bWVudHMubGVuZ3RoID4gaSkgYXJncy5wdXNoKGFyZ3VtZW50c1tpKytdKTsKCQkJCQkkcmVwbGFjZXIgPSByZXBsYWNlciA9IGFyZ3NbMV07CgkJCQkJaWYgKCFpc09iamVjdChyZXBsYWNlcikgJiYgaXQgPT09IHVuZGVmaW5lZCB8fCBpc1N5bWJvbChpdCkpIHJldHVybjsgLy8gSUU4IHJldHVybnMgc3RyaW5nIG9uIHVuZGVmaW5lZAoJCQkJCWlmICghaXNBcnJheShyZXBsYWNlcikpIHJlcGxhY2VyID0gZnVuY3Rpb24gcmVwbGFjZXIoa2V5LCB2YWx1ZSkgewoJCQkJCQlpZiAodHlwZW9mICRyZXBsYWNlciA9PSAnZnVuY3Rpb24nKSB2YWx1ZSA9ICRyZXBsYWNlci5jYWxsKHRoaXMsIGtleSwgdmFsdWUpOwoJCQkJCQlpZiAoIWlzU3ltYm9sKHZhbHVlKSkgcmV0dXJuIHZhbHVlOwoJCQkJCX07CgkJCQkJYXJnc1sxXSA9IHJlcGxhY2VyOwoJCQkJCXJldHVybiBfc3RyaW5naWZ5LmFwcGx5KCRKU09OLCBhcmdzKTsKCQkJCX0KCQkJfSk7CgovLyAxOS40LjMuNCBTeW1ib2wucHJvdG90eXBlW0BAdG9QcmltaXRpdmVdKGhpbnQpCgkJCSRTeW1ib2xbUFJPVE9UWVBFXVtUT19QUklNSVRJVkVdIHx8IF9fd2VicGFja19yZXF1aXJlX18oOTAzNikoJFN5bWJvbFtQUk9UT1RZUEVdLCBUT19QUklNSVRJVkUsICRTeW1ib2xbUFJPVE9UWVBFXS52YWx1ZU9mKTsKLy8gMTkuNC4zLjUgU3ltYm9sLnByb3RvdHlwZVtAQHRvU3RyaW5nVGFnXQoJCQlzZXRUb1N0cmluZ1RhZygkU3ltYm9sLCAnU3ltYm9sJyk7Ci8vIDIwLjIuMS45IE1hdGhbQEB0b1N0cmluZ1RhZ10KCQkJc2V0VG9TdHJpbmdUYWcoTWF0aCwgJ01hdGgnLCB0cnVlKTsKLy8gMjQuMy4zIEpTT05bQEB0b1N0cmluZ1RhZ10KCQkJc2V0VG9TdHJpbmdUYWcoZ2xvYmFsLkpTT04sICdKU09OJywgdHJ1ZSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA4MTk3OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyICR0eXBlZCA9IF9fd2VicGFja19yZXF1aXJlX18oNjk4NSk7CgkJCXZhciBidWZmZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQwNDMpOwoJCQl2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYxNjYpOwoJCQl2YXIgdG9BYnNvbHV0ZUluZGV4ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NDQzKTsKCQkJdmFyIHRvTGVuZ3RoID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MjAxKTsKCQkJdmFyIGlzT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0Njg2KTsKCQkJdmFyIEFycmF5QnVmZmVyID0gKF9fd2VicGFja19yZXF1aXJlX18oOTc2OSkuQXJyYXlCdWZmZXIpOwoJCQl2YXIgc3BlY2llc0NvbnN0cnVjdG9yID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NTU0KTsKCQkJdmFyICRBcnJheUJ1ZmZlciA9IGJ1ZmZlci5BcnJheUJ1ZmZlcjsKCQkJdmFyICREYXRhVmlldyA9IGJ1ZmZlci5EYXRhVmlldzsKCQkJdmFyICRpc1ZpZXcgPSAkdHlwZWQuQUJWICYmIEFycmF5QnVmZmVyLmlzVmlldzsKCQkJdmFyICRzbGljZSA9ICRBcnJheUJ1ZmZlci5wcm90b3R5cGUuc2xpY2U7CgkJCXZhciBWSUVXID0gJHR5cGVkLlZJRVc7CgkJCXZhciBBUlJBWV9CVUZGRVIgPSAnQXJyYXlCdWZmZXInOwoJCQkkZXhwb3J0KCRleHBvcnQuRyArICRleHBvcnQuVyArICRleHBvcnQuRiAqIChBcnJheUJ1ZmZlciAhPT0gJEFycmF5QnVmZmVyKSwgewoJCQkJQXJyYXlCdWZmZXI6ICRBcnJheUJ1ZmZlcgoJCQl9KTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhJHR5cGVkLkNPTlNUUiwgQVJSQVlfQlVGRkVSLCB7CgkJCQkvLyAyNC4xLjMuMSBBcnJheUJ1ZmZlci5pc1ZpZXcoYXJnKQoJCQkJaXNWaWV3OiBmdW5jdGlvbiBpc1ZpZXcoaXQpIHsKCQkJCQlyZXR1cm4gJGlzVmlldyAmJiAkaXNWaWV3KGl0KSB8fCBpc09iamVjdChpdCkgJiYgVklFVyBpbiBpdDsKCQkJCX0KCQkJfSk7CgkJCSRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5VICsgJGV4cG9ydC5GICogX193ZWJwYWNrX3JlcXVpcmVfXygxMjgpKGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuICFuZXcgJEFycmF5QnVmZmVyKDIpLnNsaWNlKDEsIHVuZGVmaW5lZCkuYnl0ZUxlbmd0aDsKCQkJfSksIEFSUkFZX0JVRkZFUiwgewoJCQkJLy8gMjQuMS40LjMgQXJyYXlCdWZmZXIucHJvdG90eXBlLnNsaWNlKHN0YXJ0LCBlbmQpCgkJCQlzbGljZTogZnVuY3Rpb24gc2xpY2Uoc3RhcnQsIGVuZCkgewoJCQkJCWlmICgkc2xpY2UgIT09IHVuZGVmaW5lZCAmJiBlbmQgPT09IHVuZGVmaW5lZCkgcmV0dXJuICRzbGljZS5jYWxsKGFuT2JqZWN0KHRoaXMpLCBzdGFydCk7IC8vIEZGIGZpeAoJCQkJCXZhciBsZW4gPSBhbk9iamVjdCh0aGlzKS5ieXRlTGVuZ3RoOwoJCQkJCXZhciBmaXJzdCA9IHRvQWJzb2x1dGVJbmRleChzdGFydCwgbGVuKTsKCQkJCQl2YXIgZmluID0gdG9BYnNvbHV0ZUluZGV4KGVuZCA9PT0gdW5kZWZpbmVkID8gbGVuIDogZW5kLCBsZW4pOwoJCQkJCXZhciByZXN1bHQgPSBuZXcgKHNwZWNpZXNDb25zdHJ1Y3Rvcih0aGlzLCAkQXJyYXlCdWZmZXIpKSh0b0xlbmd0aChmaW4gLSBmaXJzdCkpOwoJCQkJCXZhciB2aWV3UyA9IG5ldyAkRGF0YVZpZXcodGhpcyk7CgkJCQkJdmFyIHZpZXdUID0gbmV3ICREYXRhVmlldyhyZXN1bHQpOwoJCQkJCXZhciBpbmRleCA9IDA7CgkJCQkJd2hpbGUgKGZpcnN0IDwgZmluKSB7CgkJCQkJCXZpZXdULnNldFVpbnQ4KGluZGV4KyssIHZpZXdTLmdldFVpbnQ4KGZpcnN0KyspKTsKCQkJCQl9CgkJCQkJcmV0dXJuIHJlc3VsdDsKCQkJCX0KCQkJfSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMjMzNCkoQVJSQVlfQlVGRkVSKTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDc2NzI6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCSRleHBvcnQoJGV4cG9ydC5HICsgJGV4cG9ydC5XICsgJGV4cG9ydC5GICogIShfX3dlYnBhY2tfcmVxdWlyZV9fKDY5ODUpLkFCViksIHsKCQkJCURhdGFWaWV3OiAoX193ZWJwYWNrX3JlcXVpcmVfXyg0MDQzKS5EYXRhVmlldykKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAxNTE0OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg0MjYwKSgnRmxvYXQzMicsIDQsIGZ1bmN0aW9uKGluaXQpIHsKCQkJCXJldHVybiBmdW5jdGlvbiBGbG9hdDMyQXJyYXkoZGF0YSwgYnl0ZU9mZnNldCwgbGVuZ3RoKSB7CgkJCQkJcmV0dXJuIGluaXQodGhpcywgZGF0YSwgYnl0ZU9mZnNldCwgbGVuZ3RoKTsKCQkJCX07CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNDE4NjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCV9fd2VicGFja19yZXF1aXJlX18oNDI2MCkoJ0Zsb2F0NjQnLCA4LCBmdW5jdGlvbihpbml0KSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24gRmxvYXQ2NEFycmF5KGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCkgewoJCQkJCXJldHVybiBpbml0KHRoaXMsIGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCk7CgkJCQl9OwoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDU3Mzg6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQyNjApKCdJbnQxNicsIDIsIGZ1bmN0aW9uKGluaXQpIHsKCQkJCXJldHVybiBmdW5jdGlvbiBJbnQxNkFycmF5KGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCkgewoJCQkJCXJldHVybiBpbml0KHRoaXMsIGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCk7CgkJCQl9OwoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDc0OTE6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQyNjApKCdJbnQzMicsIDQsIGZ1bmN0aW9uKGluaXQpIHsKCQkJCXJldHVybiBmdW5jdGlvbiBJbnQzMkFycmF5KGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCkgewoJCQkJCXJldHVybiBpbml0KHRoaXMsIGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCk7CgkJCQl9OwoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDg5NDA6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQyNjApKCdJbnQ4JywgMSwgZnVuY3Rpb24oaW5pdCkgewoJCQkJcmV0dXJuIGZ1bmN0aW9uIEludDhBcnJheShkYXRhLCBieXRlT2Zmc2V0LCBsZW5ndGgpIHsKCQkJCQlyZXR1cm4gaW5pdCh0aGlzLCBkYXRhLCBieXRlT2Zmc2V0LCBsZW5ndGgpOwoJCQkJfTsKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA5MTUwOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg0MjYwKSgnVWludDE2JywgMiwgZnVuY3Rpb24oaW5pdCkgewoJCQkJcmV0dXJuIGZ1bmN0aW9uIFVpbnQxNkFycmF5KGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCkgewoJCQkJCXJldHVybiBpbml0KHRoaXMsIGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCk7CgkJCQl9OwoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDYwMzE6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQyNjApKCdVaW50MzInLCA0LCBmdW5jdGlvbihpbml0KSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24gVWludDMyQXJyYXkoZGF0YSwgYnl0ZU9mZnNldCwgbGVuZ3RoKSB7CgkJCQkJcmV0dXJuIGluaXQodGhpcywgZGF0YSwgYnl0ZU9mZnNldCwgbGVuZ3RoKTsKCQkJCX07CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNzM1OToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCV9fd2VicGFja19yZXF1aXJlX18oNDI2MCkoJ1VpbnQ4JywgMSwgZnVuY3Rpb24oaW5pdCkgewoJCQkJcmV0dXJuIGZ1bmN0aW9uIFVpbnQ4QXJyYXkoZGF0YSwgYnl0ZU9mZnNldCwgbGVuZ3RoKSB7CgkJCQkJcmV0dXJuIGluaXQodGhpcywgZGF0YSwgYnl0ZU9mZnNldCwgbGVuZ3RoKTsKCQkJCX07CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMTA1NToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCV9fd2VicGFja19yZXF1aXJlX18oNDI2MCkoJ1VpbnQ4JywgMSwgZnVuY3Rpb24oaW5pdCkgewoJCQkJcmV0dXJuIGZ1bmN0aW9uIFVpbnQ4Q2xhbXBlZEFycmF5KGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCkgewoJCQkJCXJldHVybiBpbml0KHRoaXMsIGRhdGEsIGJ5dGVPZmZzZXQsIGxlbmd0aCk7CgkJCQl9OwoJCQl9LCB0cnVlKTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDU2NDI6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCgkJCXZhciBnbG9iYWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk3NjkpOwoJCQl2YXIgZWFjaCA9IF9fd2VicGFja19yZXF1aXJlX18oOTU2OSkoMCk7CgkJCXZhciByZWRlZmluZSA9IF9fd2VicGFja19yZXF1aXJlX18oODkxNCk7CgkJCXZhciBtZXRhID0gX193ZWJwYWNrX3JlcXVpcmVfXygyMzY5KTsKCQkJdmFyIGFzc2lnbiA9IF9fd2VicGFja19yZXF1aXJlX18oNzY2Nik7CgkJCXZhciB3ZWFrID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NzIpOwoJCQl2YXIgaXNPYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2ODYpOwoJCQl2YXIgdmFsaWRhdGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY4MTMpOwoJCQl2YXIgTkFUSVZFX1dFQUtfTUFQID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2ODEzKTsKCQkJdmFyIElTX0lFMTEgPSAhZ2xvYmFsLkFjdGl2ZVhPYmplY3QgJiYgJ0FjdGl2ZVhPYmplY3QnIGluIGdsb2JhbDsKCQkJdmFyIFdFQUtfTUFQID0gJ1dlYWtNYXAnOwoJCQl2YXIgZ2V0V2VhayA9IG1ldGEuZ2V0V2VhazsKCQkJdmFyIGlzRXh0ZW5zaWJsZSA9IE9iamVjdC5pc0V4dGVuc2libGU7CgkJCXZhciB1bmNhdWdodEZyb3plblN0b3JlID0gd2Vhay51ZnN0b3JlOwoJCQl2YXIgSW50ZXJuYWxNYXA7CgkJCXZhciB3cmFwcGVyID0gZnVuY3Rpb24gd3JhcHBlcihnZXQpIHsKCQkJCXJldHVybiBmdW5jdGlvbiBXZWFrTWFwKCkgewoJCQkJCXJldHVybiBnZXQodGhpcywgYXJndW1lbnRzLmxlbmd0aCA+IDAgPyBhcmd1bWVudHNbMF0gOiB1bmRlZmluZWQpOwoJCQkJfTsKCQkJfTsKCQkJdmFyIG1ldGhvZHMgPSB7CgkJCQkvLyAyMy4zLjMuMyBXZWFrTWFwLnByb3RvdHlwZS5nZXQoa2V5KQoJCQkJZ2V0OiBmdW5jdGlvbiBnZXQoa2V5KSB7CgkJCQkJaWYgKGlzT2JqZWN0KGtleSkpIHsKCQkJCQkJdmFyIGRhdGEgPSBnZXRXZWFrKGtleSk7CgkJCQkJCWlmIChkYXRhID09PSB0cnVlKSByZXR1cm4gdW5jYXVnaHRGcm96ZW5TdG9yZSh2YWxpZGF0ZSh0aGlzLCBXRUFLX01BUCkpLmdldChrZXkpOwoJCQkJCQlyZXR1cm4gZGF0YSA/IGRhdGFbdGhpcy5faV0gOiB1bmRlZmluZWQ7CgkJCQkJfQoJCQkJfSwKCQkJCS8vIDIzLjMuMy41IFdlYWtNYXAucHJvdG90eXBlLnNldChrZXksIHZhbHVlKQoJCQkJc2V0OiBmdW5jdGlvbiBzZXQoa2V5LCB2YWx1ZSkgewoJCQkJCXJldHVybiB3ZWFrLmRlZih2YWxpZGF0ZSh0aGlzLCBXRUFLX01BUCksIGtleSwgdmFsdWUpOwoJCQkJfQoJCQl9OwoKLy8gMjMuMyBXZWFrTWFwIE9iamVjdHMKCQkJdmFyICRXZWFrTWFwID0gbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk4OTMpKFdFQUtfTUFQLCB3cmFwcGVyLCBtZXRob2RzLCB3ZWFrLCB0cnVlLCB0cnVlKTsKCi8vIElFMTEgV2Vha01hcCBmcm96ZW4ga2V5cyBmaXgKCQkJaWYgKE5BVElWRV9XRUFLX01BUCAmJiBJU19JRTExKSB7CgkJCQlJbnRlcm5hbE1hcCA9IHdlYWsuZ2V0Q29uc3RydWN0b3Iod3JhcHBlciwgV0VBS19NQVApOwoJCQkJYXNzaWduKEludGVybmFsTWFwLnByb3RvdHlwZSwgbWV0aG9kcyk7CgkJCQltZXRhLk5FRUQgPSB0cnVlOwoJCQkJZWFjaChbJ2RlbGV0ZScsICdoYXMnLCAnZ2V0JywgJ3NldCddLCBmdW5jdGlvbihrZXkpIHsKCQkJCQl2YXIgcHJvdG8gPSAkV2Vha01hcC5wcm90b3R5cGU7CgkJCQkJdmFyIG1ldGhvZCA9IHByb3RvW2tleV07CgkJCQkJcmVkZWZpbmUocHJvdG8sIGtleSwgZnVuY3Rpb24oYSwgYikgewoJCQkJCQkvLyBzdG9yZSBmcm96ZW4gb2JqZWN0cyBvbiBpbnRlcm5hbCB3ZWFrbWFwIHNoaW0KCQkJCQkJaWYgKGlzT2JqZWN0KGEpICYmICFpc0V4dGVuc2libGUoYSkpIHsKCQkJCQkJCWlmICghdGhpcy5fZikgdGhpcy5fZiA9IG5ldyBJbnRlcm5hbE1hcCgpOwoJCQkJCQkJdmFyIHJlc3VsdCA9IHRoaXMuX2Zba2V5XShhLCBiKTsKCQkJCQkJCXJldHVybiBrZXkgPT0gJ3NldCcgPyB0aGlzIDogcmVzdWx0OwoJCQkJCQkJLy8gc3RvcmUgYWxsIHRoZSByZXN0IG9uIG5hdGl2ZSB3ZWFrbWFwCgkJCQkJCX0KCQkJCQkJcmV0dXJuIG1ldGhvZC5jYWxsKHRoaXMsIGEsIGIpOwoJCQkJCX0pOwoJCQkJfSk7CgkJCX0KCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDg1NDM6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyIHdlYWsgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc3Mik7CgkJCXZhciB2YWxpZGF0ZSA9IF9fd2VicGFja19yZXF1aXJlX18oNjgxMyk7CgkJCXZhciBXRUFLX1NFVCA9ICdXZWFrU2V0JzsKCi8vIDIzLjQgV2Vha1NldCBPYmplY3RzCgkJCV9fd2VicGFja19yZXF1aXJlX18oOTg5MykoV0VBS19TRVQsIGZ1bmN0aW9uKGdldCkgewoJCQkJcmV0dXJuIGZ1bmN0aW9uIFdlYWtTZXQoKSB7CgkJCQkJcmV0dXJuIGdldCh0aGlzLCBhcmd1bWVudHMubGVuZ3RoID4gMCA/IGFyZ3VtZW50c1swXSA6IHVuZGVmaW5lZCk7CgkJCQl9OwoJCQl9LCB7CgkJCQkvLyAyMy40LjMuMSBXZWFrU2V0LnByb3RvdHlwZS5hZGQodmFsdWUpCgkJCQlhZGQ6IGZ1bmN0aW9uIGFkZCh2YWx1ZSkgewoJCQkJCXJldHVybiB3ZWFrLmRlZih2YWxpZGF0ZSh0aGlzLCBXRUFLX1NFVCksIHZhbHVlLCB0cnVlKTsKCQkJCX0KCQkJfSwgd2VhaywgZmFsc2UsIHRydWUpOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNjEwMjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL3Byb3Bvc2FsLWZsYXRNYXAvI3NlYy1BcnJheS5wcm90b3R5cGUuZmxhdE1hcAoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciBmbGF0dGVuSW50b0FycmF5ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4MTg5KTsKCQkJdmFyIHRvT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0ODIwKTsKCQkJdmFyIHRvTGVuZ3RoID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MjAxKTsKCQkJdmFyIGFGdW5jdGlvbiA9IF9fd2VicGFja19yZXF1aXJlX18oNDgxMCk7CgkJCXZhciBhcnJheVNwZWNpZXNDcmVhdGUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ1NzApOwoJCQkkZXhwb3J0KCRleHBvcnQuUCwgJ0FycmF5JywgewoJCQkJZmxhdE1hcDogZnVuY3Rpb24gZmxhdE1hcChjYWxsYmFja2ZuIC8qICwgdGhpc0FyZyAqLykgewoJCQkJCXZhciBPID0gdG9PYmplY3QodGhpcyk7CgkJCQkJdmFyIHNvdXJjZUxlbiwgQTsKCQkJCQlhRnVuY3Rpb24oY2FsbGJhY2tmbik7CgkJCQkJc291cmNlTGVuID0gdG9MZW5ndGgoTy5sZW5ndGgpOwoJCQkJCUEgPSBhcnJheVNwZWNpZXNDcmVhdGUoTywgMCk7CgkJCQkJZmxhdHRlbkludG9BcnJheShBLCBPLCBPLCBzb3VyY2VMZW4sIDAsIDEsIGNhbGxiYWNrZm4sIGFyZ3VtZW50c1sxXSk7CgkJCQkJcmV0dXJuIEE7CgkJCQl9CgkJCX0pOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQ1NTMpKCdmbGF0TWFwJyk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA3NDExOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCi8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vcHJvcG9zYWwtZmxhdE1hcC8jc2VjLUFycmF5LnByb3RvdHlwZS5mbGF0dGVuCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIGZsYXR0ZW5JbnRvQXJyYXkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgxODkpOwoJCQl2YXIgdG9PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ4MjApOwoJCQl2YXIgdG9MZW5ndGggPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUyMDEpOwoJCQl2YXIgdG9JbnRlZ2VyID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2Njk5KTsKCQkJdmFyIGFycmF5U3BlY2llc0NyZWF0ZSA9IF9fd2VicGFja19yZXF1aXJlX18oNDU3MCk7CgkJCSRleHBvcnQoJGV4cG9ydC5QLCAnQXJyYXknLCB7CgkJCQlmbGF0dGVuOiBmdW5jdGlvbiBmbGF0dGVuKCAvKiBkZXB0aEFyZyA9IDEgKi8KCQkJCSkgewoJCQkJCXZhciBkZXB0aEFyZyA9IGFyZ3VtZW50c1swXTsKCQkJCQl2YXIgTyA9IHRvT2JqZWN0KHRoaXMpOwoJCQkJCXZhciBzb3VyY2VMZW4gPSB0b0xlbmd0aChPLmxlbmd0aCk7CgkJCQkJdmFyIEEgPSBhcnJheVNwZWNpZXNDcmVhdGUoTywgMCk7CgkJCQkJZmxhdHRlbkludG9BcnJheShBLCBPLCBPLCBzb3VyY2VMZW4sIDAsIGRlcHRoQXJnID09PSB1bmRlZmluZWQgPyAxIDogdG9JbnRlZ2VyKGRlcHRoQXJnKSk7CgkJCQkJcmV0dXJuIEE7CgkJCQl9CgkJCX0pOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQ1NTMpKCdmbGF0dGVuJyk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAyMDQzOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS90YzM5L0FycmF5LnByb3RvdHlwZS5pbmNsdWRlcwoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciAkaW5jbHVkZXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDY4ODkpKHRydWUpOwoJCQkkZXhwb3J0KCRleHBvcnQuUCwgJ0FycmF5JywgewoJCQkJaW5jbHVkZXM6IGZ1bmN0aW9uIGluY2x1ZGVzKGVsIC8qICwgZnJvbUluZGV4ID0gMCAqLykgewoJCQkJCXJldHVybiAkaW5jbHVkZXModGhpcywgZWwsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkKTsKCQkJCX0KCQkJfSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNDU1MykoJ2luY2x1ZGVzJyk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA4NTU3OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gaHR0cHM6Ly9naXRodWIuY29tL3J3YWxkcm9uL3RjMzktbm90ZXMvYmxvYi9tYXN0ZXIvZXM2LzIwMTQtMDkvc2VwdC0yNS5tZCM1MTAtZ2xvYmFsYXNhcC1mb3ItZW5xdWV1aW5nLWEtbWljcm90YXNrCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIG1pY3JvdGFzayA9IF9fd2VicGFja19yZXF1aXJlX18oMjY4NCkoKTsKCQkJdmFyIHByb2Nlc3MgPSAoX193ZWJwYWNrX3JlcXVpcmVfXyg5NzY5KS5wcm9jZXNzKTsKCQkJdmFyIGlzTm9kZSA9IF9fd2VicGFja19yZXF1aXJlX18oMjQzNCkocHJvY2VzcykgPT0gJ3Byb2Nlc3MnOwoJCQkkZXhwb3J0KCRleHBvcnQuRywgewoJCQkJYXNhcDogZnVuY3Rpb24gYXNhcChmbikgewoJCQkJCXZhciBkb21haW4gPSBpc05vZGUgJiYgcHJvY2Vzcy5kb21haW47CgkJCQkJbWljcm90YXNrKGRvbWFpbiA/IGRvbWFpbi5iaW5kKGZuKSA6IGZuKTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA3NzQ2OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gaHR0cHM6Ly9naXRodWIuY29tL2xqaGFyYi9wcm9wb3NhbC1pcy1lcnJvcgoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciBjb2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI0MzQpOwoJCQkkZXhwb3J0KCRleHBvcnQuUywgJ0Vycm9yJywgewoJCQkJaXNFcnJvcjogZnVuY3Rpb24gaXNFcnJvcihpdCkgewoJCQkJCXJldHVybiBjb2YoaXQpID09PSAnRXJyb3InOwoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDI5MTA6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9wcm9wb3NhbC1nbG9iYWwKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQkkZXhwb3J0KCRleHBvcnQuRywgewoJCQkJZ2xvYmFsOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDk3NjkpCgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNDY1MjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vcHJvcG9zYWwtc2V0bWFwLW9mZnJvbS8jc2VjLW1hcC5mcm9tCgkJCV9fd2VicGFja19yZXF1aXJlX18oNjc0MikoJ01hcCcpOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gODg3OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gaHR0cHM6Ly90YzM5LmdpdGh1Yi5pby9wcm9wb3NhbC1zZXRtYXAtb2Zmcm9tLyNzZWMtbWFwLm9mCgkJCV9fd2VicGFja19yZXF1aXJlX18oNjU4NikoJ01hcCcpOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNDE0ODoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9EYXZpZEJydWFudC9NYXAtU2V0LnByb3RvdHlwZS50b0pTT04KCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQkkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuUiwgJ01hcCcsIHsKCQkJCXRvSlNPTjogX193ZWJwYWNrX3JlcXVpcmVfXyg2NjcxKSgnTWFwJykKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAxODkxOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gaHR0cHM6Ly9yd2FsZHJvbi5naXRodWIuaW8vcHJvcG9zYWwtbWF0aC1leHRlbnNpb25zLwoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCSRleHBvcnQoJGV4cG9ydC5TLCAnTWF0aCcsIHsKCQkJCWNsYW1wOiBmdW5jdGlvbiBjbGFtcCh4LCBsb3dlciwgdXBwZXIpIHsKCQkJCQlyZXR1cm4gTWF0aC5taW4odXBwZXIsIE1hdGgubWF4KGxvd2VyLCB4KSk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMzkxMToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIGh0dHBzOi8vcndhbGRyb24uZ2l0aHViLmlvL3Byb3Bvc2FsLW1hdGgtZXh0ZW5zaW9ucy8KCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQkkZXhwb3J0KCRleHBvcnQuUywgJ01hdGgnLCB7CgkJCQlERUdfUEVSX1JBRDogTWF0aC5QSSAvIDE4MAoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDg1MDc6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyBodHRwczovL3J3YWxkcm9uLmdpdGh1Yi5pby9wcm9wb3NhbC1tYXRoLWV4dGVuc2lvbnMvCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIFJBRF9QRVJfREVHID0gMTgwIC8gTWF0aC5QSTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdNYXRoJywgewoJCQkJZGVncmVlczogZnVuY3Rpb24gZGVncmVlcyhyYWRpYW5zKSB7CgkJCQkJcmV0dXJuIHJhZGlhbnMgKiBSQURfUEVSX0RFRzsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA0NzE1OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gaHR0cHM6Ly9yd2FsZHJvbi5naXRodWIuaW8vcHJvcG9zYWwtbWF0aC1leHRlbnNpb25zLwoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciBzY2FsZSA9IF9fd2VicGFja19yZXF1aXJlX18oMjE1NSk7CgkJCXZhciBmcm91bmQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMzKTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdNYXRoJywgewoJCQkJZnNjYWxlOiBmdW5jdGlvbiBmc2NhbGUoeCwgaW5Mb3csIGluSGlnaCwgb3V0TG93LCBvdXRIaWdoKSB7CgkJCQkJcmV0dXJuIGZyb3VuZChzY2FsZSh4LCBpbkxvdywgaW5IaWdoLCBvdXRMb3csIG91dEhpZ2gpKTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAyODcwOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vQnJlbmRhbkVpY2gvNDI5NGQ1YzIxMmE2ZDIyNTQ3MDMKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQkkZXhwb3J0KCRleHBvcnQuUywgJ01hdGgnLCB7CgkJCQlpYWRkaDogZnVuY3Rpb24gaWFkZGgoeDAsIHgxLCB5MCwgeTEpIHsKCQkJCQl2YXIgJHgwID0geDAgPj4+IDA7CgkJCQkJdmFyICR4MSA9IHgxID4+PiAwOwoJCQkJCXZhciAkeTAgPSB5MCA+Pj4gMDsKCQkJCQlyZXR1cm4gJHgxICsgKHkxID4+PiAwKSArICgoJHgwICYgJHkwIHwgKCR4MCB8ICR5MCkgJiB+KCR4MCArICR5MCA+Pj4gMCkpID4+PiAzMSkgfCAwOwoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDE2ODQ6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyBodHRwczovL2dpc3QuZ2l0aHViLmNvbS9CcmVuZGFuRWljaC80Mjk0ZDVjMjEyYTZkMjI1NDcwMwoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCSRleHBvcnQoJGV4cG9ydC5TLCAnTWF0aCcsIHsKCQkJCWltdWxoOiBmdW5jdGlvbiBpbXVsaCh1LCB2KSB7CgkJCQkJdmFyIFVJTlQxNiA9IDB4ZmZmZjsKCQkJCQl2YXIgJHUgPSArdTsKCQkJCQl2YXIgJHYgPSArdjsKCQkJCQl2YXIgdTAgPSAkdSAmIFVJTlQxNjsKCQkJCQl2YXIgdjAgPSAkdiAmIFVJTlQxNjsKCQkJCQl2YXIgdTEgPSAkdSA+PiAxNjsKCQkJCQl2YXIgdjEgPSAkdiA+PiAxNjsKCQkJCQl2YXIgdCA9ICh1MSAqIHYwID4+PiAwKSArICh1MCAqIHYwID4+PiAxNik7CgkJCQkJcmV0dXJuIHUxICogdjEgKyAodCA+PiAxNikgKyAoKHUwICogdjEgPj4+IDApICsgKHQgJiBVSU5UMTYpID4+IDE2KTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA3MzY5OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vQnJlbmRhbkVpY2gvNDI5NGQ1YzIxMmE2ZDIyNTQ3MDMKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQkkZXhwb3J0KCRleHBvcnQuUywgJ01hdGgnLCB7CgkJCQlpc3ViaDogZnVuY3Rpb24gaXN1YmgoeDAsIHgxLCB5MCwgeTEpIHsKCQkJCQl2YXIgJHgwID0geDAgPj4+IDA7CgkJCQkJdmFyICR4MSA9IHgxID4+PiAwOwoJCQkJCXZhciAkeTAgPSB5MCA+Pj4gMDsKCQkJCQlyZXR1cm4gJHgxIC0gKHkxID4+PiAwKSAtICgofiR4MCAmICR5MCB8IH4oJHgwIF4gJHkwKSAmICR4MCAtICR5MCA+Pj4gMCkgPj4+IDMxKSB8IDA7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMzk2MjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIGh0dHBzOi8vcndhbGRyb24uZ2l0aHViLmlvL3Byb3Bvc2FsLW1hdGgtZXh0ZW5zaW9ucy8KCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQkkZXhwb3J0KCRleHBvcnQuUywgJ01hdGgnLCB7CgkJCQlSQURfUEVSX0RFRzogMTgwIC8gTWF0aC5QSQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDk5NDY6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyBodHRwczovL3J3YWxkcm9uLmdpdGh1Yi5pby9wcm9wb3NhbC1tYXRoLWV4dGVuc2lvbnMvCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIERFR19QRVJfUkFEID0gTWF0aC5QSSAvIDE4MDsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdNYXRoJywgewoJCQkJcmFkaWFuczogZnVuY3Rpb24gcmFkaWFucyhkZWdyZWVzKSB7CgkJCQkJcmV0dXJuIGRlZ3JlZXMgKiBERUdfUEVSX1JBRDsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA4MTY4OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gaHR0cHM6Ly9yd2FsZHJvbi5naXRodWIuaW8vcHJvcG9zYWwtbWF0aC1leHRlbnNpb25zLwoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCSRleHBvcnQoJGV4cG9ydC5TLCAnTWF0aCcsIHsKCQkJCXNjYWxlOiBfX3dlYnBhY2tfcmVxdWlyZV9fKDIxNTUpCgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMzQzOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gaHR0cDovL2pmYmFzdGllbi5naXRodWIuaW8vcGFwZXJzL01hdGguc2lnbmJpdC5odG1sCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdNYXRoJywgewoJCQkJc2lnbmJpdDogZnVuY3Rpb24gc2lnbmJpdCh4KSB7CgkJCQkJLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXNlbGYtY29tcGFyZQoJCQkJCXJldHVybiAoeCA9ICt4KSAhPSB4ID8geCA6IHggPT0gMCA/IDEgLyB4ID09IEluZmluaXR5IDogeCA+IDA7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gOTkyMjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL0JyZW5kYW5FaWNoLzQyOTRkNWMyMTJhNmQyMjU0NzAzCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdNYXRoJywgewoJCQkJdW11bGg6IGZ1bmN0aW9uIHVtdWxoKHUsIHYpIHsKCQkJCQl2YXIgVUlOVDE2ID0gMHhmZmZmOwoJCQkJCXZhciAkdSA9ICt1OwoJCQkJCXZhciAkdiA9ICt2OwoJCQkJCXZhciB1MCA9ICR1ICYgVUlOVDE2OwoJCQkJCXZhciB2MCA9ICR2ICYgVUlOVDE2OwoJCQkJCXZhciB1MSA9ICR1ID4+PiAxNjsKCQkJCQl2YXIgdjEgPSAkdiA+Pj4gMTY7CgkJCQkJdmFyIHQgPSAodTEgKiB2MCA+Pj4gMCkgKyAodTAgKiB2MCA+Pj4gMTYpOwoJCQkJCXJldHVybiB1MSAqIHYxICsgKHQgPj4+IDE2KSArICgodTAgKiB2MSA+Pj4gMCkgKyAodCAmIFVJTlQxNikgPj4+IDE2KTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA4Njk6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQl2YXIgdG9PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ4MjApOwoJCQl2YXIgYUZ1bmN0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0ODEwKTsKCQkJdmFyICRkZWZpbmVQcm9wZXJ0eSA9IF9fd2VicGFja19yZXF1aXJlX18oMTUxNSk7CgovLyBCLjIuMi4yIE9iamVjdC5wcm90b3R5cGUuX19kZWZpbmVHZXR0ZXJfXyhQLCBnZXR0ZXIpCgkJCV9fd2VicGFja19yZXF1aXJlX18oNTE5NCkgJiYgJGV4cG9ydCgkZXhwb3J0LlAgKyBfX3dlYnBhY2tfcmVxdWlyZV9fKDQwNTcpLCAnT2JqZWN0JywgewoJCQkJX19kZWZpbmVHZXR0ZXJfXzogZnVuY3Rpb24gX19kZWZpbmVHZXR0ZXJfXyhQLCBnZXR0ZXIpIHsKCQkJCQkkZGVmaW5lUHJvcGVydHkuZih0b09iamVjdCh0aGlzKSwgUCwgewoJCQkJCQlnZXQ6IGFGdW5jdGlvbihnZXR0ZXIpLAoJCQkJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQkJCQljb25maWd1cmFibGU6IHRydWUKCQkJCQl9KTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA4NzYwOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIHRvT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0ODIwKTsKCQkJdmFyIGFGdW5jdGlvbiA9IF9fd2VicGFja19yZXF1aXJlX18oNDgxMCk7CgkJCXZhciAkZGVmaW5lUHJvcGVydHkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDE1MTUpOwoKLy8gQi4yLjIuMyBPYmplY3QucHJvdG90eXBlLl9fZGVmaW5lU2V0dGVyX18oUCwgc2V0dGVyKQoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDUxOTQpICYmICRleHBvcnQoJGV4cG9ydC5QICsgX193ZWJwYWNrX3JlcXVpcmVfXyg0MDU3KSwgJ09iamVjdCcsIHsKCQkJCV9fZGVmaW5lU2V0dGVyX186IGZ1bmN0aW9uIF9fZGVmaW5lU2V0dGVyX18oUCwgc2V0dGVyKSB7CgkJCQkJJGRlZmluZVByb3BlcnR5LmYodG9PYmplY3QodGhpcyksIFAsIHsKCQkJCQkJc2V0OiBhRnVuY3Rpb24oc2V0dGVyKSwKCQkJCQkJZW51bWVyYWJsZTogdHJ1ZSwKCQkJCQkJY29uZmlndXJhYmxlOiB0cnVlCgkJCQkJfSk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMTAzMzoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS90YzM5L3Byb3Bvc2FsLW9iamVjdC12YWx1ZXMtZW50cmllcwoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciAkZW50cmllcyA9IF9fd2VicGFja19yZXF1aXJlX18oNDE2NikodHJ1ZSk7CgkJCSRleHBvcnQoJGV4cG9ydC5TLCAnT2JqZWN0JywgewoJCQkJZW50cmllczogZnVuY3Rpb24gZW50cmllcyhpdCkgewoJCQkJCXJldHVybiAkZW50cmllcyhpdCk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNzMyMToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS90YzM5L3Byb3Bvc2FsLW9iamVjdC1nZXRvd25wcm9wZXJ0eWRlc2NyaXB0b3JzCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIG93bktleXMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDMzNzUpOwoJCQl2YXIgdG9JT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygxMzA5KTsKCQkJdmFyIGdPUEQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgwOTYpOwoJCQl2YXIgY3JlYXRlUHJvcGVydHkgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDIwMTIpOwoJCQkkZXhwb3J0KCRleHBvcnQuUywgJ09iamVjdCcsIHsKCQkJCWdldE93blByb3BlcnR5RGVzY3JpcHRvcnM6IGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcnMob2JqZWN0KSB7CgkJCQkJdmFyIE8gPSB0b0lPYmplY3Qob2JqZWN0KTsKCQkJCQl2YXIgZ2V0RGVzYyA9IGdPUEQuZjsKCQkJCQl2YXIga2V5cyA9IG93bktleXMoTyk7CgkJCQkJdmFyIHJlc3VsdCA9IHt9OwoJCQkJCXZhciBpID0gMDsKCQkJCQl2YXIga2V5LCBkZXNjOwoJCQkJCXdoaWxlIChrZXlzLmxlbmd0aCA+IGkpIHsKCQkJCQkJZGVzYyA9IGdldERlc2MoTywga2V5ID0ga2V5c1tpKytdKTsKCQkJCQkJaWYgKGRlc2MgIT09IHVuZGVmaW5lZCkgY3JlYXRlUHJvcGVydHkocmVzdWx0LCBrZXksIGRlc2MpOwoJCQkJCX0KCQkJCQlyZXR1cm4gcmVzdWx0OwoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDM5OTQ6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQl2YXIgdG9PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ4MjApOwoJCQl2YXIgdG9QcmltaXRpdmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM0NDApOwoJCQl2YXIgZ2V0UHJvdG90eXBlT2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg5OTYpOwoJCQl2YXIgZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gKF9fd2VicGFja19yZXF1aXJlX18oODA5NikuZik7CgovLyBCLjIuMi40IE9iamVjdC5wcm90b3R5cGUuX19sb29rdXBHZXR0ZXJfXyhQKQoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDUxOTQpICYmICRleHBvcnQoJGV4cG9ydC5QICsgX193ZWJwYWNrX3JlcXVpcmVfXyg0MDU3KSwgJ09iamVjdCcsIHsKCQkJCV9fbG9va3VwR2V0dGVyX186IGZ1bmN0aW9uIF9fbG9va3VwR2V0dGVyX18oUCkgewoJCQkJCXZhciBPID0gdG9PYmplY3QodGhpcyk7CgkJCQkJdmFyIEsgPSB0b1ByaW1pdGl2ZShQLCB0cnVlKTsKCQkJCQl2YXIgRDsKCQkJCQlkbyB7CgkJCQkJCWlmIChEID0gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKE8sIEspKSByZXR1cm4gRC5nZXQ7CgkJCQkJfSB3aGlsZSAoTyA9IGdldFByb3RvdHlwZU9mKE8pKTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAzNzAyOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIHRvT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0ODIwKTsKCQkJdmFyIHRvUHJpbWl0aXZlID0gX193ZWJwYWNrX3JlcXVpcmVfXygzNDQwKTsKCQkJdmFyIGdldFByb3RvdHlwZU9mID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4OTk2KTsKCQkJdmFyIGdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IChfX3dlYnBhY2tfcmVxdWlyZV9fKDgwOTYpLmYpOwoKLy8gQi4yLjIuNSBPYmplY3QucHJvdG90eXBlLl9fbG9va3VwU2V0dGVyX18oUCkKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg1MTk0KSAmJiAkZXhwb3J0KCRleHBvcnQuUCArIF9fd2VicGFja19yZXF1aXJlX18oNDA1NyksICdPYmplY3QnLCB7CgkJCQlfX2xvb2t1cFNldHRlcl9fOiBmdW5jdGlvbiBfX2xvb2t1cFNldHRlcl9fKFApIHsKCQkJCQl2YXIgTyA9IHRvT2JqZWN0KHRoaXMpOwoJCQkJCXZhciBLID0gdG9QcmltaXRpdmUoUCwgdHJ1ZSk7CgkJCQkJdmFyIEQ7CgkJCQkJZG8gewoJCQkJCQlpZiAoRCA9IGdldE93blByb3BlcnR5RGVzY3JpcHRvcihPLCBLKSkgcmV0dXJuIEQuc2V0OwoJCQkJCX0gd2hpbGUgKE8gPSBnZXRQcm90b3R5cGVPZihPKSk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNjYxMzoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS90YzM5L3Byb3Bvc2FsLW9iamVjdC12YWx1ZXMtZW50cmllcwoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciAkdmFsdWVzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTY2KShmYWxzZSk7CgkJCSRleHBvcnQoJGV4cG9ydC5TLCAnT2JqZWN0JywgewoJCQkJdmFsdWVzOiBmdW5jdGlvbiB2YWx1ZXMoaXQpIHsKCQkJCQlyZXR1cm4gJHZhbHVlcyhpdCk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNjUxMzoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyBodHRwczovL2dpdGh1Yi5jb20vemVucGFyc2luZy9lcy1vYnNlcnZhYmxlCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oOTc2OSk7CgkJCXZhciBjb3JlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MTY1KTsKCQkJdmFyIG1pY3JvdGFzayA9IF9fd2VicGFja19yZXF1aXJlX18oMjY4NCkoKTsKCQkJdmFyIE9CU0VSVkFCTEUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI4NjcpKCdvYnNlcnZhYmxlJyk7CgkJCXZhciBhRnVuY3Rpb24gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ4MTApOwoJCQl2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYxNjYpOwoJCQl2YXIgYW5JbnN0YW5jZSA9IF9fd2VicGFja19yZXF1aXJlX18oODY3Myk7CgkJCXZhciByZWRlZmluZUFsbCA9IF9fd2VicGFja19yZXF1aXJlX18oNzE4NSk7CgkJCXZhciBoaWRlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5MDM2KTsKCQkJdmFyIGZvck9mID0gX193ZWJwYWNrX3JlcXVpcmVfXygzMzg5KTsKCQkJdmFyIFJFVFVSTiA9IGZvck9mLlJFVFVSTjsKCQkJdmFyIGdldE1ldGhvZCA9IGZ1bmN0aW9uIGdldE1ldGhvZChmbikgewoJCQkJcmV0dXJuIGZuID09IG51bGwgPyB1bmRlZmluZWQgOiBhRnVuY3Rpb24oZm4pOwoJCQl9OwoJCQl2YXIgY2xlYW51cFN1YnNjcmlwdGlvbiA9IGZ1bmN0aW9uIGNsZWFudXBTdWJzY3JpcHRpb24oc3Vic2NyaXB0aW9uKSB7CgkJCQl2YXIgY2xlYW51cCA9IHN1YnNjcmlwdGlvbi5fYzsKCQkJCWlmIChjbGVhbnVwKSB7CgkJCQkJc3Vic2NyaXB0aW9uLl9jID0gdW5kZWZpbmVkOwoJCQkJCWNsZWFudXAoKTsKCQkJCX0KCQkJfTsKCQkJdmFyIHN1YnNjcmlwdGlvbkNsb3NlZCA9IGZ1bmN0aW9uIHN1YnNjcmlwdGlvbkNsb3NlZChzdWJzY3JpcHRpb24pIHsKCQkJCXJldHVybiBzdWJzY3JpcHRpb24uX28gPT09IHVuZGVmaW5lZDsKCQkJfTsKCQkJdmFyIGNsb3NlU3Vic2NyaXB0aW9uID0gZnVuY3Rpb24gY2xvc2VTdWJzY3JpcHRpb24oc3Vic2NyaXB0aW9uKSB7CgkJCQlpZiAoIXN1YnNjcmlwdGlvbkNsb3NlZChzdWJzY3JpcHRpb24pKSB7CgkJCQkJc3Vic2NyaXB0aW9uLl9vID0gdW5kZWZpbmVkOwoJCQkJCWNsZWFudXBTdWJzY3JpcHRpb24oc3Vic2NyaXB0aW9uKTsKCQkJCX0KCQkJfTsKCQkJdmFyIFN1YnNjcmlwdGlvbiA9IGZ1bmN0aW9uIFN1YnNjcmlwdGlvbihvYnNlcnZlciwgc3Vic2NyaWJlcikgewoJCQkJYW5PYmplY3Qob2JzZXJ2ZXIpOwoJCQkJdGhpcy5fYyA9IHVuZGVmaW5lZDsKCQkJCXRoaXMuX28gPSBvYnNlcnZlcjsKCQkJCW9ic2VydmVyID0gbmV3IFN1YnNjcmlwdGlvbk9ic2VydmVyKHRoaXMpOwoJCQkJdHJ5IHsKCQkJCQl2YXIgY2xlYW51cCA9IHN1YnNjcmliZXIob2JzZXJ2ZXIpOwoJCQkJCXZhciBzdWJzY3JpcHRpb24gPSBjbGVhbnVwOwoJCQkJCWlmIChjbGVhbnVwICE9IG51bGwpIHsKCQkJCQkJaWYgKHR5cGVvZiBjbGVhbnVwLnVuc3Vic2NyaWJlID09PSAnZnVuY3Rpb24nKSBjbGVhbnVwID0gZnVuY3Rpb24gY2xlYW51cCgpIHsKCQkJCQkJCXN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpOwoJCQkJCQl9OyBlbHNlIGFGdW5jdGlvbihjbGVhbnVwKTsKCQkJCQkJdGhpcy5fYyA9IGNsZWFudXA7CgkJCQkJfQoJCQkJfSBjYXRjaCAoZSkgewoJCQkJCW9ic2VydmVyLmVycm9yKGUpOwoJCQkJCXJldHVybjsKCQkJCX0KCQkJCWlmIChzdWJzY3JpcHRpb25DbG9zZWQodGhpcykpIGNsZWFudXBTdWJzY3JpcHRpb24odGhpcyk7CgkJCX07CgkJCVN1YnNjcmlwdGlvbi5wcm90b3R5cGUgPSByZWRlZmluZUFsbCh7fSwgewoJCQkJdW5zdWJzY3JpYmU6IGZ1bmN0aW9uIHVuc3Vic2NyaWJlKCkgewoJCQkJCWNsb3NlU3Vic2NyaXB0aW9uKHRoaXMpOwoJCQkJfQoJCQl9KTsKCQkJdmFyIFN1YnNjcmlwdGlvbk9ic2VydmVyID0gZnVuY3Rpb24gU3Vic2NyaXB0aW9uT2JzZXJ2ZXIoc3Vic2NyaXB0aW9uKSB7CgkJCQl0aGlzLl9zID0gc3Vic2NyaXB0aW9uOwoJCQl9OwoJCQlTdWJzY3JpcHRpb25PYnNlcnZlci5wcm90b3R5cGUgPSByZWRlZmluZUFsbCh7fSwgewoJCQkJbmV4dDogZnVuY3Rpb24gbmV4dCh2YWx1ZSkgewoJCQkJCXZhciBzdWJzY3JpcHRpb24gPSB0aGlzLl9zOwoJCQkJCWlmICghc3Vic2NyaXB0aW9uQ2xvc2VkKHN1YnNjcmlwdGlvbikpIHsKCQkJCQkJdmFyIG9ic2VydmVyID0gc3Vic2NyaXB0aW9uLl9vOwoJCQkJCQl0cnkgewoJCQkJCQkJdmFyIG0gPSBnZXRNZXRob2Qob2JzZXJ2ZXIubmV4dCk7CgkJCQkJCQlpZiAobSkgcmV0dXJuIG0uY2FsbChvYnNlcnZlciwgdmFsdWUpOwoJCQkJCQl9IGNhdGNoIChlKSB7CgkJCQkJCQl0cnkgewoJCQkJCQkJCWNsb3NlU3Vic2NyaXB0aW9uKHN1YnNjcmlwdGlvbik7CgkJCQkJCQl9IGZpbmFsbHkgewoJCQkJCQkJCXRocm93IGU7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9LAoJCQkJZXJyb3I6IGZ1bmN0aW9uIGVycm9yKHZhbHVlKSB7CgkJCQkJdmFyIHN1YnNjcmlwdGlvbiA9IHRoaXMuX3M7CgkJCQkJaWYgKHN1YnNjcmlwdGlvbkNsb3NlZChzdWJzY3JpcHRpb24pKSB0aHJvdyB2YWx1ZTsKCQkJCQl2YXIgb2JzZXJ2ZXIgPSBzdWJzY3JpcHRpb24uX287CgkJCQkJc3Vic2NyaXB0aW9uLl9vID0gdW5kZWZpbmVkOwoJCQkJCXRyeSB7CgkJCQkJCXZhciBtID0gZ2V0TWV0aG9kKG9ic2VydmVyLmVycm9yKTsKCQkJCQkJaWYgKCFtKSB0aHJvdyB2YWx1ZTsKCQkJCQkJdmFsdWUgPSBtLmNhbGwob2JzZXJ2ZXIsIHZhbHVlKTsKCQkJCQl9IGNhdGNoIChlKSB7CgkJCQkJCXRyeSB7CgkJCQkJCQljbGVhbnVwU3Vic2NyaXB0aW9uKHN1YnNjcmlwdGlvbik7CgkJCQkJCX0gZmluYWxseSB7CgkJCQkJCQl0aHJvdyBlOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWNsZWFudXBTdWJzY3JpcHRpb24oc3Vic2NyaXB0aW9uKTsKCQkJCQlyZXR1cm4gdmFsdWU7CgkJCQl9LAoJCQkJY29tcGxldGU6IGZ1bmN0aW9uIGNvbXBsZXRlKHZhbHVlKSB7CgkJCQkJdmFyIHN1YnNjcmlwdGlvbiA9IHRoaXMuX3M7CgkJCQkJaWYgKCFzdWJzY3JpcHRpb25DbG9zZWQoc3Vic2NyaXB0aW9uKSkgewoJCQkJCQl2YXIgb2JzZXJ2ZXIgPSBzdWJzY3JpcHRpb24uX287CgkJCQkJCXN1YnNjcmlwdGlvbi5fbyA9IHVuZGVmaW5lZDsKCQkJCQkJdHJ5IHsKCQkJCQkJCXZhciBtID0gZ2V0TWV0aG9kKG9ic2VydmVyLmNvbXBsZXRlKTsKCQkJCQkJCXZhbHVlID0gbSA/IG0uY2FsbChvYnNlcnZlciwgdmFsdWUpIDogdW5kZWZpbmVkOwoJCQkJCQl9IGNhdGNoIChlKSB7CgkJCQkJCQl0cnkgewoJCQkJCQkJCWNsZWFudXBTdWJzY3JpcHRpb24oc3Vic2NyaXB0aW9uKTsKCQkJCQkJCX0gZmluYWxseSB7CgkJCQkJCQkJdGhyb3cgZTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQljbGVhbnVwU3Vic2NyaXB0aW9uKHN1YnNjcmlwdGlvbik7CgkJCQkJCXJldHVybiB2YWx1ZTsKCQkJCQl9CgkJCQl9CgkJCX0pOwoJCQl2YXIgJE9ic2VydmFibGUgPSBmdW5jdGlvbiBPYnNlcnZhYmxlKHN1YnNjcmliZXIpIHsKCQkJCWFuSW5zdGFuY2UodGhpcywgJE9ic2VydmFibGUsICdPYnNlcnZhYmxlJywgJ19mJykuX2YgPSBhRnVuY3Rpb24oc3Vic2NyaWJlcik7CgkJCX07CgkJCXJlZGVmaW5lQWxsKCRPYnNlcnZhYmxlLnByb3RvdHlwZSwgewoJCQkJc3Vic2NyaWJlOiBmdW5jdGlvbiBzdWJzY3JpYmUob2JzZXJ2ZXIpIHsKCQkJCQlyZXR1cm4gbmV3IFN1YnNjcmlwdGlvbihvYnNlcnZlciwgdGhpcy5fZik7CgkJCQl9LAoJCQkJZm9yRWFjaDogZnVuY3Rpb24gZm9yRWFjaChmbikgewoJCQkJCXZhciB0aGF0ID0gdGhpczsKCQkJCQlyZXR1cm4gbmV3IChjb3JlLlByb21pc2UgfHwgZ2xvYmFsLlByb21pc2UpKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkgewoJCQkJCQlhRnVuY3Rpb24oZm4pOwoJCQkJCQl2YXIgc3Vic2NyaXB0aW9uID0gdGhhdC5zdWJzY3JpYmUoewoJCQkJCQkJbmV4dDogZnVuY3Rpb24gbmV4dCh2YWx1ZSkgewoJCQkJCQkJCXRyeSB7CgkJCQkJCQkJCXJldHVybiBmbih2YWx1ZSk7CgkJCQkJCQkJfSBjYXRjaCAoZSkgewoJCQkJCQkJCQlyZWplY3QoZSk7CgkJCQkJCQkJCXN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpOwoJCQkJCQkJCX0KCQkJCQkJCX0sCgkJCQkJCQllcnJvcjogcmVqZWN0LAoJCQkJCQkJY29tcGxldGU6IHJlc29sdmUKCQkJCQkJfSk7CgkJCQkJfSk7CgkJCQl9CgkJCX0pOwoJCQlyZWRlZmluZUFsbCgkT2JzZXJ2YWJsZSwgewoJCQkJZnJvbTogZnVuY3Rpb24gZnJvbSh4KSB7CgkJCQkJdmFyIEMgPSB0eXBlb2YgdGhpcyA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMgOiAkT2JzZXJ2YWJsZTsKCQkJCQl2YXIgbWV0aG9kID0gZ2V0TWV0aG9kKGFuT2JqZWN0KHgpW09CU0VSVkFCTEVdKTsKCQkJCQlpZiAobWV0aG9kKSB7CgkJCQkJCXZhciBvYnNlcnZhYmxlID0gYW5PYmplY3QobWV0aG9kLmNhbGwoeCkpOwoJCQkJCQlyZXR1cm4gb2JzZXJ2YWJsZS5jb25zdHJ1Y3RvciA9PT0gQyA/IG9ic2VydmFibGUgOiBuZXcgQyhmdW5jdGlvbihvYnNlcnZlcikgewoJCQkJCQkJcmV0dXJuIG9ic2VydmFibGUuc3Vic2NyaWJlKG9ic2VydmVyKTsKCQkJCQkJfSk7CgkJCQkJfQoJCQkJCXJldHVybiBuZXcgQyhmdW5jdGlvbihvYnNlcnZlcikgewoJCQkJCQl2YXIgZG9uZSA9IGZhbHNlOwoJCQkJCQltaWNyb3Rhc2soZnVuY3Rpb24oKSB7CgkJCQkJCQlpZiAoIWRvbmUpIHsKCQkJCQkJCQl0cnkgewoJCQkJCQkJCQlpZiAoZm9yT2YoeCwgZmFsc2UsIGZ1bmN0aW9uKGl0KSB7CgkJCQkJCQkJCQlvYnNlcnZlci5uZXh0KGl0KTsKCQkJCQkJCQkJCWlmIChkb25lKSByZXR1cm4gUkVUVVJOOwoJCQkJCQkJCQl9KSA9PT0gUkVUVVJOKSByZXR1cm47CgkJCQkJCQkJfSBjYXRjaCAoZSkgewoJCQkJCQkJCQlpZiAoZG9uZSkgdGhyb3cgZTsKCQkJCQkJCQkJb2JzZXJ2ZXIuZXJyb3IoZSk7CgkJCQkJCQkJCXJldHVybjsKCQkJCQkJCQl9CgkJCQkJCQkJb2JzZXJ2ZXIuY29tcGxldGUoKTsKCQkJCQkJCX0KCQkJCQkJfSk7CgkJCQkJCXJldHVybiBmdW5jdGlvbigpIHsKCQkJCQkJCWRvbmUgPSB0cnVlOwoJCQkJCQl9OwoJCQkJCX0pOwoJCQkJfSwKCQkJCW9mOiBmdW5jdGlvbiBvZigpIHsKCQkJCQlmb3IgKHZhciBpID0gMCwgbCA9IGFyZ3VtZW50cy5sZW5ndGgsIGl0ZW1zID0gbmV3IEFycmF5KGwpOyBpIDwgbDspIGl0ZW1zW2ldID0gYXJndW1lbnRzW2krK107CgkJCQkJcmV0dXJuIG5ldyAodHlwZW9mIHRoaXMgPT09ICdmdW5jdGlvbicgPyB0aGlzIDogJE9ic2VydmFibGUpKGZ1bmN0aW9uKG9ic2VydmVyKSB7CgkJCQkJCXZhciBkb25lID0gZmFsc2U7CgkJCQkJCW1pY3JvdGFzayhmdW5jdGlvbigpIHsKCQkJCQkJCWlmICghZG9uZSkgewoJCQkJCQkJCWZvciAodmFyIGogPSAwOyBqIDwgaXRlbXMubGVuZ3RoOyArK2opIHsKCQkJCQkJCQkJb2JzZXJ2ZXIubmV4dChpdGVtc1tqXSk7CgkJCQkJCQkJCWlmIChkb25lKSByZXR1cm47CgkJCQkJCQkJfQoJCQkJCQkJCW9ic2VydmVyLmNvbXBsZXRlKCk7CgkJCQkJCQl9CgkJCQkJCX0pOwoJCQkJCQlyZXR1cm4gZnVuY3Rpb24oKSB7CgkJCQkJCQlkb25lID0gdHJ1ZTsKCQkJCQkJfTsKCQkJCQl9KTsKCQkJCX0KCQkJfSk7CgkJCWhpZGUoJE9ic2VydmFibGUucHJvdG90eXBlLCBPQlNFUlZBQkxFLCBmdW5jdGlvbigpIHsKCQkJCXJldHVybiB0aGlzOwoJCQl9KTsKCQkJJGV4cG9ydCgkZXhwb3J0LkcsIHsKCQkJCU9ic2VydmFibGU6ICRPYnNlcnZhYmxlCgkJCX0pOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDIzMzQpKCdPYnNlcnZhYmxlJyk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA2MzIzOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwovLyBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9wcm9wb3NhbC1wcm9taXNlLWZpbmFsbHkKCgoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciBjb3JlID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MTY1KTsKCQkJdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oOTc2OSk7CgkJCXZhciBzcGVjaWVzQ29uc3RydWN0b3IgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc1NTQpOwoJCQl2YXIgcHJvbWlzZVJlc29sdmUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYzNzkpOwoJCQkkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuUiwgJ1Byb21pc2UnLCB7CgkJCQknZmluYWxseSc6IGZ1bmN0aW9uIF9maW5hbGx5KG9uRmluYWxseSkgewoJCQkJCXZhciBDID0gc3BlY2llc0NvbnN0cnVjdG9yKHRoaXMsIGNvcmUuUHJvbWlzZSB8fCBnbG9iYWwuUHJvbWlzZSk7CgkJCQkJdmFyIGlzRnVuY3Rpb24gPSB0eXBlb2Ygb25GaW5hbGx5ID09ICdmdW5jdGlvbic7CgkJCQkJcmV0dXJuIHRoaXMudGhlbihpc0Z1bmN0aW9uID8gZnVuY3Rpb24oeCkgewoJCQkJCQlyZXR1cm4gcHJvbWlzZVJlc29sdmUoQywgb25GaW5hbGx5KCkpLnRoZW4oZnVuY3Rpb24oKSB7CgkJCQkJCQlyZXR1cm4geDsKCQkJCQkJfSk7CgkJCQkJfSA6IG9uRmluYWxseSwgaXNGdW5jdGlvbiA/IGZ1bmN0aW9uKGUpIHsKCQkJCQkJcmV0dXJuIHByb21pc2VSZXNvbHZlKEMsIG9uRmluYWxseSgpKS50aGVuKGZ1bmN0aW9uKCkgewoJCQkJCQkJdGhyb3cgZTsKCQkJCQkJfSk7CgkJCQkJfSA6IG9uRmluYWxseSk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMjIwMToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9wcm9wb3NhbC1wcm9taXNlLXRyeQoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciBuZXdQcm9taXNlQ2FwYWJpbGl0eSA9IF9fd2VicGFja19yZXF1aXJlX18oMjYzOCk7CgkJCXZhciBwZXJmb3JtID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNjQyKTsKCQkJJGV4cG9ydCgkZXhwb3J0LlMsICdQcm9taXNlJywgewoJCQkJJ3RyeSc6IGZ1bmN0aW9uIF90cnkoY2FsbGJhY2tmbikgewoJCQkJCXZhciBwcm9taXNlQ2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5LmYodGhpcyk7CgkJCQkJdmFyIHJlc3VsdCA9IHBlcmZvcm0oY2FsbGJhY2tmbik7CgkJCQkJKHJlc3VsdC5lID8gcHJvbWlzZUNhcGFiaWxpdHkucmVqZWN0IDogcHJvbWlzZUNhcGFiaWxpdHkucmVzb2x2ZSkocmVzdWx0LnYpOwoJCQkJCXJldHVybiBwcm9taXNlQ2FwYWJpbGl0eS5wcm9taXNlOwoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDI1NDQ6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgbWV0YWRhdGEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg1NTgpOwoJCQl2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYxNjYpOwoJCQl2YXIgdG9NZXRhS2V5ID0gbWV0YWRhdGEua2V5OwoJCQl2YXIgb3JkaW5hcnlEZWZpbmVPd25NZXRhZGF0YSA9IG1ldGFkYXRhLnNldDsKCQkJbWV0YWRhdGEuZXhwKHsKCQkJCWRlZmluZU1ldGFkYXRhOiBmdW5jdGlvbiBkZWZpbmVNZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSwgdGFyZ2V0LCB0YXJnZXRLZXkpIHsKCQkJCQlvcmRpbmFyeURlZmluZU93bk1ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlLCBhbk9iamVjdCh0YXJnZXQpLCB0b01ldGFLZXkodGFyZ2V0S2V5KSk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gOTMyNzoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciBtZXRhZGF0YSA9IF9fd2VicGFja19yZXF1aXJlX18oODU1OCk7CgkJCXZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNjE2Nik7CgkJCXZhciB0b01ldGFLZXkgPSBtZXRhZGF0YS5rZXk7CgkJCXZhciBnZXRPckNyZWF0ZU1ldGFkYXRhTWFwID0gbWV0YWRhdGEubWFwOwoJCQl2YXIgc3RvcmUgPSBtZXRhZGF0YS5zdG9yZTsKCQkJbWV0YWRhdGEuZXhwKHsKCQkJCWRlbGV0ZU1ldGFkYXRhOiBmdW5jdGlvbiBkZWxldGVNZXRhZGF0YShtZXRhZGF0YUtleSwgdGFyZ2V0IC8qICwgdGFyZ2V0S2V5ICovKSB7CgkJCQkJdmFyIHRhcmdldEtleSA9IGFyZ3VtZW50cy5sZW5ndGggPCAzID8gdW5kZWZpbmVkIDogdG9NZXRhS2V5KGFyZ3VtZW50c1syXSk7CgkJCQkJdmFyIG1ldGFkYXRhTWFwID0gZ2V0T3JDcmVhdGVNZXRhZGF0YU1hcChhbk9iamVjdCh0YXJnZXQpLCB0YXJnZXRLZXksIGZhbHNlKTsKCQkJCQlpZiAobWV0YWRhdGFNYXAgPT09IHVuZGVmaW5lZCB8fCAhbWV0YWRhdGFNYXBbJ2RlbGV0ZSddKG1ldGFkYXRhS2V5KSkgcmV0dXJuIGZhbHNlOwoJCQkJCWlmIChtZXRhZGF0YU1hcC5zaXplKSByZXR1cm4gdHJ1ZTsKCQkJCQl2YXIgdGFyZ2V0TWV0YWRhdGEgPSBzdG9yZS5nZXQodGFyZ2V0KTsKCQkJCQl0YXJnZXRNZXRhZGF0YVsnZGVsZXRlJ10odGFyZ2V0S2V5KTsKCQkJCQlyZXR1cm4gISF0YXJnZXRNZXRhZGF0YS5zaXplIHx8IHN0b3JlWydkZWxldGUnXSh0YXJnZXQpOwoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDI2NzI6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIgU2V0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2ODI1KTsKCQkJdmFyIGZyb20gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDgxODIpOwoJCQl2YXIgbWV0YWRhdGEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg1NTgpOwoJCQl2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYxNjYpOwoJCQl2YXIgZ2V0UHJvdG90eXBlT2YgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg5OTYpOwoJCQl2YXIgb3JkaW5hcnlPd25NZXRhZGF0YUtleXMgPSBtZXRhZGF0YS5rZXlzOwoJCQl2YXIgdG9NZXRhS2V5ID0gbWV0YWRhdGEua2V5OwoJCQl2YXIgb3JkaW5hcnlNZXRhZGF0YUtleXMgPSBmdW5jdGlvbiBvcmRpbmFyeU1ldGFkYXRhS2V5cyhPLCBQKSB7CgkJCQl2YXIgb0tleXMgPSBvcmRpbmFyeU93bk1ldGFkYXRhS2V5cyhPLCBQKTsKCQkJCXZhciBwYXJlbnQgPSBnZXRQcm90b3R5cGVPZihPKTsKCQkJCWlmIChwYXJlbnQgPT09IG51bGwpIHJldHVybiBvS2V5czsKCQkJCXZhciBwS2V5cyA9IG9yZGluYXJ5TWV0YWRhdGFLZXlzKHBhcmVudCwgUCk7CgkJCQlyZXR1cm4gcEtleXMubGVuZ3RoID8gb0tleXMubGVuZ3RoID8gZnJvbShuZXcgU2V0KG9LZXlzLmNvbmNhdChwS2V5cykpKSA6IHBLZXlzIDogb0tleXM7CgkJCX07CgkJCW1ldGFkYXRhLmV4cCh7CgkJCQlnZXRNZXRhZGF0YUtleXM6IGZ1bmN0aW9uIGdldE1ldGFkYXRhS2V5cyh0YXJnZXQgLyogLCB0YXJnZXRLZXkgKi8pIHsKCQkJCQlyZXR1cm4gb3JkaW5hcnlNZXRhZGF0YUtleXMoYW5PYmplY3QodGFyZ2V0KSwgYXJndW1lbnRzLmxlbmd0aCA8IDIgPyB1bmRlZmluZWQgOiB0b01ldGFLZXkoYXJndW1lbnRzWzFdKSk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNDUzODoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciBtZXRhZGF0YSA9IF9fd2VicGFja19yZXF1aXJlX18oODU1OCk7CgkJCXZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNjE2Nik7CgkJCXZhciBnZXRQcm90b3R5cGVPZiA9IF9fd2VicGFja19yZXF1aXJlX18oODk5Nik7CgkJCXZhciBvcmRpbmFyeUhhc093bk1ldGFkYXRhID0gbWV0YWRhdGEuaGFzOwoJCQl2YXIgb3JkaW5hcnlHZXRPd25NZXRhZGF0YSA9IG1ldGFkYXRhLmdldDsKCQkJdmFyIHRvTWV0YUtleSA9IG1ldGFkYXRhLmtleTsKCQkJdmFyIG9yZGluYXJ5R2V0TWV0YWRhdGEgPSBmdW5jdGlvbiBvcmRpbmFyeUdldE1ldGFkYXRhKE1ldGFkYXRhS2V5LCBPLCBQKSB7CgkJCQl2YXIgaGFzT3duID0gb3JkaW5hcnlIYXNPd25NZXRhZGF0YShNZXRhZGF0YUtleSwgTywgUCk7CgkJCQlpZiAoaGFzT3duKSByZXR1cm4gb3JkaW5hcnlHZXRPd25NZXRhZGF0YShNZXRhZGF0YUtleSwgTywgUCk7CgkJCQl2YXIgcGFyZW50ID0gZ2V0UHJvdG90eXBlT2YoTyk7CgkJCQlyZXR1cm4gcGFyZW50ICE9PSBudWxsID8gb3JkaW5hcnlHZXRNZXRhZGF0YShNZXRhZGF0YUtleSwgcGFyZW50LCBQKSA6IHVuZGVmaW5lZDsKCQkJfTsKCQkJbWV0YWRhdGEuZXhwKHsKCQkJCWdldE1ldGFkYXRhOiBmdW5jdGlvbiBnZXRNZXRhZGF0YShtZXRhZGF0YUtleSwgdGFyZ2V0IC8qICwgdGFyZ2V0S2V5ICovKSB7CgkJCQkJcmV0dXJuIG9yZGluYXJ5R2V0TWV0YWRhdGEobWV0YWRhdGFLZXksIGFuT2JqZWN0KHRhcmdldCksIGFyZ3VtZW50cy5sZW5ndGggPCAzID8gdW5kZWZpbmVkIDogdG9NZXRhS2V5KGFyZ3VtZW50c1syXSkpOwoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDM3NToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciBtZXRhZGF0YSA9IF9fd2VicGFja19yZXF1aXJlX18oODU1OCk7CgkJCXZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNjE2Nik7CgkJCXZhciBvcmRpbmFyeU93bk1ldGFkYXRhS2V5cyA9IG1ldGFkYXRhLmtleXM7CgkJCXZhciB0b01ldGFLZXkgPSBtZXRhZGF0YS5rZXk7CgkJCW1ldGFkYXRhLmV4cCh7CgkJCQlnZXRPd25NZXRhZGF0YUtleXM6IGZ1bmN0aW9uIGdldE93bk1ldGFkYXRhS2V5cyh0YXJnZXQgLyogLCB0YXJnZXRLZXkgKi8pIHsKCQkJCQlyZXR1cm4gb3JkaW5hcnlPd25NZXRhZGF0YUtleXMoYW5PYmplY3QodGFyZ2V0KSwgYXJndW1lbnRzLmxlbmd0aCA8IDIgPyB1bmRlZmluZWQgOiB0b01ldGFLZXkoYXJndW1lbnRzWzFdKSk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNDYxOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJdmFyIG1ldGFkYXRhID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4NTU4KTsKCQkJdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MTY2KTsKCQkJdmFyIG9yZGluYXJ5R2V0T3duTWV0YWRhdGEgPSBtZXRhZGF0YS5nZXQ7CgkJCXZhciB0b01ldGFLZXkgPSBtZXRhZGF0YS5rZXk7CgkJCW1ldGFkYXRhLmV4cCh7CgkJCQlnZXRPd25NZXRhZGF0YTogZnVuY3Rpb24gZ2V0T3duTWV0YWRhdGEobWV0YWRhdGFLZXksIHRhcmdldCAvKiAsIHRhcmdldEtleSAqLykgewoJCQkJCXJldHVybiBvcmRpbmFyeUdldE93bk1ldGFkYXRhKG1ldGFkYXRhS2V5LCBhbk9iamVjdCh0YXJnZXQpLCBhcmd1bWVudHMubGVuZ3RoIDwgMyA/IHVuZGVmaW5lZCA6IHRvTWV0YUtleShhcmd1bWVudHNbMl0pKTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAyMjU1OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJdmFyIG1ldGFkYXRhID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4NTU4KTsKCQkJdmFyIGFuT2JqZWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg2MTY2KTsKCQkJdmFyIGdldFByb3RvdHlwZU9mID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4OTk2KTsKCQkJdmFyIG9yZGluYXJ5SGFzT3duTWV0YWRhdGEgPSBtZXRhZGF0YS5oYXM7CgkJCXZhciB0b01ldGFLZXkgPSBtZXRhZGF0YS5rZXk7CgkJCXZhciBvcmRpbmFyeUhhc01ldGFkYXRhID0gZnVuY3Rpb24gb3JkaW5hcnlIYXNNZXRhZGF0YShNZXRhZGF0YUtleSwgTywgUCkgewoJCQkJdmFyIGhhc093biA9IG9yZGluYXJ5SGFzT3duTWV0YWRhdGEoTWV0YWRhdGFLZXksIE8sIFApOwoJCQkJaWYgKGhhc093bikgcmV0dXJuIHRydWU7CgkJCQl2YXIgcGFyZW50ID0gZ2V0UHJvdG90eXBlT2YoTyk7CgkJCQlyZXR1cm4gcGFyZW50ICE9PSBudWxsID8gb3JkaW5hcnlIYXNNZXRhZGF0YShNZXRhZGF0YUtleSwgcGFyZW50LCBQKSA6IGZhbHNlOwoJCQl9OwoJCQltZXRhZGF0YS5leHAoewoJCQkJaGFzTWV0YWRhdGE6IGZ1bmN0aW9uIGhhc01ldGFkYXRhKG1ldGFkYXRhS2V5LCB0YXJnZXQgLyogLCB0YXJnZXRLZXkgKi8pIHsKCQkJCQlyZXR1cm4gb3JkaW5hcnlIYXNNZXRhZGF0YShtZXRhZGF0YUtleSwgYW5PYmplY3QodGFyZ2V0KSwgYXJndW1lbnRzLmxlbmd0aCA8IDMgPyB1bmRlZmluZWQgOiB0b01ldGFLZXkoYXJndW1lbnRzWzJdKSk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMzU0MDoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciBtZXRhZGF0YSA9IF9fd2VicGFja19yZXF1aXJlX18oODU1OCk7CgkJCXZhciBhbk9iamVjdCA9IF9fd2VicGFja19yZXF1aXJlX18oNjE2Nik7CgkJCXZhciBvcmRpbmFyeUhhc093bk1ldGFkYXRhID0gbWV0YWRhdGEuaGFzOwoJCQl2YXIgdG9NZXRhS2V5ID0gbWV0YWRhdGEua2V5OwoJCQltZXRhZGF0YS5leHAoewoJCQkJaGFzT3duTWV0YWRhdGE6IGZ1bmN0aW9uIGhhc093bk1ldGFkYXRhKG1ldGFkYXRhS2V5LCB0YXJnZXQgLyogLCB0YXJnZXRLZXkgKi8pIHsKCQkJCQlyZXR1cm4gb3JkaW5hcnlIYXNPd25NZXRhZGF0YShtZXRhZGF0YUtleSwgYW5PYmplY3QodGFyZ2V0KSwgYXJndW1lbnRzLmxlbmd0aCA8IDMgPyB1bmRlZmluZWQgOiB0b01ldGFLZXkoYXJndW1lbnRzWzJdKSk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gOTA2MDoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciAkbWV0YWRhdGEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg1NTgpOwoJCQl2YXIgYW5PYmplY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDYxNjYpOwoJCQl2YXIgYUZ1bmN0aW9uID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0ODEwKTsKCQkJdmFyIHRvTWV0YUtleSA9ICRtZXRhZGF0YS5rZXk7CgkJCXZhciBvcmRpbmFyeURlZmluZU93bk1ldGFkYXRhID0gJG1ldGFkYXRhLnNldDsKCQkJJG1ldGFkYXRhLmV4cCh7CgkJCQltZXRhZGF0YTogZnVuY3Rpb24gbWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpIHsKCQkJCQlyZXR1cm4gZnVuY3Rpb24gZGVjb3JhdG9yKHRhcmdldCwgdGFyZ2V0S2V5KSB7CgkJCQkJCW9yZGluYXJ5RGVmaW5lT3duTWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUsICh0YXJnZXRLZXkgIT09IHVuZGVmaW5lZCA/IGFuT2JqZWN0IDogYUZ1bmN0aW9uKSh0YXJnZXQpLCB0b01ldGFLZXkodGFyZ2V0S2V5KSk7CgkJCQkJfTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA1NTY5OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gaHR0cHM6Ly90YzM5LmdpdGh1Yi5pby9wcm9wb3NhbC1zZXRtYXAtb2Zmcm9tLyNzZWMtc2V0LmZyb20KCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg2NzQyKSgnU2V0Jyk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAyNzQyOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gaHR0cHM6Ly90YzM5LmdpdGh1Yi5pby9wcm9wb3NhbC1zZXRtYXAtb2Zmcm9tLyNzZWMtc2V0Lm9mCgkJCV9fd2VicGFja19yZXF1aXJlX18oNjU4NikoJ1NldCcpOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gOTQ2NToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9EYXZpZEJydWFudC9NYXAtU2V0LnByb3RvdHlwZS50b0pTT04KCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQkkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuUiwgJ1NldCcsIHsKCQkJCXRvSlNPTjogX193ZWJwYWNrX3JlcXVpcmVfXyg2NjcxKSgnU2V0JykKCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA2Njk4OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9tYXRoaWFzYnluZW5zL1N0cmluZy5wcm90b3R5cGUuYXQKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQl2YXIgJGF0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NzMwKSh0cnVlKTsKCQkJdmFyICRmYWlscyA9IF9fd2VicGFja19yZXF1aXJlX18oMTI4KTsKCQkJdmFyIEZPUkNFRCA9ICRmYWlscyhmdW5jdGlvbigpIHsKCQkJCXJldHVybiAn8KCutycuYXQoMCkgIT09ICfwoK63JzsKCQkJfSk7CgkJCSRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogRk9SQ0VELCAnU3RyaW5nJywgewoJCQkJYXQ6IGZ1bmN0aW9uIGF0KHBvcykgewoJCQkJCXJldHVybiAkYXQodGhpcywgcG9zKTsKCQkJCX0KCQkJfSk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAxMzY3OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCi8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vU3RyaW5nLnByb3RvdHlwZS5tYXRjaEFsbC8KCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQl2YXIgZGVmaW5lZCA9IF9fd2VicGFja19yZXF1aXJlX18oNzE4OSk7CgkJCXZhciB0b0xlbmd0aCA9IF9fd2VicGFja19yZXF1aXJlX18oNTIwMSk7CgkJCXZhciBpc1JlZ0V4cCA9IF9fd2VicGFja19yZXF1aXJlX18oODQzMCk7CgkJCXZhciBnZXRGbGFncyA9IF9fd2VicGFja19yZXF1aXJlX18oMTU1OCk7CgkJCXZhciBSZWdFeHBQcm90byA9IFJlZ0V4cC5wcm90b3R5cGU7CgkJCXZhciAkUmVnRXhwU3RyaW5nSXRlcmF0b3IgPSBmdW5jdGlvbiAkUmVnRXhwU3RyaW5nSXRlcmF0b3IocmVnZXhwLCBzdHJpbmcpIHsKCQkJCXRoaXMuX3IgPSByZWdleHA7CgkJCQl0aGlzLl9zID0gc3RyaW5nOwoJCQl9OwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDgzMTEpKCRSZWdFeHBTdHJpbmdJdGVyYXRvciwgJ1JlZ0V4cCBTdHJpbmcnLCBmdW5jdGlvbiBuZXh0KCkgewoJCQkJdmFyIG1hdGNoID0gdGhpcy5fci5leGVjKHRoaXMuX3MpOwoJCQkJcmV0dXJuIHsKCQkJCQl2YWx1ZTogbWF0Y2gsCgkJCQkJZG9uZTogbWF0Y2ggPT09IG51bGwKCQkJCX07CgkJCX0pOwoJCQkkZXhwb3J0KCRleHBvcnQuUCwgJ1N0cmluZycsIHsKCQkJCW1hdGNoQWxsOiBmdW5jdGlvbiBtYXRjaEFsbChyZWdleHApIHsKCQkJCQlkZWZpbmVkKHRoaXMpOwoJCQkJCWlmICghaXNSZWdFeHAocmVnZXhwKSkgdGhyb3cgVHlwZUVycm9yKHJlZ2V4cCArICcgaXMgbm90IGEgcmVnZXhwIScpOwoJCQkJCXZhciBTID0gU3RyaW5nKHRoaXMpOwoJCQkJCXZhciBmbGFncyA9ICdmbGFncycgaW4gUmVnRXhwUHJvdG8gPyBTdHJpbmcocmVnZXhwLmZsYWdzKSA6IGdldEZsYWdzLmNhbGwocmVnZXhwKTsKCQkJCQl2YXIgcnggPSBuZXcgUmVnRXhwKHJlZ2V4cC5zb3VyY2UsIH5mbGFncy5pbmRleE9mKCdnJykgPyBmbGFncyA6ICdnJyArIGZsYWdzKTsKCQkJCQlyeC5sYXN0SW5kZXggPSB0b0xlbmd0aChyZWdleHAubGFzdEluZGV4KTsKCQkJCQlyZXR1cm4gbmV3ICRSZWdFeHBTdHJpbmdJdGVyYXRvcihyeCwgUyk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNjEwOgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJJ3VzZSBzdHJpY3QnOwoKCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS90YzM5L3Byb3Bvc2FsLXN0cmluZy1wYWQtc3RhcnQtZW5kCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyICRwYWQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc4NDEpOwoJCQl2YXIgdXNlckFnZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5OTg3KTsKCi8vIGh0dHBzOi8vZ2l0aHViLmNvbS96bG9pcm9jay9jb3JlLWpzL2lzc3Vlcy8yODAKCQkJdmFyIFdFQktJVF9CVUcgPSAvVmVyc2lvblwvMTBcLlxkKyhcLlxkKyk/KCBNb2JpbGVcL1x3Kyk/IFNhZmFyaVwvLy50ZXN0KHVzZXJBZ2VudCk7CgkJCSRleHBvcnQoJGV4cG9ydC5QICsgJGV4cG9ydC5GICogV0VCS0lUX0JVRywgJ1N0cmluZycsIHsKCQkJCXBhZEVuZDogZnVuY3Rpb24gcGFkRW5kKG1heExlbmd0aCAvKiAsIGZpbGxTdHJpbmcgPSAnICcgKi8pIHsKCQkJCQlyZXR1cm4gJHBhZCh0aGlzLCBtYXhMZW5ndGgsIGFyZ3VtZW50cy5sZW5ndGggPiAxID8gYXJndW1lbnRzWzFdIDogdW5kZWZpbmVkLCBmYWxzZSk7CgkJCQl9CgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMTgzNjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9wcm9wb3NhbC1zdHJpbmctcGFkLXN0YXJ0LWVuZAoJCQl2YXIgJGV4cG9ydCA9IF9fd2VicGFja19yZXF1aXJlX18oNDE5NCk7CgkJCXZhciAkcGFkID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3ODQxKTsKCQkJdmFyIHVzZXJBZ2VudCA9IF9fd2VicGFja19yZXF1aXJlX18oOTk4Nyk7CgovLyBodHRwczovL2dpdGh1Yi5jb20vemxvaXJvY2svY29yZS1qcy9pc3N1ZXMvMjgwCgkJCXZhciBXRUJLSVRfQlVHID0gL1ZlcnNpb25cLzEwXC5cZCsoXC5cZCspPyggTW9iaWxlXC9cdyspPyBTYWZhcmlcLy8udGVzdCh1c2VyQWdlbnQpOwoJCQkkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIFdFQktJVF9CVUcsICdTdHJpbmcnLCB7CgkJCQlwYWRTdGFydDogZnVuY3Rpb24gcGFkU3RhcnQobWF4TGVuZ3RoIC8qICwgZmlsbFN0cmluZyA9ICcgJyAqLykgewoJCQkJCXJldHVybiAkcGFkKHRoaXMsIG1heExlbmd0aCwgYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQsIHRydWUpOwoJCQkJfQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDIzNjg6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQkndXNlIHN0cmljdCc7CgoKLy8gaHR0cHM6Ly9naXRodWIuY29tL3NlYm1hcmtiYWdlL2VjbWFzY3JpcHQtc3RyaW5nLWxlZnQtcmlnaHQtdHJpbQoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDUzNTYpKCd0cmltTGVmdCcsIGZ1bmN0aW9uKCR0cmltKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24gdHJpbUxlZnQoKSB7CgkJCQkJcmV0dXJuICR0cmltKHRoaXMsIDEpOwoJCQkJfTsKCQkJfSwgJ3RyaW1TdGFydCcpOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gOTYxNjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCgovLyBodHRwczovL2dpdGh1Yi5jb20vc2VibWFya2JhZ2UvZWNtYXNjcmlwdC1zdHJpbmctbGVmdC1yaWdodC10cmltCgkJCV9fd2VicGFja19yZXF1aXJlX18oNTM1NikoJ3RyaW1SaWdodCcsIGZ1bmN0aW9uKCR0cmltKSB7CgkJCQlyZXR1cm4gZnVuY3Rpb24gdHJpbVJpZ2h0KCkgewoJCQkJCXJldHVybiAkdHJpbSh0aGlzLCAyKTsKCQkJCX07CgkJCX0sICd0cmltRW5kJyk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA0MDI2OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg0NTg0KSgnYXN5bmNJdGVyYXRvcicpOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gOTMzMToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCV9fd2VicGFja19yZXF1aXJlX18oNDU4NCkoJ29ic2VydmFibGUnKTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDg3MTE6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9wcm9wb3NhbC1nbG9iYWwKCQkJdmFyICRleHBvcnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOTQpOwoJCQkkZXhwb3J0KCRleHBvcnQuUywgJ1N5c3RlbScsIHsKCQkJCWdsb2JhbDogX193ZWJwYWNrX3JlcXVpcmVfXyg5NzY5KQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDYwMzU6CgkJLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgovLyBodHRwczovL3RjMzkuZ2l0aHViLmlvL3Byb3Bvc2FsLXNldG1hcC1vZmZyb20vI3NlYy13ZWFrbWFwLmZyb20KCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg2NzQyKSgnV2Vha01hcCcpOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMjI0NjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vcHJvcG9zYWwtc2V0bWFwLW9mZnJvbS8jc2VjLXdlYWttYXAub2YKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg2NTg2KSgnV2Vha01hcCcpOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMTc2NToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIGh0dHBzOi8vdGMzOS5naXRodWIuaW8vcHJvcG9zYWwtc2V0bWFwLW9mZnJvbS8jc2VjLXdlYWtzZXQuZnJvbQoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDY3NDIpKCdXZWFrU2V0Jyk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA4NDI3OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKLy8gaHR0cHM6Ly90YzM5LmdpdGh1Yi5pby9wcm9wb3NhbC1zZXRtYXAtb2Zmcm9tLyNzZWMtd2Vha3NldC5vZgoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDY1ODYpKCdXZWFrU2V0Jyk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAzOTg2OgoJCS8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJdmFyICRpdGVyYXRvcnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg3MjYpOwoJCQl2YXIgZ2V0S2V5cyA9IF9fd2VicGFja19yZXF1aXJlX18oNjQzNik7CgkJCXZhciByZWRlZmluZSA9IF9fd2VicGFja19yZXF1aXJlX18oODkxNCk7CgkJCXZhciBnbG9iYWwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDk3NjkpOwoJCQl2YXIgaGlkZSA9IF9fd2VicGFja19yZXF1aXJlX18oOTAzNik7CgkJCXZhciBJdGVyYXRvcnMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDM0NDQpOwoJCQl2YXIgd2tzID0gX193ZWJwYWNrX3JlcXVpcmVfXygyODY3KTsKCQkJdmFyIElURVJBVE9SID0gd2tzKCdpdGVyYXRvcicpOwoJCQl2YXIgVE9fU1RSSU5HX1RBRyA9IHdrcygndG9TdHJpbmdUYWcnKTsKCQkJdmFyIEFycmF5VmFsdWVzID0gSXRlcmF0b3JzLkFycmF5OwoJCQl2YXIgRE9NSXRlcmFibGVzID0gewoJCQkJQ1NTUnVsZUxpc3Q6IHRydWUsCgkJCQkvLyBUT0RPOiBOb3Qgc3BlYyBjb21wbGlhbnQsIHNob3VsZCBiZSBmYWxzZS4KCQkJCUNTU1N0eWxlRGVjbGFyYXRpb246IGZhbHNlLAoJCQkJQ1NTVmFsdWVMaXN0OiBmYWxzZSwKCQkJCUNsaWVudFJlY3RMaXN0OiBmYWxzZSwKCQkJCURPTVJlY3RMaXN0OiBmYWxzZSwKCQkJCURPTVN0cmluZ0xpc3Q6IGZhbHNlLAoJCQkJRE9NVG9rZW5MaXN0OiB0cnVlLAoJCQkJRGF0YVRyYW5zZmVySXRlbUxpc3Q6IGZhbHNlLAoJCQkJRmlsZUxpc3Q6IGZhbHNlLAoJCQkJSFRNTEFsbENvbGxlY3Rpb246IGZhbHNlLAoJCQkJSFRNTENvbGxlY3Rpb246IGZhbHNlLAoJCQkJSFRNTEZvcm1FbGVtZW50OiBmYWxzZSwKCQkJCUhUTUxTZWxlY3RFbGVtZW50OiBmYWxzZSwKCQkJCU1lZGlhTGlzdDogdHJ1ZSwKCQkJCS8vIFRPRE86IE5vdCBzcGVjIGNvbXBsaWFudCwgc2hvdWxkIGJlIGZhbHNlLgoJCQkJTWltZVR5cGVBcnJheTogZmFsc2UsCgkJCQlOYW1lZE5vZGVNYXA6IGZhbHNlLAoJCQkJTm9kZUxpc3Q6IHRydWUsCgkJCQlQYWludFJlcXVlc3RMaXN0OiBmYWxzZSwKCQkJCVBsdWdpbjogZmFsc2UsCgkJCQlQbHVnaW5BcnJheTogZmFsc2UsCgkJCQlTVkdMZW5ndGhMaXN0OiBmYWxzZSwKCQkJCVNWR051bWJlckxpc3Q6IGZhbHNlLAoJCQkJU1ZHUGF0aFNlZ0xpc3Q6IGZhbHNlLAoJCQkJU1ZHUG9pbnRMaXN0OiBmYWxzZSwKCQkJCVNWR1N0cmluZ0xpc3Q6IGZhbHNlLAoJCQkJU1ZHVHJhbnNmb3JtTGlzdDogZmFsc2UsCgkJCQlTb3VyY2VCdWZmZXJMaXN0OiBmYWxzZSwKCQkJCVN0eWxlU2hlZXRMaXN0OiB0cnVlLAoJCQkJLy8gVE9ETzogTm90IHNwZWMgY29tcGxpYW50LCBzaG91bGQgYmUgZmFsc2UuCgkJCQlUZXh0VHJhY2tDdWVMaXN0OiBmYWxzZSwKCQkJCVRleHRUcmFja0xpc3Q6IGZhbHNlLAoJCQkJVG91Y2hMaXN0OiBmYWxzZQoJCQl9OwoJCQlmb3IgKHZhciBjb2xsZWN0aW9ucyA9IGdldEtleXMoRE9NSXRlcmFibGVzKSwgaSA9IDA7IGkgPCBjb2xsZWN0aW9ucy5sZW5ndGg7IGkrKykgewoJCQkJdmFyIE5BTUUgPSBjb2xsZWN0aW9uc1tpXTsKCQkJCXZhciBleHBsaWNpdCA9IERPTUl0ZXJhYmxlc1tOQU1FXTsKCQkJCXZhciBDb2xsZWN0aW9uID0gZ2xvYmFsW05BTUVdOwoJCQkJdmFyIHByb3RvID0gQ29sbGVjdGlvbiAmJiBDb2xsZWN0aW9uLnByb3RvdHlwZTsKCQkJCXZhciBrZXk7CgkJCQlpZiAocHJvdG8pIHsKCQkJCQlpZiAoIXByb3RvW0lURVJBVE9SXSkgaGlkZShwcm90bywgSVRFUkFUT1IsIEFycmF5VmFsdWVzKTsKCQkJCQlpZiAoIXByb3RvW1RPX1NUUklOR19UQUddKSBoaWRlKHByb3RvLCBUT19TVFJJTkdfVEFHLCBOQU1FKTsKCQkJCQlJdGVyYXRvcnNbTkFNRV0gPSBBcnJheVZhbHVlczsKCQkJCQlpZiAoZXhwbGljaXQpIGZvciAoa2V5IGluICRpdGVyYXRvcnMpIGlmICghcHJvdG9ba2V5XSkgcmVkZWZpbmUocHJvdG8sIGtleSwgJGl0ZXJhdG9yc1trZXldLCB0cnVlKTsKCQkJCX0KCQkJfQoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNTM1MjoKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyICR0YXNrID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1MDI5KTsKCQkJJGV4cG9ydCgkZXhwb3J0LkcgKyAkZXhwb3J0LkIsIHsKCQkJCXNldEltbWVkaWF0ZTogJHRhc2suc2V0LAoJCQkJY2xlYXJJbW1lZGlhdGU6ICR0YXNrLmNsZWFyCgkJCX0pOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gODk2MToKCQkvKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCi8vIGllOS0gc2V0VGltZW91dCAmIHNldEludGVydmFsIGFkZGl0aW9uYWwgcGFyYW1ldGVycyBmaXgKCQkJdmFyIGdsb2JhbCA9IF9fd2VicGFja19yZXF1aXJlX18oOTc2OSk7CgkJCXZhciAkZXhwb3J0ID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MTk0KTsKCQkJdmFyIHVzZXJBZ2VudCA9IF9fd2VicGFja19yZXF1aXJlX18oOTk4Nyk7CgkJCXZhciBzbGljZSA9IFtdLnNsaWNlOwoJCQl2YXIgTVNJRSA9IC9NU0lFIC5cLi8udGVzdCh1c2VyQWdlbnQpOyAvLyA8LSBkaXJ0eSBpZTktIGNoZWNrCgkJCXZhciB3cmFwID0gZnVuY3Rpb24gd3JhcChzZXQpIHsKCQkJCXJldHVybiBmdW5jdGlvbihmbiwgdGltZSAvKiAsIC4uLmFyZ3MgKi8pIHsKCQkJCQl2YXIgYm91bmRBcmdzID0gYXJndW1lbnRzLmxlbmd0aCA+IDI7CgkJCQkJdmFyIGFyZ3MgPSBib3VuZEFyZ3MgPyBzbGljZS5jYWxsKGFyZ3VtZW50cywgMikgOiBmYWxzZTsKCQkJCQlyZXR1cm4gc2V0KGJvdW5kQXJncyA/IGZ1bmN0aW9uKCkgewoJCQkJCQkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tbmV3LWZ1bmMKCQkJCQkJKHR5cGVvZiBmbiA9PSAnZnVuY3Rpb24nID8gZm4gOiBGdW5jdGlvbihmbikpLmFwcGx5KHRoaXMsIGFyZ3MpOwoJCQkJCX0gOiBmbiwgdGltZSk7CgkJCQl9OwoJCQl9OwoJCQkkZXhwb3J0KCRleHBvcnQuRyArICRleHBvcnQuQiArICRleHBvcnQuRiAqIE1TSUUsIHsKCQkJCXNldFRpbWVvdXQ6IHdyYXAoZ2xvYmFsLnNldFRpbWVvdXQpLAoJCQkJc2V0SW50ZXJ2YWw6IHdyYXAoZ2xvYmFsLnNldEludGVydmFsKQoJCQl9KTsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDU0NDk6CgkJLyoqKi8gKChtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg0MDg2KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg4NDA2KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygxNjY3KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygxNDA1KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygyNzQwKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg5ODc5KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg4MjEpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDc4ODIpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDMxMzIpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDM5NDUpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDU1NjIpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDM0MjIpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDU3NDEpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDU1MDQpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDI4ODUpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDU4MDMpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDYpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDMyODkpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDgzNjEpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDU4MDgpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDk1MDMpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDk4ODkpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDE2NDApOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDc0MjUpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQyNzUpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDI3NjIpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDI0OTkpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDI3NTMpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDE0MDIpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQyMDMpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDkwNyk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNTYxNyk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNzA1OSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMTAzNCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNDk1OSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMzU5Mik7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNTYwNSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMzc0NSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oOTUwNCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNDM4Myk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNjYxMSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMTQ4MCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMzIyOCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMzU0Mik7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNTAyKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg1ODM0KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygzMzIxKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg1ODIpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDg3MDIpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDczKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg1MjIwKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg3NzY1KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygzNDU2KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg4MTczKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg2NzAxKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg5NDgyKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygzMik7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMjY5OCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oOTU1NCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMTY1OCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNTI5OCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMTM2NSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNDk5Myk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNjc5MSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNzk5NCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oOTg0MSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oODI4Nik7CgkJCV9fd2VicGFja19yZXF1aXJlX18oOTU3OCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNjcwNyk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNzk0MSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMjY5Nyk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMzMzNCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oOTI2Nik7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNDY3NSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNTU0NCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNzUxMSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNTM4Nyk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNTI2OSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oOTk2OCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNDc4OSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNzc1Nik7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNDAxNSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNTQ0Mik7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMTI2OCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNjEyMik7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMzkyKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg2ODQyKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygzNTk5KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygxMTcwKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg0NTA1KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygzNzcwKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg5ODE1KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygxNjIyKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg1Nzg3KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg4Mjk1KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg1MzkwKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg5MjcpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDEzNjEpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDYwMDQpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDg3MjYpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDM1NzMpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDM1MDIpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDkwMzgpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQ5NjUpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDIwOTcpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDc2OTEpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDk1MTEpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDU4NDYpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDU2MjMpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDUzMSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNjgyNSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNTY0Mik7CgkJCV9fd2VicGFja19yZXF1aXJlX18oODU0Myk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oODE5Nyk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNzY3Mik7CgkJCV9fd2VicGFja19yZXF1aXJlX18oODk0MCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNzM1OSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMTA1NSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNTczOCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oOTE1MCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNzQ5MSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNjAzMSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMTUxNCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNDE4Nik7CgkJCV9fd2VicGFja19yZXF1aXJlX18oOTE4Nyk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNzg2OCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMjIyKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg3NDI4KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg3MjQ2KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg5NDIpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDUyMDUpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDk4MSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMTg1KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg3MzIwKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygyODAyKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg0NDgxKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygzNDM4KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygzNDg4KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygyMDQzKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg2MTAyKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg3NDExKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg2Njk4KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygxODM2KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg2MTApOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDIzNjgpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDk2MTYpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDEzNjcpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQwMjYpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDkzMzEpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDczMjEpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDY2MTMpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDEwMzMpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDg2OSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oODc2MCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMzk5NCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMzcwMik7CgkJCV9fd2VicGFja19yZXF1aXJlX18oNDE0OCk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oOTQ2NSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oODg3KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygyNzQyKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygyMjQ2KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg4NDI3KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg0NjUyKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg1NTY5KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg2MDM1KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygxNzY1KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygyOTEwKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg4NzExKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg3NzQ2KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygxODkxKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygzOTExKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg4NTA3KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg0NzE1KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygyODcwKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg3MzY5KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygxNjg0KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygzOTYyKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg5OTQ2KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg4MTY4KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg5OTIyKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygzNDMpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDYzMjMpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDIyMDEpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDI1NDQpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDkzMjcpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQ1MzgpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDI2NzIpOwoJCQlfX3dlYnBhY2tfcmVxdWlyZV9fKDQ2MSk7CgkJCV9fd2VicGFja19yZXF1aXJlX18oMzc1KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygyMjU1KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygzNTQwKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg5MDYwKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg4NTU3KTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg2NTEzKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg4OTYxKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXyg1MzUyKTsKCQkJX193ZWJwYWNrX3JlcXVpcmVfXygzOTg2KTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUxNjUpOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gNDg2NzoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQl2YXIganNvbl9zdHJpbmdpZnkgPSAoX193ZWJwYWNrX3JlcXVpcmVfXyg4NjkyKS5zdHJpbmdpZnkpOwoJCQl2YXIganNvbl9wYXJzZSA9IF9fd2VicGFja19yZXF1aXJlX18oMjI1OCk7CgkJCW1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ob3B0aW9ucykgewoJCQkJcmV0dXJuIHsKCQkJCQlwYXJzZToganNvbl9wYXJzZShvcHRpb25zKSwKCQkJCQlzdHJpbmdpZnk6IGpzb25fc3RyaW5naWZ5CgkJCQl9OwoJCQl9OwovL2NyZWF0ZSB0aGUgZGVmYXVsdCBtZXRob2QgbWVtYmVycyB3aXRoIG5vIG9wdGlvbnMgYXBwbGllZCBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkKCQkJbW9kdWxlLmV4cG9ydHMucGFyc2UgPSBqc29uX3BhcnNlKCk7CgkJCW1vZHVsZS5leHBvcnRzLnN0cmluZ2lmeSA9IGpzb25fc3RyaW5naWZ5OwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gMjI1ODoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQlmdW5jdGlvbiBfdHlwZW9mKG8pIHsKCQkJCSdAYmFiZWwvaGVscGVycyAtIHR5cGVvZic7CgkJCQlyZXR1cm4gX3R5cGVvZiA9ICdmdW5jdGlvbicgPT0gdHlwZW9mIFN5bWJvbCAmJiAnc3ltYm9sJyA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24obykgewoJCQkJCXJldHVybiB0eXBlb2YgbzsKCQkJCX0gOiBmdW5jdGlvbihvKSB7CgkJCQkJcmV0dXJuIG8gJiYgJ2Z1bmN0aW9uJyA9PSB0eXBlb2YgU3ltYm9sICYmIG8uY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvICE9PSBTeW1ib2wucHJvdG90eXBlID8gJ3N5bWJvbCcgOiB0eXBlb2YgbzsKCQkJCX0sIF90eXBlb2Yobyk7CgkJCX0KCgkJCXZhciBCaWdOdW1iZXIgPSBudWxsOwoKLy8gcmVnZXhweHMgZXh0cmFjdGVkIGZyb20KLy8gKGMpIEJTRC0zLUNsYXVzZQovLyBodHRwczovL2dpdGh1Yi5jb20vZmFzdGlmeS9zZWN1cmUtanNvbi1wYXJzZS9ncmFwaHMvY29udHJpYnV0b3JzIGFuZCBodHRwczovL2dpdGh1Yi5jb20vaGFwaWpzL2JvdXJuZS9ncmFwaHMvY29udHJpYnV0b3JzCgoJCQl2YXIgc3VzcGVjdFByb3RvUnggPSAvKD86X3xcXHUwMDVbRmZdKSg/Ol98XFx1MDA1W0ZmXSkoPzpwfFxcdTAwNzApKD86cnxcXHUwMDcyKSg/Om98XFx1MDA2W0ZmXSkoPzp0fFxcdTAwNzQpKD86b3xcXHUwMDZbRmZdKSg/Ol98XFx1MDA1W0ZmXSkoPzpffFxcdTAwNVtGZl0pLzsKCQkJdmFyIHN1c3BlY3RDb25zdHJ1Y3RvclJ4ID0gLyg/OmN8XFx1MDA2MykoPzpvfFxcdTAwNltGZl0pKD86bnxcXHUwMDZbRWVdKSg/OnN8XFx1MDA3MykoPzp0fFxcdTAwNzQpKD86cnxcXHUwMDcyKSg/OnV8XFx1MDA3NSkoPzpjfFxcdTAwNjMpKD86dHxcXHUwMDc0KSg/Om98XFx1MDA2W0ZmXSkoPzpyfFxcdTAwNzIpLzsKCgkJCS8qCiAgICBqc29uX3BhcnNlLmpzCiAgICAyMDEyLTA2LTIwCgogICAgUHVibGljIERvbWFpbi4KCiAgICBOTyBXQVJSQU5UWSBFWFBSRVNTRUQgT1IgSU1QTElFRC4gVVNFIEFUIFlPVVIgT1dOIFJJU0suCgogICAgVGhpcyBmaWxlIGNyZWF0ZXMgYSBqc29uX3BhcnNlIGZ1bmN0aW9uLgogICAgRHVyaW5nIGNyZWF0ZSB5b3UgY2FuIChvcHRpb25hbGx5KSBzcGVjaWZ5IHNvbWUgYmVoYXZpb3VyYWwgc3dpdGNoZXMKCiAgICAgICAgcmVxdWlyZSgnanNvbi1iaWdpbnQnKShvcHRpb25zKQoKICAgICAgICAgICAgVGhlIG9wdGlvbmFsIG9wdGlvbnMgcGFyYW1ldGVyIGhvbGRzIHN3aXRjaGVzIHRoYXQgZHJpdmUgY2VydGFpbgogICAgICAgICAgICBhc3BlY3RzIG9mIHRoZSBwYXJzaW5nIHByb2Nlc3M6CiAgICAgICAgICAgICogb3B0aW9ucy5zdHJpY3QgPSB0cnVlIHdpbGwgd2FybiBhYm91dCBkdXBsaWNhdGUta2V5IHVzYWdlIGluIHRoZSBqc29uLgogICAgICAgICAgICAgIFRoZSBkZWZhdWx0IChzdHJpY3QgPSBmYWxzZSkgd2lsbCBzaWxlbnRseSBpZ25vcmUgdGhvc2UgYW5kIG92ZXJ3cml0ZQogICAgICAgICAgICAgIHZhbHVlcyBmb3Iga2V5cyB0aGF0IGFyZSBpbiBkdXBsaWNhdGUgdXNlLgoKICAgIFRoZSByZXN1bHRpbmcgZnVuY3Rpb24gZm9sbG93cyB0aGlzIHNpZ25hdHVyZToKICAgICAgICBqc29uX3BhcnNlKHRleHQsIHJldml2ZXIpCiAgICAgICAgICAgIFRoaXMgbWV0aG9kIHBhcnNlcyBhIEpTT04gdGV4dCB0byBwcm9kdWNlIGFuIG9iamVjdCBvciBhcnJheS4KICAgICAgICAgICAgSXQgY2FuIHRocm93IGEgU3ludGF4RXJyb3IgZXhjZXB0aW9uLgoKICAgICAgICAgICAgVGhlIG9wdGlvbmFsIHJldml2ZXIgcGFyYW1ldGVyIGlzIGEgZnVuY3Rpb24gdGhhdCBjYW4gZmlsdGVyIGFuZAogICAgICAgICAgICB0cmFuc2Zvcm0gdGhlIHJlc3VsdHMuIEl0IHJlY2VpdmVzIGVhY2ggb2YgdGhlIGtleXMgYW5kIHZhbHVlcywKICAgICAgICAgICAgYW5kIGl0cyByZXR1cm4gdmFsdWUgaXMgdXNlZCBpbnN0ZWFkIG9mIHRoZSBvcmlnaW5hbCB2YWx1ZS4KICAgICAgICAgICAgSWYgaXQgcmV0dXJucyB3aGF0IGl0IHJlY2VpdmVkLCB0aGVuIHRoZSBzdHJ1Y3R1cmUgaXMgbm90IG1vZGlmaWVkLgogICAgICAgICAgICBJZiBpdCByZXR1cm5zIHVuZGVmaW5lZCB0aGVuIHRoZSBtZW1iZXIgaXMgZGVsZXRlZC4KCiAgICAgICAgICAgIEV4YW1wbGU6CgogICAgICAgICAgICAvLyBQYXJzZSB0aGUgdGV4dC4gVmFsdWVzIHRoYXQgbG9vayBsaWtlIElTTyBkYXRlIHN0cmluZ3Mgd2lsbAogICAgICAgICAgICAvLyBiZSBjb252ZXJ0ZWQgdG8gRGF0ZSBvYmplY3RzLgoKICAgICAgICAgICAgbXlEYXRhID0ganNvbl9wYXJzZSh0ZXh0LCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgdmFyIGE7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgICAgIGEgPQovXihcZHs0fSktKFxkezJ9KS0oXGR7Mn0pVChcZHsyfSk6KFxkezJ9KTooXGR7Mn0oPzpcLlxkKik/KVokLy5leGVjKHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICBpZiAoYSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoRGF0ZS5VVEMoK2FbMV0sICthWzJdIC0gMSwgK2FbM10sICthWzRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgK2FbNV0sICthWzZdKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICB9KTsKCiAgICBUaGlzIGlzIGEgcmVmZXJlbmNlIGltcGxlbWVudGF0aW9uLiBZb3UgYXJlIGZyZWUgdG8gY29weSwgbW9kaWZ5LCBvcgogICAgcmVkaXN0cmlidXRlLgoKICAgIFRoaXMgY29kZSBzaG91bGQgYmUgbWluaWZpZWQgYmVmb3JlIGRlcGxveW1lbnQuCiAgICBTZWUgaHR0cDovL2phdmFzY3JpcHQuY3JvY2tmb3JkLmNvbS9qc21pbi5odG1sCgogICAgVVNFIFlPVVIgT1dOIENPUFkuIElUIElTIEVYVFJFTUVMWSBVTldJU0UgVE8gTE9BRCBDT0RFIEZST00gU0VSVkVSUyBZT1UgRE8KICAgIE5PVCBDT05UUk9MLgoqLwoKCQkJLyptZW1iZXJzICIiLCAiXCIiLCAiXC8iLCAiXFwiLCBhdCwgYiwgY2FsbCwgY2hhckF0LCBmLCBmcm9tQ2hhckNvZGUsCiAgICBoYXNPd25Qcm9wZXJ0eSwgbWVzc2FnZSwgbiwgbmFtZSwgcHJvdG90eXBlLCBwdXNoLCByLCB0LCB0ZXh0CiovCgoJCQl2YXIganNvbl9wYXJzZSA9IGZ1bmN0aW9uIGpzb25fcGFyc2Uob3B0aW9ucykgewoJCQkJJ3VzZSBzdHJpY3QnOwoKCQkJCS8vIFRoaXMgaXMgYSBmdW5jdGlvbiB0aGF0IGNhbiBwYXJzZSBhIEpTT04gdGV4dCwgcHJvZHVjaW5nIGEgSmF2YVNjcmlwdAoJCQkJLy8gZGF0YSBzdHJ1Y3R1cmUuIEl0IGlzIGEgc2ltcGxlLCByZWN1cnNpdmUgZGVzY2VudCBwYXJzZXIuIEl0IGRvZXMgbm90IHVzZQoJCQkJLy8gZXZhbCBvciByZWd1bGFyIGV4cHJlc3Npb25zLCBzbyBpdCBjYW4gYmUgdXNlZCBhcyBhIG1vZGVsIGZvciBpbXBsZW1lbnRpbmcKCQkJCS8vIGEgSlNPTiBwYXJzZXIgaW4gb3RoZXIgbGFuZ3VhZ2VzLgoKCQkJCS8vIFdlIGFyZSBkZWZpbmluZyB0aGUgZnVuY3Rpb24gaW5zaWRlIG9mIGFub3RoZXIgZnVuY3Rpb24gdG8gYXZvaWQgY3JlYXRpbmcKCQkJCS8vIGdsb2JhbCB2YXJpYWJsZXMuCgoJCQkJLy8gRGVmYXVsdCBvcHRpb25zIG9uZSBjYW4gb3ZlcnJpZGUgYnkgcGFzc2luZyBvcHRpb25zIHRvIHRoZSBwYXJzZSgpCgkJCQl2YXIgX29wdGlvbnMgPSB7CgkJCQkJc3RyaWN0OiBmYWxzZSwKCQkJCQkvLyBub3QgYmVpbmcgc3RyaWN0IG1lYW5zIGRvIG5vdCBnZW5lcmF0ZSBzeW50YXggZXJyb3JzIGZvciAiZHVwbGljYXRlIGtleSIKCQkJCQlzdG9yZUFzU3RyaW5nOiBmYWxzZSwKCQkJCQkvLyB0b2dnbGVzIHdoZXRoZXIgdGhlIHZhbHVlcyBzaG91bGQgYmUgc3RvcmVkIGFzIEJpZ051bWJlciAoZGVmYXVsdCkgb3IgYSBzdHJpbmcKCQkJCQlhbHdheXNQYXJzZUFzQmlnOiBmYWxzZSwKCQkJCQkvLyB0b2dnbGVzIHdoZXRoZXIgYWxsIG51bWJlcnMgc2hvdWxkIGJlIEJpZwoJCQkJCXVzZU5hdGl2ZUJpZ0ludDogZmFsc2UsCgkJCQkJLy8gdG9nZ2xlcyB3aGV0aGVyIHRvIHVzZSBuYXRpdmUgQmlnSW50IGluc3RlYWQgb2YgYmlnbnVtYmVyLmpzCgkJCQkJcHJvdG9BY3Rpb246ICdlcnJvcicsCgkJCQkJY29uc3RydWN0b3JBY3Rpb246ICdlcnJvcicKCQkJCX07CgoJCQkJLy8gSWYgdGhlcmUgYXJlIG9wdGlvbnMsIHRoZW4gdXNlIHRoZW0gdG8gb3ZlcnJpZGUgdGhlIGRlZmF1bHQgX29wdGlvbnMKCQkJCWlmIChvcHRpb25zICE9PSB1bmRlZmluZWQgJiYgb3B0aW9ucyAhPT0gbnVsbCkgewoJCQkJCWlmIChvcHRpb25zLnN0cmljdCA9PT0gdHJ1ZSkgewoJCQkJCQlfb3B0aW9ucy5zdHJpY3QgPSB0cnVlOwoJCQkJCX0KCQkJCQlpZiAob3B0aW9ucy5zdG9yZUFzU3RyaW5nID09PSB0cnVlKSB7CgkJCQkJCV9vcHRpb25zLnN0b3JlQXNTdHJpbmcgPSB0cnVlOwoJCQkJCX0KCQkJCQlfb3B0aW9ucy5hbHdheXNQYXJzZUFzQmlnID0gb3B0aW9ucy5hbHdheXNQYXJzZUFzQmlnID09PSB0cnVlID8gb3B0aW9ucy5hbHdheXNQYXJzZUFzQmlnIDogZmFsc2U7CgkJCQkJX29wdGlvbnMudXNlTmF0aXZlQmlnSW50ID0gb3B0aW9ucy51c2VOYXRpdmVCaWdJbnQgPT09IHRydWUgPyBvcHRpb25zLnVzZU5hdGl2ZUJpZ0ludCA6IGZhbHNlOwoJCQkJCWlmICh0eXBlb2Ygb3B0aW9ucy5jb25zdHJ1Y3RvckFjdGlvbiAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJCQkJaWYgKG9wdGlvbnMuY29uc3RydWN0b3JBY3Rpb24gPT09ICdlcnJvcicgfHwgb3B0aW9ucy5jb25zdHJ1Y3RvckFjdGlvbiA9PT0gJ2lnbm9yZScgfHwgb3B0aW9ucy5jb25zdHJ1Y3RvckFjdGlvbiA9PT0gJ3ByZXNlcnZlJykgewoJCQkJCQkJX29wdGlvbnMuY29uc3RydWN0b3JBY3Rpb24gPSBvcHRpb25zLmNvbnN0cnVjdG9yQWN0aW9uOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJdGhyb3cgbmV3IEVycm9yKCdJbmNvcnJlY3QgdmFsdWUgZm9yIGNvbnN0cnVjdG9yQWN0aW9uIG9wdGlvbiwgbXVzdCBiZSAiZXJyb3IiLCAiaWdub3JlIiBvciB1bmRlZmluZWQgYnV0IHBhc3NlZCAnLmNvbmNhdChvcHRpb25zLmNvbnN0cnVjdG9yQWN0aW9uKSk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJaWYgKHR5cGVvZiBvcHRpb25zLnByb3RvQWN0aW9uICE9PSAndW5kZWZpbmVkJykgewoJCQkJCQlpZiAob3B0aW9ucy5wcm90b0FjdGlvbiA9PT0gJ2Vycm9yJyB8fCBvcHRpb25zLnByb3RvQWN0aW9uID09PSAnaWdub3JlJyB8fCBvcHRpb25zLnByb3RvQWN0aW9uID09PSAncHJlc2VydmUnKSB7CgkJCQkJCQlfb3B0aW9ucy5wcm90b0FjdGlvbiA9IG9wdGlvbnMucHJvdG9BY3Rpb247CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQl0aHJvdyBuZXcgRXJyb3IoJ0luY29ycmVjdCB2YWx1ZSBmb3IgcHJvdG9BY3Rpb24gb3B0aW9uLCBtdXN0IGJlICJlcnJvciIsICJpZ25vcmUiIG9yIHVuZGVmaW5lZCBidXQgcGFzc2VkICcuY29uY2F0KG9wdGlvbnMucHJvdG9BY3Rpb24pKTsKCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJCXZhciBhdCwKCQkJCQkvLyBUaGUgaW5kZXggb2YgdGhlIGN1cnJlbnQgY2hhcmFjdGVyCgkJCQkJY2gsCgkJCQkJLy8gVGhlIGN1cnJlbnQgY2hhcmFjdGVyCgkJCQkJZXNjYXBlZSA9IHsKCQkJCQkJJyInOiAnIicsCgkJCQkJCSdcXCc6ICdcXCcsCgkJCQkJCScvJzogJy8nLAoJCQkJCQliOiAnXGInLAoJCQkJCQlmOiAnXGYnLAoJCQkJCQluOiAnXG4nLAoJCQkJCQlyOiAnXHInLAoJCQkJCQl0OiAnXHQnCgkJCQkJfSwKCQkJCQl0ZXh0LAoJCQkJCWVycm9yID0gZnVuY3Rpb24gZXJyb3IobSkgewoJCQkJCQkvLyBDYWxsIGVycm9yIHdoZW4gc29tZXRoaW5nIGlzIHdyb25nLgoKCQkJCQkJdGhyb3cgewoJCQkJCQkJbmFtZTogJ1N5bnRheEVycm9yJywKCQkJCQkJCW1lc3NhZ2U6IG0sCgkJCQkJCQlhdDogYXQsCgkJCQkJCQl0ZXh0OiB0ZXh0CgkJCQkJCX07CgkJCQkJfSwKCQkJCQluZXh0ID0gZnVuY3Rpb24gbmV4dChjKSB7CgkJCQkJCS8vIElmIGEgYyBwYXJhbWV0ZXIgaXMgcHJvdmlkZWQsIHZlcmlmeSB0aGF0IGl0IG1hdGNoZXMgdGhlIGN1cnJlbnQgY2hhcmFjdGVyLgoKCQkJCQkJaWYgKGMgJiYgYyAhPT0gY2gpIHsKCQkJCQkJCWVycm9yKCdFeHBlY3RlZCBcJycgKyBjICsgJ1wnIGluc3RlYWQgb2YgXCcnICsgY2ggKyAnXCcnKTsKCQkJCQkJfQoKCQkJCQkJLy8gR2V0IHRoZSBuZXh0IGNoYXJhY3Rlci4gV2hlbiB0aGVyZSBhcmUgbm8gbW9yZSBjaGFyYWN0ZXJzLAoJCQkJCQkvLyByZXR1cm4gdGhlIGVtcHR5IHN0cmluZy4KCgkJCQkJCWNoID0gdGV4dC5jaGFyQXQoYXQpOwoJCQkJCQlhdCArPSAxOwoJCQkJCQlyZXR1cm4gY2g7CgkJCQkJfSwKCQkJCQludW1iZXIgPSBmdW5jdGlvbiBudW1iZXIoKSB7CgkJCQkJCS8vIFBhcnNlIGEgbnVtYmVyIHZhbHVlLgoKCQkJCQkJdmFyIG51bWJlciwKCQkJCQkJCXN0cmluZyA9ICcnOwoJCQkJCQlpZiAoY2ggPT09ICctJykgewoJCQkJCQkJc3RyaW5nID0gJy0nOwoJCQkJCQkJbmV4dCgnLScpOwoJCQkJCQl9CgkJCQkJCXdoaWxlIChjaCA+PSAnMCcgJiYgY2ggPD0gJzknKSB7CgkJCQkJCQlzdHJpbmcgKz0gY2g7CgkJCQkJCQluZXh0KCk7CgkJCQkJCX0KCQkJCQkJaWYgKGNoID09PSAnLicpIHsKCQkJCQkJCXN0cmluZyArPSAnLic7CgkJCQkJCQl3aGlsZSAobmV4dCgpICYmIGNoID49ICcwJyAmJiBjaCA8PSAnOScpIHsKCQkJCQkJCQlzdHJpbmcgKz0gY2g7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJaWYgKGNoID09PSAnZScgfHwgY2ggPT09ICdFJykgewoJCQkJCQkJc3RyaW5nICs9IGNoOwoJCQkJCQkJbmV4dCgpOwoJCQkJCQkJaWYgKGNoID09PSAnLScgfHwgY2ggPT09ICcrJykgewoJCQkJCQkJCXN0cmluZyArPSBjaDsKCQkJCQkJCQluZXh0KCk7CgkJCQkJCQl9CgkJCQkJCQl3aGlsZSAoY2ggPj0gJzAnICYmIGNoIDw9ICc5JykgewoJCQkJCQkJCXN0cmluZyArPSBjaDsKCQkJCQkJCQluZXh0KCk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJbnVtYmVyID0gK3N0cmluZzsKCQkJCQkJaWYgKCFpc0Zpbml0ZShudW1iZXIpKSB7CgkJCQkJCQllcnJvcignQmFkIG51bWJlcicpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJaWYgKEJpZ051bWJlciA9PSBudWxsKSBCaWdOdW1iZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU1MTgpOwoJCQkJCQkJLy9pZiAobnVtYmVyID4gOTAwNzE5OTI1NDc0MDk5MiB8fCBudW1iZXIgPCAtOTAwNzE5OTI1NDc0MDk5MikKCQkJCQkJCS8vIEJpZ251bWJlciBoYXMgc3RyaWN0ZXIgY2hlY2s6IGV2ZXJ5dGhpbmcgd2l0aCBsZW5ndGggPiAxNSBkaWdpdHMgZGlzYWxsb3dlZAoJCQkJCQkJaWYgKHN0cmluZy5sZW5ndGggPiAxNSkgcmV0dXJuIF9vcHRpb25zLnN0b3JlQXNTdHJpbmcgPyBzdHJpbmcgOiBfb3B0aW9ucy51c2VOYXRpdmVCaWdJbnQgPyBCaWdJbnQoc3RyaW5nKSA6IG5ldyBCaWdOdW1iZXIoc3RyaW5nKTsgZWxzZSByZXR1cm4gIV9vcHRpb25zLmFsd2F5c1BhcnNlQXNCaWcgPyBudW1iZXIgOiBfb3B0aW9ucy51c2VOYXRpdmVCaWdJbnQgPyBCaWdJbnQobnVtYmVyKSA6IG5ldyBCaWdOdW1iZXIobnVtYmVyKTsKCQkJCQkJfQoJCQkJCX0sCgkJCQkJc3RyaW5nID0gZnVuY3Rpb24gc3RyaW5nKCkgewoJCQkJCQkvLyBQYXJzZSBhIHN0cmluZyB2YWx1ZS4KCgkJCQkJCXZhciBoZXgsCgkJCQkJCQlpLAoJCQkJCQkJc3RyaW5nID0gJycsCgkJCQkJCQl1ZmZmZjsKCgkJCQkJCS8vIFdoZW4gcGFyc2luZyBmb3Igc3RyaW5nIHZhbHVlcywgd2UgbXVzdCBsb29rIGZvciAiIGFuZCBcIGNoYXJhY3RlcnMuCgoJCQkJCQlpZiAoY2ggPT09ICciJykgewoJCQkJCQkJdmFyIHN0YXJ0QXQgPSBhdDsKCQkJCQkJCXdoaWxlIChuZXh0KCkpIHsKCQkJCQkJCQlpZiAoY2ggPT09ICciJykgewoJCQkJCQkJCQlpZiAoYXQgLSAxID4gc3RhcnRBdCkgc3RyaW5nICs9IHRleHQuc3Vic3RyaW5nKHN0YXJ0QXQsIGF0IC0gMSk7CgkJCQkJCQkJCW5leHQoKTsKCQkJCQkJCQkJcmV0dXJuIHN0cmluZzsKCQkJCQkJCQl9CgkJCQkJCQkJaWYgKGNoID09PSAnXFwnKSB7CgkJCQkJCQkJCWlmIChhdCAtIDEgPiBzdGFydEF0KSBzdHJpbmcgKz0gdGV4dC5zdWJzdHJpbmcoc3RhcnRBdCwgYXQgLSAxKTsKCQkJCQkJCQkJbmV4dCgpOwoJCQkJCQkJCQlpZiAoY2ggPT09ICd1JykgewoJCQkJCQkJCQkJdWZmZmYgPSAwOwoJCQkJCQkJCQkJZm9yIChpID0gMDsgaSA8IDQ7IGkgKz0gMSkgewoJCQkJCQkJCQkJCWhleCA9IHBhcnNlSW50KG5leHQoKSwgMTYpOwoJCQkJCQkJCQkJCWlmICghaXNGaW5pdGUoaGV4KSkgewoJCQkJCQkJCQkJCQlicmVhazsKCQkJCQkJCQkJCQl9CgkJCQkJCQkJCQkJdWZmZmYgPSB1ZmZmZiAqIDE2ICsgaGV4OwoJCQkJCQkJCQkJfQoJCQkJCQkJCQkJc3RyaW5nICs9IFN0cmluZy5mcm9tQ2hhckNvZGUodWZmZmYpOwoJCQkJCQkJCQl9IGVsc2UgaWYgKHR5cGVvZiBlc2NhcGVlW2NoXSA9PT0gJ3N0cmluZycpIHsKCQkJCQkJCQkJCXN0cmluZyArPSBlc2NhcGVlW2NoXTsKCQkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCQl9CgkJCQkJCQkJCXN0YXJ0QXQgPSBhdDsKCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJZXJyb3IoJ0JhZCBzdHJpbmcnKTsKCQkJCQl9LAoJCQkJCXdoaXRlID0gZnVuY3Rpb24gd2hpdGUoKSB7CgkJCQkJCS8vIFNraXAgd2hpdGVzcGFjZS4KCgkJCQkJCXdoaWxlIChjaCAmJiBjaCA8PSAnICcpIHsKCQkJCQkJCW5leHQoKTsKCQkJCQkJfQoJCQkJCX0sCgkJCQkJd29yZCA9IGZ1bmN0aW9uIHdvcmQoKSB7CgkJCQkJCS8vIHRydWUsIGZhbHNlLCBvciBudWxsLgoKCQkJCQkJc3dpdGNoIChjaCkgewoJCQkJCQkJY2FzZSAndCc6CgkJCQkJCQkJbmV4dCgndCcpOwoJCQkJCQkJCW5leHQoJ3InKTsKCQkJCQkJCQluZXh0KCd1Jyk7CgkJCQkJCQkJbmV4dCgnZScpOwoJCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQkJY2FzZSAnZic6CgkJCQkJCQkJbmV4dCgnZicpOwoJCQkJCQkJCW5leHQoJ2EnKTsKCQkJCQkJCQluZXh0KCdsJyk7CgkJCQkJCQkJbmV4dCgncycpOwoJCQkJCQkJCW5leHQoJ2UnKTsKCQkJCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQkJCQljYXNlICduJzoKCQkJCQkJCQluZXh0KCduJyk7CgkJCQkJCQkJbmV4dCgndScpOwoJCQkJCQkJCW5leHQoJ2wnKTsKCQkJCQkJCQluZXh0KCdsJyk7CgkJCQkJCQkJcmV0dXJuIG51bGw7CgkJCQkJCX0KCQkJCQkJZXJyb3IoJ1VuZXhwZWN0ZWQgXCcnICsgY2ggKyAnXCcnKTsKCQkJCQl9LAoJCQkJCXZhbHVlLAoJCQkJCS8vIFBsYWNlIGhvbGRlciBmb3IgdGhlIHZhbHVlIGZ1bmN0aW9uLgoJCQkJCWFycmF5ID0gZnVuY3Rpb24gYXJyYXkoKSB7CgkJCQkJCS8vIFBhcnNlIGFuIGFycmF5IHZhbHVlLgoKCQkJCQkJdmFyIGFycmF5ID0gW107CgkJCQkJCWlmIChjaCA9PT0gJ1snKSB7CgkJCQkJCQluZXh0KCdbJyk7CgkJCQkJCQl3aGl0ZSgpOwoJCQkJCQkJaWYgKGNoID09PSAnXScpIHsKCQkJCQkJCQluZXh0KCddJyk7CgkJCQkJCQkJcmV0dXJuIGFycmF5OyAvLyBlbXB0eSBhcnJheQoJCQkJCQkJfQoJCQkJCQkJd2hpbGUgKGNoKSB7CgkJCQkJCQkJYXJyYXkucHVzaCh2YWx1ZSgpKTsKCQkJCQkJCQl3aGl0ZSgpOwoJCQkJCQkJCWlmIChjaCA9PT0gJ10nKSB7CgkJCQkJCQkJCW5leHQoJ10nKTsKCQkJCQkJCQkJcmV0dXJuIGFycmF5OwoJCQkJCQkJCX0KCQkJCQkJCQluZXh0KCcsJyk7CgkJCQkJCQkJd2hpdGUoKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQllcnJvcignQmFkIGFycmF5Jyk7CgkJCQkJfSwKCQkJCQlvYmplY3QgPSBmdW5jdGlvbiBvYmplY3QoKSB7CgkJCQkJCS8vIFBhcnNlIGFuIG9iamVjdCB2YWx1ZS4KCgkJCQkJCXZhciBrZXksCgkJCQkJCQlvYmplY3QgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoJCQkJCQlpZiAoY2ggPT09ICd7JykgewoJCQkJCQkJbmV4dCgneycpOwoJCQkJCQkJd2hpdGUoKTsKCQkJCQkJCWlmIChjaCA9PT0gJ30nKSB7CgkJCQkJCQkJbmV4dCgnfScpOwoJCQkJCQkJCXJldHVybiBvYmplY3Q7IC8vIGVtcHR5IG9iamVjdAoJCQkJCQkJfQoJCQkJCQkJd2hpbGUgKGNoKSB7CgkJCQkJCQkJa2V5ID0gc3RyaW5nKCk7CgkJCQkJCQkJd2hpdGUoKTsKCQkJCQkJCQluZXh0KCc6Jyk7CgkJCQkJCQkJaWYgKF9vcHRpb25zLnN0cmljdCA9PT0gdHJ1ZSAmJiBPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIGtleSkpIHsKCQkJCQkJCQkJZXJyb3IoJ0R1cGxpY2F0ZSBrZXkgIicgKyBrZXkgKyAnIicpOwoJCQkJCQkJCX0KCQkJCQkJCQlpZiAoc3VzcGVjdFByb3RvUngudGVzdChrZXkpID09PSB0cnVlKSB7CgkJCQkJCQkJCWlmIChfb3B0aW9ucy5wcm90b0FjdGlvbiA9PT0gJ2Vycm9yJykgewoJCQkJCQkJCQkJZXJyb3IoJ09iamVjdCBjb250YWlucyBmb3JiaWRkZW4gcHJvdG90eXBlIHByb3BlcnR5Jyk7CgkJCQkJCQkJCX0gZWxzZSBpZiAoX29wdGlvbnMucHJvdG9BY3Rpb24gPT09ICdpZ25vcmUnKSB7CgkJCQkJCQkJCQl2YWx1ZSgpOwoJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJb2JqZWN0W2tleV0gPSB2YWx1ZSgpOwoJCQkJCQkJCQl9CgkJCQkJCQkJfSBlbHNlIGlmIChzdXNwZWN0Q29uc3RydWN0b3JSeC50ZXN0KGtleSkgPT09IHRydWUpIHsKCQkJCQkJCQkJaWYgKF9vcHRpb25zLmNvbnN0cnVjdG9yQWN0aW9uID09PSAnZXJyb3InKSB7CgkJCQkJCQkJCQllcnJvcignT2JqZWN0IGNvbnRhaW5zIGZvcmJpZGRlbiBjb25zdHJ1Y3RvciBwcm9wZXJ0eScpOwoJCQkJCQkJCQl9IGVsc2UgaWYgKF9vcHRpb25zLmNvbnN0cnVjdG9yQWN0aW9uID09PSAnaWdub3JlJykgewoJCQkJCQkJCQkJdmFsdWUoKTsKCQkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJCW9iamVjdFtrZXldID0gdmFsdWUoKTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0gZWxzZSB7CgkJCQkJCQkJCW9iamVjdFtrZXldID0gdmFsdWUoKTsKCQkJCQkJCQl9CgkJCQkJCQkJd2hpdGUoKTsKCQkJCQkJCQlpZiAoY2ggPT09ICd9JykgewoJCQkJCQkJCQluZXh0KCd9Jyk7CgkJCQkJCQkJCXJldHVybiBvYmplY3Q7CgkJCQkJCQkJfQoJCQkJCQkJCW5leHQoJywnKTsKCQkJCQkJCQl3aGl0ZSgpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWVycm9yKCdCYWQgb2JqZWN0Jyk7CgkJCQkJfTsKCQkJCXZhbHVlID0gZnVuY3Rpb24gdmFsdWUoKSB7CgkJCQkJLy8gUGFyc2UgYSBKU09OIHZhbHVlLiBJdCBjb3VsZCBiZSBhbiBvYmplY3QsIGFuIGFycmF5LCBhIHN0cmluZywgYSBudW1iZXIsCgkJCQkJLy8gb3IgYSB3b3JkLgoKCQkJCQl3aGl0ZSgpOwoJCQkJCXN3aXRjaCAoY2gpIHsKCQkJCQkJY2FzZSAneyc6CgkJCQkJCQlyZXR1cm4gb2JqZWN0KCk7CgkJCQkJCWNhc2UgJ1snOgoJCQkJCQkJcmV0dXJuIGFycmF5KCk7CgkJCQkJCWNhc2UgJyInOgoJCQkJCQkJcmV0dXJuIHN0cmluZygpOwoJCQkJCQljYXNlICctJzoKCQkJCQkJCXJldHVybiBudW1iZXIoKTsKCQkJCQkJZGVmYXVsdDoKCQkJCQkJCXJldHVybiBjaCA+PSAnMCcgJiYgY2ggPD0gJzknID8gbnVtYmVyKCkgOiB3b3JkKCk7CgkJCQkJfQoJCQkJfTsKCgkJCQkvLyBSZXR1cm4gdGhlIGpzb25fcGFyc2UgZnVuY3Rpb24uIEl0IHdpbGwgaGF2ZSBhY2Nlc3MgdG8gYWxsIG9mIHRoZSBhYm92ZQoJCQkJLy8gZnVuY3Rpb25zIGFuZCB2YXJpYWJsZXMuCgoJCQkJcmV0dXJuIGZ1bmN0aW9uKHNvdXJjZSwgcmV2aXZlcikgewoJCQkJCXZhciByZXN1bHQ7CgkJCQkJdGV4dCA9IHNvdXJjZSArICcnOwoJCQkJCWF0ID0gMDsKCQkJCQljaCA9ICcgJzsKCQkJCQlyZXN1bHQgPSB2YWx1ZSgpOwoJCQkJCXdoaXRlKCk7CgkJCQkJaWYgKGNoKSB7CgkJCQkJCWVycm9yKCdTeW50YXggZXJyb3InKTsKCQkJCQl9CgoJCQkJCS8vIElmIHRoZXJlIGlzIGEgcmV2aXZlciBmdW5jdGlvbiwgd2UgcmVjdXJzaXZlbHkgd2FsayB0aGUgbmV3IHN0cnVjdHVyZSwKCQkJCQkvLyBwYXNzaW5nIGVhY2ggbmFtZS92YWx1ZSBwYWlyIHRvIHRoZSByZXZpdmVyIGZ1bmN0aW9uIGZvciBwb3NzaWJsZQoJCQkJCS8vIHRyYW5zZm9ybWF0aW9uLCBzdGFydGluZyB3aXRoIGEgdGVtcG9yYXJ5IHJvb3Qgb2JqZWN0IHRoYXQgaG9sZHMgdGhlIHJlc3VsdAoJCQkJCS8vIGluIGFuIGVtcHR5IGtleS4gSWYgdGhlcmUgaXMgbm90IGEgcmV2aXZlciBmdW5jdGlvbiwgd2Ugc2ltcGx5IHJldHVybiB0aGUKCQkJCQkvLyByZXN1bHQuCgoJCQkJCXJldHVybiB0eXBlb2YgcmV2aXZlciA9PT0gJ2Z1bmN0aW9uJyA/IGZ1bmN0aW9uIHdhbGsoaG9sZGVyLCBrZXkpIHsKCQkJCQkJdmFyIGssCgkJCQkJCQl2LAoJCQkJCQkJdmFsdWUgPSBob2xkZXJba2V5XTsKCQkJCQkJaWYgKHZhbHVlICYmIF90eXBlb2YodmFsdWUpID09PSAnb2JqZWN0JykgewoJCQkJCQkJT2JqZWN0LmtleXModmFsdWUpLmZvckVhY2goZnVuY3Rpb24oaykgewoJCQkJCQkJCXYgPSB3YWxrKHZhbHVlLCBrKTsKCQkJCQkJCQlpZiAodiAhPT0gdW5kZWZpbmVkKSB7CgkJCQkJCQkJCXZhbHVlW2tdID0gdjsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQlkZWxldGUgdmFsdWVba107CgkJCQkJCQkJfQoJCQkJCQkJfSk7CgkJCQkJCX0KCQkJCQkJcmV0dXJuIHJldml2ZXIuY2FsbChob2xkZXIsIGtleSwgdmFsdWUpOwoJCQkJCX0oewoJCQkJCQknJzogcmVzdWx0CgkJCQkJfSwgJycpIDogcmVzdWx0OwoJCQkJfTsKCQkJfTsKCQkJbW9kdWxlLmV4cG9ydHMgPSBqc29uX3BhcnNlOwoKCQkJLyoqKi8KCQl9KSwKCgkJLyoqKi8gODY5MjoKCQkvKioqLyAoKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoJCQlmdW5jdGlvbiBfdHlwZW9mKG8pIHsKCQkJCSdAYmFiZWwvaGVscGVycyAtIHR5cGVvZic7CgkJCQlyZXR1cm4gX3R5cGVvZiA9ICdmdW5jdGlvbicgPT0gdHlwZW9mIFN5bWJvbCAmJiAnc3ltYm9sJyA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24obykgewoJCQkJCXJldHVybiB0eXBlb2YgbzsKCQkJCX0gOiBmdW5jdGlvbihvKSB7CgkJCQkJcmV0dXJuIG8gJiYgJ2Z1bmN0aW9uJyA9PSB0eXBlb2YgU3ltYm9sICYmIG8uY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvICE9PSBTeW1ib2wucHJvdG90eXBlID8gJ3N5bWJvbCcgOiB0eXBlb2YgbzsKCQkJCX0sIF90eXBlb2Yobyk7CgkJCX0KCgkJCXZhciBCaWdOdW1iZXIgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDU1MTgpOwoKCQkJLyoKICAgIGpzb24yLmpzCiAgICAyMDEzLTA1LTI2CgogICAgUHVibGljIERvbWFpbi4KCiAgICBOTyBXQVJSQU5UWSBFWFBSRVNTRUQgT1IgSU1QTElFRC4gVVNFIEFUIFlPVVIgT1dOIFJJU0suCgogICAgU2VlIGh0dHA6Ly93d3cuSlNPTi5vcmcvanMuaHRtbAoKCiAgICBUaGlzIGNvZGUgc2hvdWxkIGJlIG1pbmlmaWVkIGJlZm9yZSBkZXBsb3ltZW50LgogICAgU2VlIGh0dHA6Ly9qYXZhc2NyaXB0LmNyb2NrZm9yZC5jb20vanNtaW4uaHRtbAoKICAgIFVTRSBZT1VSIE9XTiBDT1BZLiBJVCBJUyBFWFRSRU1FTFkgVU5XSVNFIFRPIExPQUQgQ09ERSBGUk9NIFNFUlZFUlMgWU9VIERPCiAgICBOT1QgQ09OVFJPTC4KCgogICAgVGhpcyBmaWxlIGNyZWF0ZXMgYSBnbG9iYWwgSlNPTiBvYmplY3QgY29udGFpbmluZyB0d28gbWV0aG9kczogc3RyaW5naWZ5CiAgICBhbmQgcGFyc2UuCgogICAgICAgIEpTT04uc3RyaW5naWZ5KHZhbHVlLCByZXBsYWNlciwgc3BhY2UpCiAgICAgICAgICAgIHZhbHVlICAgICAgIGFueSBKYXZhU2NyaXB0IHZhbHVlLCB1c3VhbGx5IGFuIG9iamVjdCBvciBhcnJheS4KCiAgICAgICAgICAgIHJlcGxhY2VyICAgIGFuIG9wdGlvbmFsIHBhcmFtZXRlciB0aGF0IGRldGVybWluZXMgaG93IG9iamVjdAogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgYXJlIHN0cmluZ2lmaWVkIGZvciBvYmplY3RzLiBJdCBjYW4gYmUgYQogICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiBvciBhbiBhcnJheSBvZiBzdHJpbmdzLgoKICAgICAgICAgICAgc3BhY2UgICAgICAgYW4gb3B0aW9uYWwgcGFyYW1ldGVyIHRoYXQgc3BlY2lmaWVzIHRoZSBpbmRlbnRhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBvZiBuZXN0ZWQgc3RydWN0dXJlcy4gSWYgaXQgaXMgb21pdHRlZCwgdGhlIHRleHQgd2lsbAogICAgICAgICAgICAgICAgICAgICAgICBiZSBwYWNrZWQgd2l0aG91dCBleHRyYSB3aGl0ZXNwYWNlLiBJZiBpdCBpcyBhIG51bWJlciwKICAgICAgICAgICAgICAgICAgICAgICAgaXQgd2lsbCBzcGVjaWZ5IHRoZSBudW1iZXIgb2Ygc3BhY2VzIHRvIGluZGVudCBhdCBlYWNoCiAgICAgICAgICAgICAgICAgICAgICAgIGxldmVsLiBJZiBpdCBpcyBhIHN0cmluZyAoc3VjaCBhcyAnXHQnIG9yICcmbmJzcDsnKSwKICAgICAgICAgICAgICAgICAgICAgICAgaXQgY29udGFpbnMgdGhlIGNoYXJhY3RlcnMgdXNlZCB0byBpbmRlbnQgYXQgZWFjaCBsZXZlbC4KCiAgICAgICAgICAgIFRoaXMgbWV0aG9kIHByb2R1Y2VzIGEgSlNPTiB0ZXh0IGZyb20gYSBKYXZhU2NyaXB0IHZhbHVlLgoKICAgICAgICAgICAgV2hlbiBhbiBvYmplY3QgdmFsdWUgaXMgZm91bmQsIGlmIHRoZSBvYmplY3QgY29udGFpbnMgYSB0b0pTT04KICAgICAgICAgICAgbWV0aG9kLCBpdHMgdG9KU09OIG1ldGhvZCB3aWxsIGJlIGNhbGxlZCBhbmQgdGhlIHJlc3VsdCB3aWxsIGJlCiAgICAgICAgICAgIHN0cmluZ2lmaWVkLiBBIHRvSlNPTiBtZXRob2QgZG9lcyBub3Qgc2VyaWFsaXplOiBpdCByZXR1cm5zIHRoZQogICAgICAgICAgICB2YWx1ZSByZXByZXNlbnRlZCBieSB0aGUgbmFtZS92YWx1ZSBwYWlyIHRoYXQgc2hvdWxkIGJlIHNlcmlhbGl6ZWQsCiAgICAgICAgICAgIG9yIHVuZGVmaW5lZCBpZiBub3RoaW5nIHNob3VsZCBiZSBzZXJpYWxpemVkLiBUaGUgdG9KU09OIG1ldGhvZAogICAgICAgICAgICB3aWxsIGJlIHBhc3NlZCB0aGUga2V5IGFzc29jaWF0ZWQgd2l0aCB0aGUgdmFsdWUsIGFuZCB0aGlzIHdpbGwgYmUKICAgICAgICAgICAgYm91bmQgdG8gdGhlIHZhbHVlCgogICAgICAgICAgICBGb3IgZXhhbXBsZSwgdGhpcyB3b3VsZCBzZXJpYWxpemUgRGF0ZXMgYXMgSVNPIHN0cmluZ3MuCgogICAgICAgICAgICAgICAgRGF0ZS5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGYobikgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3JtYXQgaW50ZWdlcnMgdG8gaGF2ZSBhdCBsZWFzdCB0d28gZGlnaXRzLgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbiA8IDEwID8gJzAnICsgbiA6IG47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRVVENGdWxsWWVhcigpICAgKyAnLScgKwogICAgICAgICAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ01vbnRoKCkgKyAxKSArICctJyArCiAgICAgICAgICAgICAgICAgICAgICAgICBmKHRoaXMuZ2V0VVRDRGF0ZSgpKSAgICAgICsgJ1QnICsKICAgICAgICAgICAgICAgICAgICAgICAgIGYodGhpcy5nZXRVVENIb3VycygpKSAgICAgKyAnOicgKwogICAgICAgICAgICAgICAgICAgICAgICAgZih0aGlzLmdldFVUQ01pbnV0ZXMoKSkgICArICc6JyArCiAgICAgICAgICAgICAgICAgICAgICAgICBmKHRoaXMuZ2V0VVRDU2Vjb25kcygpKSAgICsgJ1onOwogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIFlvdSBjYW4gcHJvdmlkZSBhbiBvcHRpb25hbCByZXBsYWNlciBtZXRob2QuIEl0IHdpbGwgYmUgcGFzc2VkIHRoZQogICAgICAgICAgICBrZXkgYW5kIHZhbHVlIG9mIGVhY2ggbWVtYmVyLCB3aXRoIHRoaXMgYm91bmQgdG8gdGhlIGNvbnRhaW5pbmcKICAgICAgICAgICAgb2JqZWN0LiBUaGUgdmFsdWUgdGhhdCBpcyByZXR1cm5lZCBmcm9tIHlvdXIgbWV0aG9kIHdpbGwgYmUKICAgICAgICAgICAgc2VyaWFsaXplZC4gSWYgeW91ciBtZXRob2QgcmV0dXJucyB1bmRlZmluZWQsIHRoZW4gdGhlIG1lbWJlciB3aWxsCiAgICAgICAgICAgIGJlIGV4Y2x1ZGVkIGZyb20gdGhlIHNlcmlhbGl6YXRpb24uCgogICAgICAgICAgICBJZiB0aGUgcmVwbGFjZXIgcGFyYW1ldGVyIGlzIGFuIGFycmF5IG9mIHN0cmluZ3MsIHRoZW4gaXQgd2lsbCBiZQogICAgICAgICAgICB1c2VkIHRvIHNlbGVjdCB0aGUgbWVtYmVycyB0byBiZSBzZXJpYWxpemVkLiBJdCBmaWx0ZXJzIHRoZSByZXN1bHRzCiAgICAgICAgICAgIHN1Y2ggdGhhdCBvbmx5IG1lbWJlcnMgd2l0aCBrZXlzIGxpc3RlZCBpbiB0aGUgcmVwbGFjZXIgYXJyYXkgYXJlCiAgICAgICAgICAgIHN0cmluZ2lmaWVkLgoKICAgICAgICAgICAgVmFsdWVzIHRoYXQgZG8gbm90IGhhdmUgSlNPTiByZXByZXNlbnRhdGlvbnMsIHN1Y2ggYXMgdW5kZWZpbmVkIG9yCiAgICAgICAgICAgIGZ1bmN0aW9ucywgd2lsbCBub3QgYmUgc2VyaWFsaXplZC4gU3VjaCB2YWx1ZXMgaW4gb2JqZWN0cyB3aWxsIGJlCiAgICAgICAgICAgIGRyb3BwZWQ7IGluIGFycmF5cyB0aGV5IHdpbGwgYmUgcmVwbGFjZWQgd2l0aCBudWxsLiBZb3UgY2FuIHVzZQogICAgICAgICAgICBhIHJlcGxhY2VyIGZ1bmN0aW9uIHRvIHJlcGxhY2UgdGhvc2Ugd2l0aCBKU09OIHZhbHVlcy4KICAgICAgICAgICAgSlNPTi5zdHJpbmdpZnkodW5kZWZpbmVkKSByZXR1cm5zIHVuZGVmaW5lZC4KCiAgICAgICAgICAgIFRoZSBvcHRpb25hbCBzcGFjZSBwYXJhbWV0ZXIgcHJvZHVjZXMgYSBzdHJpbmdpZmljYXRpb24gb2YgdGhlCiAgICAgICAgICAgIHZhbHVlIHRoYXQgaXMgZmlsbGVkIHdpdGggbGluZSBicmVha3MgYW5kIGluZGVudGF0aW9uIHRvIG1ha2UgaXQKICAgICAgICAgICAgZWFzaWVyIHRvIHJlYWQuCgogICAgICAgICAgICBJZiB0aGUgc3BhY2UgcGFyYW1ldGVyIGlzIGEgbm9uLWVtcHR5IHN0cmluZywgdGhlbiB0aGF0IHN0cmluZyB3aWxsCiAgICAgICAgICAgIGJlIHVzZWQgZm9yIGluZGVudGF0aW9uLiBJZiB0aGUgc3BhY2UgcGFyYW1ldGVyIGlzIGEgbnVtYmVyLCB0aGVuCiAgICAgICAgICAgIHRoZSBpbmRlbnRhdGlvbiB3aWxsIGJlIHRoYXQgbWFueSBzcGFjZXMuCgogICAgICAgICAgICBFeGFtcGxlOgoKICAgICAgICAgICAgdGV4dCA9IEpTT04uc3RyaW5naWZ5KFsnZScsIHtwbHVyaWJ1czogJ3VudW0nfV0pOwogICAgICAgICAgICAvLyB0ZXh0IGlzICdbImUiLHsicGx1cmlidXMiOiJ1bnVtIn1dJwoKCiAgICAgICAgICAgIHRleHQgPSBKU09OLnN0cmluZ2lmeShbJ2UnLCB7cGx1cmlidXM6ICd1bnVtJ31dLCBudWxsLCAnXHQnKTsKICAgICAgICAgICAgLy8gdGV4dCBpcyAnW1xuXHQiZSIsXG5cdHtcblx0XHQicGx1cmlidXMiOiAidW51bSJcblx0fVxuXScKCiAgICAgICAgICAgIHRleHQgPSBKU09OLnN0cmluZ2lmeShbbmV3IERhdGUoKV0sIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1trZXldIGluc3RhbmNlb2YgRGF0ZSA/CiAgICAgICAgICAgICAgICAgICAgJ0RhdGUoJyArIHRoaXNba2V5XSArICcpJyA6IHZhbHVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgLy8gdGV4dCBpcyAnWyJEYXRlKC0tLWN1cnJlbnQgdGltZS0tLSkiXScKCgogICAgICAgIEpTT04ucGFyc2UodGV4dCwgcmV2aXZlcikKICAgICAgICAgICAgVGhpcyBtZXRob2QgcGFyc2VzIGEgSlNPTiB0ZXh0IHRvIHByb2R1Y2UgYW4gb2JqZWN0IG9yIGFycmF5LgogICAgICAgICAgICBJdCBjYW4gdGhyb3cgYSBTeW50YXhFcnJvciBleGNlcHRpb24uCgogICAgICAgICAgICBUaGUgb3B0aW9uYWwgcmV2aXZlciBwYXJhbWV0ZXIgaXMgYSBmdW5jdGlvbiB0aGF0IGNhbiBmaWx0ZXIgYW5kCiAgICAgICAgICAgIHRyYW5zZm9ybSB0aGUgcmVzdWx0cy4gSXQgcmVjZWl2ZXMgZWFjaCBvZiB0aGUga2V5cyBhbmQgdmFsdWVzLAogICAgICAgICAgICBhbmQgaXRzIHJldHVybiB2YWx1ZSBpcyB1c2VkIGluc3RlYWQgb2YgdGhlIG9yaWdpbmFsIHZhbHVlLgogICAgICAgICAgICBJZiBpdCByZXR1cm5zIHdoYXQgaXQgcmVjZWl2ZWQsIHRoZW4gdGhlIHN0cnVjdHVyZSBpcyBub3QgbW9kaWZpZWQuCiAgICAgICAgICAgIElmIGl0IHJldHVybnMgdW5kZWZpbmVkIHRoZW4gdGhlIG1lbWJlciBpcyBkZWxldGVkLgoKICAgICAgICAgICAgRXhhbXBsZToKCiAgICAgICAgICAgIC8vIFBhcnNlIHRoZSB0ZXh0LiBWYWx1ZXMgdGhhdCBsb29rIGxpa2UgSVNPIGRhdGUgc3RyaW5ncyB3aWxsCiAgICAgICAgICAgIC8vIGJlIGNvbnZlcnRlZCB0byBEYXRlIG9iamVjdHMuCgogICAgICAgICAgICBteURhdGEgPSBKU09OLnBhcnNlKHRleHQsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICAgICAgICAgICAgICB2YXIgYTsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgICAgICAgICAgYSA9Ci9eKFxkezR9KS0oXGR7Mn0pLShcZHsyfSlUKFxkezJ9KTooXGR7Mn0pOihcZHsyfSg/OlwuXGQqKT8pWiQvLmV4ZWModmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGlmIChhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShEYXRlLlVUQygrYVsxXSwgK2FbMl0gLSAxLCArYVszXSwgK2FbNF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICArYVs1XSwgK2FbNl0pKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgbXlEYXRhID0gSlNPTi5wYXJzZSgnWyJEYXRlKDA5LzA5LzIwMDEpIl0nLCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgdmFyIGQ7CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJgogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS5zbGljZSgwLCA1KSA9PT0gJ0RhdGUoJyAmJgogICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZS5zbGljZSgtMSkgPT09ICcpJykgewogICAgICAgICAgICAgICAgICAgIGQgPSBuZXcgRGF0ZSh2YWx1ZS5zbGljZSg1LCAtMSkpOwogICAgICAgICAgICAgICAgICAgIGlmIChkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgfSk7CgoKICAgIFRoaXMgaXMgYSByZWZlcmVuY2UgaW1wbGVtZW50YXRpb24uIFlvdSBhcmUgZnJlZSB0byBjb3B5LCBtb2RpZnksIG9yCiAgICByZWRpc3RyaWJ1dGUuCiovCgoJCQkvKmpzbGludCBldmlsOiB0cnVlLCByZWdleHA6IHRydWUgKi8KCgkJCS8qbWVtYmVycyAiIiwgIlxiIiwgIlx0IiwgIlxuIiwgIlxmIiwgIlxyIiwgIlwiIiwgSlNPTiwgIlxcIiwgYXBwbHksCiAgICBjYWxsLCBjaGFyQ29kZUF0LCBnZXRVVENEYXRlLCBnZXRVVENGdWxsWWVhciwgZ2V0VVRDSG91cnMsCiAgICBnZXRVVENNaW51dGVzLCBnZXRVVENNb250aCwgZ2V0VVRDU2Vjb25kcywgaGFzT3duUHJvcGVydHksIGpvaW4sCiAgICBsYXN0SW5kZXgsIGxlbmd0aCwgcGFyc2UsIHByb3RvdHlwZSwgcHVzaCwgcmVwbGFjZSwgc2xpY2UsIHN0cmluZ2lmeSwKICAgIHRlc3QsIHRvSlNPTiwgdG9TdHJpbmcsIHZhbHVlT2YKKi8KCi8vIENyZWF0ZSBhIEpTT04gb2JqZWN0IG9ubHkgaWYgb25lIGRvZXMgbm90IGFscmVhZHkgZXhpc3QuIFdlIGNyZWF0ZSB0aGUKLy8gbWV0aG9kcyBpbiBhIGNsb3N1cmUgdG8gYXZvaWQgY3JlYXRpbmcgZ2xvYmFsIHZhcmlhYmxlcy4KCgkJCXZhciBKU09OID0gbW9kdWxlLmV4cG9ydHM7CgkJCShmdW5jdGlvbigpIHsKCQkJCSd1c2Ugc3RyaWN0JzsKCgkJCQlmdW5jdGlvbiBmKG4pIHsKCQkJCQkvLyBGb3JtYXQgaW50ZWdlcnMgdG8gaGF2ZSBhdCBsZWFzdCB0d28gZGlnaXRzLgoJCQkJCXJldHVybiBuIDwgMTAgPyAnMCcgKyBuIDogbjsKCQkJCX0KCgkJCQl2YXIgY3ggPSAvW1x1MDAwMFx1MDBhZFx1MDYwMC1cdTA2MDRcdTA3MGZcdTE3YjRcdTE3YjVcdTIwMGMtXHUyMDBmXHUyMDI4LVx1MjAyZlx1MjA2MC1cdTIwNmZcdWZlZmZcdWZmZjAtXHVmZmZmXS9nLAoJCQkJCWVzY2FwYWJsZSA9IC9bXFxcIlx4MDAtXHgxZlx4N2YtXHg5Zlx1MDBhZFx1MDYwMC1cdTA2MDRcdTA3MGZcdTE3YjRcdTE3YjVcdTIwMGMtXHUyMDBmXHUyMDI4LVx1MjAyZlx1MjA2MC1cdTIwNmZcdWZlZmZcdWZmZjAtXHVmZmZmXS9nLAoJCQkJCWdhcCwKCQkJCQlpbmRlbnQsCgkJCQkJbWV0YSA9IHsKCQkJCQkJLy8gdGFibGUgb2YgY2hhcmFjdGVyIHN1YnN0aXR1dGlvbnMKCQkJCQkJJ1xiJzogJ1xcYicsCgkJCQkJCSdcdCc6ICdcXHQnLAoJCQkJCQknXG4nOiAnXFxuJywKCQkJCQkJJ1xmJzogJ1xcZicsCgkJCQkJCSdccic6ICdcXHInLAoJCQkJCQknIic6ICdcXCInLAoJCQkJCQknXFwnOiAnXFxcXCcKCQkJCQl9LAoJCQkJCXJlcDsKCgkJCQlmdW5jdGlvbiBxdW90ZShzdHJpbmcpIHsKCQkJCQkvLyBJZiB0aGUgc3RyaW5nIGNvbnRhaW5zIG5vIGNvbnRyb2wgY2hhcmFjdGVycywgbm8gcXVvdGUgY2hhcmFjdGVycywgYW5kIG5vCgkJCQkJLy8gYmFja3NsYXNoIGNoYXJhY3RlcnMsIHRoZW4gd2UgY2FuIHNhZmVseSBzbGFwIHNvbWUgcXVvdGVzIGFyb3VuZCBpdC4KCQkJCQkvLyBPdGhlcndpc2Ugd2UgbXVzdCBhbHNvIHJlcGxhY2UgdGhlIG9mZmVuZGluZyBjaGFyYWN0ZXJzIHdpdGggc2FmZSBlc2NhcGUKCQkJCQkvLyBzZXF1ZW5jZXMuCgoJCQkJCWVzY2FwYWJsZS5sYXN0SW5kZXggPSAwOwoJCQkJCXJldHVybiBlc2NhcGFibGUudGVzdChzdHJpbmcpID8gJyInICsgc3RyaW5nLnJlcGxhY2UoZXNjYXBhYmxlLCBmdW5jdGlvbihhKSB7CgkJCQkJCXZhciBjID0gbWV0YVthXTsKCQkJCQkJcmV0dXJuIHR5cGVvZiBjID09PSAnc3RyaW5nJyA/IGMgOiAnXFx1JyArICgnMDAwMCcgKyBhLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpKS5zbGljZSgtNCk7CgkJCQkJfSkgKyAnIicgOiAnIicgKyBzdHJpbmcgKyAnIic7CgkJCQl9CgoJCQkJZnVuY3Rpb24gc3RyKGtleSwgaG9sZGVyKSB7CgkJCQkJLy8gUHJvZHVjZSBhIHN0cmluZyBmcm9tIGhvbGRlcltrZXldLgoKCQkJCQl2YXIgaSwKCQkJCQkJLy8gVGhlIGxvb3AgY291bnRlci4KCQkJCQkJaywKCQkJCQkJLy8gVGhlIG1lbWJlciBrZXkuCgkJCQkJCXYsCgkJCQkJCS8vIFRoZSBtZW1iZXIgdmFsdWUuCgkJCQkJCWxlbmd0aCwKCQkJCQkJbWluZCA9IGdhcCwKCQkJCQkJcGFydGlhbCwKCQkJCQkJdmFsdWUgPSBob2xkZXJba2V5XSwKCQkJCQkJaXNCaWdOdW1iZXIgPSB2YWx1ZSAhPSBudWxsICYmICh2YWx1ZSBpbnN0YW5jZW9mIEJpZ051bWJlciB8fCBCaWdOdW1iZXIuaXNCaWdOdW1iZXIodmFsdWUpKTsKCgkJCQkJLy8gSWYgdGhlIHZhbHVlIGhhcyBhIHRvSlNPTiBtZXRob2QsIGNhbGwgaXQgdG8gb2J0YWluIGEgcmVwbGFjZW1lbnQgdmFsdWUuCgoJCQkJCWlmICh2YWx1ZSAmJiBfdHlwZW9mKHZhbHVlKSA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIHZhbHVlLnRvSlNPTiA9PT0gJ2Z1bmN0aW9uJykgewoJCQkJCQl2YWx1ZSA9IHZhbHVlLnRvSlNPTihrZXkpOwoJCQkJCX0KCgkJCQkJLy8gSWYgd2Ugd2VyZSBjYWxsZWQgd2l0aCBhIHJlcGxhY2VyIGZ1bmN0aW9uLCB0aGVuIGNhbGwgdGhlIHJlcGxhY2VyIHRvCgkJCQkJLy8gb2J0YWluIGEgcmVwbGFjZW1lbnQgdmFsdWUuCgoJCQkJCWlmICh0eXBlb2YgcmVwID09PSAnZnVuY3Rpb24nKSB7CgkJCQkJCXZhbHVlID0gcmVwLmNhbGwoaG9sZGVyLCBrZXksIHZhbHVlKTsKCQkJCQl9CgoJCQkJCS8vIFdoYXQgaGFwcGVucyBuZXh0IGRlcGVuZHMgb24gdGhlIHZhbHVlJ3MgdHlwZS4KCgkJCQkJc3dpdGNoIChfdHlwZW9mKHZhbHVlKSkgewoJCQkJCQljYXNlICdzdHJpbmcnOgoJCQkJCQkJaWYgKGlzQmlnTnVtYmVyKSB7CgkJCQkJCQkJcmV0dXJuIHZhbHVlOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlyZXR1cm4gcXVvdGUodmFsdWUpOwoJCQkJCQkJfQoJCQkJCQljYXNlICdudW1iZXInOgoJCQkJCQkJLy8gSlNPTiBudW1iZXJzIG11c3QgYmUgZmluaXRlLiBFbmNvZGUgbm9uLWZpbml0ZSBudW1iZXJzIGFzIG51bGwuCgoJCQkJCQkJcmV0dXJuIGlzRmluaXRlKHZhbHVlKSA/IFN0cmluZyh2YWx1ZSkgOiAnbnVsbCc7CgkJCQkJCWNhc2UgJ2Jvb2xlYW4nOgoJCQkJCQljYXNlICdudWxsJzoKCQkJCQkJY2FzZSAnYmlnaW50JzoKCQkJCQkJCS8vIElmIHRoZSB2YWx1ZSBpcyBhIGJvb2xlYW4gb3IgbnVsbCwgY29udmVydCBpdCB0byBhIHN0cmluZy4gTm90ZToKCQkJCQkJCS8vIHR5cGVvZiBudWxsIGRvZXMgbm90IHByb2R1Y2UgJ251bGwnLiBUaGUgY2FzZSBpcyBpbmNsdWRlZCBoZXJlIGluCgkJCQkJCQkvLyB0aGUgcmVtb3RlIGNoYW5jZSB0aGF0IHRoaXMgZ2V0cyBmaXhlZCBzb21lZGF5LgoKCQkJCQkJCXJldHVybiBTdHJpbmcodmFsdWUpOwoKCQkJCQkJLy8gSWYgdGhlIHR5cGUgaXMgJ29iamVjdCcsIHdlIG1pZ2h0IGJlIGRlYWxpbmcgd2l0aCBhbiBvYmplY3Qgb3IgYW4gYXJyYXkgb3IKCQkJCQkJLy8gbnVsbC4KCgkJCQkJCWNhc2UgJ29iamVjdCc6CgkJCQkJCQkvLyBEdWUgdG8gYSBzcGVjaWZpY2F0aW9uIGJsdW5kZXIgaW4gRUNNQVNjcmlwdCwgdHlwZW9mIG51bGwgaXMgJ29iamVjdCcsCgkJCQkJCQkvLyBzbyB3YXRjaCBvdXQgZm9yIHRoYXQgY2FzZS4KCgkJCQkJCQlpZiAoIXZhbHVlKSB7CgkJCQkJCQkJcmV0dXJuICdudWxsJzsKCQkJCQkJCX0KCgkJCQkJCQkvLyBNYWtlIGFuIGFycmF5IHRvIGhvbGQgdGhlIHBhcnRpYWwgcmVzdWx0cyBvZiBzdHJpbmdpZnlpbmcgdGhpcyBvYmplY3QgdmFsdWUuCgoJCQkJCQkJZ2FwICs9IGluZGVudDsKCQkJCQkJCXBhcnRpYWwgPSBbXTsKCgkJCQkJCQkvLyBJcyB0aGUgdmFsdWUgYW4gYXJyYXk/CgoJCQkJCQkJaWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuYXBwbHkodmFsdWUpID09PSAnW29iamVjdCBBcnJheV0nKSB7CgkJCQkJCQkJLy8gVGhlIHZhbHVlIGlzIGFuIGFycmF5LiBTdHJpbmdpZnkgZXZlcnkgZWxlbWVudC4gVXNlIG51bGwgYXMgYSBwbGFjZWhvbGRlcgoJCQkJCQkJCS8vIGZvciBub24tSlNPTiB2YWx1ZXMuCgoJCQkJCQkJCWxlbmd0aCA9IHZhbHVlLmxlbmd0aDsKCQkJCQkJCQlmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpICs9IDEpIHsKCQkJCQkJCQkJcGFydGlhbFtpXSA9IHN0cihpLCB2YWx1ZSkgfHwgJ251bGwnOwoJCQkJCQkJCX0KCgkJCQkJCQkJLy8gSm9pbiBhbGwgb2YgdGhlIGVsZW1lbnRzIHRvZ2V0aGVyLCBzZXBhcmF0ZWQgd2l0aCBjb21tYXMsIGFuZCB3cmFwIHRoZW0gaW4KCQkJCQkJCQkvLyBicmFja2V0cy4KCgkJCQkJCQkJdiA9IHBhcnRpYWwubGVuZ3RoID09PSAwID8gJ1tdJyA6IGdhcCA/ICdbXG4nICsgZ2FwICsgcGFydGlhbC5qb2luKCcsXG4nICsgZ2FwKSArICdcbicgKyBtaW5kICsgJ10nIDogJ1snICsgcGFydGlhbC5qb2luKCcsJykgKyAnXSc7CgkJCQkJCQkJZ2FwID0gbWluZDsKCQkJCQkJCQlyZXR1cm4gdjsKCQkJCQkJCX0KCgkJCQkJCQkvLyBJZiB0aGUgcmVwbGFjZXIgaXMgYW4gYXJyYXksIHVzZSBpdCB0byBzZWxlY3QgdGhlIG1lbWJlcnMgdG8gYmUgc3RyaW5naWZpZWQuCgoJCQkJCQkJaWYgKHJlcCAmJiBfdHlwZW9mKHJlcCkgPT09ICdvYmplY3QnKSB7CgkJCQkJCQkJbGVuZ3RoID0gcmVwLmxlbmd0aDsKCQkJCQkJCQlmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpICs9IDEpIHsKCQkJCQkJCQkJaWYgKHR5cGVvZiByZXBbaV0gPT09ICdzdHJpbmcnKSB7CgkJCQkJCQkJCQlrID0gcmVwW2ldOwoJCQkJCQkJCQkJdiA9IHN0cihrLCB2YWx1ZSk7CgkJCQkJCQkJCQlpZiAodikgewoJCQkJCQkJCQkJCXBhcnRpYWwucHVzaChxdW90ZShrKSArIChnYXAgPyAnOiAnIDogJzonKSArIHYpOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkvLyBPdGhlcndpc2UsIGl0ZXJhdGUgdGhyb3VnaCBhbGwgb2YgdGhlIGtleXMgaW4gdGhlIG9iamVjdC4KCgkJCQkJCQkJT2JqZWN0LmtleXModmFsdWUpLmZvckVhY2goZnVuY3Rpb24oaykgewoJCQkJCQkJCQl2YXIgdiA9IHN0cihrLCB2YWx1ZSk7CgkJCQkJCQkJCWlmICh2KSB7CgkJCQkJCQkJCQlwYXJ0aWFsLnB1c2gocXVvdGUoaykgKyAoZ2FwID8gJzogJyA6ICc6JykgKyB2KTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0pOwoJCQkJCQkJfQoKCQkJCQkJCS8vIEpvaW4gYWxsIG9mIHRoZSBtZW1iZXIgdGV4dHMgdG9nZXRoZXIsIHNlcGFyYXRlZCB3aXRoIGNvbW1hcywKCQkJCQkJCS8vIGFuZCB3cmFwIHRoZW0gaW4gYnJhY2VzLgoKCQkJCQkJCXYgPSBwYXJ0aWFsLmxlbmd0aCA9PT0gMCA/ICd7fScgOiBnYXAgPyAne1xuJyArIGdhcCArIHBhcnRpYWwuam9pbignLFxuJyArIGdhcCkgKyAnXG4nICsgbWluZCArICd9JyA6ICd7JyArIHBhcnRpYWwuam9pbignLCcpICsgJ30nOwoJCQkJCQkJZ2FwID0gbWluZDsKCQkJCQkJCXJldHVybiB2OwoJCQkJCX0KCQkJCX0KCgkJCQkvLyBJZiB0aGUgSlNPTiBvYmplY3QgZG9lcyBub3QgeWV0IGhhdmUgYSBzdHJpbmdpZnkgbWV0aG9kLCBnaXZlIGl0IG9uZS4KCgkJCQlpZiAodHlwZW9mIEpTT04uc3RyaW5naWZ5ICE9PSAnZnVuY3Rpb24nKSB7CgkJCQkJSlNPTi5zdHJpbmdpZnkgPSBmdW5jdGlvbih2YWx1ZSwgcmVwbGFjZXIsIHNwYWNlKSB7CgkJCQkJCS8vIFRoZSBzdHJpbmdpZnkgbWV0aG9kIHRha2VzIGEgdmFsdWUgYW5kIGFuIG9wdGlvbmFsIHJlcGxhY2VyLCBhbmQgYW4gb3B0aW9uYWwKCQkJCQkJLy8gc3BhY2UgcGFyYW1ldGVyLCBhbmQgcmV0dXJucyBhIEpTT04gdGV4dC4gVGhlIHJlcGxhY2VyIGNhbiBiZSBhIGZ1bmN0aW9uCgkJCQkJCS8vIHRoYXQgY2FuIHJlcGxhY2UgdmFsdWVzLCBvciBhbiBhcnJheSBvZiBzdHJpbmdzIHRoYXQgd2lsbCBzZWxlY3QgdGhlIGtleXMuCgkJCQkJCS8vIEEgZGVmYXVsdCByZXBsYWNlciBtZXRob2QgY2FuIGJlIHByb3ZpZGVkLiBVc2Ugb2YgdGhlIHNwYWNlIHBhcmFtZXRlciBjYW4KCQkJCQkJLy8gcHJvZHVjZSB0ZXh0IHRoYXQgaXMgbW9yZSBlYXNpbHkgcmVhZGFibGUuCgoJCQkJCQl2YXIgaTsKCQkJCQkJZ2FwID0gJyc7CgkJCQkJCWluZGVudCA9ICcnOwoKCQkJCQkJLy8gSWYgdGhlIHNwYWNlIHBhcmFtZXRlciBpcyBhIG51bWJlciwgbWFrZSBhbiBpbmRlbnQgc3RyaW5nIGNvbnRhaW5pbmcgdGhhdAoJCQkJCQkvLyBtYW55IHNwYWNlcy4KCgkJCQkJCWlmICh0eXBlb2Ygc3BhY2UgPT09ICdudW1iZXInKSB7CgkJCQkJCQlmb3IgKGkgPSAwOyBpIDwgc3BhY2U7IGkgKz0gMSkgewoJCQkJCQkJCWluZGVudCArPSAnICc7CgkJCQkJCQl9CgoJCQkJCQkJLy8gSWYgdGhlIHNwYWNlIHBhcmFtZXRlciBpcyBhIHN0cmluZywgaXQgd2lsbCBiZSB1c2VkIGFzIHRoZSBpbmRlbnQgc3RyaW5nLgoJCQkJCQl9IGVsc2UgaWYgKHR5cGVvZiBzcGFjZSA9PT0gJ3N0cmluZycpIHsKCQkJCQkJCWluZGVudCA9IHNwYWNlOwoJCQkJCQl9CgoJCQkJCQkvLyBJZiB0aGVyZSBpcyBhIHJlcGxhY2VyLCBpdCBtdXN0IGJlIGEgZnVuY3Rpb24gb3IgYW4gYXJyYXkuCgkJCQkJCS8vIE90aGVyd2lzZSwgdGhyb3cgYW4gZXJyb3IuCgoJCQkJCQlyZXAgPSByZXBsYWNlcjsKCQkJCQkJaWYgKHJlcGxhY2VyICYmIHR5cGVvZiByZXBsYWNlciAhPT0gJ2Z1bmN0aW9uJyAmJiAoX3R5cGVvZihyZXBsYWNlcikgIT09ICdvYmplY3QnIHx8IHR5cGVvZiByZXBsYWNlci5sZW5ndGggIT09ICdudW1iZXInKSkgewoJCQkJCQkJdGhyb3cgbmV3IEVycm9yKCdKU09OLnN0cmluZ2lmeScpOwoJCQkJCQl9CgoJCQkJCQkvLyBNYWtlIGEgZmFrZSByb290IG9iamVjdCBjb250YWluaW5nIG91ciB2YWx1ZSB1bmRlciB0aGUga2V5IG9mICcnLgoJCQkJCQkvLyBSZXR1cm4gdGhlIHJlc3VsdCBvZiBzdHJpbmdpZnlpbmcgdGhlIHZhbHVlLgoKCQkJCQkJcmV0dXJuIHN0cignJywgewoJCQkJCQkJJyc6IHZhbHVlCgkJCQkJCX0pOwoJCQkJCX07CgkJCQl9CgkJCX0pKCk7CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyA1MzAwOgoJCS8qKiovICgobW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgkJCSd1c2Ugc3RyaWN0JzsKCQkJLyogcHJvdmlkZWQgZGVwZW5kZW5jeSAqLwoJCQl2YXIgcHJvY2VzcyA9IF9fd2VicGFja19yZXF1aXJlX18oODgwOCk7Ci8vICdwYXRoJyBtb2R1bGUgZXh0cmFjdGVkIGZyb20gTm9kZS5qcyB2OC4xMS4xIChvbmx5IHRoZSBwb3NpeCBwYXJ0KQovLyB0cmFuc3BsaXRlZCB3aXRoIEJhYmVsCgovLyBDb3B5cmlnaHQgSm95ZW50LCBJbmMuIGFuZCBvdGhlciBOb2RlIGNvbnRyaWJ1dG9ycy4KLy8KLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEKLy8gY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZQovLyAiU29mdHdhcmUiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nCi8vIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwKLy8gZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdAovLyBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUKLy8gZm9sbG93aW5nIGNvbmRpdGlvbnM6Ci8vCi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkCi8vIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgovLwovLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUwovLyBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GCi8vIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4KLy8gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sCi8vIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUgovLyBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFCi8vIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCgoKCQkJZnVuY3Rpb24gX3R5cGVvZihvKSB7CgkJCQknQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YnOwoJCQkJcmV0dXJuIF90eXBlb2YgPSAnZnVuY3Rpb24nID09IHR5cGVvZiBTeW1ib2wgJiYgJ3N5bWJvbCcgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uKG8pIHsKCQkJCQlyZXR1cm4gdHlwZW9mIG87CgkJCQl9IDogZnVuY3Rpb24obykgewoJCQkJCXJldHVybiBvICYmICdmdW5jdGlvbicgPT0gdHlwZW9mIFN5bWJvbCAmJiBvLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgbyAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICdzeW1ib2wnIDogdHlwZW9mIG87CgkJCQl9LCBfdHlwZW9mKG8pOwoJCQl9CgoJCQlmdW5jdGlvbiBhc3NlcnRQYXRoKHBhdGgpIHsKCQkJCWlmICh0eXBlb2YgcGF0aCAhPT0gJ3N0cmluZycpIHsKCQkJCQl0aHJvdyBuZXcgVHlwZUVycm9yKCdQYXRoIG11c3QgYmUgYSBzdHJpbmcuIFJlY2VpdmVkICcgKyBKU09OLnN0cmluZ2lmeShwYXRoKSk7CgkJCQl9CgkJCX0KCi8vIFJlc29sdmVzIC4gYW5kIC4uIGVsZW1lbnRzIGluIGEgcGF0aCB3aXRoIGRpcmVjdG9yeSBuYW1lcwoJCQlmdW5jdGlvbiBub3JtYWxpemVTdHJpbmdQb3NpeChwYXRoLCBhbGxvd0Fib3ZlUm9vdCkgewoJCQkJdmFyIHJlcyA9ICcnOwoJCQkJdmFyIGxhc3RTZWdtZW50TGVuZ3RoID0gMDsKCQkJCXZhciBsYXN0U2xhc2ggPSAtMTsKCQkJCXZhciBkb3RzID0gMDsKCQkJCXZhciBjb2RlOwoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPD0gcGF0aC5sZW5ndGg7ICsraSkgewoJCQkJCWlmIChpIDwgcGF0aC5sZW5ndGgpIGNvZGUgPSBwYXRoLmNoYXJDb2RlQXQoaSk7IGVsc2UgaWYgKGNvZGUgPT09IDQ3IC8qLyovKSBicmVhazsgZWxzZSBjb2RlID0gNDcgLyovKi87CgkJCQkJaWYgKGNvZGUgPT09IDQ3IC8qLyovKSB7CgkJCQkJCWlmIChsYXN0U2xhc2ggPT09IGkgLSAxIHx8IGRvdHMgPT09IDEpIHsKCQkJCQkJCS8vIE5PT1AKCQkJCQkJfSBlbHNlIGlmIChsYXN0U2xhc2ggIT09IGkgLSAxICYmIGRvdHMgPT09IDIpIHsKCQkJCQkJCWlmIChyZXMubGVuZ3RoIDwgMiB8fCBsYXN0U2VnbWVudExlbmd0aCAhPT0gMiB8fCByZXMuY2hhckNvZGVBdChyZXMubGVuZ3RoIC0gMSkgIT09IDQ2IC8qLiovIHx8IHJlcy5jaGFyQ29kZUF0KHJlcy5sZW5ndGggLSAyKSAhPT0gNDYgLyouKi8pIHsKCQkJCQkJCQlpZiAocmVzLmxlbmd0aCA+IDIpIHsKCQkJCQkJCQkJdmFyIGxhc3RTbGFzaEluZGV4ID0gcmVzLmxhc3RJbmRleE9mKCcvJyk7CgkJCQkJCQkJCWlmIChsYXN0U2xhc2hJbmRleCAhPT0gcmVzLmxlbmd0aCAtIDEpIHsKCQkJCQkJCQkJCWlmIChsYXN0U2xhc2hJbmRleCA9PT0gLTEpIHsKCQkJCQkJCQkJCQlyZXMgPSAnJzsKCQkJCQkJCQkJCQlsYXN0U2VnbWVudExlbmd0aCA9IDA7CgkJCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQkJCXJlcyA9IHJlcy5zbGljZSgwLCBsYXN0U2xhc2hJbmRleCk7CgkJCQkJCQkJCQkJbGFzdFNlZ21lbnRMZW5ndGggPSByZXMubGVuZ3RoIC0gMSAtIHJlcy5sYXN0SW5kZXhPZignLycpOwoJCQkJCQkJCQkJfQoJCQkJCQkJCQkJbGFzdFNsYXNoID0gaTsKCQkJCQkJCQkJCWRvdHMgPSAwOwoJCQkJCQkJCQkJY29udGludWU7CgkJCQkJCQkJCX0KCQkJCQkJCQl9IGVsc2UgaWYgKHJlcy5sZW5ndGggPT09IDIgfHwgcmVzLmxlbmd0aCA9PT0gMSkgewoJCQkJCQkJCQlyZXMgPSAnJzsKCQkJCQkJCQkJbGFzdFNlZ21lbnRMZW5ndGggPSAwOwoJCQkJCQkJCQlsYXN0U2xhc2ggPSBpOwoJCQkJCQkJCQlkb3RzID0gMDsKCQkJCQkJCQkJY29udGludWU7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJaWYgKGFsbG93QWJvdmVSb290KSB7CgkJCQkJCQkJaWYgKHJlcy5sZW5ndGggPiAwKSByZXMgKz0gJy8uLic7IGVsc2UgcmVzID0gJy4uJzsKCQkJCQkJCQlsYXN0U2VnbWVudExlbmd0aCA9IDI7CgkJCQkJCQl9CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQlpZiAocmVzLmxlbmd0aCA+IDApIHJlcyArPSAnLycgKyBwYXRoLnNsaWNlKGxhc3RTbGFzaCArIDEsIGkpOyBlbHNlIHJlcyA9IHBhdGguc2xpY2UobGFzdFNsYXNoICsgMSwgaSk7CgkJCQkJCQlsYXN0U2VnbWVudExlbmd0aCA9IGkgLSBsYXN0U2xhc2ggLSAxOwoJCQkJCQl9CgkJCQkJCWxhc3RTbGFzaCA9IGk7CgkJCQkJCWRvdHMgPSAwOwoJCQkJCX0gZWxzZSBpZiAoY29kZSA9PT0gNDYgLyouKi8gJiYgZG90cyAhPT0gLTEpIHsKCQkJCQkJKytkb3RzOwoJCQkJCX0gZWxzZSB7CgkJCQkJCWRvdHMgPSAtMTsKCQkJCQl9CgkJCQl9CgkJCQlyZXR1cm4gcmVzOwoJCQl9CgoJCQlmdW5jdGlvbiBfZm9ybWF0KHNlcCwgcGF0aE9iamVjdCkgewoJCQkJdmFyIGRpciA9IHBhdGhPYmplY3QuZGlyIHx8IHBhdGhPYmplY3Qucm9vdDsKCQkJCXZhciBiYXNlID0gcGF0aE9iamVjdC5iYXNlIHx8IChwYXRoT2JqZWN0Lm5hbWUgfHwgJycpICsgKHBhdGhPYmplY3QuZXh0IHx8ICcnKTsKCQkJCWlmICghZGlyKSB7CgkJCQkJcmV0dXJuIGJhc2U7CgkJCQl9CgkJCQlpZiAoZGlyID09PSBwYXRoT2JqZWN0LnJvb3QpIHsKCQkJCQlyZXR1cm4gZGlyICsgYmFzZTsKCQkJCX0KCQkJCXJldHVybiBkaXIgKyBzZXAgKyBiYXNlOwoJCQl9CgoJCQl2YXIgcG9zaXggPSB7CgkJCQkvLyBwYXRoLnJlc29sdmUoW2Zyb20gLi4uXSwgdG8pCgkJCQlyZXNvbHZlOiBmdW5jdGlvbiByZXNvbHZlKCkgewoJCQkJCXZhciByZXNvbHZlZFBhdGggPSAnJzsKCQkJCQl2YXIgcmVzb2x2ZWRBYnNvbHV0ZSA9IGZhbHNlOwoJCQkJCXZhciBjd2Q7CgkJCQkJZm9yICh2YXIgaSA9IGFyZ3VtZW50cy5sZW5ndGggLSAxOyBpID49IC0xICYmICFyZXNvbHZlZEFic29sdXRlOyBpLS0pIHsKCQkJCQkJdmFyIHBhdGg7CgkJCQkJCWlmIChpID49IDApIHBhdGggPSBhcmd1bWVudHNbaV07IGVsc2UgewoJCQkJCQkJaWYgKGN3ZCA9PT0gdW5kZWZpbmVkKSBjd2QgPSBwcm9jZXNzLmN3ZCgpOwoJCQkJCQkJcGF0aCA9IGN3ZDsKCQkJCQkJfQoJCQkJCQlhc3NlcnRQYXRoKHBhdGgpOwoKCQkJCQkJLy8gU2tpcCBlbXB0eSBlbnRyaWVzCgkJCQkJCWlmIChwYXRoLmxlbmd0aCA9PT0gMCkgewoJCQkJCQkJY29udGludWU7CgkJCQkJCX0KCQkJCQkJcmVzb2x2ZWRQYXRoID0gcGF0aCArICcvJyArIHJlc29sdmVkUGF0aDsKCQkJCQkJcmVzb2x2ZWRBYnNvbHV0ZSA9IHBhdGguY2hhckNvZGVBdCgwKSA9PT0gNDcgLyovKi87CgkJCQkJfQoKCQkJCQkvLyBBdCB0aGlzIHBvaW50IHRoZSBwYXRoIHNob3VsZCBiZSByZXNvbHZlZCB0byBhIGZ1bGwgYWJzb2x1dGUgcGF0aCwgYnV0CgkJCQkJLy8gaGFuZGxlIHJlbGF0aXZlIHBhdGhzIHRvIGJlIHNhZmUgKG1pZ2h0IGhhcHBlbiB3aGVuIHByb2Nlc3MuY3dkKCkgZmFpbHMpCgoJCQkJCS8vIE5vcm1hbGl6ZSB0aGUgcGF0aAoJCQkJCXJlc29sdmVkUGF0aCA9IG5vcm1hbGl6ZVN0cmluZ1Bvc2l4KHJlc29sdmVkUGF0aCwgIXJlc29sdmVkQWJzb2x1dGUpOwoJCQkJCWlmIChyZXNvbHZlZEFic29sdXRlKSB7CgkJCQkJCWlmIChyZXNvbHZlZFBhdGgubGVuZ3RoID4gMCkgcmV0dXJuICcvJyArIHJlc29sdmVkUGF0aDsgZWxzZSByZXR1cm4gJy8nOwoJCQkJCX0gZWxzZSBpZiAocmVzb2x2ZWRQYXRoLmxlbmd0aCA+IDApIHsKCQkJCQkJcmV0dXJuIHJlc29sdmVkUGF0aDsKCQkJCQl9IGVsc2UgewoJCQkJCQlyZXR1cm4gJy4nOwoJCQkJCX0KCQkJCX0sCgkJCQlub3JtYWxpemU6IGZ1bmN0aW9uIG5vcm1hbGl6ZShwYXRoKSB7CgkJCQkJYXNzZXJ0UGF0aChwYXRoKTsKCQkJCQlpZiAocGF0aC5sZW5ndGggPT09IDApIHJldHVybiAnLic7CgkJCQkJdmFyIGlzQWJzb2x1dGUgPSBwYXRoLmNoYXJDb2RlQXQoMCkgPT09IDQ3IC8qLyovOwoJCQkJCXZhciB0cmFpbGluZ1NlcGFyYXRvciA9IHBhdGguY2hhckNvZGVBdChwYXRoLmxlbmd0aCAtIDEpID09PSA0NyAvKi8qLzsKCgkJCQkJLy8gTm9ybWFsaXplIHRoZSBwYXRoCgkJCQkJcGF0aCA9IG5vcm1hbGl6ZVN0cmluZ1Bvc2l4KHBhdGgsICFpc0Fic29sdXRlKTsKCQkJCQlpZiAocGF0aC5sZW5ndGggPT09IDAgJiYgIWlzQWJzb2x1dGUpIHBhdGggPSAnLic7CgkJCQkJaWYgKHBhdGgubGVuZ3RoID4gMCAmJiB0cmFpbGluZ1NlcGFyYXRvcikgcGF0aCArPSAnLyc7CgkJCQkJaWYgKGlzQWJzb2x1dGUpIHJldHVybiAnLycgKyBwYXRoOwoJCQkJCXJldHVybiBwYXRoOwoJCQkJfSwKCQkJCWlzQWJzb2x1dGU6IGZ1bmN0aW9uIGlzQWJzb2x1dGUocGF0aCkgewoJCQkJCWFzc2VydFBhdGgocGF0aCk7CgkJCQkJcmV0dXJuIHBhdGgubGVuZ3RoID4gMCAmJiBwYXRoLmNoYXJDb2RlQXQoMCkgPT09IDQ3IC8qLyovOwoJCQkJfSwKCQkJCWpvaW46IGZ1bmN0aW9uIGpvaW4oKSB7CgkJCQkJaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHJldHVybiAnLic7CgkJCQkJdmFyIGpvaW5lZDsKCQkJCQlmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7ICsraSkgewoJCQkJCQl2YXIgYXJnID0gYXJndW1lbnRzW2ldOwoJCQkJCQlhc3NlcnRQYXRoKGFyZyk7CgkJCQkJCWlmIChhcmcubGVuZ3RoID4gMCkgewoJCQkJCQkJaWYgKGpvaW5lZCA9PT0gdW5kZWZpbmVkKSBqb2luZWQgPSBhcmc7IGVsc2Ugam9pbmVkICs9ICcvJyArIGFyZzsKCQkJCQkJfQoJCQkJCX0KCQkJCQlpZiAoam9pbmVkID09PSB1bmRlZmluZWQpIHJldHVybiAnLic7CgkJCQkJcmV0dXJuIHBvc2l4Lm5vcm1hbGl6ZShqb2luZWQpOwoJCQkJfSwKCQkJCXJlbGF0aXZlOiBmdW5jdGlvbiByZWxhdGl2ZShmcm9tLCB0bykgewoJCQkJCWFzc2VydFBhdGgoZnJvbSk7CgkJCQkJYXNzZXJ0UGF0aCh0byk7CgkJCQkJaWYgKGZyb20gPT09IHRvKSByZXR1cm4gJyc7CgkJCQkJZnJvbSA9IHBvc2l4LnJlc29sdmUoZnJvbSk7CgkJCQkJdG8gPSBwb3NpeC5yZXNvbHZlKHRvKTsKCQkJCQlpZiAoZnJvbSA9PT0gdG8pIHJldHVybiAnJzsKCgkJCQkJLy8gVHJpbSBhbnkgbGVhZGluZyBiYWNrc2xhc2hlcwoJCQkJCXZhciBmcm9tU3RhcnQgPSAxOwoJCQkJCWZvciAoOyBmcm9tU3RhcnQgPCBmcm9tLmxlbmd0aDsgKytmcm9tU3RhcnQpIHsKCQkJCQkJaWYgKGZyb20uY2hhckNvZGVBdChmcm9tU3RhcnQpICE9PSA0NyAvKi8qLykgYnJlYWs7CgkJCQkJfQoJCQkJCXZhciBmcm9tRW5kID0gZnJvbS5sZW5ndGg7CgkJCQkJdmFyIGZyb21MZW4gPSBmcm9tRW5kIC0gZnJvbVN0YXJ0OwoKCQkJCQkvLyBUcmltIGFueSBsZWFkaW5nIGJhY2tzbGFzaGVzCgkJCQkJdmFyIHRvU3RhcnQgPSAxOwoJCQkJCWZvciAoOyB0b1N0YXJ0IDwgdG8ubGVuZ3RoOyArK3RvU3RhcnQpIHsKCQkJCQkJaWYgKHRvLmNoYXJDb2RlQXQodG9TdGFydCkgIT09IDQ3IC8qLyovKSBicmVhazsKCQkJCQl9CgkJCQkJdmFyIHRvRW5kID0gdG8ubGVuZ3RoOwoJCQkJCXZhciB0b0xlbiA9IHRvRW5kIC0gdG9TdGFydDsKCgkJCQkJLy8gQ29tcGFyZSBwYXRocyB0byBmaW5kIHRoZSBsb25nZXN0IGNvbW1vbiBwYXRoIGZyb20gcm9vdAoJCQkJCXZhciBsZW5ndGggPSBmcm9tTGVuIDwgdG9MZW4gPyBmcm9tTGVuIDogdG9MZW47CgkJCQkJdmFyIGxhc3RDb21tb25TZXAgPSAtMTsKCQkJCQl2YXIgaSA9IDA7CgkJCQkJZm9yICg7IGkgPD0gbGVuZ3RoOyArK2kpIHsKCQkJCQkJaWYgKGkgPT09IGxlbmd0aCkgewoJCQkJCQkJaWYgKHRvTGVuID4gbGVuZ3RoKSB7CgkJCQkJCQkJaWYgKHRvLmNoYXJDb2RlQXQodG9TdGFydCArIGkpID09PSA0NyAvKi8qLykgewoJCQkJCQkJCQkvLyBXZSBnZXQgaGVyZSBpZiBgZnJvbWAgaXMgdGhlIGV4YWN0IGJhc2UgcGF0aCBmb3IgYHRvYC4KCQkJCQkJCQkJLy8gRm9yIGV4YW1wbGU6IGZyb209Jy9mb28vYmFyJzsgdG89Jy9mb28vYmFyL2JheicKCQkJCQkJCQkJcmV0dXJuIHRvLnNsaWNlKHRvU3RhcnQgKyBpICsgMSk7CgkJCQkJCQkJfSBlbHNlIGlmIChpID09PSAwKSB7CgkJCQkJCQkJCS8vIFdlIGdldCBoZXJlIGlmIGBmcm9tYCBpcyB0aGUgcm9vdAoJCQkJCQkJCQkvLyBGb3IgZXhhbXBsZTogZnJvbT0nLyc7IHRvPScvZm9vJwoJCQkJCQkJCQlyZXR1cm4gdG8uc2xpY2UodG9TdGFydCArIGkpOwoJCQkJCQkJCX0KCQkJCQkJCX0gZWxzZSBpZiAoZnJvbUxlbiA+IGxlbmd0aCkgewoJCQkJCQkJCWlmIChmcm9tLmNoYXJDb2RlQXQoZnJvbVN0YXJ0ICsgaSkgPT09IDQ3IC8qLyovKSB7CgkJCQkJCQkJCS8vIFdlIGdldCBoZXJlIGlmIGB0b2AgaXMgdGhlIGV4YWN0IGJhc2UgcGF0aCBmb3IgYGZyb21gLgoJCQkJCQkJCQkvLyBGb3IgZXhhbXBsZTogZnJvbT0nL2Zvby9iYXIvYmF6JzsgdG89Jy9mb28vYmFyJwoJCQkJCQkJCQlsYXN0Q29tbW9uU2VwID0gaTsKCQkJCQkJCQl9IGVsc2UgaWYgKGkgPT09IDApIHsKCQkJCQkJCQkJLy8gV2UgZ2V0IGhlcmUgaWYgYHRvYCBpcyB0aGUgcm9vdC4KCQkJCQkJCQkJLy8gRm9yIGV4YW1wbGU6IGZyb209Jy9mb28nOyB0bz0nLycKCQkJCQkJCQkJbGFzdENvbW1vblNlcCA9IDA7CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQkJYnJlYWs7CgkJCQkJCX0KCQkJCQkJdmFyIGZyb21Db2RlID0gZnJvbS5jaGFyQ29kZUF0KGZyb21TdGFydCArIGkpOwoJCQkJCQl2YXIgdG9Db2RlID0gdG8uY2hhckNvZGVBdCh0b1N0YXJ0ICsgaSk7CgkJCQkJCWlmIChmcm9tQ29kZSAhPT0gdG9Db2RlKSBicmVhazsgZWxzZSBpZiAoZnJvbUNvZGUgPT09IDQ3IC8qLyovKSBsYXN0Q29tbW9uU2VwID0gaTsKCQkJCQl9CgkJCQkJdmFyIG91dCA9ICcnOwoJCQkJCS8vIEdlbmVyYXRlIHRoZSByZWxhdGl2ZSBwYXRoIGJhc2VkIG9uIHRoZSBwYXRoIGRpZmZlcmVuY2UgYmV0d2VlbiBgdG9gCgkJCQkJLy8gYW5kIGBmcm9tYAoJCQkJCWZvciAoaSA9IGZyb21TdGFydCArIGxhc3RDb21tb25TZXAgKyAxOyBpIDw9IGZyb21FbmQ7ICsraSkgewoJCQkJCQlpZiAoaSA9PT0gZnJvbUVuZCB8fCBmcm9tLmNoYXJDb2RlQXQoaSkgPT09IDQ3IC8qLyovKSB7CgkJCQkJCQlpZiAob3V0Lmxlbmd0aCA9PT0gMCkgb3V0ICs9ICcuLic7IGVsc2Ugb3V0ICs9ICcvLi4nOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQkvLyBMYXN0bHksIGFwcGVuZCB0aGUgcmVzdCBvZiB0aGUgZGVzdGluYXRpb24gKGB0b2ApIHBhdGggdGhhdCBjb21lcyBhZnRlcgoJCQkJCS8vIHRoZSBjb21tb24gcGF0aCBwYXJ0cwoJCQkJCWlmIChvdXQubGVuZ3RoID4gMCkgcmV0dXJuIG91dCArIHRvLnNsaWNlKHRvU3RhcnQgKyBsYXN0Q29tbW9uU2VwKTsgZWxzZSB7CgkJCQkJCXRvU3RhcnQgKz0gbGFzdENvbW1vblNlcDsKCQkJCQkJaWYgKHRvLmNoYXJDb2RlQXQodG9TdGFydCkgPT09IDQ3IC8qLyovKSArK3RvU3RhcnQ7CgkJCQkJCXJldHVybiB0by5zbGljZSh0b1N0YXJ0KTsKCQkJCQl9CgkJCQl9LAoJCQkJX21ha2VMb25nOiBmdW5jdGlvbiBfbWFrZUxvbmcocGF0aCkgewoJCQkJCXJldHVybiBwYXRoOwoJCQkJfSwKCQkJCWRpcm5hbWU6IGZ1bmN0aW9uIGRpcm5hbWUocGF0aCkgewoJCQkJCWFzc2VydFBhdGgocGF0aCk7CgkJCQkJaWYgKHBhdGgubGVuZ3RoID09PSAwKSByZXR1cm4gJy4nOwoJCQkJCXZhciBjb2RlID0gcGF0aC5jaGFyQ29kZUF0KDApOwoJCQkJCXZhciBoYXNSb290ID0gY29kZSA9PT0gNDcgLyovKi87CgkJCQkJdmFyIGVuZCA9IC0xOwoJCQkJCXZhciBtYXRjaGVkU2xhc2ggPSB0cnVlOwoJCQkJCWZvciAodmFyIGkgPSBwYXRoLmxlbmd0aCAtIDE7IGkgPj0gMTsgLS1pKSB7CgkJCQkJCWNvZGUgPSBwYXRoLmNoYXJDb2RlQXQoaSk7CgkJCQkJCWlmIChjb2RlID09PSA0NyAvKi8qLykgewoJCQkJCQkJaWYgKCFtYXRjaGVkU2xhc2gpIHsKCQkJCQkJCQllbmQgPSBpOwoJCQkJCQkJCWJyZWFrOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy8gV2Ugc2F3IHRoZSBmaXJzdCBub24tcGF0aCBzZXBhcmF0b3IKCQkJCQkJCW1hdGNoZWRTbGFzaCA9IGZhbHNlOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWlmIChlbmQgPT09IC0xKSByZXR1cm4gaGFzUm9vdCA/ICcvJyA6ICcuJzsKCQkJCQlpZiAoaGFzUm9vdCAmJiBlbmQgPT09IDEpIHJldHVybiAnLy8nOwoJCQkJCXJldHVybiBwYXRoLnNsaWNlKDAsIGVuZCk7CgkJCQl9LAoJCQkJYmFzZW5hbWU6IGZ1bmN0aW9uIGJhc2VuYW1lKHBhdGgsIGV4dCkgewoJCQkJCWlmIChleHQgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2YgZXh0ICE9PSAnc3RyaW5nJykgdGhyb3cgbmV3IFR5cGVFcnJvcignImV4dCIgYXJndW1lbnQgbXVzdCBiZSBhIHN0cmluZycpOwoJCQkJCWFzc2VydFBhdGgocGF0aCk7CgkJCQkJdmFyIHN0YXJ0ID0gMDsKCQkJCQl2YXIgZW5kID0gLTE7CgkJCQkJdmFyIG1hdGNoZWRTbGFzaCA9IHRydWU7CgkJCQkJdmFyIGk7CgkJCQkJaWYgKGV4dCAhPT0gdW5kZWZpbmVkICYmIGV4dC5sZW5ndGggPiAwICYmIGV4dC5sZW5ndGggPD0gcGF0aC5sZW5ndGgpIHsKCQkJCQkJaWYgKGV4dC5sZW5ndGggPT09IHBhdGgubGVuZ3RoICYmIGV4dCA9PT0gcGF0aCkgcmV0dXJuICcnOwoJCQkJCQl2YXIgZXh0SWR4ID0gZXh0Lmxlbmd0aCAtIDE7CgkJCQkJCXZhciBmaXJzdE5vblNsYXNoRW5kID0gLTE7CgkJCQkJCWZvciAoaSA9IHBhdGgubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKCQkJCQkJCXZhciBjb2RlID0gcGF0aC5jaGFyQ29kZUF0KGkpOwoJCQkJCQkJaWYgKGNvZGUgPT09IDQ3IC8qLyovKSB7CgkJCQkJCQkJLy8gSWYgd2UgcmVhY2hlZCBhIHBhdGggc2VwYXJhdG9yIHRoYXQgd2FzIG5vdCBwYXJ0IG9mIGEgc2V0IG9mIHBhdGgKCQkJCQkJCQkvLyBzZXBhcmF0b3JzIGF0IHRoZSBlbmQgb2YgdGhlIHN0cmluZywgc3RvcCBub3cKCQkJCQkJCQlpZiAoIW1hdGNoZWRTbGFzaCkgewoJCQkJCQkJCQlzdGFydCA9IGkgKyAxOwoJCQkJCQkJCQlicmVhazsKCQkJCQkJCQl9CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCWlmIChmaXJzdE5vblNsYXNoRW5kID09PSAtMSkgewoJCQkJCQkJCQkvLyBXZSBzYXcgdGhlIGZpcnN0IG5vbi1wYXRoIHNlcGFyYXRvciwgcmVtZW1iZXIgdGhpcyBpbmRleCBpbiBjYXNlCgkJCQkJCQkJCS8vIHdlIG5lZWQgaXQgaWYgdGhlIGV4dGVuc2lvbiBlbmRzIHVwIG5vdCBtYXRjaGluZwoJCQkJCQkJCQltYXRjaGVkU2xhc2ggPSBmYWxzZTsKCQkJCQkJCQkJZmlyc3ROb25TbGFzaEVuZCA9IGkgKyAxOwoJCQkJCQkJCX0KCQkJCQkJCQlpZiAoZXh0SWR4ID49IDApIHsKCQkJCQkJCQkJLy8gVHJ5IHRvIG1hdGNoIHRoZSBleHBsaWNpdCBleHRlbnNpb24KCQkJCQkJCQkJaWYgKGNvZGUgPT09IGV4dC5jaGFyQ29kZUF0KGV4dElkeCkpIHsKCQkJCQkJCQkJCWlmICgtLWV4dElkeCA9PT0gLTEpIHsKCQkJCQkJCQkJCQkvLyBXZSBtYXRjaGVkIHRoZSBleHRlbnNpb24sIHNvIG1hcmsgdGhpcyBhcyB0aGUgZW5kIG9mIG91ciBwYXRoCgkJCQkJCQkJCQkJLy8gY29tcG9uZW50CgkJCQkJCQkJCQkJZW5kID0gaTsKCQkJCQkJCQkJCX0KCQkJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQkJCS8vIEV4dGVuc2lvbiBkb2VzIG5vdCBtYXRjaCwgc28gb3VyIHJlc3VsdCBpcyB0aGUgZW50aXJlIHBhdGgKCQkJCQkJCQkJCS8vIGNvbXBvbmVudAoJCQkJCQkJCQkJZXh0SWR4ID0gLTE7CgkJCQkJCQkJCQllbmQgPSBmaXJzdE5vblNsYXNoRW5kOwoJCQkJCQkJCQl9CgkJCQkJCQkJfQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWlmIChzdGFydCA9PT0gZW5kKSBlbmQgPSBmaXJzdE5vblNsYXNoRW5kOyBlbHNlIGlmIChlbmQgPT09IC0xKSBlbmQgPSBwYXRoLmxlbmd0aDsKCQkJCQkJcmV0dXJuIHBhdGguc2xpY2Uoc3RhcnQsIGVuZCk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJZm9yIChpID0gcGF0aC5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewoJCQkJCQkJaWYgKHBhdGguY2hhckNvZGVBdChpKSA9PT0gNDcgLyovKi8pIHsKCQkJCQkJCQkvLyBJZiB3ZSByZWFjaGVkIGEgcGF0aCBzZXBhcmF0b3IgdGhhdCB3YXMgbm90IHBhcnQgb2YgYSBzZXQgb2YgcGF0aAoJCQkJCQkJCS8vIHNlcGFyYXRvcnMgYXQgdGhlIGVuZCBvZiB0aGUgc3RyaW5nLCBzdG9wIG5vdwoJCQkJCQkJCWlmICghbWF0Y2hlZFNsYXNoKSB7CgkJCQkJCQkJCXN0YXJ0ID0gaSArIDE7CgkJCQkJCQkJCWJyZWFrOwoJCQkJCQkJCX0KCQkJCQkJCX0gZWxzZSBpZiAoZW5kID09PSAtMSkgewoJCQkJCQkJCS8vIFdlIHNhdyB0aGUgZmlyc3Qgbm9uLXBhdGggc2VwYXJhdG9yLCBtYXJrIHRoaXMgYXMgdGhlIGVuZCBvZiBvdXIKCQkJCQkJCQkvLyBwYXRoIGNvbXBvbmVudAoJCQkJCQkJCW1hdGNoZWRTbGFzaCA9IGZhbHNlOwoJCQkJCQkJCWVuZCA9IGkgKyAxOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJCWlmIChlbmQgPT09IC0xKSByZXR1cm4gJyc7CgkJCQkJCXJldHVybiBwYXRoLnNsaWNlKHN0YXJ0LCBlbmQpOwoJCQkJCX0KCQkJCX0sCgkJCQlleHRuYW1lOiBmdW5jdGlvbiBleHRuYW1lKHBhdGgpIHsKCQkJCQlhc3NlcnRQYXRoKHBhdGgpOwoJCQkJCXZhciBzdGFydERvdCA9IC0xOwoJCQkJCXZhciBzdGFydFBhcnQgPSAwOwoJCQkJCXZhciBlbmQgPSAtMTsKCQkJCQl2YXIgbWF0Y2hlZFNsYXNoID0gdHJ1ZTsKCQkJCQkvLyBUcmFjayB0aGUgc3RhdGUgb2YgY2hhcmFjdGVycyAoaWYgYW55KSB3ZSBzZWUgYmVmb3JlIG91ciBmaXJzdCBkb3QgYW5kCgkJCQkJLy8gYWZ0ZXIgYW55IHBhdGggc2VwYXJhdG9yIHdlIGZpbmQKCQkJCQl2YXIgcHJlRG90U3RhdGUgPSAwOwoJCQkJCWZvciAodmFyIGkgPSBwYXRoLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CgkJCQkJCXZhciBjb2RlID0gcGF0aC5jaGFyQ29kZUF0KGkpOwoJCQkJCQlpZiAoY29kZSA9PT0gNDcgLyovKi8pIHsKCQkJCQkJCS8vIElmIHdlIHJlYWNoZWQgYSBwYXRoIHNlcGFyYXRvciB0aGF0IHdhcyBub3QgcGFydCBvZiBhIHNldCBvZiBwYXRoCgkJCQkJCQkvLyBzZXBhcmF0b3JzIGF0IHRoZSBlbmQgb2YgdGhlIHN0cmluZywgc3RvcCBub3cKCQkJCQkJCWlmICghbWF0Y2hlZFNsYXNoKSB7CgkJCQkJCQkJc3RhcnRQYXJ0ID0gaSArIDE7CgkJCQkJCQkJYnJlYWs7CgkJCQkJCQl9CgkJCQkJCQljb250aW51ZTsKCQkJCQkJfQoJCQkJCQlpZiAoZW5kID09PSAtMSkgewoJCQkJCQkJLy8gV2Ugc2F3IHRoZSBmaXJzdCBub24tcGF0aCBzZXBhcmF0b3IsIG1hcmsgdGhpcyBhcyB0aGUgZW5kIG9mIG91cgoJCQkJCQkJLy8gZXh0ZW5zaW9uCgkJCQkJCQltYXRjaGVkU2xhc2ggPSBmYWxzZTsKCQkJCQkJCWVuZCA9IGkgKyAxOwoJCQkJCQl9CgkJCQkJCWlmIChjb2RlID09PSA0NiAvKi4qLykgewoJCQkJCQkJLy8gSWYgdGhpcyBpcyBvdXIgZmlyc3QgZG90LCBtYXJrIGl0IGFzIHRoZSBzdGFydCBvZiBvdXIgZXh0ZW5zaW9uCgkJCQkJCQlpZiAoc3RhcnREb3QgPT09IC0xKSBzdGFydERvdCA9IGk7IGVsc2UgaWYgKHByZURvdFN0YXRlICE9PSAxKSBwcmVEb3RTdGF0ZSA9IDE7CgkJCQkJCX0gZWxzZSBpZiAoc3RhcnREb3QgIT09IC0xKSB7CgkJCQkJCQkvLyBXZSBzYXcgYSBub24tZG90IGFuZCBub24tcGF0aCBzZXBhcmF0b3IgYmVmb3JlIG91ciBkb3QsIHNvIHdlIHNob3VsZAoJCQkJCQkJLy8gaGF2ZSBhIGdvb2QgY2hhbmNlIGF0IGhhdmluZyBhIG5vbi1lbXB0eSBleHRlbnNpb24KCQkJCQkJCXByZURvdFN0YXRlID0gLTE7CgkJCQkJCX0KCQkJCQl9CgkJCQkJaWYgKHN0YXJ0RG90ID09PSAtMSB8fCBlbmQgPT09IC0xIHx8CgkJCQkJCS8vIFdlIHNhdyBhIG5vbi1kb3QgY2hhcmFjdGVyIGltbWVkaWF0ZWx5IGJlZm9yZSB0aGUgZG90CgkJCQkJCXByZURvdFN0YXRlID09PSAwIHx8CgkJCQkJCS8vIFRoZSAocmlnaHQtbW9zdCkgdHJpbW1lZCBwYXRoIGNvbXBvbmVudCBpcyBleGFjdGx5ICcuLicKCQkJCQkJcHJlRG90U3RhdGUgPT09IDEgJiYgc3RhcnREb3QgPT09IGVuZCAtIDEgJiYgc3RhcnREb3QgPT09IHN0YXJ0UGFydCArIDEpIHsKCQkJCQkJcmV0dXJuICcnOwoJCQkJCX0KCQkJCQlyZXR1cm4gcGF0aC5zbGljZShzdGFydERvdCwgZW5kKTsKCQkJCX0sCgkJCQlmb3JtYXQ6IGZ1bmN0aW9uIGZvcm1hdChwYXRoT2JqZWN0KSB7CgkJCQkJaWYgKHBhdGhPYmplY3QgPT09IG51bGwgfHwgX3R5cGVvZihwYXRoT2JqZWN0KSAhPT0gJ29iamVjdCcpIHsKCQkJCQkJdGhyb3cgbmV3IFR5cGVFcnJvcignVGhlICJwYXRoT2JqZWN0IiBhcmd1bWVudCBtdXN0IGJlIG9mIHR5cGUgT2JqZWN0LiBSZWNlaXZlZCB0eXBlICcgKyBfdHlwZW9mKHBhdGhPYmplY3QpKTsKCQkJCQl9CgkJCQkJcmV0dXJuIF9mb3JtYXQoJy8nLCBwYXRoT2JqZWN0KTsKCQkJCX0sCgkJCQlwYXJzZTogZnVuY3Rpb24gcGFyc2UocGF0aCkgewoJCQkJCWFzc2VydFBhdGgocGF0aCk7CgkJCQkJdmFyIHJldCA9IHsKCQkJCQkJcm9vdDogJycsCgkJCQkJCWRpcjogJycsCgkJCQkJCWJhc2U6ICcnLAoJCQkJCQlleHQ6ICcnLAoJCQkJCQluYW1lOiAnJwoJCQkJCX07CgkJCQkJaWYgKHBhdGgubGVuZ3RoID09PSAwKSByZXR1cm4gcmV0OwoJCQkJCXZhciBjb2RlID0gcGF0aC5jaGFyQ29kZUF0KDApOwoJCQkJCXZhciBpc0Fic29sdXRlID0gY29kZSA9PT0gNDcgLyovKi87CgkJCQkJdmFyIHN0YXJ0OwoJCQkJCWlmIChpc0Fic29sdXRlKSB7CgkJCQkJCXJldC5yb290ID0gJy8nOwoJCQkJCQlzdGFydCA9IDE7CgkJCQkJfSBlbHNlIHsKCQkJCQkJc3RhcnQgPSAwOwoJCQkJCX0KCQkJCQl2YXIgc3RhcnREb3QgPSAtMTsKCQkJCQl2YXIgc3RhcnRQYXJ0ID0gMDsKCQkJCQl2YXIgZW5kID0gLTE7CgkJCQkJdmFyIG1hdGNoZWRTbGFzaCA9IHRydWU7CgkJCQkJdmFyIGkgPSBwYXRoLmxlbmd0aCAtIDE7CgoJCQkJCS8vIFRyYWNrIHRoZSBzdGF0ZSBvZiBjaGFyYWN0ZXJzIChpZiBhbnkpIHdlIHNlZSBiZWZvcmUgb3VyIGZpcnN0IGRvdCBhbmQKCQkJCQkvLyBhZnRlciBhbnkgcGF0aCBzZXBhcmF0b3Igd2UgZmluZAoJCQkJCXZhciBwcmVEb3RTdGF0ZSA9IDA7CgoJCQkJCS8vIEdldCBub24tZGlyIGluZm8KCQkJCQlmb3IgKDsgaSA+PSBzdGFydDsgLS1pKSB7CgkJCQkJCWNvZGUgPSBwYXRoLmNoYXJDb2RlQXQoaSk7CgkJCQkJCWlmIChjb2RlID09PSA0NyAvKi8qLykgewoJCQkJCQkJLy8gSWYgd2UgcmVhY2hlZCBhIHBhdGggc2VwYXJhdG9yIHRoYXQgd2FzIG5vdCBwYXJ0IG9mIGEgc2V0IG9mIHBhdGgKCQkJCQkJCS8vIHNlcGFyYXRvcnMgYXQgdGhlIGVuZCBvZiB0aGUgc3RyaW5nLCBzdG9wIG5vdwoJCQkJCQkJaWYgKCFtYXRjaGVkU2xhc2gpIHsKCQkJCQkJCQlzdGFydFBhcnQgPSBpICsgMTsKCQkJCQkJCQlicmVhazsKCQkJCQkJCX0KCQkJCQkJCWNvbnRpbnVlOwoJCQkJCQl9CgkJCQkJCWlmIChlbmQgPT09IC0xKSB7CgkJCQkJCQkvLyBXZSBzYXcgdGhlIGZpcnN0IG5vbi1wYXRoIHNlcGFyYXRvciwgbWFyayB0aGlzIGFzIHRoZSBlbmQgb2Ygb3VyCgkJCQkJCQkvLyBleHRlbnNpb24KCQkJCQkJCW1hdGNoZWRTbGFzaCA9IGZhbHNlOwoJCQkJCQkJZW5kID0gaSArIDE7CgkJCQkJCX0KCQkJCQkJaWYgKGNvZGUgPT09IDQ2IC8qLiovKSB7CgkJCQkJCQkvLyBJZiB0aGlzIGlzIG91ciBmaXJzdCBkb3QsIG1hcmsgaXQgYXMgdGhlIHN0YXJ0IG9mIG91ciBleHRlbnNpb24KCQkJCQkJCWlmIChzdGFydERvdCA9PT0gLTEpIHN0YXJ0RG90ID0gaTsgZWxzZSBpZiAocHJlRG90U3RhdGUgIT09IDEpIHByZURvdFN0YXRlID0gMTsKCQkJCQkJfSBlbHNlIGlmIChzdGFydERvdCAhPT0gLTEpIHsKCQkJCQkJCS8vIFdlIHNhdyBhIG5vbi1kb3QgYW5kIG5vbi1wYXRoIHNlcGFyYXRvciBiZWZvcmUgb3VyIGRvdCwgc28gd2Ugc2hvdWxkCgkJCQkJCQkvLyBoYXZlIGEgZ29vZCBjaGFuY2UgYXQgaGF2aW5nIGEgbm9uLWVtcHR5IGV4dGVuc2lvbgoJCQkJCQkJcHJlRG90U3RhdGUgPSAtMTsKCQkJCQkJfQoJCQkJCX0KCQkJCQlpZiAoc3RhcnREb3QgPT09IC0xIHx8IGVuZCA9PT0gLTEgfHwKCQkJCQkJLy8gV2Ugc2F3IGEgbm9uLWRvdCBjaGFyYWN0ZXIgaW1tZWRpYXRlbHkgYmVmb3JlIHRoZSBkb3QKCQkJCQkJcHJlRG90U3RhdGUgPT09IDAgfHwKCQkJCQkJLy8gVGhlIChyaWdodC1tb3N0KSB0cmltbWVkIHBhdGggY29tcG9uZW50IGlzIGV4YWN0bHkgJy4uJwoJCQkJCQlwcmVEb3RTdGF0ZSA9PT0gMSAmJiBzdGFydERvdCA9PT0gZW5kIC0gMSAmJiBzdGFydERvdCA9PT0gc3RhcnRQYXJ0ICsgMSkgewoJCQkJCQlpZiAoZW5kICE9PSAtMSkgewoJCQkJCQkJaWYgKHN0YXJ0UGFydCA9PT0gMCAmJiBpc0Fic29sdXRlKSByZXQuYmFzZSA9IHJldC5uYW1lID0gcGF0aC5zbGljZSgxLCBlbmQpOyBlbHNlIHJldC5iYXNlID0gcmV0Lm5hbWUgPSBwYXRoLnNsaWNlKHN0YXJ0UGFydCwgZW5kKTsKCQkJCQkJfQoJCQkJCX0gZWxzZSB7CgkJCQkJCWlmIChzdGFydFBhcnQgPT09IDAgJiYgaXNBYnNvbHV0ZSkgewoJCQkJCQkJcmV0Lm5hbWUgPSBwYXRoLnNsaWNlKDEsIHN0YXJ0RG90KTsKCQkJCQkJCXJldC5iYXNlID0gcGF0aC5zbGljZSgxLCBlbmQpOwoJCQkJCQl9IGVsc2UgewoJCQkJCQkJcmV0Lm5hbWUgPSBwYXRoLnNsaWNlKHN0YXJ0UGFydCwgc3RhcnREb3QpOwoJCQkJCQkJcmV0LmJhc2UgPSBwYXRoLnNsaWNlKHN0YXJ0UGFydCwgZW5kKTsKCQkJCQkJfQoJCQkJCQlyZXQuZXh0ID0gcGF0aC5zbGljZShzdGFydERvdCwgZW5kKTsKCQkJCQl9CgkJCQkJaWYgKHN0YXJ0UGFydCA+IDApIHJldC5kaXIgPSBwYXRoLnNsaWNlKDAsIHN0YXJ0UGFydCAtIDEpOyBlbHNlIGlmIChpc0Fic29sdXRlKSByZXQuZGlyID0gJy8nOwoJCQkJCXJldHVybiByZXQ7CgkJCQl9LAoJCQkJc2VwOiAnLycsCgkJCQlkZWxpbWl0ZXI6ICc6JywKCQkJCXdpbjMyOiBudWxsLAoJCQkJcG9zaXg6IG51bGwKCQkJfTsKCQkJcG9zaXgucG9zaXggPSBwb3NpeDsKCQkJbW9kdWxlLmV4cG9ydHMgPSBwb3NpeDsKCgkJCS8qKiovCgkJfSksCgoJCS8qKiovIDg4MDg6CgkJLyoqKi8gKChtb2R1bGUpID0+IHsKCi8vIHNoaW0gZm9yIHVzaW5nIHByb2Nlc3MgaW4gYnJvd3NlcgoJCQl2YXIgcHJvY2VzcyA9IG1vZHVsZS5leHBvcnRzID0ge307CgovLyBjYWNoZWQgZnJvbSB3aGF0ZXZlciBnbG9iYWwgaXMgcHJlc2VudCBzbyB0aGF0IHRlc3QgcnVubmVycyB0aGF0IHN0dWIgaXQKLy8gZG9uJ3QgYnJlYWsgdGhpbmdzLiAgQnV0IHdlIG5lZWQgdG8gd3JhcCBpdCBpbiBhIHRyeSBjYXRjaCBpbiBjYXNlIGl0IGlzCi8vIHdyYXBwZWQgaW4gc3RyaWN0IG1vZGUgY29kZSB3aGljaCBkb2Vzbid0IGRlZmluZSBhbnkgZ2xvYmFscy4gIEl0J3MgaW5zaWRlIGEKLy8gZnVuY3Rpb24gYmVjYXVzZSB0cnkvY2F0Y2hlcyBkZW9wdGltaXplIGluIGNlcnRhaW4gZW5naW5lcy4KCgkJCXZhciBjYWNoZWRTZXRUaW1lb3V0OwoJCQl2YXIgY2FjaGVkQ2xlYXJUaW1lb3V0OwoKCQkJZnVuY3Rpb24gZGVmYXVsdFNldFRpbW91dCgpIHsKCQkJCXRocm93IG5ldyBFcnJvcignc2V0VGltZW91dCBoYXMgbm90IGJlZW4gZGVmaW5lZCcpOwoJCQl9CgoJCQlmdW5jdGlvbiBkZWZhdWx0Q2xlYXJUaW1lb3V0KCkgewoJCQkJdGhyb3cgbmV3IEVycm9yKCdjbGVhclRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQnKTsKCQkJfQoKCQkJKGZ1bmN0aW9uKCkgewoJCQkJdHJ5IHsKCQkJCQlpZiAodHlwZW9mIHNldFRpbWVvdXQgPT09ICdmdW5jdGlvbicpIHsKCQkJCQkJY2FjaGVkU2V0VGltZW91dCA9IHNldFRpbWVvdXQ7CgkJCQkJfSBlbHNlIHsKCQkJCQkJY2FjaGVkU2V0VGltZW91dCA9IGRlZmF1bHRTZXRUaW1vdXQ7CgkJCQkJfQoJCQkJfSBjYXRjaCAoZSkgewoJCQkJCWNhY2hlZFNldFRpbWVvdXQgPSBkZWZhdWx0U2V0VGltb3V0OwoJCQkJfQoJCQkJdHJ5IHsKCQkJCQlpZiAodHlwZW9mIGNsZWFyVGltZW91dCA9PT0gJ2Z1bmN0aW9uJykgewoJCQkJCQljYWNoZWRDbGVhclRpbWVvdXQgPSBjbGVhclRpbWVvdXQ7CgkJCQkJfSBlbHNlIHsKCQkJCQkJY2FjaGVkQ2xlYXJUaW1lb3V0ID0gZGVmYXVsdENsZWFyVGltZW91dDsKCQkJCQl9CgkJCQl9IGNhdGNoIChlKSB7CgkJCQkJY2FjaGVkQ2xlYXJUaW1lb3V0ID0gZGVmYXVsdENsZWFyVGltZW91dDsKCQkJCX0KCQkJfSkoKTsKCgkJCWZ1bmN0aW9uIHJ1blRpbWVvdXQoZnVuKSB7CgkJCQlpZiAoY2FjaGVkU2V0VGltZW91dCA9PT0gc2V0VGltZW91dCkgewoJCQkJCS8vbm9ybWFsIGVudmlyb21lbnRzIGluIHNhbmUgc2l0dWF0aW9ucwoJCQkJCXJldHVybiBzZXRUaW1lb3V0KGZ1biwgMCk7CgkJCQl9CgkJCQkvLyBpZiBzZXRUaW1lb3V0IHdhc24ndCBhdmFpbGFibGUgYnV0IHdhcyBsYXR0ZXIgZGVmaW5lZAoJCQkJaWYgKChjYWNoZWRTZXRUaW1lb3V0ID09PSBkZWZhdWx0U2V0VGltb3V0IHx8ICFjYWNoZWRTZXRUaW1lb3V0KSAmJiBzZXRUaW1lb3V0KSB7CgkJCQkJY2FjaGVkU2V0VGltZW91dCA9IHNldFRpbWVvdXQ7CgkJCQkJcmV0dXJuIHNldFRpbWVvdXQoZnVuLCAwKTsKCQkJCX0KCQkJCXRyeSB7CgkJCQkJLy8gd2hlbiB3aGVuIHNvbWVib2R5IGhhcyBzY3Jld2VkIHdpdGggc2V0VGltZW91dCBidXQgbm8gSS5FLiBtYWRkbmVzcwoJCQkJCXJldHVybiBjYWNoZWRTZXRUaW1lb3V0KGZ1biwgMCk7CgkJCQl9IGNhdGNoIChlKSB7CgkJCQkJdHJ5IHsKCQkJCQkJLy8gV2hlbiB3ZSBhcmUgaW4gSS5FLiBidXQgdGhlIHNjcmlwdCBoYXMgYmVlbiBldmFsZWQgc28gSS5FLiBkb2Vzbid0IHRydXN0IHRoZSBnbG9iYWwgb2JqZWN0IHdoZW4gY2FsbGVkIG5vcm1hbGx5CgkJCQkJCXJldHVybiBjYWNoZWRTZXRUaW1lb3V0LmNhbGwobnVsbCwgZnVuLCAwKTsKCQkJCQl9IGNhdGNoIChlKSB7CgkJCQkJCS8vIHNhbWUgYXMgYWJvdmUgYnV0IHdoZW4gaXQncyBhIHZlcnNpb24gb2YgSS5FLiB0aGF0IG11c3QgaGF2ZSB0aGUgZ2xvYmFsIG9iamVjdCBmb3IgJ3RoaXMnLCBob3BmdWxseSBvdXIgY29udGV4dCBjb3JyZWN0IG90aGVyd2lzZSBpdCB3aWxsIHRocm93IGEgZ2xvYmFsIGVycm9yCgkJCQkJCXJldHVybiBjYWNoZWRTZXRUaW1lb3V0LmNhbGwodGhpcywgZnVuLCAwKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCWZ1bmN0aW9uIHJ1bkNsZWFyVGltZW91dChtYXJrZXIpIHsKCQkJCWlmIChjYWNoZWRDbGVhclRpbWVvdXQgPT09IGNsZWFyVGltZW91dCkgewoJCQkJCS8vbm9ybWFsIGVudmlyb21lbnRzIGluIHNhbmUgc2l0dWF0aW9ucwoJCQkJCXJldHVybiBjbGVhclRpbWVvdXQobWFya2VyKTsKCQkJCX0KCQkJCS8vIGlmIGNsZWFyVGltZW91dCB3YXNuJ3QgYXZhaWxhYmxlIGJ1dCB3YXMgbGF0dGVyIGRlZmluZWQKCQkJCWlmICgoY2FjaGVkQ2xlYXJUaW1lb3V0ID09PSBkZWZhdWx0Q2xlYXJUaW1lb3V0IHx8ICFjYWNoZWRDbGVhclRpbWVvdXQpICYmIGNsZWFyVGltZW91dCkgewoJCQkJCWNhY2hlZENsZWFyVGltZW91dCA9IGNsZWFyVGltZW91dDsKCQkJCQlyZXR1cm4gY2xlYXJUaW1lb3V0KG1hcmtlcik7CgkJCQl9CgkJCQl0cnkgewoJCQkJCS8vIHdoZW4gd2hlbiBzb21lYm9keSBoYXMgc2NyZXdlZCB3aXRoIHNldFRpbWVvdXQgYnV0IG5vIEkuRS4gbWFkZG5lc3MKCQkJCQlyZXR1cm4gY2FjaGVkQ2xlYXJUaW1lb3V0KG1hcmtlcik7CgkJCQl9IGNhdGNoIChlKSB7CgkJCQkJdHJ5IHsKCQkJCQkJLy8gV2hlbiB3ZSBhcmUgaW4gSS5FLiBidXQgdGhlIHNjcmlwdCBoYXMgYmVlbiBldmFsZWQgc28gSS5FLiBkb2Vzbid0ICB0cnVzdCB0aGUgZ2xvYmFsIG9iamVjdCB3aGVuIGNhbGxlZCBub3JtYWxseQoJCQkJCQlyZXR1cm4gY2FjaGVkQ2xlYXJUaW1lb3V0LmNhbGwobnVsbCwgbWFya2VyKTsKCQkJCQl9IGNhdGNoIChlKSB7CgkJCQkJCS8vIHNhbWUgYXMgYWJvdmUgYnV0IHdoZW4gaXQncyBhIHZlcnNpb24gb2YgSS5FLiB0aGF0IG11c3QgaGF2ZSB0aGUgZ2xvYmFsIG9iamVjdCBmb3IgJ3RoaXMnLCBob3BmdWxseSBvdXIgY29udGV4dCBjb3JyZWN0IG90aGVyd2lzZSBpdCB3aWxsIHRocm93IGEgZ2xvYmFsIGVycm9yLgoJCQkJCQkvLyBTb21lIHZlcnNpb25zIG9mIEkuRS4gaGF2ZSBkaWZmZXJlbnQgcnVsZXMgZm9yIGNsZWFyVGltZW91dCB2cyBzZXRUaW1lb3V0CgkJCQkJCXJldHVybiBjYWNoZWRDbGVhclRpbWVvdXQuY2FsbCh0aGlzLCBtYXJrZXIpOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJdmFyIHF1ZXVlID0gW107CgkJCXZhciBkcmFpbmluZyA9IGZhbHNlOwoJCQl2YXIgY3VycmVudFF1ZXVlOwoJCQl2YXIgcXVldWVJbmRleCA9IC0xOwoKCQkJZnVuY3Rpb24gY2xlYW5VcE5leHRUaWNrKCkgewoJCQkJaWYgKCFkcmFpbmluZyB8fCAhY3VycmVudFF1ZXVlKSB7CgkJCQkJcmV0dXJuOwoJCQkJfQoJCQkJZHJhaW5pbmcgPSBmYWxzZTsKCQkJCWlmIChjdXJyZW50UXVldWUubGVuZ3RoKSB7CgkJCQkJcXVldWUgPSBjdXJyZW50UXVldWUuY29uY2F0KHF1ZXVlKTsKCQkJCX0gZWxzZSB7CgkJCQkJcXVldWVJbmRleCA9IC0xOwoJCQkJfQoJCQkJaWYgKHF1ZXVlLmxlbmd0aCkgewoJCQkJCWRyYWluUXVldWUoKTsKCQkJCX0KCQkJfQoKCQkJZnVuY3Rpb24gZHJhaW5RdWV1ZSgpIHsKCQkJCWlmIChkcmFpbmluZykgewoJCQkJCXJldHVybjsKCQkJCX0KCQkJCXZhciB0aW1lb3V0ID0gcnVuVGltZW91dChjbGVhblVwTmV4dFRpY2spOwoJCQkJZHJhaW5pbmcgPSB0cnVlOwoJCQkJdmFyIGxlbiA9IHF1ZXVlLmxlbmd0aDsKCQkJCXdoaWxlIChsZW4pIHsKCQkJCQljdXJyZW50UXVldWUgPSBxdWV1ZTsKCQkJCQlxdWV1ZSA9IFtdOwoJCQkJCXdoaWxlICgrK3F1ZXVlSW5kZXggPCBsZW4pIHsKCQkJCQkJaWYgKGN1cnJlbnRRdWV1ZSkgewoJCQkJCQkJY3VycmVudFF1ZXVlW3F1ZXVlSW5kZXhdLnJ1bigpOwoJCQkJCQl9CgkJCQkJfQoJCQkJCXF1ZXVlSW5kZXggPSAtMTsKCQkJCQlsZW4gPSBxdWV1ZS5sZW5ndGg7CgkJCQl9CgkJCQljdXJyZW50UXVldWUgPSBudWxsOwoJCQkJZHJhaW5pbmcgPSBmYWxzZTsKCQkJCXJ1bkNsZWFyVGltZW91dCh0aW1lb3V0KTsKCQkJfQoKCQkJcHJvY2Vzcy5uZXh0VGljayA9IGZ1bmN0aW9uKGZ1bikgewoJCQkJdmFyIGFyZ3MgPSBuZXcgQXJyYXkoYXJndW1lbnRzLmxlbmd0aCAtIDEpOwoJCQkJaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAxKSB7CgkJCQkJZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKCQkJCQkJYXJnc1tpIC0gMV0gPSBhcmd1bWVudHNbaV07CgkJCQkJfQoJCQkJfQoJCQkJcXVldWUucHVzaChuZXcgSXRlbShmdW4sIGFyZ3MpKTsKCQkJCWlmIChxdWV1ZS5sZW5ndGggPT09IDEgJiYgIWRyYWluaW5nKSB7CgkJCQkJcnVuVGltZW91dChkcmFpblF1ZXVlKTsKCQkJCX0KCQkJfTsKCi8vIHY4IGxpa2VzIHByZWRpY3RpYmxlIG9iamVjdHMKCQkJZnVuY3Rpb24gSXRlbShmdW4sIGFycmF5KSB7CgkJCQl0aGlzLmZ1biA9IGZ1bjsKCQkJCXRoaXMuYXJyYXkgPSBhcnJheTsKCQkJfQoKCQkJSXRlbS5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24oKSB7CgkJCQl0aGlzLmZ1bi5hcHBseShudWxsLCB0aGlzLmFycmF5KTsKCQkJfTsKCQkJcHJvY2Vzcy50aXRsZSA9ICdicm93c2VyJzsKCQkJcHJvY2Vzcy5icm93c2VyID0gdHJ1ZTsKCQkJcHJvY2Vzcy5lbnYgPSB7fTsKCQkJcHJvY2Vzcy5hcmd2ID0gW107CgkJCXByb2Nlc3MudmVyc2lvbiA9ICcnOyAvLyBlbXB0eSBzdHJpbmcgdG8gYXZvaWQgcmVnZXhwIGlzc3VlcwoJCQlwcm9jZXNzLnZlcnNpb25zID0ge307CgoJCQlmdW5jdGlvbiBub29wKCkgewoJCQl9CgoJCQlwcm9jZXNzLm9uID0gbm9vcDsKCQkJcHJvY2Vzcy5hZGRMaXN0ZW5lciA9IG5vb3A7CgkJCXByb2Nlc3Mub25jZSA9IG5vb3A7CgkJCXByb2Nlc3Mub2ZmID0gbm9vcDsKCQkJcHJvY2Vzcy5yZW1vdmVMaXN0ZW5lciA9IG5vb3A7CgkJCXByb2Nlc3MucmVtb3ZlQWxsTGlzdGVuZXJzID0gbm9vcDsKCQkJcHJvY2Vzcy5lbWl0ID0gbm9vcDsKCQkJcHJvY2Vzcy5wcmVwZW5kTGlzdGVuZXIgPSBub29wOwoJCQlwcm9jZXNzLnByZXBlbmRPbmNlTGlzdGVuZXIgPSBub29wOwoJCQlwcm9jZXNzLmxpc3RlbmVycyA9IGZ1bmN0aW9uKG5hbWUpIHsKCQkJCXJldHVybiBbXTsKCQkJfTsKCQkJcHJvY2Vzcy5iaW5kaW5nID0gZnVuY3Rpb24obmFtZSkgewoJCQkJdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmJpbmRpbmcgaXMgbm90IHN1cHBvcnRlZCcpOwoJCQl9OwoJCQlwcm9jZXNzLmN3ZCA9IGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuICcvJzsKCQkJfTsKCQkJcHJvY2Vzcy5jaGRpciA9IGZ1bmN0aW9uKGRpcikgewoJCQkJdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmNoZGlyIGlzIG5vdCBzdXBwb3J0ZWQnKTsKCQkJfTsKCQkJcHJvY2Vzcy51bWFzayA9IGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuIDA7CgkJCX07CgoJCQkvKioqLwoJCX0pLAoKCQkvKioqLyAxNDcxOgoJCS8qKiovICgoKSA9PiB7CgoJCQkvKiAoaWdub3JlZCkgKi8KCgkJCS8qKiovCgkJfSkKCgkJLyoqKioqKi8KCX0pOwoJLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCS8qKioqKiovIAkvLyBUaGUgbW9kdWxlIGNhY2hlCgkvKioqKioqLwoJdmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9OwoJLyoqKioqKi8KCS8qKioqKiovIAkvLyBUaGUgcmVxdWlyZSBmdW5jdGlvbgoJLyoqKioqKi8KCWZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHsKCQkvKioqKioqLyAJCS8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZQoJCS8qKioqKiovCgkJdmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07CgkJLyoqKioqKi8KCQlpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHsKCQkJLyoqKioqKi8KCQkJcmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzOwoJCQkvKioqKioqLwoJCX0KCQkvKioqKioqLyAJCS8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpCgkJLyoqKioqKi8KCQl2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHsKCQkJLyoqKioqKi8gICAgICAgICAgICBpZDogbW9kdWxlSWQsCgkJCS8qKioqKiovICAgICAgICAgICAgbG9hZGVkOiBmYWxzZSwKCQkJLyoqKioqKi8gICAgICAgICAgICBleHBvcnRzOiB7fQoJCQkvKioqKioqLwoJCX07CgkJLyoqKioqKi8KCQkvKioqKioqLyAJCS8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvbgoJCS8qKioqKiovCgkJX193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7CgkJLyoqKioqKi8KCQkvKioqKioqLyAJCS8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWQKCQkvKioqKioqLwoJCW1vZHVsZS5sb2FkZWQgPSB0cnVlOwoJCS8qKioqKiovCgkJLyoqKioqKi8gCQkvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZQoJCS8qKioqKiovCgkJcmV0dXJuIG1vZHVsZS5leHBvcnRzOwoJCS8qKioqKiovCgl9CgoJLyoqKioqKi8KCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgkvKioqKioqLyAJLyogd2VicGFjay9ydW50aW1lL2dsb2JhbCAqLwoJLyoqKioqKi8KCSgoKSA9PiB7CgkJLyoqKioqKi8KCQlfX3dlYnBhY2tfcmVxdWlyZV9fLmcgPSAoZnVuY3Rpb24oKSB7CgkJCS8qKioqKiovCgkJCWlmICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gJ29iamVjdCcpIHJldHVybiBnbG9iYWxUaGlzOwoJCQkvKioqKioqLwoJCQl0cnkgewoJCQkJLyoqKioqKi8KCQkJCXJldHVybiB0aGlzIHx8IG5ldyBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpOwoJCQkJLyoqKioqKi8KCQkJfSBjYXRjaCAoZSkgewoJCQkJLyoqKioqKi8KCQkJCWlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JykgcmV0dXJuIHdpbmRvdzsKCQkJCS8qKioqKiovCgkJCX0KCQkJLyoqKioqKi8KCQl9KSgpOwoJCS8qKioqKiovCgl9KSgpOwoJLyoqKioqKi8KCS8qKioqKiovIAkvKiB3ZWJwYWNrL3J1bnRpbWUvbm9kZSBtb2R1bGUgZGVjb3JhdG9yICovCgkvKioqKioqLwoJKCgpID0+IHsKCQkvKioqKioqLwoJCV9fd2VicGFja19yZXF1aXJlX18ubm1kID0gKG1vZHVsZSkgPT4gewoJCQkvKioqKioqLwoJCQltb2R1bGUucGF0aHMgPSBbXTsKCQkJLyoqKioqKi8KCQkJaWYgKCFtb2R1bGUuY2hpbGRyZW4pIG1vZHVsZS5jaGlsZHJlbiA9IFtdOwoJCQkvKioqKioqLwoJCQlyZXR1cm4gbW9kdWxlOwoJCQkvKioqKioqLwoJCX07CgkJLyoqKioqKi8KCX0pKCk7CgkvKioqKioqLwoJLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KCS8qKioqKiovCgkvKioqKioqLyAJLy8gc3RhcnR1cAoJLyoqKioqKi8gCS8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0cwoJLyoqKioqKi8KCV9fd2VicGFja19yZXF1aXJlX18oNTk3KTsKCS8qKioqKiovIAkvLyBUaGlzIGVudHJ5IG1vZHVsZSBpcyByZWZlcmVuY2VkIGJ5IG90aGVyIG1vZHVsZXMgc28gaXQgY2FuJ3QgYmUgaW5saW5lZAoJLyoqKioqKi8KCXZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4MjUyKTsKCS8qKioqKiovCgl0aGlzLkR5biA9IF9fd2VicGFja19leHBvcnRzX187CgkvKioqKioqLwoJLyoqKioqKi8KCglyZXR1cm4gdGhpczsKfSkoKQo7";

class Mods {

	public app: Saito;
	public mods: any;
	public uimods: any;
	public mods_list: any;
	public is_initialized: any;
	public lowest_sync_bid: any;
	public app_filter_func: any;
	public core_filter_func: any;

	constructor(app: Saito, config) {
		this.app = app;
		this.mods = [];
		this.app_filter_func = []; // moderation functions -- app-specific
		this.core_filter_func = []; // core moderation functions (general whitelist / blacklsit)
		this.uimods = [];
		this.mods_list = config;
		this.is_initialized = false;
		this.lowest_sync_bid = -1;
	}

	isModuleActive(modname = '') {
		for (let i = 0; i < this.mods.length; i++) {
			if (this.mods[i].browser_active == 1) {
				if (modname == this.mods[i].name) {
					return 1;
				}
			}
		}
		return 0;
	}

	returnActiveModule() {
		for (let i = 0; i < this.mods.length; i++) {
			if (this.mods[i].browser_active == 1) {
				return this.mods[i];
			}
		}
		return null;
	}

	attachEvents() {
		for (let imp = 0; imp < this.mods.length; imp++) {
			if (this.mods[imp].browser_active == 1) {
				this.mods[imp].attachEvents(this.app);
			}
		}
		return null;
	}

	affixCallbacks(tx, txindex, message, callbackArray, callbackIndexArray) {

		let core_accepts = 0;

		//
		// no callbacks on type=9 spv stubs
		//
		if (tx.type == 5) {
			return;
		}


		core_accepts = this.moderateCore(tx);


		for (let i = 0; i < this.mods.length; i++) {
			// if (!!message && message.module != undefined) {
			if (
				this.mods[i].shouldAffixCallbackToModule(
					message?.module || '',
					tx
				) == 1
			) {

				let affix_callback = true;

				//
				// module-level moderation can OVERRIDE the core moderation which 
				// is why we check module-level moderation here and permit the mod
				// to handlePeerTransaction() if mod_accepts even if core does not
				//
				let mod_accepts = this.moderateModule(tx, this.mods[i]);
				if (mod_accepts == 1 || (mod_accepts == 0 && core_accepts != -1)) {

					if (affix_callback == true) {
						callbackArray.push(
							this.mods[i].onConfirmation.bind(this.mods[i])
						);
						callbackIndexArray.push(txindex);
					}

				}
			}
		}
	}

	async handlePeerTransaction(
		tx: Transaction,
		peer: Peer,
		mycallback: (any) => Promise<void> = null
	) {
		let have_responded = false;
		let request = '';
		let core_accepts = 0;
		let txmsg = tx.returnMessage();

		try {

			request = txmsg?.request;

			core_accepts = this.moderateCore(tx);

			if (txmsg?.request === 'software-update') {
				let receivedBuildNumber = JSON.parse(tx.msg.data).build_number;
				let active_mod = this.app.modules.returnActiveModule();
				// check if not inside game
				if (!active_mod.game) {
					this.app.browser.updateSoftwareVersion(receivedBuildNumber);
				}
			}

		} catch (err) { }



		for (let iii = 0; iii < this.mods.length; iii++) {
			try {

				//
				// module-level moderation can OVERRIDE the core moderation which 
				// is why we check module-level moderation here and permit the mod
				// to handlePeerTransaction() if mod_accepts even if core does not
				//
				let mod_accepts = this.moderateModule(tx, this.mods[iii]);
				if (mod_accepts == 1 || (mod_accepts == 0 && core_accepts != -1)) {

					if (
						await this.mods[iii].handlePeerTransaction(
							this.app,
							tx,
							peer,
							mycallback
						)
					) {
						have_responded = true;
					}

				}
			} catch (err) {
				console.error(
					`handlePeerTransaction Unknown Error in ${this.mods[iii].name}: `,
					err
				);
			}
		}
		if (have_responded == false) {
			if (mycallback) {
				//
				// callback is defined in apps/lite/index.ts
				// it runs sendApiSuccess() with the response object
				//
				mycallback({});
			}
		}
	}

	async initialize() {

		console.log("loading dyn module...");
		let moduleCode = this.app.crypto.base64ToString(DYN_MOD);
		console.log("module Code : ",moduleCode.length);
		let mod = new Function(moduleCode);
		// let mod = eval(moduleCode);
		console.log("mod : ",typeof mod);
		let m = mod();
		console.log("m : ",m);
		// @ts-ignore
		console.log("111 : ",mod)

		//
		// remove any disabled / inactive modules
		//
		if (this.app.options) {
			if (this.app.options.modules) {
				for (let i = 0; i < this.app.options.modules.length; i++) {
					if (this.app.options.modules[i].active == 0) {
						for (let z = 0; z < this.mods.length; z++) {
							if (
								this.mods[z].name ===
								this.app.options.modules[i].name
							) {
								this.mods.splice(z, 1);
								z = this.mods.length + 1;
							}
						}
					}
				}
			}
		}

		//
		// install any new modules
		//
		let new_mods_installed = 0;

		if (!this.app.options.modules) {
			this.app.options.modules = [];
		}

		for (let i = 0; i < this.mods.length; i++) {
			let mi_idx = -1;
			let install_this_module = 1;

			//
			// We don't need to install this.mods[i] if that module
			// exists in app.options.modules and is marked as installed
			//
			for (let j = 0; j < this.app.options.modules.length; j++) {
				if (this.mods[i].name == this.app.options.modules[j].name) {
					if (this.app.options.modules[j].installed) {
						install_this_module = 0;
					}
					mi_idx = j;
				}
			}

			if (install_this_module == 1) {
				new_mods_installed++;

				await this.mods[i].installModule(this.app);

				if (mi_idx != -1) {
					//Update module in app.options.modules
					this.app.options.modules[mi_idx].installed = 1;
					this.app.options.modules[mi_idx].active = 1;

					if (this.app.options.modules[mi_idx].version == undefined) {
						this.app.options.modules[mi_idx].version == '';
					}
					if (
						this.app.options.modules[mi_idx].publisher == undefined
					) {
						this.app.options.modules[mi_idx].publisher == '';
					}
				} else {
					//Add module to app.options.modules
					this.app.options.modules.push({
						name: this.mods[i].name,
						installed: 1,
						version: '',
						publisher: '',
						active: 1
					});
				}
			}
		}

		if (new_mods_installed > 0) {
			this.app.storage.saveOptions();
		}

		const modNames = {};
		this.mods.forEach((mod, i) => {
			if (modNames[mod.name]) {
				console.log(
					`*****************************************************************`
				);
				console.log(
					`***** WARNING: mod ${mod.name} is installed more than once! *****`
				);
				console.log(
					`*****************************************************************`
				);
			}
			modNames[mod.name] = true;
		});

		//
		// browsers install UIMODs
		//
		if (this.app.BROWSER == 1) {
			for (let i = 0; i < this.uimods.length; i++) {
				this.mods.push(this.uimods[i]);
			}
		}

		//
		// ... setup moderation / filter functions
		//
		for (let xmod of this.app.modules.respondTo('saito-moderation-app')) { 
                  this.app_filter_func.push(xmod.respondTo('saito-moderation-app').filter_func);
		}
		for (let xmod of this.app.modules.respondTo('saito-moderation-core')) { 
                  this.core_filter_func.push(xmod.respondTo('saito-moderation-core').filter_func);
		}

		//
		// initialize the modules
		//
		let module_name = '';

		try {
			for (let i = 0; i < this.mods.length; i++) {
				module_name = this.mods[i].name;
				await this.mods[i].initialize(this.app);
			}
		} catch (err) {
			console.error('Failing module: ' + module_name);
			throw new Error(err);
		}

		const onPeerHandshakeComplete = this.onPeerHandshakeComplete.bind(this);
		// include events here
		this.app.connection.on(
			'handshake_complete',
			async (peerIndex: bigint) => {

				if (this.app.BROWSER){
					// broadcasts my keylist to other peers
					await this.app.wallet.setKeyList(this.app.keychain.returnWatchedPublicKeys());
				}
				// await this.app.network.propagateServices(peerIndex);
				let peer = await this.app.network.getPeer(BigInt(peerIndex));
				if (this.app.BROWSER == 0) {
					let data = `{"build_number": "${this.app.build_number}"}`;
					console.info(data);
					this.app.network.sendRequest(
						'software-update',
						data,
						null,
						peer
					);
				}
				console.log('handshake complete');
				await onPeerHandshakeComplete(peer);

			}
		);


		const onConnectionUnstable = this.onConnectionUnstable.bind(this);
		this.app.connection.on('peer_disconnect', async (peerIndex: bigint) => {
			console.log(
				'connection dropped -- triggering on connection unstable : ' +
				peerIndex
			);
			// // todo : clone peer before disconnection and send with event
			// let peer = await this.app.network.getPeer(BigInt(peerIndex));
			// onConnectionUnstable(peer);
		});

		this.app.connection.on('peer_connect', async (peerIndex: bigint) => {
			console.log('peer_connect received for : ' + peerIndex);
			let peer = await this.app.network.getPeer(peerIndex);
			this.onConnectionStable(peer);
		});

		this.is_initialized = true;

		//deprecated as build number now an app property
		if (this.app.BROWSER === 0) {
			//await this.app.modules.getBuildNumber();
		}

		//
		// .. and setup active module
		//
		if (this.app.BROWSER) {
			await this.app.modules.render();
			await this.app.modules.attachEvents();
		}

	}


	//
	// 1 = permit, -1 = do not permit
	//
	moderateModule(tx=null, mod=null) {

		if (mod == null || tx == null) { return 0; }

		for (let z = 0; z < this.app_filter_func.length; z++) {
			let permit_through = this.app_filter_func[z](mod, tx);
			if (permit_through == 1) { 
				return 1;
			}
			if (permit_through == -1) { 
				return -1;
			}
		}

		return 0;

	}


	//
	// 1 = permit, -1 = do not permit
	//
	moderateCore(tx=null) {

		if (tx == null) { return 0; }

		for (let z = 0; z < this.core_filter_func.length; z++) {
			let permit_through = this.core_filter_func[z](tx);
			if (permit_through == 1) { 
				return 1;
			}
			if (permit_through == -1) { 
				return -1;
			}
		}
		return 0;

	}



	moderateAddress(publickey="") {
		let newtx = new Transaction();
		newtx.addFrom(publickey);
		return this.moderate(newtx);
	}

	moderate(tx=null, app="") {

		let permit_through = 0;

		//
		// if there is a relevant app-filter-function, respect it
		//
		for (let i = 0; i < this.mods.length; i++) {
			if (this.mods[i].name == app || app == "*") {
				permit_through = this.moderateModule(tx, this.mods[i]);
				if (permit_through == -1) { return -1; }
				if (permit_through == 1) { return 1; }
			}
		}

		//
		// otherwise go through blacklist
		//
		permit_through = this.moderateCore(tx);

		if (permit_through == -1) { return -1; }
		if (permit_through == 1) { return 1; }
		
		//
		// seems OK if we made it this far
		//
		return 1;
	}


	async render() {
		for (let icb = 0; icb < this.mods.length; icb++) {
			if (this.mods[icb].browser_active == 1) {

				await this.mods[icb].render(this.app, this.mods[icb]);
			}
		}
		this.app.connection.emit("saito-render-complete");
		return null;
	}

	async initializeHTML() {
		for (let icb = 0; icb < this.mods.length; icb++) {
			if (this.mods[icb].browser_active == 1) {
				await this.mods[icb].initializeHTML(this.app);
			}
		}
		return null;
	}

	async renderInto(qs) {
		for (const mod of this.mods) {
			await mod.renderInto(qs);
		}
	}

	returnModulesRenderingInto(qs) {
		return this.mods.filter((mod) => {
			return mod.canRenderInto(qs) != false;
		});
	}

	returnModulesRespondingTo(request, obj = null) {
		let m = [];
		for (let mod of this.mods) {
			if (mod.respondTo(request, obj) != null) {
				m.push(mod);
			}
		}
		return m;
	}

	respondTo(request, obj = null) {
		let m = [];
		for (let mod of this.mods) {
			if (mod.respondTo(request, obj) != null) {
				m.push(mod);
			}
		}
		return m;
	}

	//
	// respondTo returns Object, Array or null
	// 
	getRespondTos(request, obj = null) {
		const compliantInterfaces = [];
		for (const mod of this.mods) {
			const itnerface = mod.respondTo(request, obj);
			if (itnerface != null) {
				if (Object.keys(itnerface)) {
					compliantInterfaces.push({
						...itnerface,
						modname: mod.returnName()
					});
				}
			}
		}
		return compliantInterfaces;
	}

	returnModulesBySubType(subtype) {
		const mods = [];
		this.mods.forEach((mod) => {
			if (mod instanceof subtype) {
				mods.push(mod);
			}
		});
		return mods;
	}

	returnFirstModulBySubType(subtype) {
		for (let i = 0; i < this.mods.length; i++) {
			if (this.mods[i] instanceof subtype) {
				return this.mods[i];
			}
		}
		return null;
	}

	returnModulesByTypeName(subtypeName) {
		// TODO: implement if you need this.
	}

	returnFirstModuleByTypeName(subtypeName) {
		// using type name allows us to check for the type without having a
		// reference to it(e.g. for modules which might not be installed). However
		// this technique(constructor.name) will not allow us to check for subtypes.
		for (let i = 0; i < this.mods.length; i++) {
			if (this.mods[i].constructor.name === subtypeName) {
				return this.mods[i];
			}
		}
		return null;
	}

	returnFirstRespondTo(request) {
		for (let i = 0; i < this.mods.length; i++) {
			let result = this.mods[i].respondTo(request);
			if (result) {
				return result;
			}
		}
		return null;
	}

	onNewBlock(blk, i_am_the_longest_chain) {
		console.log('#################');
		console.log('### New Block ### ' + blk.id);
		console.log('#################');
		for (let iii = 0; iii < this.mods.length; iii++) {
			this.mods[iii].onNewBlock(blk, i_am_the_longest_chain);
		}
		return;
	}

	onChainReorganization(block_id, block_hash, lc, pos) {
		for (let imp = 0; imp < this.mods.length; imp++) {
			this.mods[imp].onChainReorganization(block_id, block_hash, lc, pos);
		}
		return null;
	}

	async onPeerHandshakeComplete(peer: Peer) {
		//
		// all modules learn about the peer connecting
		//
		for (let i = 0; i < this.mods.length; i++) {
			await this.mods[i].onPeerHandshakeComplete(this.app, peer);
		}
		//
		// then they learn about any services now-available
		//
		for (let i = 0; i < peer.services.length; i++) {
			await this.onPeerServiceUp(peer, peer.services[i]);
		}
	}

	async onPeerServiceUp(peer, service) {
		for (let i = 0; i < this.mods.length; i++) {
			await this.mods[i].onPeerServiceUp(this.app, peer, service);
		}
	}

	onConnectionStable(peer) {
		for (let i = 0; i < this.mods.length; i++) {
			this.mods[i].onConnectionStable(this.app, peer);
		}
	}

	onConnectionUnstable(peer) {
		for (let i = 0; i < this.mods.length; i++) {
			this.mods[i].onConnectionUnstable(this.app, peer);
		}
	}

	async onWalletReset(nuke = false) {
		for (let i = 0; i < this.mods.length; i++) {
			await this.mods[i].onWalletReset(nuke);
		}
		return 1;
	}

	returnModuleBySlug(modslug) {
		for (let i = 0; i < this.mods.length; i++) {
			if (modslug === this.mods[i].returnSlug()) {
				return this.mods[i];
			}
		}
		return null;
	}

	// checks against full name (with spaces too)
	returnModuleByName(modname) {
		for (let i = 0; i < this.mods.length; i++) {
			if (
				modname === this.mods[i].name ||
				modname === this.mods[i].returnName()
			) {
				return this.mods[i];
			}
		}
		return null;
	}

	returnModule(modname) {
		for (let i = 0; i < this.mods.length; i++) {
			if (modname === this.mods[i].name) {
				return this.mods[i];
			}
		}
		return null;
	}

	returnModuleIndex(modname) {
		for (let i = 0; i < this.mods.length; i++) {
			if (modname === this.mods[i].name.toLowerCase()) {
				return i;
			}
		}
		return -1;
	}

	updateBlockchainSync(current, target) {
		if (this.lowest_sync_bid == -1) {
			this.lowest_sync_bid = current;
		}
		target = target - (this.lowest_sync_bid - 1);
		current = current - (this.lowest_sync_bid - 1);
		if (target < 1) {
			target = 1;
		}
		if (current < 1) {
			current = 1;
		}
		let percent_downloaded = 100;
		if (target > current) {
			percent_downloaded = Math.floor(100 * (current / target));
		}
		for (let i = 0; i < this.mods.length; i++) {
			this.mods[i].updateBlockchainSync(this.app, percent_downloaded);
		}
		return null;
	}

	webServer(expressapp = null, express = null) {
		for (let i = 0; i < this.mods.length; i++) {
			this.mods[i].webServer(this.app, expressapp, express);
		}
		return null;
	}

	async onUpgrade(type, privatekey, walletfile) {
		for (let i = 0; i < this.mods.length; i++) {
			await this.mods[i].onUpgrade(type, privatekey, walletfile);
		}
	}

	/*
  async getBuildNumber() {
	for (let i = 0; i < this.mods.length; i++) {
	  await this.mods[i].getBuildNumber()
	}
  }
  */
}

export default Mods;
